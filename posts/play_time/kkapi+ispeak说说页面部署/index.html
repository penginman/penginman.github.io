<!doctype html><html lang=en><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>KKapi+ISpeak说说页面部署 | </title><link rel=canonical href=/posts/play_time/kkapi+ispeak%E8%AF%B4%E8%AF%B4%E9%A1%B5%E9%9D%A2%E9%83%A8%E7%BD%B2/><meta name=description content="为世界上所有的美好而战"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="/posts/play_time/kkapi+ispeak%E8%AF%B4%E8%AF%B4%E9%A1%B5%E9%9D%A2%E9%83%A8%E7%BD%B2/"><meta property="og:title" content="KKapi+ISpeak说说页面部署"><meta property="og:description" content="前言 感觉原来的 Artitalk 说说不好康，在开往里发现好多博客都用的说说功能叫叨叨点啥，看了看作者的说说页面，可以插入图片和标签分类，还有仅自己可见的功能，感觉挺不错的（实际是自己想折腾）所以就整一个。自己在部署过程中实在是踩了不少的坑，而且作者的文档感觉写的也不算完善，所以打算自己记录一下。
项目结构 作者的文档中各种仓库链接属实给我跳晕了，最后理出来的项目分为以下部分：
kkapi。是作为说说的后端部分，连接 MongoDB 数据库，还有一个kkadmin的管理页面 ISpeak。说说的主体部分，依赖于后端的 kkapi ，分为前端的展示页面，和一个对接后端的发布说说页面。 作者文档中给出很多部署方法，白嫖版的就是 vercel 后端 api + 管理界面 + MongoDB 提供的云服务，但是个人感觉 vercel 经常被墙，所以部署的 api 感觉也不会稳定，而且考虑到数据的存放问题，所以我选择的是都部署到自己服务器上。
后端部署 Docker 安装 Mongodb 安装可以参考菜鸟教程的 Docker 安装 MongoDB 。因为之前听过 MongoDB 的未授权访问，所以考虑到安全性问题，创建容器的时候添加 MONGO_INITDB_ROOT_USERNAME 和 MONGO_INITDB_ROOT_PASSWORD 设置用户的账号密码，开启Docker MongoDB 的身份验证。考虑到数据未来的迁移可以通过 -v 挂载宿主机的一个目录。可以修改默认端口再减少一些风险。最后我启动的命令如下
docker run -d --name mongodb \ -p xxxxx:27017 \ -v /my/own/datadir:/data/db \ -e MONGO_INITDB_ROOT_USERNAME=mongoadmin \ -e MONGO_INITDB_ROOT_PASSWORD=secret \ --restart=always mongo 之后可以使用工具测试一下连接。
kkapi 部署 和项目文档中的教程差不多，要注意使用的 node 版本请高于 16.0.0"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-04T00:00:00+00:00"><meta property="article:modified_time" content="2022-10-16T00:00:00+00:00"><meta property="article:tag" content="说说"><meta name=twitter:card content="summary"><meta name=twitter:title content="KKapi+ISpeak说说页面部署"><meta name=twitter:description content="前言 感觉原来的 Artitalk 说说不好康，在开往里发现好多博客都用的说说功能叫叨叨点啥，看了看作者的说说页面，可以插入图片和标签分类，还有仅自己可见的功能，感觉挺不错的（实际是自己想折腾）所以就整一个。自己在部署过程中实在是踩了不少的坑，而且作者的文档感觉写的也不算完善，所以打算自己记录一下。
项目结构 作者的文档中各种仓库链接属实给我跳晕了，最后理出来的项目分为以下部分：
kkapi。是作为说说的后端部分，连接 MongoDB 数据库，还有一个kkadmin的管理页面 ISpeak。说说的主体部分，依赖于后端的 kkapi ，分为前端的展示页面，和一个对接后端的发布说说页面。 作者文档中给出很多部署方法，白嫖版的就是 vercel 后端 api + 管理界面 + MongoDB 提供的云服务，但是个人感觉 vercel 经常被墙，所以部署的 api 感觉也不会稳定，而且考虑到数据的存放问题，所以我选择的是都部署到自己服务器上。
后端部署 Docker 安装 Mongodb 安装可以参考菜鸟教程的 Docker 安装 MongoDB 。因为之前听过 MongoDB 的未授权访问，所以考虑到安全性问题，创建容器的时候添加 MONGO_INITDB_ROOT_USERNAME 和 MONGO_INITDB_ROOT_PASSWORD 设置用户的账号密码，开启Docker MongoDB 的身份验证。考虑到数据未来的迁移可以通过 -v 挂载宿主机的一个目录。可以修改默认端口再减少一些风险。最后我启动的命令如下
docker run -d --name mongodb \ -p xxxxx:27017 \ -v /my/own/datadir:/data/db \ -e MONGO_INITDB_ROOT_USERNAME=mongoadmin \ -e MONGO_INITDB_ROOT_PASSWORD=secret \ --restart=always mongo 之后可以使用工具测试一下连接。
kkapi 部署 和项目文档中的教程差不多，要注意使用的 node 版本请高于 16.0.0"><link rel=stylesheet href=/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/friends>Friends</a></li><li><a href>开往</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=/friends/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=/posts/play_time/zut-%E4%BD%BF%E7%94%A8%E8%B7%AF%E7%94%B1%E5%99%A8%E8%BF%9E%E6%8E%A5%E6%A0%A1%E5%9B%AD%E7%BD%91/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&text=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&title=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&is_video=false&description=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2&body=Check out this article: %2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&title=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&title=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&name=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2&description=%3ch2%20id%3d%22%e5%89%8d%e8%a8%80%22%3e%e5%89%8d%e8%a8%80%3c%2fh2%3e%0a%3cp%3e%e6%84%9f%e8%a7%89%e5%8e%9f%e6%9d%a5%e7%9a%84%20Artitalk%20%e8%af%b4%e8%af%b4%e4%b8%8d%e5%a5%bd%e5%ba%b7%ef%bc%8c%e5%9c%a8%e5%bc%80%e5%be%80%e9%87%8c%e5%8f%91%e7%8e%b0%e5%a5%bd%e5%a4%9a%e5%8d%9a%e5%ae%a2%e9%83%bd%e7%94%a8%e7%9a%84%e8%af%b4%e8%af%b4%e5%8a%9f%e8%83%bd%e5%8f%ab%e5%8f%a8%e5%8f%a8%e7%82%b9%e5%95%a5%ef%bc%8c%e7%9c%8b%e4%ba%86%e7%9c%8b%e4%bd%9c%e8%80%85%e7%9a%84%3ca%20href%3d%22https%3a%2f%2fwww.antmoe.com%2fspeak%2f%22%3e%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%3c%2fa%3e%ef%bc%8c%e5%8f%af%e4%bb%a5%e6%8f%92%e5%85%a5%e5%9b%be%e7%89%87%e5%92%8c%e6%a0%87%e7%ad%be%e5%88%86%e7%b1%bb%ef%bc%8c%e8%bf%98%e6%9c%89%e4%bb%85%e8%87%aa%e5%b7%b1%e5%8f%af%e8%a7%81%e7%9a%84%e5%8a%9f%e8%83%bd%ef%bc%8c%e6%84%9f%e8%a7%89%e6%8c%ba%e4%b8%8d%e9%94%99%e7%9a%84%ef%bc%88%e5%ae%9e%e9%99%85%e6%98%af%e8%87%aa%e5%b7%b1%e6%83%b3%e6%8a%98%e8%85%be%ef%bc%89%e6%89%80%e4%bb%a5%e5%b0%b1%e6%95%b4%e4%b8%80%e4%b8%aa%e3%80%82%e8%87%aa%e5%b7%b1%e5%9c%a8%e9%83%a8%e7%bd%b2%e8%bf%87%e7%a8%8b%e4%b8%ad%e5%ae%9e%e5%9c%a8%e6%98%af%e8%b8%a9%e4%ba%86%e4%b8%8d%e5%b0%91%e7%9a%84%e5%9d%91%ef%bc%8c%e8%80%8c%e4%b8%94%e4%bd%9c%e8%80%85%e7%9a%84%e6%96%87%e6%a1%a3%e6%84%9f%e8%a7%89%e5%86%99%e7%9a%84%e4%b9%9f%e4%b8%8d%e7%ae%97%e5%ae%8c%e5%96%84%ef%bc%8c%e6%89%80%e4%bb%a5%e6%89%93%e7%ae%97%e8%87%aa%e5%b7%b1%e8%ae%b0%e5%bd%95%e4%b8%80%e4%b8%8b%e3%80%82%3c%2fp%3e%0a%3ch2%20id%3d%22%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84%22%3e%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84%3c%2fh2%3e%0a%3cp%3e%e4%bd%9c%e8%80%85%e7%9a%84%e6%96%87%e6%a1%a3%e4%b8%ad%e5%90%84%e7%a7%8d%e4%bb%93%e5%ba%93%e9%93%be%e6%8e%a5%e5%b1%9e%e5%ae%9e%e7%bb%99%e6%88%91%e8%b7%b3%e6%99%95%e4%ba%86%ef%bc%8c%e6%9c%80%e5%90%8e%e7%90%86%e5%87%ba%e6%9d%a5%e7%9a%84%e9%a1%b9%e7%9b%ae%e5%88%86%e4%b8%ba%e4%bb%a5%e4%b8%8b%e9%83%a8%e5%88%86%ef%bc%9a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3e%3ccode%3ekkapi%3c%2fcode%3e%e3%80%82%e6%98%af%e4%bd%9c%e4%b8%ba%e8%af%b4%e8%af%b4%e7%9a%84%e5%90%8e%e7%ab%af%e9%83%a8%e5%88%86%ef%bc%8c%e8%bf%9e%e6%8e%a5%20MongoDB%20%e6%95%b0%e6%8d%ae%e5%ba%93%ef%bc%8c%e8%bf%98%e6%9c%89%e4%b8%80%e4%b8%aa%3ccode%3ekkadmin%3c%2fcode%3e%e7%9a%84%e7%ae%a1%e7%90%86%e9%a1%b5%e9%9d%a2%3c%2fli%3e%0a%3cli%3e%3ccode%3eISpeak%3c%2fcode%3e%e3%80%82%e8%af%b4%e8%af%b4%e7%9a%84%e4%b8%bb%e4%bd%93%e9%83%a8%e5%88%86%ef%bc%8c%e4%be%9d%e8%b5%96%e4%ba%8e%e5%90%8e%e7%ab%af%e7%9a%84%20%3ccode%3ekkapi%3c%2fcode%3e%20%ef%bc%8c%e5%88%86%e4%b8%ba%e5%89%8d%e7%ab%af%e7%9a%84%e5%b1%95%e7%a4%ba%e9%a1%b5%e9%9d%a2%ef%bc%8c%e5%92%8c%e4%b8%80%e4%b8%aa%e5%af%b9%e6%8e%a5%e5%90%8e%e7%ab%af%e7%9a%84%e5%8f%91%e5%b8%83%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e3%80%82%3c%2fli%3e%0a%3c%2ful%3e%0a%3cp%3e%e4%bd%9c%e8%80%85%e6%96%87%e6%a1%a3%e4%b8%ad%e7%bb%99%e5%87%ba%e5%be%88%e5%a4%9a%e9%83%a8%e7%bd%b2%e6%96%b9%e6%b3%95%ef%bc%8c%e7%99%bd%e5%ab%96%e7%89%88%e7%9a%84%e5%b0%b1%e6%98%af%20vercel%20%e5%90%8e%e7%ab%af%20api%20%2b%20%e7%ae%a1%e7%90%86%e7%95%8c%e9%9d%a2%20%2b%20MongoDB%20%e6%8f%90%e4%be%9b%e7%9a%84%e4%ba%91%e6%9c%8d%e5%8a%a1%ef%bc%8c%e4%bd%86%e6%98%af%e4%b8%aa%e4%ba%ba%e6%84%9f%e8%a7%89%20vercel%20%e7%bb%8f%e5%b8%b8%e8%a2%ab%e5%a2%99%ef%bc%8c%e6%89%80%e4%bb%a5%e9%83%a8%e7%bd%b2%e7%9a%84%20api%20%e6%84%9f%e8%a7%89%e4%b9%9f%e4%b8%8d%e4%bc%9a%e7%a8%b3%e5%ae%9a%ef%bc%8c%e8%80%8c%e4%b8%94%e8%80%83%e8%99%91%e5%88%b0%e6%95%b0%e6%8d%ae%e7%9a%84%e5%ad%98%e6%94%be%e9%97%ae%e9%a2%98%ef%bc%8c%e6%89%80%e4%bb%a5%e6%88%91%e9%80%89%e6%8b%a9%e7%9a%84%e6%98%af%e9%83%bd%e9%83%a8%e7%bd%b2%e5%88%b0%e8%87%aa%e5%b7%b1%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%e3%80%82%3c%2fp%3e%0a%3ch2%20id%3d%22%e5%90%8e%e7%ab%af%e9%83%a8%e7%bd%b2%22%3e%e5%90%8e%e7%ab%af%e9%83%a8%e7%bd%b2%3c%2fh2%3e%0a%3ch3%20id%3d%22docker-%e5%ae%89%e8%a3%85-mongodb%22%3eDocker%20%e5%ae%89%e8%a3%85%20Mongodb%3c%2fh3%3e%0a%3cp%3e%e5%ae%89%e8%a3%85%e5%8f%af%e4%bb%a5%e5%8f%82%e8%80%83%e8%8f%9c%e9%b8%9f%e6%95%99%e7%a8%8b%e7%9a%84%20%3ca%20href%3d%22https%3a%2f%2fwww.runoob.com%2fdocker%2fdocker-install-mongodb.html%22%3eDocker%20%e5%ae%89%e8%a3%85%20MongoDB%3c%2fa%3e%20%e3%80%82%e5%9b%a0%e4%b8%ba%e4%b9%8b%e5%89%8d%e5%90%ac%e8%bf%87%20MongoDB%20%e7%9a%84%e6%9c%aa%e6%8e%88%e6%9d%83%e8%ae%bf%e9%97%ae%ef%bc%8c%e6%89%80%e4%bb%a5%e8%80%83%e8%99%91%e5%88%b0%e5%ae%89%e5%85%a8%e6%80%a7%e9%97%ae%e9%a2%98%ef%bc%8c%e5%88%9b%e5%bb%ba%e5%ae%b9%e5%99%a8%e7%9a%84%e6%97%b6%e5%80%99%e6%b7%bb%e5%8a%a0%20%3ccode%3eMONGO_INITDB_ROOT_USERNAME%3c%2fcode%3e%20%e5%92%8c%20%3ccode%3eMONGO_INITDB_ROOT_PASSWORD%3c%2fcode%3e%20%e8%ae%be%e7%bd%ae%e7%94%a8%e6%88%b7%e7%9a%84%e8%b4%a6%e5%8f%b7%e5%af%86%e7%a0%81%ef%bc%8c%e5%bc%80%e5%90%afDocker%20MongoDB%20%e7%9a%84%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%e3%80%82%e8%80%83%e8%99%91%e5%88%b0%e6%95%b0%e6%8d%ae%e6%9c%aa%e6%9d%a5%e7%9a%84%e8%bf%81%e7%a7%bb%e5%8f%af%e4%bb%a5%e9%80%9a%e8%bf%87%20%3ccode%3e-v%3c%2fcode%3e%20%e6%8c%82%e8%bd%bd%e5%ae%bf%e4%b8%bb%e6%9c%ba%e7%9a%84%e4%b8%80%e4%b8%aa%e7%9b%ae%e5%bd%95%e3%80%82%e5%8f%af%e4%bb%a5%e4%bf%ae%e6%94%b9%e9%bb%98%e8%ae%a4%e7%ab%af%e5%8f%a3%e5%86%8d%e5%87%8f%e5%b0%91%e4%b8%80%e4%ba%9b%e9%a3%8e%e9%99%a9%e3%80%82%e6%9c%80%e5%90%8e%e6%88%91%e5%90%af%e5%8a%a8%e7%9a%84%e5%91%bd%e4%bb%a4%e5%a6%82%e4%b8%8b%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-shell%22%20data-lang%3d%22shell%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3edocker%20run%20-d%20--name%20mongodb%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09-p%20xxxxx%3a27017%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09-v%20%2fmy%2fown%2fdatadir%3a%2fdata%2fdb%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09-e%20MONGO_INITDB_ROOT_USERNAME%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3emongoadmin%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09-e%20MONGO_INITDB_ROOT_PASSWORD%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3esecret%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09--restart%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3ealways%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09mongo%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%e4%b9%8b%e5%90%8e%e5%8f%af%e4%bb%a5%e4%bd%bf%e7%94%a8%e5%b7%a5%e5%85%b7%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b%e8%bf%9e%e6%8e%a5%e3%80%82%3c%2fp%3e%0a%3ch3%20id%3d%22kkapi-%e9%83%a8%e7%bd%b2%22%3ekkapi%20%e9%83%a8%e7%bd%b2%3c%2fh3%3e%0a%3cp%3e%e5%92%8c%e9%a1%b9%e7%9b%ae%e6%96%87%e6%a1%a3%e4%b8%ad%e7%9a%84%e6%95%99%e7%a8%8b%e5%b7%ae%e4%b8%8d%e5%a4%9a%ef%bc%8c%e8%a6%81%e6%b3%a8%e6%84%8f%e4%bd%bf%e7%94%a8%e7%9a%84%20node%20%e7%89%88%e6%9c%ac%e8%af%b7%e9%ab%98%e4%ba%8e%20%3ccode%3e16.0.0%3c%2fcode%3e%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&t=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#项目结构>项目结构</a></li><li><a href=#后端部署>后端部署</a><ul><li><a href=#docker-安装-mongodb>Docker 安装 Mongodb</a></li><li><a href=#kkapi-部署>kkapi 部署</a></li><li><a href=#kkapiadmin可视化管理后台>kkapiadmin（可视化管理后台）</a></li></ul></li><li><a href=#前端部署>前端部署</a></li><li><a href=#github-登陆验证可选>Github 登陆验证（可选*）</a></li><li><a href=#完工>完工</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">KKapi+ISpeak说说页面部署</h1><div class=meta><div class=postdate><time datetime="2022-10-04 00:00:00 +0000 UTC" itemprop=datePublished>2022-10-04</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/%E7%9E%8E%E6%8A%98%E8%85%BE>瞎折腾</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/%E8%AF%B4%E8%AF%B4 rel=tag>说说</a></div></div></header><div class=content itemprop=articleBody><h2 id=前言>前言</h2><p>感觉原来的 Artitalk 说说不好康，在开往里发现好多博客都用的说说功能叫叨叨点啥，看了看作者的<a href=https://www.antmoe.com/speak/>说说页面</a>，可以插入图片和标签分类，还有仅自己可见的功能，感觉挺不错的（实际是自己想折腾）所以就整一个。自己在部署过程中实在是踩了不少的坑，而且作者的文档感觉写的也不算完善，所以打算自己记录一下。</p><h2 id=项目结构>项目结构</h2><p>作者的文档中各种仓库链接属实给我跳晕了，最后理出来的项目分为以下部分：</p><ul><li><code>kkapi</code>。是作为说说的后端部分，连接 MongoDB 数据库，还有一个<code>kkadmin</code>的管理页面</li><li><code>ISpeak</code>。说说的主体部分，依赖于后端的 <code>kkapi</code> ，分为前端的展示页面，和一个对接后端的发布说说页面。</li></ul><p>作者文档中给出很多部署方法，白嫖版的就是 vercel 后端 api + 管理界面 + MongoDB 提供的云服务，但是个人感觉 vercel 经常被墙，所以部署的 api 感觉也不会稳定，而且考虑到数据的存放问题，所以我选择的是都部署到自己服务器上。</p><h2 id=后端部署>后端部署</h2><h3 id=docker-安装-mongodb>Docker 安装 Mongodb</h3><p>安装可以参考菜鸟教程的 <a href=https://www.runoob.com/docker/docker-install-mongodb.html>Docker 安装 MongoDB</a> 。因为之前听过 MongoDB 的未授权访问，所以考虑到安全性问题，创建容器的时候添加 <code>MONGO_INITDB_ROOT_USERNAME</code> 和 <code>MONGO_INITDB_ROOT_PASSWORD</code> 设置用户的账号密码，开启Docker MongoDB 的身份验证。考虑到数据未来的迁移可以通过 <code>-v</code> 挂载宿主机的一个目录。可以修改默认端口再减少一些风险。最后我启动的命令如下</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>docker run -d --name mongodb <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-p xxxxx:27017 <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-v /my/own/datadir:/data/db <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-e MONGO_INITDB_ROOT_USERNAME<span style=color:#f92672>=</span>mongoadmin <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	-e MONGO_INITDB_ROOT_PASSWORD<span style=color:#f92672>=</span>secret <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>	--restart<span style=color:#f92672>=</span>always
</span></span><span style=display:flex><span>	mongo
</span></span></code></pre></div><p>之后可以使用工具测试一下连接。</p><h3 id=kkapi-部署>kkapi 部署</h3><p>和项目文档中的教程差不多，要注意使用的 node 版本请高于 <code>16.0.0</code></p><ol><li>首先克隆项目源码
<code>git clone https://ghproxy.com/https://github.com/kkfive/kkapi-open.git</code></li><li>接下来项目需要安装的工具 <code>yarn</code> 和 <code>pm2</code>，分别是
<code>npm i yarn -g</code>
<code>npm i pm2 -g</code></li><li>然后安装项目所需依赖 <code>yarn install</code> 。</li><li>之后再执行 <code>yarn build</code> 编译项目。这里我的小鸡顶不住编译所以自己在本地编译传上去了💧。</li><li>在项目文件夹创建环境变量文件，格式如</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-env data-lang=env><span style=display:flex><span>PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>3000</span>
</span></span><span style=display:flex><span>DATABASE_URL<span style=color:#f92672>=</span>mongodb://127.0.0.1:27017/kkpaiopen?authSource<span style=color:#f92672>=</span>admin
</span></span><span style=display:flex><span>DATABASE_USER<span style=color:#f92672>=</span>mongoadmin
</span></span><span style=display:flex><span>DATABASE_PASSWORD<span style=color:#f92672>=</span>secret
</span></span><span style=display:flex><span><span style=color:#75715e># 加密密钥 测试</span>
</span></span><span style=display:flex><span>SECRETKEY<span style=color:#f92672>=</span>xxxxxxxxxxxxxxx
</span></span></code></pre></div><p>这里的数据库连接地址我原来还想使用MongoDB提供的免费云服务当数据库，但是没搞成功，所以最后使用了本地的 MongoDB，有大佬知道的可以指点一下。</p><ol start=6><li>使用 <code>pm2</code> 使用守护线程启动项目
<code>pm2 start pm2.json</code></li></ol><p>我启动项目遇到了 <code>[PM2][WARN] Expect “restart_delay” to be a typeof [object Number], but now is [object String]</code> 错误，这个错误原因是作者的 pm2.json 中的 <code>restart_delay</code> 值是字符串类型 <code>60s</code> 改成数值 <code>60</code> 就可以了。</p><ol start=7><li><p>测试项目是否成功启动
可以使用 <code>lsof -i:端口</code> 查看端口是否被监听判断项目是否成功启动。没成功的原因大概率是因为数据库连接地址、数据库账号密码不正确。</p></li><li><p>创建初始化用户
<code>curl http://127.0.0.1:3000/api/user/init</code>
创建的默认用户名和密码是 <code>admin</code> 和 <code>123456</code>，这个用户名密码用来登陆可视化的管理后台，并且用户似乎<strong>只能拥有一个</strong>。</p></li></ol><h3 id=kkapiadmin可视化管理后台>kkapiadmin（可视化管理后台）</h3><p>参考<a href=https://kkapi.js.org/guide/admin/setup.html>官方文档</a>中的教程，使用的 Vercel 部署的。这个墙不墙的就无所谓了，注意的坑有：</p><ul><li>修改部署分支和生产分支为 <code>vercel</code>。</li><li>fork 作者仓库的时候记得把 only fork master 取消勾选。</li></ul><p>之后登录就是用前面初始化的用户名密码，进入后台以后可以修改密码。登陆后台以后需要设置：</p><ul><li>ISpeak 标签。因为发布说说是需要选择标签的，标签中的背景颜色值是<strong>十六进制的颜色</strong>代码</li><li>添加用户token。<strong>需要注意！！！</strong>，添加的token的<strong>标题</strong>只能是 <code>speak</code> 不能是其他的，否则发布说说时会提示token不存在，发布时验证的就是字段为 <code>speak</code> 的token的值。</li></ul><p><img src=https://img.braindance.top/article/2022/10/04/c5191febc049fbed86f5b77df8367c89.png alt></p><p>接下来可以在前端说说页面测试发布说说，发布说说需要输入后端 kkapi 地址、用户id （在管理后台可以找到）、token。网址：https://ispeak-biubiu.vercel.app/</p><p><img src=https://img.braindance.top/article/2022/10/04/778dcc5fe051722e4f9a919b7a9e2a61.png alt></p><p><img src=https://img.braindance.top/article/2022/10/04/491fff2969d731ff17d8799fe6a20d14.png alt></p><p>发布成功可以在后端看到发布的说说。</p><h2 id=前端部署>前端部署</h2><p>我使用的是 Ispeak 搭配的 twikoo 评论，因为现在博客使用的就是 twikoo，省去了再部署评论的麻烦。根据<a href=https://kkapi.js.org/posts/ispeak/>ISpeak文档部分</a>，<a href=https://github.com/kkfive/ISpeak/blob/master/src/types/parameter.ts>ispeak 配置项</a>中 <code>comment</code> 是一个回调函数，可以自行初始化评论，参照twikoo评论初始化的格式。我博客中的说说页面代码</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;tip&#34;</span> <span style=color:#a6e22e>style</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text-align:center;&#34;</span>&gt;ipseak加载中&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>div</span> <span style=color:#a6e22e>id</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;ispeak&#34;</span>&gt;&lt;/<span style=color:#f92672>div</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>link</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.staticfile.org/highlight.js/10.6.0/styles/atom-one-dark.min.css&#34;</span>
</span></span><span style=display:flex><span>/&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>link</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.jsdelivr.net/npm/ispeak@4.4.0/style.css&#34;</span>
</span></span><span style=display:flex><span>/&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.staticfile.org/highlight.js/10.6.0/highlight.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.staticfile.org/marked/2.0.0/marked.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.jsdelivr.net/npm/ispeak@4.4.0/ispeak.umd.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span> <span style=color:#a6e22e>src</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;https://cdn.staticfile.org/twikoo/1.6.7/twikoo.all.min.js&#34;</span>&gt;&lt;/<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>&lt;<span style=color:#f92672>script</span>&gt;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>head</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByTagName</span>(<span style=color:#e6db74>&#39;head&#39;</span>)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>meta</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>createElement</span>(<span style=color:#e6db74>&#39;meta&#39;</span>)
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>name</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;referrer&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>content</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;no-referrer&#39;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>head</span>.<span style=color:#a6e22e>appendChild</span>(<span style=color:#a6e22e>meta</span>)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ispeak</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ispeak</span>.<span style=color:#a6e22e>init</span>({
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>el</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;#ispeak&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>api</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;这里是后端kkapi地址&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>author</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;后端用户id&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>pageSize</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>10</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>loading_img</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;https://bu.dusays.com/2021/03/04/d2d5e983e2961.gif&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>comment</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>speak</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>const</span> { <span style=color:#a6e22e>_id</span>, <span style=color:#a6e22e>title</span>, <span style=color:#a6e22e>content</span> } <span style=color:#f92672>=</span> <span style=color:#a6e22e>speak</span>
</span></span><span style=display:flex><span>          <span style=color:#75715e>// 4.4.0 之后在此回调函数中初始化评论
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#75715e>//这里是twikoo的初始化配置，如果使用其他评论可以在这里修改
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>          <span style=color:#a6e22e>twikoo</span>.<span style=color:#a6e22e>init</span>({ 
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>el</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;.ispeak-comment&#39;</span>, <span style=color:#75715e>// 默认情况下 ipseak 生成class为 ispeak-comment 的div
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>path</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;/shuoshuo/?q=&#39;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>_id</span>,
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>envId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;twikoo后端地址&#34;</span>
</span></span><span style=display:flex><span>          })
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>then</span>(<span style=color:#66d9ef>function</span> () {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>&#39;ispeak 加载完成&#39;</span>)
</span></span><span style=display:flex><span>        document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;tip&#39;</span>).<span style=color:#a6e22e>style</span>.<span style=color:#a6e22e>display</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;none&#39;</span>
</span></span><span style=display:flex><span>      })
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;tip&#39;</span>).<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;ipseak依赖加载失败！&#39;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>script</span>&gt;
</span></span></code></pre></div><p>更新一波。被人发现了说说的评论没有独立，自己改了下配置。
上面的代码加入了 32 和 37 行代码，其中 37 行 <code>path</code> 属性设置为你当前的说说页面路径加 <code>q</code> 参数，这个参数可能无所谓吧，但是 <code>_id</code> 是当前说说的唯一 id，因为自己在页面中测试时，说说评论请求的地址格式也是根据 37 行代码这个进行请求查询的。</p><h2 id=github-登陆验证可选>Github 登陆验证（可选*）</h2><p>可以发布仅登陆可见的说说，但是需要配置 Github app。</p><ol><li>参考<a href=https://kkapi.js.org/guide/setup/github.html>项目文档</a>创建 app ，其中填写的 speak 页面路径就是 ISpeak 所在的博客路径</li><li>创建以后拥有了 <code>Client ID</code> 和 <code>Client Secrets</code>，这两项需要填写在 kkapi 后端部署的 <code>local.env</code> 配置中。</li><li>在 kkapi 的后端界面个人设置中填写 <code>GitHubId</code> 。获得方法访问 github 提供的接口
<code>https://api.github.com/users/&lt;Your UserName></code>注意替换尖括号整体为你github的用户名，不是昵称。</li></ol><p><img src=https://file.acs.pw/picGo/2022/03/13/20220313121930.png alt></p><ol start=4><li>在前端页面的 <code>speak</code> 初始化中添加两个属性</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#a6e22e>ispeak</span>.<span style=color:#a6e22e>init</span>({
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span><span style=color:#a6e22e>speakPage</span><span style=color:#960050;background-color:#1e0010>：</span><span style=color:#e6db74>&#34;/shuoshuo/&#34;</span>,  <span style=color:#75715e>//这里是说说的页面路径，对应于 github app 中填写的 speak 页面路径（用双引号括起来，我不知道为啥单引号不行）
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>githubClientId</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;Iv1.*******&#39;</span>,  <span style=color:#75715e>//github app 的 Client ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>...
</span></span><span style=display:flex><span>})
</span></span></code></pre></div><p>然后就可以在你的说说下面找到一个 Github 授权登陆。</p><p><img src=https://img.braindance.top/article/2022/10/04/4aeea0532e5dc44c83a6822033d9971e.png alt></p><h2 id=完工>完工</h2><p>说说还支持 markdown 格式的图片插入，看起来更好用了，给作者点个赞。</p></div></article><div class=blog-post-comments><div id=tcomment></div><script src=https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo.braindance.top/.netlify/functions/twikoo",el:"#tcomment",lang:"zh-CN"})</script></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/friends>Friends</a></li><li><a href>开往</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#项目结构>项目结构</a></li><li><a href=#后端部署>后端部署</a><ul><li><a href=#docker-安装-mongodb>Docker 安装 Mongodb</a></li><li><a href=#kkapi-部署>kkapi 部署</a></li><li><a href=#kkapiadmin可视化管理后台>kkapiadmin（可视化管理后台）</a></li></ul></li><li><a href=#前端部署>前端部署</a></li><li><a href=#github-登陆验证可选>Github 登陆验证（可选*）</a></li><li><a href=#完工>完工</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&text=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&title=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&is_video=false&description=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2&body=Check out this article: %2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&title=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&title=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&name=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2&description=%3ch2%20id%3d%22%e5%89%8d%e8%a8%80%22%3e%e5%89%8d%e8%a8%80%3c%2fh2%3e%0a%3cp%3e%e6%84%9f%e8%a7%89%e5%8e%9f%e6%9d%a5%e7%9a%84%20Artitalk%20%e8%af%b4%e8%af%b4%e4%b8%8d%e5%a5%bd%e5%ba%b7%ef%bc%8c%e5%9c%a8%e5%bc%80%e5%be%80%e9%87%8c%e5%8f%91%e7%8e%b0%e5%a5%bd%e5%a4%9a%e5%8d%9a%e5%ae%a2%e9%83%bd%e7%94%a8%e7%9a%84%e8%af%b4%e8%af%b4%e5%8a%9f%e8%83%bd%e5%8f%ab%e5%8f%a8%e5%8f%a8%e7%82%b9%e5%95%a5%ef%bc%8c%e7%9c%8b%e4%ba%86%e7%9c%8b%e4%bd%9c%e8%80%85%e7%9a%84%3ca%20href%3d%22https%3a%2f%2fwww.antmoe.com%2fspeak%2f%22%3e%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%3c%2fa%3e%ef%bc%8c%e5%8f%af%e4%bb%a5%e6%8f%92%e5%85%a5%e5%9b%be%e7%89%87%e5%92%8c%e6%a0%87%e7%ad%be%e5%88%86%e7%b1%bb%ef%bc%8c%e8%bf%98%e6%9c%89%e4%bb%85%e8%87%aa%e5%b7%b1%e5%8f%af%e8%a7%81%e7%9a%84%e5%8a%9f%e8%83%bd%ef%bc%8c%e6%84%9f%e8%a7%89%e6%8c%ba%e4%b8%8d%e9%94%99%e7%9a%84%ef%bc%88%e5%ae%9e%e9%99%85%e6%98%af%e8%87%aa%e5%b7%b1%e6%83%b3%e6%8a%98%e8%85%be%ef%bc%89%e6%89%80%e4%bb%a5%e5%b0%b1%e6%95%b4%e4%b8%80%e4%b8%aa%e3%80%82%e8%87%aa%e5%b7%b1%e5%9c%a8%e9%83%a8%e7%bd%b2%e8%bf%87%e7%a8%8b%e4%b8%ad%e5%ae%9e%e5%9c%a8%e6%98%af%e8%b8%a9%e4%ba%86%e4%b8%8d%e5%b0%91%e7%9a%84%e5%9d%91%ef%bc%8c%e8%80%8c%e4%b8%94%e4%bd%9c%e8%80%85%e7%9a%84%e6%96%87%e6%a1%a3%e6%84%9f%e8%a7%89%e5%86%99%e7%9a%84%e4%b9%9f%e4%b8%8d%e7%ae%97%e5%ae%8c%e5%96%84%ef%bc%8c%e6%89%80%e4%bb%a5%e6%89%93%e7%ae%97%e8%87%aa%e5%b7%b1%e8%ae%b0%e5%bd%95%e4%b8%80%e4%b8%8b%e3%80%82%3c%2fp%3e%0a%3ch2%20id%3d%22%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84%22%3e%e9%a1%b9%e7%9b%ae%e7%bb%93%e6%9e%84%3c%2fh2%3e%0a%3cp%3e%e4%bd%9c%e8%80%85%e7%9a%84%e6%96%87%e6%a1%a3%e4%b8%ad%e5%90%84%e7%a7%8d%e4%bb%93%e5%ba%93%e9%93%be%e6%8e%a5%e5%b1%9e%e5%ae%9e%e7%bb%99%e6%88%91%e8%b7%b3%e6%99%95%e4%ba%86%ef%bc%8c%e6%9c%80%e5%90%8e%e7%90%86%e5%87%ba%e6%9d%a5%e7%9a%84%e9%a1%b9%e7%9b%ae%e5%88%86%e4%b8%ba%e4%bb%a5%e4%b8%8b%e9%83%a8%e5%88%86%ef%bc%9a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3e%3ccode%3ekkapi%3c%2fcode%3e%e3%80%82%e6%98%af%e4%bd%9c%e4%b8%ba%e8%af%b4%e8%af%b4%e7%9a%84%e5%90%8e%e7%ab%af%e9%83%a8%e5%88%86%ef%bc%8c%e8%bf%9e%e6%8e%a5%20MongoDB%20%e6%95%b0%e6%8d%ae%e5%ba%93%ef%bc%8c%e8%bf%98%e6%9c%89%e4%b8%80%e4%b8%aa%3ccode%3ekkadmin%3c%2fcode%3e%e7%9a%84%e7%ae%a1%e7%90%86%e9%a1%b5%e9%9d%a2%3c%2fli%3e%0a%3cli%3e%3ccode%3eISpeak%3c%2fcode%3e%e3%80%82%e8%af%b4%e8%af%b4%e7%9a%84%e4%b8%bb%e4%bd%93%e9%83%a8%e5%88%86%ef%bc%8c%e4%be%9d%e8%b5%96%e4%ba%8e%e5%90%8e%e7%ab%af%e7%9a%84%20%3ccode%3ekkapi%3c%2fcode%3e%20%ef%bc%8c%e5%88%86%e4%b8%ba%e5%89%8d%e7%ab%af%e7%9a%84%e5%b1%95%e7%a4%ba%e9%a1%b5%e9%9d%a2%ef%bc%8c%e5%92%8c%e4%b8%80%e4%b8%aa%e5%af%b9%e6%8e%a5%e5%90%8e%e7%ab%af%e7%9a%84%e5%8f%91%e5%b8%83%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e3%80%82%3c%2fli%3e%0a%3c%2ful%3e%0a%3cp%3e%e4%bd%9c%e8%80%85%e6%96%87%e6%a1%a3%e4%b8%ad%e7%bb%99%e5%87%ba%e5%be%88%e5%a4%9a%e9%83%a8%e7%bd%b2%e6%96%b9%e6%b3%95%ef%bc%8c%e7%99%bd%e5%ab%96%e7%89%88%e7%9a%84%e5%b0%b1%e6%98%af%20vercel%20%e5%90%8e%e7%ab%af%20api%20%2b%20%e7%ae%a1%e7%90%86%e7%95%8c%e9%9d%a2%20%2b%20MongoDB%20%e6%8f%90%e4%be%9b%e7%9a%84%e4%ba%91%e6%9c%8d%e5%8a%a1%ef%bc%8c%e4%bd%86%e6%98%af%e4%b8%aa%e4%ba%ba%e6%84%9f%e8%a7%89%20vercel%20%e7%bb%8f%e5%b8%b8%e8%a2%ab%e5%a2%99%ef%bc%8c%e6%89%80%e4%bb%a5%e9%83%a8%e7%bd%b2%e7%9a%84%20api%20%e6%84%9f%e8%a7%89%e4%b9%9f%e4%b8%8d%e4%bc%9a%e7%a8%b3%e5%ae%9a%ef%bc%8c%e8%80%8c%e4%b8%94%e8%80%83%e8%99%91%e5%88%b0%e6%95%b0%e6%8d%ae%e7%9a%84%e5%ad%98%e6%94%be%e9%97%ae%e9%a2%98%ef%bc%8c%e6%89%80%e4%bb%a5%e6%88%91%e9%80%89%e6%8b%a9%e7%9a%84%e6%98%af%e9%83%bd%e9%83%a8%e7%bd%b2%e5%88%b0%e8%87%aa%e5%b7%b1%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%e3%80%82%3c%2fp%3e%0a%3ch2%20id%3d%22%e5%90%8e%e7%ab%af%e9%83%a8%e7%bd%b2%22%3e%e5%90%8e%e7%ab%af%e9%83%a8%e7%bd%b2%3c%2fh2%3e%0a%3ch3%20id%3d%22docker-%e5%ae%89%e8%a3%85-mongodb%22%3eDocker%20%e5%ae%89%e8%a3%85%20Mongodb%3c%2fh3%3e%0a%3cp%3e%e5%ae%89%e8%a3%85%e5%8f%af%e4%bb%a5%e5%8f%82%e8%80%83%e8%8f%9c%e9%b8%9f%e6%95%99%e7%a8%8b%e7%9a%84%20%3ca%20href%3d%22https%3a%2f%2fwww.runoob.com%2fdocker%2fdocker-install-mongodb.html%22%3eDocker%20%e5%ae%89%e8%a3%85%20MongoDB%3c%2fa%3e%20%e3%80%82%e5%9b%a0%e4%b8%ba%e4%b9%8b%e5%89%8d%e5%90%ac%e8%bf%87%20MongoDB%20%e7%9a%84%e6%9c%aa%e6%8e%88%e6%9d%83%e8%ae%bf%e9%97%ae%ef%bc%8c%e6%89%80%e4%bb%a5%e8%80%83%e8%99%91%e5%88%b0%e5%ae%89%e5%85%a8%e6%80%a7%e9%97%ae%e9%a2%98%ef%bc%8c%e5%88%9b%e5%bb%ba%e5%ae%b9%e5%99%a8%e7%9a%84%e6%97%b6%e5%80%99%e6%b7%bb%e5%8a%a0%20%3ccode%3eMONGO_INITDB_ROOT_USERNAME%3c%2fcode%3e%20%e5%92%8c%20%3ccode%3eMONGO_INITDB_ROOT_PASSWORD%3c%2fcode%3e%20%e8%ae%be%e7%bd%ae%e7%94%a8%e6%88%b7%e7%9a%84%e8%b4%a6%e5%8f%b7%e5%af%86%e7%a0%81%ef%bc%8c%e5%bc%80%e5%90%afDocker%20MongoDB%20%e7%9a%84%e8%ba%ab%e4%bb%bd%e9%aa%8c%e8%af%81%e3%80%82%e8%80%83%e8%99%91%e5%88%b0%e6%95%b0%e6%8d%ae%e6%9c%aa%e6%9d%a5%e7%9a%84%e8%bf%81%e7%a7%bb%e5%8f%af%e4%bb%a5%e9%80%9a%e8%bf%87%20%3ccode%3e-v%3c%2fcode%3e%20%e6%8c%82%e8%bd%bd%e5%ae%bf%e4%b8%bb%e6%9c%ba%e7%9a%84%e4%b8%80%e4%b8%aa%e7%9b%ae%e5%bd%95%e3%80%82%e5%8f%af%e4%bb%a5%e4%bf%ae%e6%94%b9%e9%bb%98%e8%ae%a4%e7%ab%af%e5%8f%a3%e5%86%8d%e5%87%8f%e5%b0%91%e4%b8%80%e4%ba%9b%e9%a3%8e%e9%99%a9%e3%80%82%e6%9c%80%e5%90%8e%e6%88%91%e5%90%af%e5%8a%a8%e7%9a%84%e5%91%bd%e4%bb%a4%e5%a6%82%e4%b8%8b%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-shell%22%20data-lang%3d%22shell%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3edocker%20run%20-d%20--name%20mongodb%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09-p%20xxxxx%3a27017%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09-v%20%2fmy%2fown%2fdatadir%3a%2fdata%2fdb%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09-e%20MONGO_INITDB_ROOT_USERNAME%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3emongoadmin%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09-e%20MONGO_INITDB_ROOT_PASSWORD%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3esecret%20%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%5c%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e%3c%2fspan%3e%09--restart%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3ealways%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%09mongo%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%e4%b9%8b%e5%90%8e%e5%8f%af%e4%bb%a5%e4%bd%bf%e7%94%a8%e5%b7%a5%e5%85%b7%e6%b5%8b%e8%af%95%e4%b8%80%e4%b8%8b%e8%bf%9e%e6%8e%a5%e3%80%82%3c%2fp%3e%0a%3ch3%20id%3d%22kkapi-%e9%83%a8%e7%bd%b2%22%3ekkapi%20%e9%83%a8%e7%bd%b2%3c%2fh3%3e%0a%3cp%3e%e5%92%8c%e9%a1%b9%e7%9b%ae%e6%96%87%e6%a1%a3%e4%b8%ad%e7%9a%84%e6%95%99%e7%a8%8b%e5%b7%ae%e4%b8%8d%e5%a4%9a%ef%bc%8c%e8%a6%81%e6%b3%a8%e6%84%8f%e4%bd%bf%e7%94%a8%e7%9a%84%20node%20%e7%89%88%e6%9c%ac%e8%af%b7%e9%ab%98%e4%ba%8e%20%3ccode%3e16.0.0%3c%2fcode%3e%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fplay_time%2fkkapi%2bispeak%25E8%25AF%25B4%25E8%25AF%25B4%25E9%25A1%25B5%25E9%259D%25A2%25E9%2583%25A8%25E7%25BD%25B2%2f&t=KKapi%2bISpeak%e8%af%b4%e8%af%b4%e9%a1%b5%e9%9d%a2%e9%83%a8%e7%bd%b2" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2024</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/friends>Friends</a></li><li><a href>开往</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>