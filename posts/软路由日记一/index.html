<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>软路由日记(一) - Braindance</title><meta name=Description content="Braindance's blog"><meta property="og:title" content="软路由日记(一)"><meta property="og:description" content="前言在学校疫情期间买了一个 j4125 的软路由，一直等到回家过了很久才到手，因为买的是裸机，还有些配件是在别的店买的，回家以后发现地址只能在区以内修改"><meta property="og:type" content="article"><meta property="og:url" content="https://www.braindance.top/posts/%E8%BD%AF%E8%B7%AF%E7%94%B1%E6%97%A5%E8%AE%B0%E4%B8%80/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-02-03T00:00:00+08:00"><meta property="article:modified_time" content="2023-02-03T00:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="软路由日记(一)"><meta name=twitter:description content="前言在学校疫情期间买了一个 j4125 的软路由，一直等到回家过了很久才到手，因为买的是裸机，还有些配件是在别的店买的，回家以后发现地址只能在区以内修改"><meta name=application-name content="Braindance"><meta name=apple-mobile-web-app-title content="Braindance"><meta name=theme-color content="#f8f8f8"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=canonical href=https://www.braindance.top/posts/%E8%BD%AF%E8%B7%AF%E7%94%B1%E6%97%A5%E8%AE%B0%E4%B8%80/><link rel=prev href=https://www.braindance.top/posts/%E4%B8%AD%E5%9B%BD%E8%81%94%E9%80%9Ask-d748%E5%85%89%E7%8C%AB%E8%B6%85%E7%BA%A7%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/color.css><link rel=stylesheet href=/css/style.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/fontawesome-free/all.min.css><noscript><link rel=stylesheet href=/lib/fontawesome-free/all.min.css></noscript><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/animate/animate.min.css><noscript><link rel=stylesheet href=/lib/animate/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"软路由日记(一)","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/www.braindance.top\/posts\/%E8%BD%AF%E8%B7%AF%E7%94%B1%E6%97%A5%E8%AE%B0%E4%B8%80\/"},"genre":"posts","keywords":"软路由","wordcount":2555,"url":"https:\/\/www.braindance.top\/posts\/%E8%BD%AF%E8%B7%AF%E7%94%B1%E6%97%A5%E8%AE%B0%E4%B8%80\/","datePublished":"2023-02-03T00:00:00+08:00","dateModified":"2023-02-03T00:00:00+08:00","publisher":{"@type":"Organization","name":"Braindance"},"author":{"@type":"Person","name":"Braindance"},"description":""}</script><script src=//instant.page/5.1.1 defer type=module integrity=sha384-MWfCL6g1OTGsbSwfuMHc8+8J2u71/LA8dzlIN3ycajckxuZZmF+DNjdm7O6H3PSq></script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>function setTheme(e){document.body.setAttribute("theme",e),document.documentElement.style.setProperty("color-scheme",e==="light"?"light":"dark"),window.theme=e}function saveTheme(e){window.localStorage&&localStorage.setItem("theme",e)}function getMeta(e){const t=document.getElementsByTagName("meta");for(let n=0;n<t.length;n++)if(t[n].getAttribute("name")===e)return t[n];return""}if(window.localStorage&&localStorage.getItem("theme")){let e=localStorage.getItem("theme");e==="light"||e==="dark"||e==="black"?setTheme(e):setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}else""==="light"||""==="dark"||""==="black"?(setTheme(""),saveTheme("")):(saveTheme("auto"),setTheme(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"));let metaColors={light:"#f8f8f8",dark:"#252627",black:"#000000"};getMeta("theme-color").content=metaColors[document.body.getAttribute("theme")]</script><div id=back-to-top></div><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Braindance>Braindance</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/ title=文章>文章 </a><a class=menu-item href=/tags/ title=标签>标签 </a><a class=menu-item href=/categories/ title=分类>分类 </a><a class=menu-item href=/about/ title=关于>关于 </a><a class=menu-item href=/friend/ title=友链>友链 </a><a class=menu-item href=https://travellings.cn title=开往 rel="noopener noreferrer" target=_blank>🚇 开往 </a><a class=menu-item href=https://notion.braindance.top title=同步notion笔记 rel="noopener noreferrer" target=_blank><img class=emoji src=https://www.penginman.com/img/favicon.ico width=20> 笔记 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder=搜些什么 id=search-input-desktop>
<a href=# class="search-button search-toggle" id=search-toggle-desktop title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-desktop title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=# class="menu-item theme-switch" title=切换主题><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Braindance>Braindance</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder=搜些什么 id=search-input-mobile>
<a href=# class="search-button search-toggle" id=search-toggle-mobile title=搜索><i class="fas fa-search fa-fw"></i></a>
<a href=# class="search-button search-clear" id=search-clear-mobile title=清空><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=# class=search-cancel id=search-cancel-mobile>取消</a></div><a class=menu-item href=/posts/ title=文章>文章</a><a class=menu-item href=/tags/ title=标签>标签</a><a class=menu-item href=/categories/ title=分类>分类</a><a class=menu-item href=/about/ title=关于>关于</a><a class=menu-item href=/friend/ title=友链>友链</a><a class=menu-item href=https://travellings.cn title=开往 rel="noopener noreferrer" target=_blank>🚇开往</a><a class=menu-item href=https://notion.braindance.top title=同步notion笔记 rel="noopener noreferrer" target=_blank><img class=emoji src=https://www.penginman.com/img/favicon.ico width=20>笔记</a><a href=# class="menu-item theme-switch" title=切换主题>
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>目录</h2><div class=toc-content id=toc-content-auto><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#准备材料>准备材料</a></li><li><a href=#restful-制作安装>Restful 制作安装</a></li><li><a href=#虚拟机网段规划分配>虚拟机网段规划分配</a></li><li><a href=#安装-pve-系统>安装 PVE 系统</a><ul><li><a href=#连接-pve-主机>连接 PVE 主机</a></li></ul></li><li><a href=#一些配置>一些配置</a><ul><li><a href=#pve直通特性功能>PVE直通特性功能</a></li><li><a href=#增加模块>增加模块</a></li></ul></li><li><a href=#结束>结束</a></li></ul></nav></div></div><script>document.getElementsByTagName("main")[0].setAttribute("pageStyle","normal")</script><script>document.getElementsByTagName("main")[0].setAttribute("autoTOC","true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">软路由日记(一)</h1><div class=post-meta><div class=post-meta-line><span class=post-author><i class="author fas fa-user-circle fa-fw"></i><a href=/ title=Author rel=author class=author>Braindance</a>
</span>&nbsp;<span class=post-category>收录于 </span>&nbsp;<span class=post-category>类别 <a href=/categories/%E7%9E%8E%E6%8A%98%E8%85%BE/><i class="far fa-folder fa-fw"></i>瞎折腾</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2023-02-03>2023-02-03</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime=2023-02-03>2023-02-03</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;约 2555 字&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;预计阅读 6 分钟&nbsp;<span id=/posts/%E8%BD%AF%E8%B7%AF%E7%94%B1%E6%97%A5%E8%AE%B0%E4%B8%80/ class=leancloud_visitors data-flag-title=软路由日记(一)>
<i class="far fa-eye fa-fw"></i>&nbsp;<span class=leancloud-visitors-count id=twikoo_visitors></span>&nbsp;次阅读
</span>&nbsp;<span id=/posts/%E8%BD%AF%E8%B7%AF%E7%94%B1%E6%97%A5%E8%AE%B0%E4%B8%80/ class=comment_count data-flag-title=软路由日记(一)>
<i class="far fa-comments fa-fw"></i>&nbsp;<span class=twikoo-comment-count id=twikoo-comment-count></span>&nbsp;条评论
</span>&nbsp;</div></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>目录</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#前言>前言</a></li><li><a href=#准备材料>准备材料</a></li><li><a href=#restful-制作安装>Restful 制作安装</a></li><li><a href=#虚拟机网段规划分配>虚拟机网段规划分配</a></li><li><a href=#安装-pve-系统>安装 PVE 系统</a><ul><li><a href=#连接-pve-主机>连接 PVE 主机</a></li></ul></li><li><a href=#一些配置>一些配置</a><ul><li><a href=#pve直通特性功能>PVE直通特性功能</a></li><li><a href=#增加模块>增加模块</a></li></ul></li><li><a href=#结束>结束</a></li></ul></nav></div></div><div class=content id=content><div class="details admonition note open"><div class="details-summary admonition-title"><i class="icon fas fa-pencil-alt fa-fwnote"></i>注意<i class="details-icon fas fa-angle-right fa-fw"></i></div><div class=details-content><div class=admonition-content>本文最后更新于 <span class=timeago datetime=2023-02-03T00:00:00 title="February 3, 2023">2023-02-03</span>，文中内容可能已过时。</div></div></div><h2 id=前言 class=headerLink><a href=#%e5%89%8d%e8%a8%80 class=header-mark></a>前言</h2><p>在学校疫情期间买了一个 j4125 的软路由，一直等到回家过了很久才到手，因为买的是裸机，还有些配件是在别的店买的，回家以后发现地址只能在区以内修改，只能取消订单重新下了单。</p><p>最后的配件列表如下：</p><ul><li>DDR4 8G * 2</li><li>128G msata * 1</li><li>金士顿 480G sata * 1 （送的有sata的电源线和数据线，要注意下电源线用那种带拐角的，不然不好插上去）</li><li>DV 12V5A 电源 5.5mm</li></ul><p>原来咸鱼上买了假三星内存条回来插上发现不能用，所以把笔记本上的两根 8G 换下来了，然后又觉得电脑单根有点卡，所以又下了一单，哈哈哈现在电脑上是假三星 32G。电源是发货最慢的，我把家里路由器机顶盒的电源找了个遍，发现都插不上去，重要的是同样是圆口的插孔，还分好多不一样的尺寸，这个是最大的 5.5mm 的，最后出去找了一家买监控的店，在压箱货里面找到了一个非常非常塑料感的电源，卖了我 30 块，我现在还记得我进去的时候老板正在玩魔兽骑着坐骑跑路。</p><p>再安利两个视频，我前期了解主要通过这两个 up 的视频学习的。</p><p><a href=https://www.bilibili.com/video/BV1WL411P7yN target=_blank rel="noopener noreferrer">保姆级J4125英特尔2.5G安装PVE+Ikuai+Openwrt</a></p><p><a href=https://www.bilibili.com/video/BV13b4y1J7dX target=_blank rel="noopener noreferrer">用U盘直接给J4125软路由安装OpenWrt固件，超简单小白也看得懂</a></p><h2 id=准备材料 class=headerLink><a href=#%e5%87%86%e5%a4%87%e6%9d%90%e6%96%99 class=header-mark></a>准备材料</h2><p>需要准备：</p><ul><li>U盘一个。制作引导盘，安装完成以后可以恢复</li><li>键盘。安装向导需要一些配置</li><li>网线。安装完成以后可以访问 web页面配置</li></ul><p>软件安装包：</p><ul><li>Restful。官网：<a href=http://rufus.ie/zh/ target=_blank rel="noopener noreferrer">http://rufus.ie/zh/</a></li><li>pve镜像。官网：<a href=https://www.proxmox.com/en/downloads target=_blank rel="noopener noreferrer">https://www.proxmox.com/en/downloads</a>。要下载名称有 ISO Installer 才是系统镜像文件</li></ul><h2 id=restful-制作安装 class=headerLink><a href=#restful-%e5%88%b6%e4%bd%9c%e5%ae%89%e8%a3%85 class=header-mark></a>Restful 制作安装</h2><p>插上U盘，打开 Restful 写入镜像文件，设备选择U盘盘符，引导类型选择镜像文件，然后右边选择下载好的 PVE 镜像文件，其他的配置默认即可。</p><p><figure><a class=lightgallery href=https://img.braindance.top/artical/2023/02/03/63dcb88214c79.png title=https://img.braindance.top/artical/2023/02/03/63dcb88214c79.png data-thumbnail=https://img.braindance.top/artical/2023/02/03/63dcb88214c79.png><img loading=lazy src=https://img.braindance.top/artical/2023/02/03/63dcb88214c79.png srcset="https://img.braindance.top/artical/2023/02/03/63dcb88214c79.png, https://img.braindance.top/artical/2023/02/03/63dcb88214c79.png 1.5x, https://img.braindance.top/artical/2023/02/03/63dcb88214c79.png 2x" sizes=auto alt=https://img.braindance.top/artical/2023/02/03/63dcb88214c79.png></a></figure></p><p>确认以后会有一个弹窗选择 DD 镜像模式写入。用个网上找的图片</p><p><figure><a class=lightgallery href=https://qnam.smzdm.com/202202/24/62174f66812b27757.png_e1080.jpg title=https://qnam.smzdm.com/202202/24/62174f66812b27757.png_e1080.jpg data-thumbnail=https://qnam.smzdm.com/202202/24/62174f66812b27757.png_e1080.jpg><img loading=lazy src=https://qnam.smzdm.com/202202/24/62174f66812b27757.png_e1080.jpg srcset="https://qnam.smzdm.com/202202/24/62174f66812b27757.png_e1080.jpg, https://qnam.smzdm.com/202202/24/62174f66812b27757.png_e1080.jpg 1.5x, https://qnam.smzdm.com/202202/24/62174f66812b27757.png_e1080.jpg 2x" sizes=auto alt=https://qnam.smzdm.com/202202/24/62174f66812b27757.png_e1080.jpg></a></figure></p><p>引导盘算制作好了。如果引导盘安装完成以后想要恢复成原来U盘，插上U盘，注意一下识别的盘符，引导类型选择为<code>非可引导</code>重新格式化一下即可，文件系统 FAT32 不能写入超过 2G 大小的文件，所以我一般选 NTFS。</p><h2 id=虚拟机网段规划分配 class=headerLink><a href=#%e8%99%9a%e6%8b%9f%e6%9c%ba%e7%bd%91%e6%ae%b5%e8%a7%84%e5%88%92%e5%88%86%e9%85%8d class=header-mark></a>虚拟机网段规划分配</h2><p>因为安装的时候需要配置 PVE 网络的网关，既然用了软路由肯定是要用 OpenWrt、爱快这种路由系统装到虚拟机里，所以在安装之前先规划一下虚拟机的 IP 分配问题。以我安装的 OpenWrt 为例。</p><p>我打算把软路由作为旁路由使用，不会影响家里爸妈用网体验，自己只需要本地改一下 WIFI 的网关为软路由地址即可。因为我家的入户路由所在的 IP 段是 192.168.1.0/24 ，所以我选择一个其他的网段如 192.168.5.0/24，避免和主路由所在的网段搞混。选择 PVE 系统的 IP 为 192.168.5.2，OpenWrt 虚拟机的 IP 为 192.168.5.3，其他虚拟机顺延。所以在安装 PVE 系统的时候网关需要填为 OpenWrt 准备的虚拟机地址 192.168.5.3，PVE 地址也需要修改为对应的。</p><p>所以最后的结果就是：</p><blockquote><p>PVE 主系统：192.168.5.2</p><p>OpenWrt：192.168.5.3</p><p>Xbantu：192.168.5.4</p><p>&mldr;&mldr;</p></blockquote><p>如果是直接作为主路由拨号使用，网关同样要填上 OpenWrt 的地址，因为要用 OpenWrt 拨号。</p><h2 id=安装-pve-系统 class=headerLink><a href=#%e5%ae%89%e8%a3%85-pve-%e7%b3%bb%e7%bb%9f class=header-mark></a>安装 PVE 系统</h2><p>U盘插上软路由，注意一下启动界面提示的进入 BIOS 界面的按键，我的是 F7，如果不一样问客服或者搜一搜。选择U盘作为引导盘启动安装系统，找一下自己的U盘名称。</p><p><figure><a class=lightgallery href=https://img.braindance.top/artical/2023/02/03/63dcbc8286845.png title=1675410562364.png data-thumbnail=https://img.braindance.top/artical/2023/02/03/63dcbc8286845.png><img loading=lazy src=https://img.braindance.top/artical/2023/02/03/63dcbc8286845.png srcset="https://img.braindance.top/artical/2023/02/03/63dcbc8286845.png, https://img.braindance.top/artical/2023/02/03/63dcbc8286845.png 1.5x, https://img.braindance.top/artical/2023/02/03/63dcbc8286845.png 2x" sizes=auto alt=https://img.braindance.top/artical/2023/02/03/63dcbc8286845.png></a></figure></p><p>接下来进入PVE的安装界面。我已经装好系统了没图，可以看着上面推荐的视频里来，界面依次是：</p><ol><li>选择默认的硬盘。</li><li>输入国家、时区、键盘语言。</li><li>设置管理员的密码、确认密码，设置邮箱。</li></ol><p>这个邮箱我暂时还没有用到，可能 PVE 官方远程管理用得上，先填一个能使用的吧。</p><ol start=4><li>设置管理网卡口、域名、虚拟机 IP 段、网关、DNS。</li></ol><p><strong>网卡</strong>的选择是用于管理 PVE 虚拟机的网卡。比如我的软路由有四个物理网卡，我选择其中一个物理插上网线用来管理 PVE 及其虚拟机，其他三个物理网卡分配给其他虚拟机使用，通常是不可以直接访问 PVE 管理面板的。下拉列表有网卡真实的 MAC 地址，看最后两位一般是有顺序的，我也是大致对应软路由上的物理网口，<del>应该是从小到大吧</del>，我选择了第四个最后一个网口最为 PVE 的管理网口。</p><p><strong>域名</strong>可能和 PVE 官方的远程管理有关。虚拟机 <strong>IP 段</strong>就是 PVE 管理的虚拟机可获得的 IP 范围。<strong>DNS</strong> 不多说了。</p><p><strong>网关</strong>的设置，在<a href=###%e8%99%9a%e6%8b%9f%e6%9c%ba%e7%bd%91%e6%ae%b5%e8%a7%84%e5%88%92%e5%88%86%e9%85%8d rel>虚拟机网段规划分配</a>章节中有说明，填上。</p><ol start=5><li>确认填写信息</li></ol><p>确认安装后稍等一段时间，PVE 会自动重启，系统选择 <strong>Proxmox VE GUN/Linux</strong>，之后会进入 PVE 系统的登陆页面。</p><p><figure><a class=lightgallery href=https://img.braindance.top/artical/2023/02/07/63e1ab32bee01.png title=1675733810414.png data-thumbnail=https://img.braindance.top/artical/2023/02/07/63e1ab32bee01.png><img loading=lazy src=https://img.braindance.top/artical/2023/02/07/63e1ab32bee01.png srcset="https://img.braindance.top/artical/2023/02/07/63e1ab32bee01.png, https://img.braindance.top/artical/2023/02/07/63e1ab32bee01.png 1.5x, https://img.braindance.top/artical/2023/02/07/63e1ab32bee01.png 2x" sizes=auto alt=https://img.braindance.top/artical/2023/02/07/63e1ab32bee01.png></a></figure></p><p>登陆的用户名是 <strong>root</strong>，密码是刚刚安装时填写的密码。上面的信息是 PVE 的 Web 控制台地址，图中的地址可能和我的不一样，这个和前面设置的 IP 段有关。</p><h3 id=连接-pve-主机 class=headerLink><a href=#%e8%bf%9e%e6%8e%a5-pve-%e4%b8%bb%e6%9c%ba class=header-mark></a>连接 PVE 主机</h3><p>安装完成以后，使用网线连接软路由，并配置自己电脑的有线网卡保证和软路由在同一个网段。比如我前面规划我的 IP 网段为 192.168.5.0/24，电脑随便填一个不会冲突的 IP，网关和 DNS 可以填为 OpenWrt 预留的地址。</p><p><figure><a class=lightgallery href=https://img.braindance.top/artical/2023/02/07/63e1a9ce293c3.png title=1675733453093.png data-thumbnail=https://img.braindance.top/artical/2023/02/07/63e1a9ce293c3.png><img loading=lazy src=https://img.braindance.top/artical/2023/02/07/63e1a9ce293c3.png srcset="https://img.braindance.top/artical/2023/02/07/63e1a9ce293c3.png, https://img.braindance.top/artical/2023/02/07/63e1a9ce293c3.png 1.5x, https://img.braindance.top/artical/2023/02/07/63e1a9ce293c3.png 2x" sizes=auto alt=https://img.braindance.top/artical/2023/02/07/63e1a9ce293c3.png></a></figure></p><p>之后可以直接访问安装成功时提示的 PVE Web 控制台地址和端口，即使没有证书也要使用 <strong>https</strong> 访问，浏览器高级选项中有继续访问。用户名是 <strong>root</strong> 密码就是安装时填写的。下面可以选择语言为简体中文。可能会有一个其他提示直接跳过即可。</p><p><figure><a class=lightgallery href=https://img.braindance.top/artical/2023/02/07/63e1ae4e965f6.png title=1675734606058.png data-thumbnail=https://img.braindance.top/artical/2023/02/07/63e1ae4e965f6.png><img loading=lazy src=https://img.braindance.top/artical/2023/02/07/63e1ae4e965f6.png srcset="https://img.braindance.top/artical/2023/02/07/63e1ae4e965f6.png, https://img.braindance.top/artical/2023/02/07/63e1ae4e965f6.png 1.5x, https://img.braindance.top/artical/2023/02/07/63e1ae4e965f6.png 2x" sizes=auto alt=https://img.braindance.top/artical/2023/02/07/63e1ae4e965f6.png></a></figure></p><h2 id=一些配置 class=headerLink><a href=#%e4%b8%80%e4%ba%9b%e9%85%8d%e7%bd%ae class=header-mark></a>一些配置</h2><p>为了方便一些虚拟机可以直通硬件设备，比如 NAS 直通硬盘，提高工作效率，所以需要对 PVE 设置并开启硬件直通。</p><p>前面步骤连上软路由，使用 Shell 连接 PVE 系统，以上面为例地址为 192.168.5.2，用户名密码同上面。虚拟的相关技术不太懂，本人也是跟着操作的。</p><p>偶然发现一篇文章讲了一些相关内容，内核大佬请看 <a href=https://blog.csdn.net/coolfishbone_joey/article/details/124411847 target=_blank rel="noopener noreferrer">[转]关于Linux grub配置iommu=pt intel_iommu=on</a></p><h3 id=pve直通特性功能 class=headerLink><a href=#pve%e7%9b%b4%e9%80%9a%e7%89%b9%e6%80%a7%e5%8a%9f%e8%83%bd class=header-mark></a>PVE直通特性功能</h3><p>注意 Intel 和 AMD 的CPU 一些参数不一样，我使用的 J4125 是 Intel 的。修改的文件都是 <code>/etc/default/grub</code> ，需要修改的参数是 <code>GRUB_CMDLINE_LINUX_DEFAULT</code>，默认值应该是</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GRUB_CMDLINE_LINUX_DEFAULT=&#34;quiet&#34;
</span></span></code></pre></td></tr></table></div></div><p>根据 CPU 不同需要修改成</p><ul><li>Intel CPU</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GRUB_CMDLINE_LINUX_DEFAULT=&#34;quiet intel_iommu=on iommu=pt&#34;
</span></span></code></pre></td></tr></table></div></div><ul><li>AMD CPU</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GRUB_CMDLINE_LINUX_DEFAULT=&#34;quiet amd_iommu=on iommu=pt&#34;
</span></span></code></pre></td></tr></table></div></div><p>注意参数之间的空格，修改之后保存退出，执行指令 <code>update-grub</code> 更新一下引导程序，出现 <strong>done</strong>字样就算成功。</p><h3 id=增加模块 class=headerLink><a href=#%e5%a2%9e%e5%8a%a0%e6%a8%a1%e5%9d%97 class=header-mark></a>增加模块</h3><p>接下来增加一些模块，修改 <code>/etc/modules</code>文件，添加#号下面的几个模块。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># /etc/modules: kernel modules to load at boot time.
</span></span><span class=line><span class=cl>#
</span></span><span class=line><span class=cl># This file contains the names of kernel modules that should be loaded
</span></span><span class=line><span class=cl># at boot time, one per line. Lines beginning with &#34;#&#34; are ignored.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>vfio
</span></span><span class=line><span class=cl>vfio_iommu_type1
</span></span><span class=line><span class=cl>vfio_pci
</span></span><span class=line><span class=cl>vfio_virqfd
</span></span></code></pre></td></tr></table></div></div><p>然后执行指令 <code>update-initramfs -u -k all</code> 对模块的升级。没有出现 <strong>Error</strong> 字样就算成功了，之后 <strong>reboot</strong> 重启一下。</p><h2 id=结束 class=headerLink><a href=#%e7%bb%93%e6%9d%9f class=header-mark></a>结束</h2><p>这一篇就先写到 PVE 的安装和配置直通，下一篇打算写自己经历的固件的选择和安装。软路由老早就装好了，当时也没截图凭借一些其他的教程写了自己的经过，自己挖的坑一定要填上！</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>更新于 2023-02-03</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/>软路由</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>返回</a></span>&nbsp;|&nbsp;<span><a href=/>主页</a></span></section></div><div class=post-nav><a href=/posts/%E4%B8%AD%E5%9B%BD%E8%81%94%E9%80%9Ask-d748%E5%85%89%E7%8C%AB%E8%B6%85%E7%BA%A7%E5%AF%86%E7%A0%81%E8%8E%B7%E5%8F%96/ class=prev rel=prev title=中国联通SK-D748光猫超级密码获取><i class="fas fa-angle-left fa-fw"></i>中国联通SK-D748光猫超级密码获取</a></div></div><div id=comments><div id=twikoo></div><noscript>Please enable JavaScript to view the comments powered by <a href=https://twikoo.js.org/>Twikoo</a>.</noscript></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>由 <a href=https://gohugo.io/ target=_blank rel="noopener noreferrer" title="Hugo 0.111.3">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href=https://github.com/HEIGE-PCloud/DoIt target=_blank rel="noopener noreferrer" title="DoIt 0.3.0"><i class="far fa-edit fa-fw"></i> DoIt</a></div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2020 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank rel="noopener noreferrer">Braindance</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div><div class=footer-line></div><div class=footer-line></div></div></footer></div><div id=fixed-buttons><a href=#back-to-top id=back-to-top-button class=fixed-button title=回到顶部><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title=查看评论><i class="fas fa-comment fa-fw"></i></a></div><div class=assets><link rel=stylesheet href=/lib/lightgallery/lightgallery.min.css><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=preload as=style onload='this.onload=null,this.rel="stylesheet"' href=/lib/katex/copy-tex.min.css><noscript><link rel=stylesheet href=/lib/katex/copy-tex.min.css></noscript><script type=text/javascript>window.config={code:{copyTitle:"复制到剪贴板",maxShownLines:10},comment:{twikoo:{commentCount:!0,el:"#twikoo",envId:"https://twikoo.penginman.com/",lang:"zh-cn"}},lightGallery:{actualSize:!1,exThumbImage:"data-thumbnail",hideBarsDelay:2e3,selector:".lightgallery",speed:400,thumbContHeight:80,thumbWidth:80,thumbnail:!0},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{distance:100,findAllMatches:!1,fuseIndexURL:"/index.json",highlightTag:"em",ignoreFieldNorm:!1,ignoreLocation:!1,isCaseSensitive:!1,location:0,maxResultLength:10,minMatchCharLength:2,noResultsFound:"没有找到结果",snippetLength:50,threshold:.3,type:"fuse",useExtendedSearch:!1},table:{sort:!0},twemoji:!0}</script><script type=text/javascript src=/lib/twikoo/twikoo.all.min.js defer></script><script type=text/javascript src=/js/twikoo.min.js defer></script><script type=text/javascript src=/lib/tablesort/tablesort.min.js></script><script type=text/javascript src=/lib/twemoji/twemoji.min.js defer></script><script type=text/javascript src=/js/twemoji.min.js defer></script><script type=text/javascript src=/lib/lightgallery/lightgallery.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-thumbnail.min.js></script><script type=text/javascript src=/lib/lightgallery/lg-zoom.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js defer></script><script type=text/javascript src=/lib/katex/auto-render.min.js defer></script><script type=text/javascript src=/lib/katex/copy-tex.min.js defer></script><script type=text/javascript src=/lib/katex/mhchem.min.js defer></script><script type=text/javascript src=/js/katex.min.js defer></script><script type=text/javascript src=/js/theme.min.js defer></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-176925141-1",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=UA-176925141-1" async></script><script>var _hmt=_hmt||[];(function(){var e,t=document.createElement("script");t.src="https://hm.baidu.com/hm.js?3b1ab845351bb3a8ee808b639bca6ce5",e=document.getElementsByTagName("script")[0],e.parentNode.insertBefore(t,e)})()</script></div></body></html>