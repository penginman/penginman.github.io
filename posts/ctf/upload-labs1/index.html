<!doctype html><html lang=en><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Upload-Labs(一) | </title><link rel=canonical href=/posts/ctf/upload-labs1/><meta name=description content="为世界上所有的美好而战"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="/posts/ctf/upload-labs1/"><meta property="og:title" content="Upload-Labs(一)"><meta property="og:description" content="介绍 大部分的网站和应用系统都有上传功能，而程序员在开发任意文件上传功能时，并未考虑文件格式后缀的合法性校验或者是否只在前端通过js进行后缀检验。这时攻击者可以上传一个与网站脚本语言相对应的恶意代码动态脚本，例如(jsp、asp、php、aspx文件后缀)到服务器上，从而访问这些恶意脚本中包含的恶意代码，进行动态解析最终达到执行恶意代码的效果，进一步影响服务器安全。
在线靶机地址：
linux环境 windows环境 Pass-01 ​	尝试上传php木马，发现提示上传错误
​	提示只能上传jpg、png、gif类型的图片。查看源码发现是一个前端的后缀过滤，那么我们尝试绕过前端的JS代码。
​	源码：
function checkFile() { var file = document.getElementsByName('upload_file')[0].value; if (file == null || file == &#34;&#34;) { alert(&#34;请选择要上传的文件!&#34;); return false; } //定义允许上传的文件类型 var allow_ext = &#34;.jpg|.png|.gif&#34;; //提取上传文件的类型 var ext_name = file.substring(file.lastIndexOf(&#34;.&#34;)); //判断上传文件类型是否允许上传 if (allow_ext.indexOf(ext_name + &#34;|&#34;) == -1) { var errMsg = &#34;该文件不允许上传，请上传&#34; + allow_ext + &#34;类型的文件,当前文件类型为：&#34; + ext_name; alert(errMsg); return false; } } ​	把文件后缀名改成jpg格式上传，使用burp suit抓包。把.jpg后缀重新改为.php即可实现绕过前端JS代码。
​	然后右键打开图片，代码成功执行。完工
​	注：后面题目的php代码都使用2333.php：
<?php eval(phpinfo()); ​	执行结果是打印出php版本信息。
Pass-02 ​	源码：
$is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif')) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH . '/' . $_FILES['upload_file']['name'] if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = '上传出错！'; } } else { $msg = '文件类型不正确，请重新上传！'; } } else { $msg = UPLOAD_PATH.'文件夹不存在,请手工创建！'; } } ​	发现文件判断是根据image/jpeg、image/png...进行过滤判定，这些值都是Http请求中的Content-Type常见的值，通常浏览网页中各种各样的文件类型的就是通过它判断。那么这道题的目标就是绕过它。贴一个我参考值种类的博客:Http请求中Content-Type。"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-08T19:23:16+00:00"><meta property="article:modified_time" content="2020-11-08T19:23:16+00:00"><meta property="article:tag" content="文件上传漏洞"><meta name=twitter:card content="summary"><meta name=twitter:title content="Upload-Labs(一)"><meta name=twitter:description content="介绍 大部分的网站和应用系统都有上传功能，而程序员在开发任意文件上传功能时，并未考虑文件格式后缀的合法性校验或者是否只在前端通过js进行后缀检验。这时攻击者可以上传一个与网站脚本语言相对应的恶意代码动态脚本，例如(jsp、asp、php、aspx文件后缀)到服务器上，从而访问这些恶意脚本中包含的恶意代码，进行动态解析最终达到执行恶意代码的效果，进一步影响服务器安全。
在线靶机地址：
linux环境 windows环境 Pass-01 ​	尝试上传php木马，发现提示上传错误
​	提示只能上传jpg、png、gif类型的图片。查看源码发现是一个前端的后缀过滤，那么我们尝试绕过前端的JS代码。
​	源码：
function checkFile() { var file = document.getElementsByName('upload_file')[0].value; if (file == null || file == &#34;&#34;) { alert(&#34;请选择要上传的文件!&#34;); return false; } //定义允许上传的文件类型 var allow_ext = &#34;.jpg|.png|.gif&#34;; //提取上传文件的类型 var ext_name = file.substring(file.lastIndexOf(&#34;.&#34;)); //判断上传文件类型是否允许上传 if (allow_ext.indexOf(ext_name + &#34;|&#34;) == -1) { var errMsg = &#34;该文件不允许上传，请上传&#34; + allow_ext + &#34;类型的文件,当前文件类型为：&#34; + ext_name; alert(errMsg); return false; } } ​	把文件后缀名改成jpg格式上传，使用burp suit抓包。把.jpg后缀重新改为.php即可实现绕过前端JS代码。
​	然后右键打开图片，代码成功执行。完工
​	注：后面题目的php代码都使用2333.php：
<?php eval(phpinfo()); ​	执行结果是打印出php版本信息。
Pass-02 ​	源码：
$is_upload = false; $msg = null; if (isset($_POST['submit'])) { if (file_exists(UPLOAD_PATH)) { if (($_FILES['upload_file']['type'] == 'image/jpeg') || ($_FILES['upload_file']['type'] == 'image/png') || ($_FILES['upload_file']['type'] == 'image/gif')) { $temp_file = $_FILES['upload_file']['tmp_name']; $img_path = UPLOAD_PATH . '/' . $_FILES['upload_file']['name'] if (move_uploaded_file($temp_file, $img_path)) { $is_upload = true; } else { $msg = '上传出错！'; } } else { $msg = '文件类型不正确，请重新上传！'; } } else { $msg = UPLOAD_PATH.'文件夹不存在,请手工创建！'; } } ​	发现文件判断是根据image/jpeg、image/png...进行过滤判定，这些值都是Http请求中的Content-Type常见的值，通常浏览网页中各种各样的文件类型的就是通过它判断。那么这道题的目标就是绕过它。贴一个我参考值种类的博客:Http请求中Content-Type。"><link rel=stylesheet href=/css/styles.c05d68261bf086a9d7713c4f8a6215a3601608e267a816a7ee58f139b3d1aae51222aae2081c8e0c6bd35e1334773b7a16283022f31f92afd93bb37e5e822e66.css integrity="sha512-wF1oJhvwhqnXcTxPimIVo2AWCOJnqBan7ljxObPRquUSIqriCByODGvTXhM0dzt6FigwIvMfkq/ZO7N+XoIuZg=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/friends>Friends</a></li><li><a href>开往</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=/posts/ctf/hackgame20202/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=/posts/ctf/upload-labs2/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fctf%2fupload-labs1%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2fposts%2fctf%2fupload-labs1%2f&text=Upload-Labs%28%e4%b8%80%29" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fctf%2fupload-labs1%2f&title=Upload-Labs%28%e4%b8%80%29" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fctf%2fupload-labs1%2f&is_video=false&description=Upload-Labs%28%e4%b8%80%29" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Upload-Labs%28%e4%b8%80%29&body=Check out this article: %2fposts%2fctf%2fupload-labs1%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2fposts%2fctf%2fupload-labs1%2f&title=Upload-Labs%28%e4%b8%80%29" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2fposts%2fctf%2fupload-labs1%2f&title=Upload-Labs%28%e4%b8%80%29" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fctf%2fupload-labs1%2f&name=Upload-Labs%28%e4%b8%80%29&description=%3ch2%20id%3d%22%e4%bb%8b%e7%bb%8d%22%3e%e4%bb%8b%e7%bb%8d%3c%2fh2%3e%0a%3cblockquote%3e%0a%3cp%3e%e5%a4%a7%e9%83%a8%e5%88%86%e7%9a%84%e7%bd%91%e7%ab%99%e5%92%8c%e5%ba%94%e7%94%a8%e7%b3%bb%e7%bb%9f%e9%83%bd%e6%9c%89%e4%b8%8a%e4%bc%a0%e5%8a%9f%e8%83%bd%ef%bc%8c%e8%80%8c%e7%a8%8b%e5%ba%8f%e5%91%98%e5%9c%a8%e5%bc%80%e5%8f%91%e4%bb%bb%e6%84%8f%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e5%8a%9f%e8%83%bd%e6%97%b6%ef%bc%8c%e5%b9%b6%e6%9c%aa%e8%80%83%e8%99%91%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f%e5%90%8e%e7%bc%80%e7%9a%84%e5%90%88%e6%b3%95%e6%80%a7%e6%a0%a1%e9%aa%8c%e6%88%96%e8%80%85%e6%98%af%e5%90%a6%e5%8f%aa%e5%9c%a8%e5%89%8d%e7%ab%af%e9%80%9a%e8%bf%87js%e8%bf%9b%e8%a1%8c%e5%90%8e%e7%bc%80%e6%a3%80%e9%aa%8c%e3%80%82%e8%bf%99%e6%97%b6%e6%94%bb%e5%87%bb%e8%80%85%e5%8f%af%e4%bb%a5%e4%b8%8a%e4%bc%a0%e4%b8%80%e4%b8%aa%e4%b8%8e%e7%bd%91%e7%ab%99%e8%84%9a%e6%9c%ac%e8%af%ad%e8%a8%80%e7%9b%b8%e5%af%b9%e5%ba%94%e7%9a%84%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%8a%a8%e6%80%81%e8%84%9a%e6%9c%ac%ef%bc%8c%e4%be%8b%e5%a6%82%28jsp%e3%80%81asp%e3%80%81php%e3%80%81aspx%e6%96%87%e4%bb%b6%e5%90%8e%e7%bc%80%29%e5%88%b0%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%ef%bc%8c%e4%bb%8e%e8%80%8c%e8%ae%bf%e9%97%ae%e8%bf%99%e4%ba%9b%e6%81%b6%e6%84%8f%e8%84%9a%e6%9c%ac%e4%b8%ad%e5%8c%85%e5%90%ab%e7%9a%84%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%ef%bc%8c%e8%bf%9b%e8%a1%8c%e5%8a%a8%e6%80%81%e8%a7%a3%e6%9e%90%e6%9c%80%e7%bb%88%e8%be%be%e5%88%b0%e6%89%a7%e8%a1%8c%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e7%9a%84%e6%95%88%e6%9e%9c%ef%bc%8c%e8%bf%9b%e4%b8%80%e6%ad%a5%e5%bd%b1%e5%93%8d%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%ae%89%e5%85%a8%e3%80%82%3c%2fp%3e%0a%3c%2fblockquote%3e%0a%3cp%3e%e5%9c%a8%e7%ba%bf%e9%9d%b6%e6%9c%ba%e5%9c%b0%e5%9d%80%ef%bc%9a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3e%3ca%20href%3d%22https%3a%2f%2fbuuoj.cn%2fchallenges%23Upload-Labs-Linux%22%3elinux%e7%8e%af%e5%a2%83%3c%2fa%3e%3c%2fli%3e%0a%3cli%3e%3ca%20href%3d%22https%3a%2f%2fbuuoj.cn%2fchallenges%23%255BWindows%255DUpload-Labs-Windows%22%3ewindows%e7%8e%af%e5%a2%83%3c%2fa%3e%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch2%20id%3d%22pass-01%22%3ePass-01%3c%2fh2%3e%0a%3cp%3e%e2%80%8b%09%e5%b0%9d%e8%af%95%e4%b8%8a%e4%bc%a0php%e6%9c%a8%e9%a9%ac%ef%bc%8c%e5%8f%91%e7%8e%b0%e6%8f%90%e7%a4%ba%e4%b8%8a%e4%bc%a0%e9%94%99%e8%af%af%3c%2fp%3e%0a%3cp%3e%3cimg%20src%3d%22https%3a%2f%2fs1.ax1x.com%2f2020%2f11%2f08%2fBTKbfs.png%22%20alt%3d%22%22%3e%3c%2fp%3e%0a%3cp%3e%e2%80%8b%09%e6%8f%90%e7%a4%ba%e5%8f%aa%e8%83%bd%e4%b8%8a%e4%bc%a0%3ccode%3ejpg%e3%80%81png%e3%80%81gif%3c%2fcode%3e%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%9b%be%e7%89%87%e3%80%82%e6%9f%a5%e7%9c%8b%e6%ba%90%e7%a0%81%e5%8f%91%e7%8e%b0%e6%98%af%e4%b8%80%e4%b8%aa%e5%89%8d%e7%ab%af%e7%9a%84%e5%90%8e%e7%bc%80%e8%bf%87%e6%bb%a4%ef%bc%8c%e9%82%a3%e4%b9%88%e6%88%91%e4%bb%ac%e5%b0%9d%e8%af%95%e7%bb%95%e8%bf%87%e5%89%8d%e7%ab%af%e7%9a%84JS%e4%bb%a3%e7%a0%81%e3%80%82%3c%2fp%3e%0a%3cp%3e%e2%80%8b%09%e6%ba%90%e7%a0%81%ef%bc%9a%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-javascript%22%20data-lang%3d%22javascript%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3efunction%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3echeckFile%3c%2fspan%3e%28%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evar%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20document.%3cspan%20style%3d%22color%3a%23a6e22e%22%3egetElementsByName%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%29%5b%3cspan%20style%3d%22color%3a%23ae81ff%22%3e0%3c%2fspan%3e%5d.%3cspan%20style%3d%22color%3a%23a6e22e%22%3evalue%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3enull%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%7c%7c%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%26%2334%3b%3c%2fspan%3e%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3ealert%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%e8%af%b7%e9%80%89%e6%8b%a9%e8%a6%81%e4%b8%8a%e4%bc%a0%e7%9a%84%e6%96%87%e4%bb%b6%21%26%2334%3b%3c%2fspan%3e%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ereturn%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3efalse%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2375715e%22%3e%2f%2f%e5%ae%9a%e4%b9%89%e5%85%81%e8%ae%b8%e4%b8%8a%e4%bc%a0%e7%9a%84%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2375715e%22%3e%3c%2fspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evar%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eallow_ext%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b.jpg%7c.png%7c.gif%26%2334%3b%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2375715e%22%3e%2f%2f%e6%8f%90%e5%8f%96%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6%e7%9a%84%e7%b1%bb%e5%9e%8b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2375715e%22%3e%3c%2fspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evar%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eext_name%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e.%3cspan%20style%3d%22color%3a%23a6e22e%22%3esubstring%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e.%3cspan%20style%3d%22color%3a%23a6e22e%22%3elastIndexOf%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b.%26%2334%3b%3c%2fspan%3e%29%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2375715e%22%3e%2f%2f%e5%88%a4%e6%96%ad%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e6%98%af%e5%90%a6%e5%85%81%e8%ae%b8%e4%b8%8a%e4%bc%a0%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2375715e%22%3e%3c%2fspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eallow_ext%3c%2fspan%3e.%3cspan%20style%3d%22color%3a%23a6e22e%22%3eindexOf%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eext_name%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%7c%26%2334%3b%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e-%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evar%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eerrMsg%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%e8%af%a5%e6%96%87%e4%bb%b6%e4%b8%8d%e5%85%81%e8%ae%b8%e4%b8%8a%e4%bc%a0%ef%bc%8c%e8%af%b7%e4%b8%8a%e4%bc%a0%26%2334%3b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eallow_ext%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%e7%b1%bb%e5%9e%8b%e7%9a%84%e6%96%87%e4%bb%b6%2c%e5%bd%93%e5%89%8d%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e4%b8%ba%ef%bc%9a%26%2334%3b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eext_name%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3ealert%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eerrMsg%3c%2fspan%3e%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ereturn%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3efalse%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%e2%80%8b%09%e6%8a%8a%e6%96%87%e4%bb%b6%e5%90%8e%e7%bc%80%e5%90%8d%e6%94%b9%e6%88%90jpg%e6%a0%bc%e5%bc%8f%e4%b8%8a%e4%bc%a0%ef%bc%8c%e4%bd%bf%e7%94%a8%3cstrong%3eburp%20suit%3c%2fstrong%3e%e6%8a%93%e5%8c%85%e3%80%82%e6%8a%8a%3ccode%3e.jpg%3c%2fcode%3e%e5%90%8e%e7%bc%80%e9%87%8d%e6%96%b0%e6%94%b9%e4%b8%ba%3ccode%3e.php%3c%2fcode%3e%e5%8d%b3%e5%8f%af%e5%ae%9e%e7%8e%b0%e7%bb%95%e8%bf%87%e5%89%8d%e7%ab%afJS%e4%bb%a3%e7%a0%81%e3%80%82%3c%2fp%3e%0a%3cp%3e%3cimg%20src%3d%22https%3a%2f%2fs1.ax1x.com%2f2020%2f11%2f08%2fBTM5g1.png%22%20alt%3d%22%22%3e%3c%2fp%3e%0a%3cp%3e%e2%80%8b%09%e7%84%b6%e5%90%8e%e5%8f%b3%e9%94%ae%e6%89%93%e5%bc%80%e5%9b%be%e7%89%87%ef%bc%8c%e4%bb%a3%e7%a0%81%e6%88%90%e5%8a%9f%e6%89%a7%e8%a1%8c%e3%80%82%e5%ae%8c%e5%b7%a5%3c%2fp%3e%0a%3cp%3e%3cimg%20src%3d%22https%3a%2f%2fs1.ax1x.com%2f2020%2f11%2f08%2fBTQV8s.png%22%20alt%3d%22%22%3e%3c%2fp%3e%0a%3cp%3e%e2%80%8b%09%e6%b3%a8%ef%bc%9a%e5%90%8e%e9%9d%a2%e9%a2%98%e7%9b%ae%e7%9a%84php%e4%bb%a3%e7%a0%81%e9%83%bd%e4%bd%bf%e7%94%a8%3ccode%3e2333.php%3c%2fcode%3e%ef%bc%9a%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-php%22%20data-lang%3d%22php%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e%26lt%3b%3f%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3ephp%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eeval%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3ephpinfo%3c%2fspan%3e%28%29%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%e2%80%8b%09%e6%89%a7%e8%a1%8c%e7%bb%93%e6%9e%9c%e6%98%af%e6%89%93%e5%8d%b0%e5%87%baphp%e7%89%88%e6%9c%ac%e4%bf%a1%e6%81%af%e3%80%82%3c%2fp%3e%0a%3ch2%20id%3d%22pass-02%22%3ePass-02%3c%2fh2%3e%0a%3cp%3e%e2%80%8b%09%e6%ba%90%e7%a0%81%ef%bc%9a%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-php%22%20data-lang%3d%22php%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%24is_upload%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3efalse%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%24msg%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3enull%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eisset%3c%2fspan%3e%28%24_POST%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bsubmit%26%2339%3b%3c%2fspan%3e%5d%29%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile_exists%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eUPLOAD_PATH%3c%2fspan%3e%29%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%28%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3btype%26%2339%3b%3c%2fspan%3e%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bimage%2fjpeg%26%2339%3b%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%7c%7c%3c%2fspan%3e%20%28%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3btype%26%2339%3b%3c%2fspan%3e%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bimage%2fpng%26%2339%3b%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%7c%7c%3c%2fspan%3e%20%28%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3btype%26%2339%3b%3c%2fspan%3e%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bimage%2fgif%26%2339%3b%3c%2fspan%3e%29%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%24temp_file%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3btmp_name%26%2339%3b%3c%2fspan%3e%5d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%24img_path%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eUPLOAD_PATH%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e.%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3b%2f%26%2339%3b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e.%3c%2fspan%3e%20%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bname%26%2339%3b%3c%2fspan%3e%5d%20%20%20%20%20%20%20%20%20%20%20%20%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3emove_uploaded_file%3c%2fspan%3e%28%24temp_file%2c%20%24img_path%29%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24is_upload%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3etrue%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%7d%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eelse%3c%2fspan%3e%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24msg%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3b%e4%b8%8a%e4%bc%a0%e5%87%ba%e9%94%99%ef%bc%81%26%2339%3b%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%7d%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eelse%3c%2fspan%3e%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%24msg%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3b%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e4%b8%8d%e6%ad%a3%e7%a1%ae%ef%bc%8c%e8%af%b7%e9%87%8d%e6%96%b0%e4%b8%8a%e4%bc%a0%ef%bc%81%26%2339%3b%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%7d%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eelse%3c%2fspan%3e%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%24msg%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eUPLOAD_PATH%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e.%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3b%e6%96%87%e4%bb%b6%e5%a4%b9%e4%b8%8d%e5%ad%98%e5%9c%a8%2c%e8%af%b7%e6%89%8b%e5%b7%a5%e5%88%9b%e5%bb%ba%ef%bc%81%26%2339%3b%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%e2%80%8b%09%e5%8f%91%e7%8e%b0%e6%96%87%e4%bb%b6%e5%88%a4%e6%96%ad%e6%98%af%e6%a0%b9%e6%8d%ae%3ccode%3eimage%2fjpeg%e3%80%81image%2fpng...%3c%2fcode%3e%e8%bf%9b%e8%a1%8c%e8%bf%87%e6%bb%a4%e5%88%a4%e5%ae%9a%ef%bc%8c%e8%bf%99%e4%ba%9b%e5%80%bc%e9%83%bd%e6%98%afHttp%e8%af%b7%e6%b1%82%e4%b8%ad%e7%9a%84%3cstrong%3eContent-Type%3c%2fstrong%3e%e5%b8%b8%e8%a7%81%e7%9a%84%e5%80%bc%ef%bc%8c%e9%80%9a%e5%b8%b8%e6%b5%8f%e8%a7%88%e7%bd%91%e9%a1%b5%e4%b8%ad%e5%90%84%e7%a7%8d%e5%90%84%e6%a0%b7%e7%9a%84%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%b0%b1%e6%98%af%e9%80%9a%e8%bf%87%e5%ae%83%e5%88%a4%e6%96%ad%e3%80%82%e9%82%a3%e4%b9%88%e8%bf%99%e9%81%93%e9%a2%98%e7%9a%84%e7%9b%ae%e6%a0%87%e5%b0%b1%e6%98%af%e7%bb%95%e8%bf%87%e5%ae%83%e3%80%82%e8%b4%b4%e4%b8%80%e4%b8%aa%e6%88%91%e5%8f%82%e8%80%83%e5%80%bc%e7%a7%8d%e7%b1%bb%e7%9a%84%e5%8d%9a%e5%ae%a2%3a%3ca%20href%3d%22https%3a%2f%2fwww.cnblogs.com%2fklb561%2fp%2f10090540.html%22%3eHttp%e8%af%b7%e6%b1%82%e4%b8%adContent-Type%3c%2fa%3e%e3%80%82%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fctf%2fupload-labs1%2f&t=Upload-Labs%28%e4%b8%80%29" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><a href=#介绍>介绍</a></li><li><a href=#pass-01>Pass-01</a></li><li><a href=#pass-02>Pass-02</a></li><li><a href=#pass-03>Pass-03</a></li><li><a href=#pass-04>Pass-04</a></li><li><a href=#pass-05>Pass-05</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Upload-Labs(一)</h1><div class=meta><div class=postdate><time datetime="2020-11-08 19:23:16 +0000 UTC" itemprop=datePublished>2020-11-08</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/ctf>CTF</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E rel=tag>文件上传漏洞</a></div></div></header><div class=content itemprop=articleBody><h2 id=介绍>介绍</h2><blockquote><p>大部分的网站和应用系统都有上传功能，而程序员在开发任意文件上传功能时，并未考虑文件格式后缀的合法性校验或者是否只在前端通过js进行后缀检验。这时攻击者可以上传一个与网站脚本语言相对应的恶意代码动态脚本，例如(jsp、asp、php、aspx文件后缀)到服务器上，从而访问这些恶意脚本中包含的恶意代码，进行动态解析最终达到执行恶意代码的效果，进一步影响服务器安全。</p></blockquote><p>在线靶机地址：</p><ul><li><a href=https://buuoj.cn/challenges#Upload-Labs-Linux>linux环境</a></li><li><a href=https://buuoj.cn/challenges#%5BWindows%5DUpload-Labs-Windows>windows环境</a></li></ul><h2 id=pass-01>Pass-01</h2><p>​ 尝试上传php木马，发现提示上传错误</p><p><img src=https://s1.ax1x.com/2020/11/08/BTKbfs.png alt></p><p>​ 提示只能上传<code>jpg、png、gif</code>类型的图片。查看源码发现是一个前端的后缀过滤，那么我们尝试绕过前端的JS代码。</p><p>​ 源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>checkFile</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementsByName</span>(<span style=color:#e6db74>&#39;upload_file&#39;</span>)[<span style=color:#ae81ff>0</span>].<span style=color:#a6e22e>value</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>null</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;&#34;</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#34;请选择要上传的文件!&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#75715e>//定义允许上传的文件类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>allow_ext</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;.jpg|.png|.gif&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#75715e>//提取上传文件的类型
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ext_name</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>substring</span>(<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>lastIndexOf</span>(<span style=color:#e6db74>&#34;.&#34;</span>));
</span></span><span style=display:flex><span>    <span style=color:#75715e>//判断上传文件类型是否允许上传
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>allow_ext</span>.<span style=color:#a6e22e>indexOf</span>(<span style=color:#a6e22e>ext_name</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;|&#34;</span>) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>errMsg</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;该文件不允许上传，请上传&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>allow_ext</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;类型的文件,当前文件类型为：&#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>ext_name</span>;
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>alert</span>(<span style=color:#a6e22e>errMsg</span>);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>​ 把文件后缀名改成jpg格式上传，使用<strong>burp suit</strong>抓包。把<code>.jpg</code>后缀重新改为<code>.php</code>即可实现绕过前端JS代码。</p><p><img src=https://s1.ax1x.com/2020/11/08/BTM5g1.png alt></p><p>​ 然后右键打开图片，代码成功执行。完工</p><p><img src=https://s1.ax1x.com/2020/11/08/BTQV8s.png alt></p><p>​ 注：后面题目的php代码都使用<code>2333.php</code>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> <span style=color:#66d9ef>eval</span>(<span style=color:#a6e22e>phpinfo</span>());
</span></span></code></pre></div><p>​ 执行结果是打印出php版本信息。</p><h2 id=pass-02>Pass-02</h2><p>​ 源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>$msg <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;submit&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file_exists</span>(<span style=color:#a6e22e>UPLOAD_PATH</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (($_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;image/jpeg&#39;</span>) <span style=color:#f92672>||</span> ($_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;image/png&#39;</span>) <span style=color:#f92672>||</span> ($_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;type&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;image/gif&#39;</span>)) {
</span></span><span style=display:flex><span>            $temp_file <span style=color:#f92672>=</span> $_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>];
</span></span><span style=display:flex><span>            $img_path <span style=color:#f92672>=</span> <span style=color:#a6e22e>UPLOAD_PATH</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#f92672>.</span> $_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;name&#39;</span>]            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>move_uploaded_file</span>($temp_file, $img_path)) {
</span></span><span style=display:flex><span>                $is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;上传出错！&#39;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;文件类型不正确，请重新上传！&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        $msg <span style=color:#f92672>=</span> <span style=color:#a6e22e>UPLOAD_PATH</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;文件夹不存在,请手工创建！&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>​ 发现文件判断是根据<code>image/jpeg、image/png...</code>进行过滤判定，这些值都是Http请求中的<strong>Content-Type</strong>常见的值，通常浏览网页中各种各样的文件类型的就是通过它判断。那么这道题的目标就是绕过它。贴一个我参考值种类的博客:<a href=https://www.cnblogs.com/klb561/p/10090540.html>Http请求中Content-Type</a>。</p><p>​ 同样是burp抓包修改<strong>Content-Type</strong>的值。</p><p><img src=https://s1.ax1x.com/2020/11/08/BT1EXq.png alt></p><p>​ 打开图片，php代码成功执行。完工</p><h2 id=pass-03>Pass-03</h2><p>源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>$msg <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;submit&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file_exists</span>(<span style=color:#a6e22e>UPLOAD_PATH</span>)) {
</span></span><span style=display:flex><span>        $deny_ext <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#39;.asp&#39;</span>,<span style=color:#e6db74>&#39;.aspx&#39;</span>,<span style=color:#e6db74>&#39;.php&#39;</span>,<span style=color:#e6db74>&#39;.jsp&#39;</span>);
</span></span><span style=display:flex><span>        $file_name <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;name&#39;</span>]);
</span></span><span style=display:flex><span>        $file_name <span style=color:#f92672>=</span> <span style=color:#a6e22e>deldot</span>($file_name);<span style=color:#75715e>//删除文件名末尾的点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>strrchr</span>($file_name, <span style=color:#e6db74>&#39;.&#39;</span>);
</span></span><span style=display:flex><span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>strtolower</span>($file_ext); <span style=color:#75715e>//转换为小写
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_ireplace</span>(<span style=color:#e6db74>&#39;::$DATA&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, $file_ext);<span style=color:#75715e>//去除字符串::$DATA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($file_ext); <span style=color:#75715e>//收尾去空
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>($file_ext, $deny_ext)) {
</span></span><span style=display:flex><span>            $temp_file <span style=color:#f92672>=</span> $_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>];
</span></span><span style=display:flex><span>            $img_path <span style=color:#f92672>=</span> <span style=color:#a6e22e>UPLOAD_PATH</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#34;YmdHis&#34;</span>)<span style=color:#f92672>.</span><span style=color:#a6e22e>rand</span>(<span style=color:#ae81ff>1000</span>,<span style=color:#ae81ff>9999</span>)<span style=color:#f92672>.</span>$file_ext;            
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>move_uploaded_file</span>($temp_file,$img_path)) {
</span></span><span style=display:flex><span>                 $is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;上传出错！&#39;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;不允许上传.asp,.aspx,.php,.jsp后缀文件！&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        $msg <span style=color:#f92672>=</span> <span style=color:#a6e22e>UPLOAD_PATH</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;文件夹不存在,请手工创建！&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>​ 发现只过滤了<code>.asp、.aspx、.php、.jsp</code>文件，那么可以使用<code>php3、phtml、phps、php5</code>文件绕过过滤，并执行语句。通常，在嵌入了php脚本的html中，使用 <code>phtml</code>作为后缀名；而php3，我的理解是php之前版本的文件后缀，如<code>php5</code>。</p><p>​ 直接把<code>2333.php</code>改为<code>2333.php3</code>上传打开，执行成功。完工</p><p><img src=https://s1.ax1x.com/2020/11/09/BTq2cV.png alt></p><h2 id=pass-04>Pass-04</h2><p>源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>$msg <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;submit&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file_exists</span>(<span style=color:#a6e22e>UPLOAD_PATH</span>)) {
</span></span><span style=display:flex><span>        $deny_ext <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#34;.php&#34;</span>,<span style=color:#e6db74>&#34;.php5&#34;</span>,<span style=color:#e6db74>&#34;.php4&#34;</span>,<span style=color:#e6db74>&#34;.php3&#34;</span>,<span style=color:#e6db74>&#34;.php2&#34;</span>,<span style=color:#e6db74>&#34;php1&#34;</span>,<span style=color:#e6db74>&#34;.html&#34;</span>,<span style=color:#e6db74>&#34;.htm&#34;</span>,<span style=color:#e6db74>&#34;.phtml&#34;</span>,<span style=color:#e6db74>&#34;.pht&#34;</span>,<span style=color:#e6db74>&#34;.pHp&#34;</span>,<span style=color:#e6db74>&#34;.pHp5&#34;</span>,<span style=color:#e6db74>&#34;.pHp4&#34;</span>,<span style=color:#e6db74>&#34;.pHp3&#34;</span>,<span style=color:#e6db74>&#34;.pHp2&#34;</span>,<span style=color:#e6db74>&#34;pHp1&#34;</span>,<span style=color:#e6db74>&#34;.Html&#34;</span>,<span style=color:#e6db74>&#34;.Htm&#34;</span>,<span style=color:#e6db74>&#34;.pHtml&#34;</span>,<span style=color:#e6db74>&#34;.jsp&#34;</span>,<span style=color:#e6db74>&#34;.jspa&#34;</span>,<span style=color:#e6db74>&#34;.jspx&#34;</span>,<span style=color:#e6db74>&#34;.jsw&#34;</span>,<span style=color:#e6db74>&#34;.jsv&#34;</span>,<span style=color:#e6db74>&#34;.jspf&#34;</span>,<span style=color:#e6db74>&#34;.jtml&#34;</span>,<span style=color:#e6db74>&#34;.jSp&#34;</span>,<span style=color:#e6db74>&#34;.jSpx&#34;</span>,<span style=color:#e6db74>&#34;.jSpa&#34;</span>,<span style=color:#e6db74>&#34;.jSw&#34;</span>,<span style=color:#e6db74>&#34;.jSv&#34;</span>,<span style=color:#e6db74>&#34;.jSpf&#34;</span>,<span style=color:#e6db74>&#34;.jHtml&#34;</span>,<span style=color:#e6db74>&#34;.asp&#34;</span>,<span style=color:#e6db74>&#34;.aspx&#34;</span>,<span style=color:#e6db74>&#34;.asa&#34;</span>,<span style=color:#e6db74>&#34;.asax&#34;</span>,<span style=color:#e6db74>&#34;.ascx&#34;</span>,<span style=color:#e6db74>&#34;.ashx&#34;</span>,<span style=color:#e6db74>&#34;.asmx&#34;</span>,<span style=color:#e6db74>&#34;.cer&#34;</span>,<span style=color:#e6db74>&#34;.aSp&#34;</span>,<span style=color:#e6db74>&#34;.aSpx&#34;</span>,<span style=color:#e6db74>&#34;.aSa&#34;</span>,<span style=color:#e6db74>&#34;.aSax&#34;</span>,<span style=color:#e6db74>&#34;.aScx&#34;</span>,<span style=color:#e6db74>&#34;.aShx&#34;</span>,<span style=color:#e6db74>&#34;.aSmx&#34;</span>,<span style=color:#e6db74>&#34;.cEr&#34;</span>,<span style=color:#e6db74>&#34;.sWf&#34;</span>,<span style=color:#e6db74>&#34;.swf&#34;</span>);
</span></span><span style=display:flex><span>        $file_name <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;name&#39;</span>]);
</span></span><span style=display:flex><span>        $file_name <span style=color:#f92672>=</span> <span style=color:#a6e22e>deldot</span>($file_name);<span style=color:#75715e>//删除文件名末尾的点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>strrchr</span>($file_name, <span style=color:#e6db74>&#39;.&#39;</span>);
</span></span><span style=display:flex><span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>strtolower</span>($file_ext); <span style=color:#75715e>//转换为小写
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_ireplace</span>(<span style=color:#e6db74>&#39;::$DATA&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, $file_ext);<span style=color:#75715e>//去除字符串::$DATA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($file_ext); <span style=color:#75715e>//收尾去空
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>($file_ext, $deny_ext)) {
</span></span><span style=display:flex><span>            $temp_file <span style=color:#f92672>=</span> $_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>];
</span></span><span style=display:flex><span>            $img_path <span style=color:#f92672>=</span> <span style=color:#a6e22e>UPLOAD_PATH</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>.</span>$file_name;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>move_uploaded_file</span>($temp_file, $img_path)) {
</span></span><span style=display:flex><span>                $is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;上传出错！&#39;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;此文件不允许上传!&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        $msg <span style=color:#f92672>=</span> <span style=color:#a6e22e>UPLOAD_PATH</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;文件夹不存在,请手工创建！&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>​ 好家伙，这次直接一大堆文件都被过滤了，几乎有问题的都在数组里。发现没有.<code>htaccess</code>文件过滤，所以上传一个.<code>htaccess</code>文件内容如下：</p><pre tabindex=0><code>SetHandler application/x-httpd-php
</code></pre><p>​ 原理的话我讲一下个人的见解：.<code>htaccess</code>文件是一个<code>apache</code>服务器的配置文件，它的作用就是对于该目录下的所有文件都需要符合这个配置文件。然后上传的文件内容作用是：所有文件访问时都会解析为<code>php</code>。参考的博客：<a href=https://www.cnblogs.com/gyrgyr/p/10773118.html>htaccess使用方法介绍</a>。</p><p>​ 接下来上传<code>2333.jpg</code>图片木马，再打开就会被成功解析为<code>php</code>文件并执行：</p><p><img src=https://s1.ax1x.com/2020/11/09/BTqoN9.png alt></p><p><img src=https://s1.ax1x.com/2020/11/09/BTqqc6.png alt></p><p>​ 完工</p><h2 id=pass-05>Pass-05</h2><p>源码：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>$msg <span style=color:#f92672>=</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;submit&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>file_exists</span>(<span style=color:#a6e22e>UPLOAD_PATH</span>)) {
</span></span><span style=display:flex><span>        $deny_ext <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>(<span style=color:#e6db74>&#34;.php&#34;</span>,<span style=color:#e6db74>&#34;.php5&#34;</span>,<span style=color:#e6db74>&#34;.php4&#34;</span>,<span style=color:#e6db74>&#34;.php3&#34;</span>,<span style=color:#e6db74>&#34;.php2&#34;</span>,<span style=color:#e6db74>&#34;.html&#34;</span>,<span style=color:#e6db74>&#34;.htm&#34;</span>,<span style=color:#e6db74>&#34;.phtml&#34;</span>,<span style=color:#e6db74>&#34;.pht&#34;</span>,<span style=color:#e6db74>&#34;.pHp&#34;</span>,<span style=color:#e6db74>&#34;.pHp5&#34;</span>,<span style=color:#e6db74>&#34;.pHp4&#34;</span>,<span style=color:#e6db74>&#34;.pHp3&#34;</span>,<span style=color:#e6db74>&#34;.pHp2&#34;</span>,<span style=color:#e6db74>&#34;.Html&#34;</span>,<span style=color:#e6db74>&#34;.Htm&#34;</span>,<span style=color:#e6db74>&#34;.pHtml&#34;</span>,<span style=color:#e6db74>&#34;.jsp&#34;</span>,<span style=color:#e6db74>&#34;.jspa&#34;</span>,<span style=color:#e6db74>&#34;.jspx&#34;</span>,<span style=color:#e6db74>&#34;.jsw&#34;</span>,<span style=color:#e6db74>&#34;.jsv&#34;</span>,<span style=color:#e6db74>&#34;.jspf&#34;</span>,<span style=color:#e6db74>&#34;.jtml&#34;</span>,<span style=color:#e6db74>&#34;.jSp&#34;</span>,<span style=color:#e6db74>&#34;.jSpx&#34;</span>,<span style=color:#e6db74>&#34;.jSpa&#34;</span>,<span style=color:#e6db74>&#34;.jSw&#34;</span>,<span style=color:#e6db74>&#34;.jSv&#34;</span>,<span style=color:#e6db74>&#34;.jSpf&#34;</span>,<span style=color:#e6db74>&#34;.jHtml&#34;</span>,<span style=color:#e6db74>&#34;.asp&#34;</span>,<span style=color:#e6db74>&#34;.aspx&#34;</span>,<span style=color:#e6db74>&#34;.asa&#34;</span>,<span style=color:#e6db74>&#34;.asax&#34;</span>,<span style=color:#e6db74>&#34;.ascx&#34;</span>,<span style=color:#e6db74>&#34;.ashx&#34;</span>,<span style=color:#e6db74>&#34;.asmx&#34;</span>,<span style=color:#e6db74>&#34;.cer&#34;</span>,<span style=color:#e6db74>&#34;.aSp&#34;</span>,<span style=color:#e6db74>&#34;.aSpx&#34;</span>,<span style=color:#e6db74>&#34;.aSa&#34;</span>,<span style=color:#e6db74>&#34;.aSax&#34;</span>,<span style=color:#e6db74>&#34;.aScx&#34;</span>,<span style=color:#e6db74>&#34;.aShx&#34;</span>,<span style=color:#e6db74>&#34;.aSmx&#34;</span>,<span style=color:#e6db74>&#34;.cEr&#34;</span>,<span style=color:#e6db74>&#34;.sWf&#34;</span>,<span style=color:#e6db74>&#34;.swf&#34;</span>,<span style=color:#e6db74>&#34;.htaccess&#34;</span>);
</span></span><span style=display:flex><span>        $file_name <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;name&#39;</span>]);
</span></span><span style=display:flex><span>        $file_name <span style=color:#f92672>=</span> <span style=color:#a6e22e>deldot</span>($file_name);<span style=color:#75715e>//删除文件名末尾的点
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>strrchr</span>($file_name, <span style=color:#e6db74>&#39;.&#39;</span>);
</span></span><span style=display:flex><span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_ireplace</span>(<span style=color:#e6db74>&#39;::$DATA&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>, $file_ext);<span style=color:#75715e>//去除字符串::$DATA
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        $file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>trim</span>($file_ext); <span style=color:#75715e>//首尾去空
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>in_array</span>($file_ext, $deny_ext)) {
</span></span><span style=display:flex><span>            $temp_file <span style=color:#f92672>=</span> $_FILES[<span style=color:#e6db74>&#39;upload_file&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>];
</span></span><span style=display:flex><span>            $img_path <span style=color:#f92672>=</span> <span style=color:#a6e22e>UPLOAD_PATH</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/&#39;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>date</span>(<span style=color:#e6db74>&#34;YmdHis&#34;</span>)<span style=color:#f92672>.</span><span style=color:#a6e22e>rand</span>(<span style=color:#ae81ff>1000</span>,<span style=color:#ae81ff>9999</span>)<span style=color:#f92672>.</span>$file_ext;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>move_uploaded_file</span>($temp_file, $img_path)) {
</span></span><span style=display:flex><span>                $is_upload <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;上传出错！&#39;</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>            $msg <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;此文件类型不允许上传！&#39;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        $msg <span style=color:#f92672>=</span> <span style=color:#a6e22e>UPLOAD_PATH</span> <span style=color:#f92672>.</span> <span style=color:#e6db74>&#39;文件夹不存在,请手工创建！&#39;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>​ 细心的话可以发现，这道题的源码中在末尾添加了<code>.htaccess</code>文件过滤，但是也少了一条语句</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span>$file_ext <span style=color:#f92672>=</span> <span style=color:#a6e22e>strtolower</span>($file_ext); <span style=color:#75715e>//转换为小写
</span></span></span></code></pre></div><p>目标就很明确了，直接使用大小写绕过过滤。</p><p><img src=https://s1.ax1x.com/2020/11/09/BTLmNj.png alt></p><p>​ 打开图片成功执行。完工</p></div></article><div class=blog-post-comments><div id=tcomment></div><script src=https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js></script><script>twikoo.init({envId:"https://twikoo.braindance.top/.netlify/functions/twikoo",el:"#tcomment",lang:"zh-CN"})</script></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/friends>Friends</a></li><li><a href>开往</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><a href=#介绍>介绍</a></li><li><a href=#pass-01>Pass-01</a></li><li><a href=#pass-02>Pass-02</a></li><li><a href=#pass-03>Pass-03</a></li><li><a href=#pass-04>Pass-04</a></li><li><a href=#pass-05>Pass-05</a></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=%2fposts%2fctf%2fupload-labs1%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=%2fposts%2fctf%2fupload-labs1%2f&text=Upload-Labs%28%e4%b8%80%29" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=%2fposts%2fctf%2fupload-labs1%2f&title=Upload-Labs%28%e4%b8%80%29" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=%2fposts%2fctf%2fupload-labs1%2f&is_video=false&description=Upload-Labs%28%e4%b8%80%29" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Upload-Labs%28%e4%b8%80%29&body=Check out this article: %2fposts%2fctf%2fupload-labs1%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=%2fposts%2fctf%2fupload-labs1%2f&title=Upload-Labs%28%e4%b8%80%29" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=%2fposts%2fctf%2fupload-labs1%2f&title=Upload-Labs%28%e4%b8%80%29" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=%2fposts%2fctf%2fupload-labs1%2f&name=Upload-Labs%28%e4%b8%80%29&description=%3ch2%20id%3d%22%e4%bb%8b%e7%bb%8d%22%3e%e4%bb%8b%e7%bb%8d%3c%2fh2%3e%0a%3cblockquote%3e%0a%3cp%3e%e5%a4%a7%e9%83%a8%e5%88%86%e7%9a%84%e7%bd%91%e7%ab%99%e5%92%8c%e5%ba%94%e7%94%a8%e7%b3%bb%e7%bb%9f%e9%83%bd%e6%9c%89%e4%b8%8a%e4%bc%a0%e5%8a%9f%e8%83%bd%ef%bc%8c%e8%80%8c%e7%a8%8b%e5%ba%8f%e5%91%98%e5%9c%a8%e5%bc%80%e5%8f%91%e4%bb%bb%e6%84%8f%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%e5%8a%9f%e8%83%bd%e6%97%b6%ef%bc%8c%e5%b9%b6%e6%9c%aa%e8%80%83%e8%99%91%e6%96%87%e4%bb%b6%e6%a0%bc%e5%bc%8f%e5%90%8e%e7%bc%80%e7%9a%84%e5%90%88%e6%b3%95%e6%80%a7%e6%a0%a1%e9%aa%8c%e6%88%96%e8%80%85%e6%98%af%e5%90%a6%e5%8f%aa%e5%9c%a8%e5%89%8d%e7%ab%af%e9%80%9a%e8%bf%87js%e8%bf%9b%e8%a1%8c%e5%90%8e%e7%bc%80%e6%a3%80%e9%aa%8c%e3%80%82%e8%bf%99%e6%97%b6%e6%94%bb%e5%87%bb%e8%80%85%e5%8f%af%e4%bb%a5%e4%b8%8a%e4%bc%a0%e4%b8%80%e4%b8%aa%e4%b8%8e%e7%bd%91%e7%ab%99%e8%84%9a%e6%9c%ac%e8%af%ad%e8%a8%80%e7%9b%b8%e5%af%b9%e5%ba%94%e7%9a%84%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e5%8a%a8%e6%80%81%e8%84%9a%e6%9c%ac%ef%bc%8c%e4%be%8b%e5%a6%82%28jsp%e3%80%81asp%e3%80%81php%e3%80%81aspx%e6%96%87%e4%bb%b6%e5%90%8e%e7%bc%80%29%e5%88%b0%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%ef%bc%8c%e4%bb%8e%e8%80%8c%e8%ae%bf%e9%97%ae%e8%bf%99%e4%ba%9b%e6%81%b6%e6%84%8f%e8%84%9a%e6%9c%ac%e4%b8%ad%e5%8c%85%e5%90%ab%e7%9a%84%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%ef%bc%8c%e8%bf%9b%e8%a1%8c%e5%8a%a8%e6%80%81%e8%a7%a3%e6%9e%90%e6%9c%80%e7%bb%88%e8%be%be%e5%88%b0%e6%89%a7%e8%a1%8c%e6%81%b6%e6%84%8f%e4%bb%a3%e7%a0%81%e7%9a%84%e6%95%88%e6%9e%9c%ef%bc%8c%e8%bf%9b%e4%b8%80%e6%ad%a5%e5%bd%b1%e5%93%8d%e6%9c%8d%e5%8a%a1%e5%99%a8%e5%ae%89%e5%85%a8%e3%80%82%3c%2fp%3e%0a%3c%2fblockquote%3e%0a%3cp%3e%e5%9c%a8%e7%ba%bf%e9%9d%b6%e6%9c%ba%e5%9c%b0%e5%9d%80%ef%bc%9a%3c%2fp%3e%0a%3cul%3e%0a%3cli%3e%3ca%20href%3d%22https%3a%2f%2fbuuoj.cn%2fchallenges%23Upload-Labs-Linux%22%3elinux%e7%8e%af%e5%a2%83%3c%2fa%3e%3c%2fli%3e%0a%3cli%3e%3ca%20href%3d%22https%3a%2f%2fbuuoj.cn%2fchallenges%23%255BWindows%255DUpload-Labs-Windows%22%3ewindows%e7%8e%af%e5%a2%83%3c%2fa%3e%3c%2fli%3e%0a%3c%2ful%3e%0a%3ch2%20id%3d%22pass-01%22%3ePass-01%3c%2fh2%3e%0a%3cp%3e%e2%80%8b%09%e5%b0%9d%e8%af%95%e4%b8%8a%e4%bc%a0php%e6%9c%a8%e9%a9%ac%ef%bc%8c%e5%8f%91%e7%8e%b0%e6%8f%90%e7%a4%ba%e4%b8%8a%e4%bc%a0%e9%94%99%e8%af%af%3c%2fp%3e%0a%3cp%3e%3cimg%20src%3d%22https%3a%2f%2fs1.ax1x.com%2f2020%2f11%2f08%2fBTKbfs.png%22%20alt%3d%22%22%3e%3c%2fp%3e%0a%3cp%3e%e2%80%8b%09%e6%8f%90%e7%a4%ba%e5%8f%aa%e8%83%bd%e4%b8%8a%e4%bc%a0%3ccode%3ejpg%e3%80%81png%e3%80%81gif%3c%2fcode%3e%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%9b%be%e7%89%87%e3%80%82%e6%9f%a5%e7%9c%8b%e6%ba%90%e7%a0%81%e5%8f%91%e7%8e%b0%e6%98%af%e4%b8%80%e4%b8%aa%e5%89%8d%e7%ab%af%e7%9a%84%e5%90%8e%e7%bc%80%e8%bf%87%e6%bb%a4%ef%bc%8c%e9%82%a3%e4%b9%88%e6%88%91%e4%bb%ac%e5%b0%9d%e8%af%95%e7%bb%95%e8%bf%87%e5%89%8d%e7%ab%af%e7%9a%84JS%e4%bb%a3%e7%a0%81%e3%80%82%3c%2fp%3e%0a%3cp%3e%e2%80%8b%09%e6%ba%90%e7%a0%81%ef%bc%9a%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-javascript%22%20data-lang%3d%22javascript%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3efunction%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3echeckFile%3c%2fspan%3e%28%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evar%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20document.%3cspan%20style%3d%22color%3a%23a6e22e%22%3egetElementsByName%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%29%5b%3cspan%20style%3d%22color%3a%23ae81ff%22%3e0%3c%2fspan%3e%5d.%3cspan%20style%3d%22color%3a%23a6e22e%22%3evalue%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3enull%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%7c%7c%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%26%2334%3b%3c%2fspan%3e%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3ealert%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%e8%af%b7%e9%80%89%e6%8b%a9%e8%a6%81%e4%b8%8a%e4%bc%a0%e7%9a%84%e6%96%87%e4%bb%b6%21%26%2334%3b%3c%2fspan%3e%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ereturn%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3efalse%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2375715e%22%3e%2f%2f%e5%ae%9a%e4%b9%89%e5%85%81%e8%ae%b8%e4%b8%8a%e4%bc%a0%e7%9a%84%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2375715e%22%3e%3c%2fspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evar%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eallow_ext%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b.jpg%7c.png%7c.gif%26%2334%3b%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2375715e%22%3e%2f%2f%e6%8f%90%e5%8f%96%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6%e7%9a%84%e7%b1%bb%e5%9e%8b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2375715e%22%3e%3c%2fspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evar%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eext_name%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e.%3cspan%20style%3d%22color%3a%23a6e22e%22%3esubstring%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile%3c%2fspan%3e.%3cspan%20style%3d%22color%3a%23a6e22e%22%3elastIndexOf%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b.%26%2334%3b%3c%2fspan%3e%29%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2375715e%22%3e%2f%2f%e5%88%a4%e6%96%ad%e4%b8%8a%e4%bc%a0%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e6%98%af%e5%90%a6%e5%85%81%e8%ae%b8%e4%b8%8a%e4%bc%a0%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2375715e%22%3e%3c%2fspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eallow_ext%3c%2fspan%3e.%3cspan%20style%3d%22color%3a%23a6e22e%22%3eindexOf%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eext_name%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%7c%26%2334%3b%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e-%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23ae81ff%22%3e1%3c%2fspan%3e%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3evar%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eerrMsg%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%e8%af%a5%e6%96%87%e4%bb%b6%e4%b8%8d%e5%85%81%e8%ae%b8%e4%b8%8a%e4%bc%a0%ef%bc%8c%e8%af%b7%e4%b8%8a%e4%bc%a0%26%2334%3b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eallow_ext%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2334%3b%e7%b1%bb%e5%9e%8b%e7%9a%84%e6%96%87%e4%bb%b6%2c%e5%bd%93%e5%89%8d%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e4%b8%ba%ef%bc%9a%26%2334%3b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%2b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eext_name%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3ealert%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eerrMsg%3c%2fspan%3e%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3ereturn%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3efalse%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%e2%80%8b%09%e6%8a%8a%e6%96%87%e4%bb%b6%e5%90%8e%e7%bc%80%e5%90%8d%e6%94%b9%e6%88%90jpg%e6%a0%bc%e5%bc%8f%e4%b8%8a%e4%bc%a0%ef%bc%8c%e4%bd%bf%e7%94%a8%3cstrong%3eburp%20suit%3c%2fstrong%3e%e6%8a%93%e5%8c%85%e3%80%82%e6%8a%8a%3ccode%3e.jpg%3c%2fcode%3e%e5%90%8e%e7%bc%80%e9%87%8d%e6%96%b0%e6%94%b9%e4%b8%ba%3ccode%3e.php%3c%2fcode%3e%e5%8d%b3%e5%8f%af%e5%ae%9e%e7%8e%b0%e7%bb%95%e8%bf%87%e5%89%8d%e7%ab%afJS%e4%bb%a3%e7%a0%81%e3%80%82%3c%2fp%3e%0a%3cp%3e%3cimg%20src%3d%22https%3a%2f%2fs1.ax1x.com%2f2020%2f11%2f08%2fBTM5g1.png%22%20alt%3d%22%22%3e%3c%2fp%3e%0a%3cp%3e%e2%80%8b%09%e7%84%b6%e5%90%8e%e5%8f%b3%e9%94%ae%e6%89%93%e5%bc%80%e5%9b%be%e7%89%87%ef%bc%8c%e4%bb%a3%e7%a0%81%e6%88%90%e5%8a%9f%e6%89%a7%e8%a1%8c%e3%80%82%e5%ae%8c%e5%b7%a5%3c%2fp%3e%0a%3cp%3e%3cimg%20src%3d%22https%3a%2f%2fs1.ax1x.com%2f2020%2f11%2f08%2fBTQV8s.png%22%20alt%3d%22%22%3e%3c%2fp%3e%0a%3cp%3e%e2%80%8b%09%e6%b3%a8%ef%bc%9a%e5%90%8e%e9%9d%a2%e9%a2%98%e7%9b%ae%e7%9a%84php%e4%bb%a3%e7%a0%81%e9%83%bd%e4%bd%bf%e7%94%a8%3ccode%3e2333.php%3c%2fcode%3e%ef%bc%9a%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-php%22%20data-lang%3d%22php%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e%26lt%3b%3f%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23a6e22e%22%3ephp%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eeval%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3ephpinfo%3c%2fspan%3e%28%29%29%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%e2%80%8b%09%e6%89%a7%e8%a1%8c%e7%bb%93%e6%9e%9c%e6%98%af%e6%89%93%e5%8d%b0%e5%87%baphp%e7%89%88%e6%9c%ac%e4%bf%a1%e6%81%af%e3%80%82%3c%2fp%3e%0a%3ch2%20id%3d%22pass-02%22%3ePass-02%3c%2fh2%3e%0a%3cp%3e%e2%80%8b%09%e6%ba%90%e7%a0%81%ef%bc%9a%3c%2fp%3e%0a%3cdiv%20class%3d%22highlight%22%3e%3cpre%20tabindex%3d%220%22%20style%3d%22color%3a%23f8f8f2%3bbackground-color%3a%23272822%3b-moz-tab-size%3a4%3b-o-tab-size%3a4%3btab-size%3a4%3b%22%3e%3ccode%20class%3d%22language-php%22%20data-lang%3d%22php%22%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%24is_upload%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3efalse%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%24msg%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3enull%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eisset%3c%2fspan%3e%28%24_POST%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bsubmit%26%2339%3b%3c%2fspan%3e%5d%29%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3efile_exists%3c%2fspan%3e%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3eUPLOAD_PATH%3c%2fspan%3e%29%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%28%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3btype%26%2339%3b%3c%2fspan%3e%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bimage%2fjpeg%26%2339%3b%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%7c%7c%3c%2fspan%3e%20%28%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3btype%26%2339%3b%3c%2fspan%3e%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bimage%2fpng%26%2339%3b%3c%2fspan%3e%29%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%7c%7c%3c%2fspan%3e%20%28%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3btype%26%2339%3b%3c%2fspan%3e%5d%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bimage%2fgif%26%2339%3b%3c%2fspan%3e%29%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%24temp_file%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3btmp_name%26%2339%3b%3c%2fspan%3e%5d%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%24img_path%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eUPLOAD_PATH%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e.%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3b%2f%26%2339%3b%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23f92672%22%3e.%3c%2fspan%3e%20%24_FILES%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bupload_file%26%2339%3b%3c%2fspan%3e%5d%5b%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3bname%26%2339%3b%3c%2fspan%3e%5d%20%20%20%20%20%20%20%20%20%20%20%20%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eif%3c%2fspan%3e%20%28%3cspan%20style%3d%22color%3a%23a6e22e%22%3emove_uploaded_file%3c%2fspan%3e%28%24temp_file%2c%20%24img_path%29%29%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24is_upload%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3etrue%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%7d%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eelse%3c%2fspan%3e%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%24msg%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3b%e4%b8%8a%e4%bc%a0%e5%87%ba%e9%94%99%ef%bc%81%26%2339%3b%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%7d%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eelse%3c%2fspan%3e%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%20%20%20%20%24msg%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3b%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e4%b8%8d%e6%ad%a3%e7%a1%ae%ef%bc%8c%e8%af%b7%e9%87%8d%e6%96%b0%e4%b8%8a%e4%bc%a0%ef%bc%81%26%2339%3b%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%7d%20%3cspan%20style%3d%22color%3a%2366d9ef%22%3eelse%3c%2fspan%3e%20%7b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%20%20%20%20%24msg%20%3cspan%20style%3d%22color%3a%23f92672%22%3e%3d%3c%2fspan%3e%20%3cspan%20style%3d%22color%3a%23a6e22e%22%3eUPLOAD_PATH%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23f92672%22%3e.%3c%2fspan%3e%3cspan%20style%3d%22color%3a%23e6db74%22%3e%26%2339%3b%e6%96%87%e4%bb%b6%e5%a4%b9%e4%b8%8d%e5%ad%98%e5%9c%a8%2c%e8%af%b7%e6%89%8b%e5%b7%a5%e5%88%9b%e5%bb%ba%ef%bc%81%26%2339%3b%3c%2fspan%3e%3b%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%20%20%20%20%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3cspan%20style%3d%22display%3aflex%3b%22%3e%3cspan%3e%7d%0a%3c%2fspan%3e%3c%2fspan%3e%3c%2fcode%3e%3c%2fpre%3e%3c%2fdiv%3e%3cp%3e%e2%80%8b%09%e5%8f%91%e7%8e%b0%e6%96%87%e4%bb%b6%e5%88%a4%e6%96%ad%e6%98%af%e6%a0%b9%e6%8d%ae%3ccode%3eimage%2fjpeg%e3%80%81image%2fpng...%3c%2fcode%3e%e8%bf%9b%e8%a1%8c%e8%bf%87%e6%bb%a4%e5%88%a4%e5%ae%9a%ef%bc%8c%e8%bf%99%e4%ba%9b%e5%80%bc%e9%83%bd%e6%98%afHttp%e8%af%b7%e6%b1%82%e4%b8%ad%e7%9a%84%3cstrong%3eContent-Type%3c%2fstrong%3e%e5%b8%b8%e8%a7%81%e7%9a%84%e5%80%bc%ef%bc%8c%e9%80%9a%e5%b8%b8%e6%b5%8f%e8%a7%88%e7%bd%91%e9%a1%b5%e4%b8%ad%e5%90%84%e7%a7%8d%e5%90%84%e6%a0%b7%e7%9a%84%e6%96%87%e4%bb%b6%e7%b1%bb%e5%9e%8b%e7%9a%84%e5%b0%b1%e6%98%af%e9%80%9a%e8%bf%87%e5%ae%83%e5%88%a4%e6%96%ad%e3%80%82%e9%82%a3%e4%b9%88%e8%bf%99%e9%81%93%e9%a2%98%e7%9a%84%e7%9b%ae%e6%a0%87%e5%b0%b1%e6%98%af%e7%bb%95%e8%bf%87%e5%ae%83%e3%80%82%e8%b4%b4%e4%b8%80%e4%b8%aa%e6%88%91%e5%8f%82%e8%80%83%e5%80%bc%e7%a7%8d%e7%b1%bb%e7%9a%84%e5%8d%9a%e5%ae%a2%3a%3ca%20href%3d%22https%3a%2f%2fwww.cnblogs.com%2fklb561%2fp%2f10090540.html%22%3eHttp%e8%af%b7%e6%b1%82%e4%b8%adContent-Type%3c%2fa%3e%e3%80%82%3c%2fp%3e" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=%2fposts%2fctf%2fupload-labs1%2f&t=Upload-Labs%28%e4%b8%80%29" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=toc-toggle class=icon href=# onclick='return $("#toc-footer").toggle(),!1' aria-label=TOC><i class="fas fa-list fa-lg" aria-hidden=true></i> TOC</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2024</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Writings</a></li><li><a href=/tags>Tags</a></li><li><a href=/about>About</a></li><li><a href=/friends>Friends</a></li><li><a href>开往</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>